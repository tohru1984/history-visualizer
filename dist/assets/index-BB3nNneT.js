(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))y(b);new MutationObserver(b=>{for(const E of b)if(E.type==="childList")for(const S of E.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&y(S)}).observe(document,{childList:!0,subtree:!0});function h(b){const E={};return b.integrity&&(E.integrity=b.integrity),b.referrerPolicy&&(E.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?E.credentials="include":b.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function y(b){if(b.ep)return;b.ep=!0;const E=h(b);fetch(b.href,E)}})();var Kw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $v(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Zv={exports:{}},ip={},qv={exports:{}},At={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xc=Symbol.for("react.element"),Jw=Symbol.for("react.portal"),Yw=Symbol.for("react.fragment"),Qw=Symbol.for("react.strict_mode"),eb=Symbol.for("react.profiler"),tb=Symbol.for("react.provider"),rb=Symbol.for("react.context"),ib=Symbol.for("react.forward_ref"),nb=Symbol.for("react.suspense"),sb=Symbol.for("react.memo"),ab=Symbol.for("react.lazy"),M_=Symbol.iterator;function ob(i){return i===null||typeof i!="object"?null:(i=M_&&i[M_]||i["@@iterator"],typeof i=="function"?i:null)}var Gv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Hv=Object.assign,Wv={};function eu(i,a,h){this.props=i,this.context=a,this.refs=Wv,this.updater=h||Gv}eu.prototype.isReactComponent={};eu.prototype.setState=function(i,a){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,a,"setState")};eu.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function Xv(){}Xv.prototype=eu.prototype;function tg(i,a,h){this.props=i,this.context=a,this.refs=Wv,this.updater=h||Gv}var rg=tg.prototype=new Xv;rg.constructor=tg;Hv(rg,eu.prototype);rg.isPureReactComponent=!0;var D_=Array.isArray,Kv=Object.prototype.hasOwnProperty,ig={current:null},Jv={key:!0,ref:!0,__self:!0,__source:!0};function Yv(i,a,h){var y,b={},E=null,S=null;if(a!=null)for(y in a.ref!==void 0&&(S=a.ref),a.key!==void 0&&(E=""+a.key),a)Kv.call(a,y)&&!Jv.hasOwnProperty(y)&&(b[y]=a[y]);var d=arguments.length-2;if(d===1)b.children=h;else if(1<d){for(var H=Array(d),le=0;le<d;le++)H[le]=arguments[le+2];b.children=H}if(i&&i.defaultProps)for(y in d=i.defaultProps,d)b[y]===void 0&&(b[y]=d[y]);return{$$typeof:Xc,type:i,key:E,ref:S,props:b,_owner:ig.current}}function lb(i,a){return{$$typeof:Xc,type:i.type,key:a,ref:i.ref,props:i.props,_owner:i._owner}}function ng(i){return typeof i=="object"&&i!==null&&i.$$typeof===Xc}function ub(i){var a={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(h){return a[h]})}var L_=/\/+/g;function Rf(i,a){return typeof i=="object"&&i!==null&&i.key!=null?ub(""+i.key):a.toString(36)}function wd(i,a,h,y,b){var E=typeof i;(E==="undefined"||E==="boolean")&&(i=null);var S=!1;if(i===null)S=!0;else switch(E){case"string":case"number":S=!0;break;case"object":switch(i.$$typeof){case Xc:case Jw:S=!0}}if(S)return S=i,b=b(S),i=y===""?"."+Rf(S,0):y,D_(b)?(h="",i!=null&&(h=i.replace(L_,"$&/")+"/"),wd(b,a,h,"",function(le){return le})):b!=null&&(ng(b)&&(b=lb(b,h+(!b.key||S&&S.key===b.key?"":(""+b.key).replace(L_,"$&/")+"/")+i)),a.push(b)),1;if(S=0,y=y===""?".":y+":",D_(i))for(var d=0;d<i.length;d++){E=i[d];var H=y+Rf(E,d);S+=wd(E,a,h,H,b)}else if(H=ob(i),typeof H=="function")for(i=H.call(i),d=0;!(E=i.next()).done;)E=E.value,H=y+Rf(E,d++),S+=wd(E,a,h,H,b);else if(E==="object")throw a=String(i),Error("Objects are not valid as a React child (found: "+(a==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":a)+"). If you meant to render a collection of children, use an array instead.");return S}function rd(i,a,h){if(i==null)return i;var y=[],b=0;return wd(i,y,"","",function(E){return a.call(h,E,b++)}),y}function cb(i){if(i._status===-1){var a=i._result;a=a(),a.then(function(h){(i._status===0||i._status===-1)&&(i._status=1,i._result=h)},function(h){(i._status===0||i._status===-1)&&(i._status=2,i._result=h)}),i._status===-1&&(i._status=0,i._result=a)}if(i._status===1)return i._result.default;throw i._result}var Ai={current:null},bd={transition:null},hb={ReactCurrentDispatcher:Ai,ReactCurrentBatchConfig:bd,ReactCurrentOwner:ig};function Qv(){throw Error("act(...) is not supported in production builds of React.")}At.Children={map:rd,forEach:function(i,a,h){rd(i,function(){a.apply(this,arguments)},h)},count:function(i){var a=0;return rd(i,function(){a++}),a},toArray:function(i){return rd(i,function(a){return a})||[]},only:function(i){if(!ng(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};At.Component=eu;At.Fragment=Yw;At.Profiler=eb;At.PureComponent=tg;At.StrictMode=Qw;At.Suspense=nb;At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=hb;At.act=Qv;At.cloneElement=function(i,a,h){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var y=Hv({},i.props),b=i.key,E=i.ref,S=i._owner;if(a!=null){if(a.ref!==void 0&&(E=a.ref,S=ig.current),a.key!==void 0&&(b=""+a.key),i.type&&i.type.defaultProps)var d=i.type.defaultProps;for(H in a)Kv.call(a,H)&&!Jv.hasOwnProperty(H)&&(y[H]=a[H]===void 0&&d!==void 0?d[H]:a[H])}var H=arguments.length-2;if(H===1)y.children=h;else if(1<H){d=Array(H);for(var le=0;le<H;le++)d[le]=arguments[le+2];y.children=d}return{$$typeof:Xc,type:i.type,key:b,ref:E,props:y,_owner:S}};At.createContext=function(i){return i={$$typeof:rb,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:tb,_context:i},i.Consumer=i};At.createElement=Yv;At.createFactory=function(i){var a=Yv.bind(null,i);return a.type=i,a};At.createRef=function(){return{current:null}};At.forwardRef=function(i){return{$$typeof:ib,render:i}};At.isValidElement=ng;At.lazy=function(i){return{$$typeof:ab,_payload:{_status:-1,_result:i},_init:cb}};At.memo=function(i,a){return{$$typeof:sb,type:i,compare:a===void 0?null:a}};At.startTransition=function(i){var a=bd.transition;bd.transition={};try{i()}finally{bd.transition=a}};At.unstable_act=Qv;At.useCallback=function(i,a){return Ai.current.useCallback(i,a)};At.useContext=function(i){return Ai.current.useContext(i)};At.useDebugValue=function(){};At.useDeferredValue=function(i){return Ai.current.useDeferredValue(i)};At.useEffect=function(i,a){return Ai.current.useEffect(i,a)};At.useId=function(){return Ai.current.useId()};At.useImperativeHandle=function(i,a,h){return Ai.current.useImperativeHandle(i,a,h)};At.useInsertionEffect=function(i,a){return Ai.current.useInsertionEffect(i,a)};At.useLayoutEffect=function(i,a){return Ai.current.useLayoutEffect(i,a)};At.useMemo=function(i,a){return Ai.current.useMemo(i,a)};At.useReducer=function(i,a,h){return Ai.current.useReducer(i,a,h)};At.useRef=function(i){return Ai.current.useRef(i)};At.useState=function(i){return Ai.current.useState(i)};At.useSyncExternalStore=function(i,a,h){return Ai.current.useSyncExternalStore(i,a,h)};At.useTransition=function(){return Ai.current.useTransition()};At.version="18.3.1";qv.exports=At;var Sr=qv.exports;const db=$v(Sr);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pb=Sr,fb=Symbol.for("react.element"),mb=Symbol.for("react.fragment"),gb=Object.prototype.hasOwnProperty,yb=pb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,_b={key:!0,ref:!0,__self:!0,__source:!0};function ex(i,a,h){var y,b={},E=null,S=null;h!==void 0&&(E=""+h),a.key!==void 0&&(E=""+a.key),a.ref!==void 0&&(S=a.ref);for(y in a)gb.call(a,y)&&!_b.hasOwnProperty(y)&&(b[y]=a[y]);if(i&&i.defaultProps)for(y in a=i.defaultProps,a)b[y]===void 0&&(b[y]=a[y]);return{$$typeof:fb,type:i,key:E,ref:S,props:b,_owner:yb.current}}ip.Fragment=mb;ip.jsx=ex;ip.jsxs=ex;Zv.exports=ip;var we=Zv.exports,lm={},tx={exports:{}},dn={},rx={exports:{}},ix={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function a(Xe,ct){var dt=Xe.length;Xe.push(ct);e:for(;0<dt;){var Tt=dt-1>>>1,Bt=Xe[Tt];if(0<b(Bt,ct))Xe[Tt]=ct,Xe[dt]=Bt,dt=Tt;else break e}}function h(Xe){return Xe.length===0?null:Xe[0]}function y(Xe){if(Xe.length===0)return null;var ct=Xe[0],dt=Xe.pop();if(dt!==ct){Xe[0]=dt;e:for(var Tt=0,Bt=Xe.length,oi=Bt>>>1;Tt<oi;){var Ir=2*(Tt+1)-1,Jr=Xe[Ir],Nr=Ir+1,ke=Xe[Nr];if(0>b(Jr,dt))Nr<Bt&&0>b(ke,Jr)?(Xe[Tt]=ke,Xe[Nr]=dt,Tt=Nr):(Xe[Tt]=Jr,Xe[Ir]=dt,Tt=Ir);else if(Nr<Bt&&0>b(ke,dt))Xe[Tt]=ke,Xe[Nr]=dt,Tt=Nr;else break e}}return ct}function b(Xe,ct){var dt=Xe.sortIndex-ct.sortIndex;return dt!==0?dt:Xe.id-ct.id}if(typeof performance=="object"&&typeof performance.now=="function"){var E=performance;i.unstable_now=function(){return E.now()}}else{var S=Date,d=S.now();i.unstable_now=function(){return S.now()-d}}var H=[],le=[],ve=1,ne=null,G=3,Re=!1,Fe=!1,Ne=!1,It=typeof setTimeout=="function"?setTimeout:null,ue=typeof clearTimeout=="function"?clearTimeout:null,re=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function de(Xe){for(var ct=h(le);ct!==null;){if(ct.callback===null)y(le);else if(ct.startTime<=Xe)y(le),ct.sortIndex=ct.expirationTime,a(H,ct);else break;ct=h(le)}}function Te(Xe){if(Ne=!1,de(Xe),!Fe)if(h(H)!==null)Fe=!0,Kr(Ue);else{var ct=h(le);ct!==null&&Or(Te,ct.startTime-Xe)}}function Ue(Xe,ct){Fe=!1,Ne&&(Ne=!1,ue(it),it=-1),Re=!0;var dt=G;try{for(de(ct),ne=h(H);ne!==null&&(!(ne.expirationTime>ct)||Xe&&!gt());){var Tt=ne.callback;if(typeof Tt=="function"){ne.callback=null,G=ne.priorityLevel;var Bt=Tt(ne.expirationTime<=ct);ct=i.unstable_now(),typeof Bt=="function"?ne.callback=Bt:ne===h(H)&&y(H),de(ct)}else y(H);ne=h(H)}if(ne!==null)var oi=!0;else{var Ir=h(le);Ir!==null&&Or(Te,Ir.startTime-ct),oi=!1}return oi}finally{ne=null,G=dt,Re=!1}}var Ge=!1,We=null,it=-1,Mt=5,pt=-1;function gt(){return!(i.unstable_now()-pt<Mt)}function fr(){if(We!==null){var Xe=i.unstable_now();pt=Xe;var ct=!0;try{ct=We(!0,Xe)}finally{ct?Xt():(Ge=!1,We=null)}}else Ge=!1}var Xt;if(typeof re=="function")Xt=function(){re(fr)};else if(typeof MessageChannel<"u"){var ur=new MessageChannel,wt=ur.port2;ur.port1.onmessage=fr,Xt=function(){wt.postMessage(null)}}else Xt=function(){It(fr,0)};function Kr(Xe){We=Xe,Ge||(Ge=!0,Xt())}function Or(Xe,ct){it=It(function(){Xe(i.unstable_now())},ct)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(Xe){Xe.callback=null},i.unstable_continueExecution=function(){Fe||Re||(Fe=!0,Kr(Ue))},i.unstable_forceFrameRate=function(Xe){0>Xe||125<Xe?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Mt=0<Xe?Math.floor(1e3/Xe):5},i.unstable_getCurrentPriorityLevel=function(){return G},i.unstable_getFirstCallbackNode=function(){return h(H)},i.unstable_next=function(Xe){switch(G){case 1:case 2:case 3:var ct=3;break;default:ct=G}var dt=G;G=ct;try{return Xe()}finally{G=dt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(Xe,ct){switch(Xe){case 1:case 2:case 3:case 4:case 5:break;default:Xe=3}var dt=G;G=Xe;try{return ct()}finally{G=dt}},i.unstable_scheduleCallback=function(Xe,ct,dt){var Tt=i.unstable_now();switch(typeof dt=="object"&&dt!==null?(dt=dt.delay,dt=typeof dt=="number"&&0<dt?Tt+dt:Tt):dt=Tt,Xe){case 1:var Bt=-1;break;case 2:Bt=250;break;case 5:Bt=1073741823;break;case 4:Bt=1e4;break;default:Bt=5e3}return Bt=dt+Bt,Xe={id:ve++,callback:ct,priorityLevel:Xe,startTime:dt,expirationTime:Bt,sortIndex:-1},dt>Tt?(Xe.sortIndex=dt,a(le,Xe),h(H)===null&&Xe===h(le)&&(Ne?(ue(it),it=-1):Ne=!0,Or(Te,dt-Tt))):(Xe.sortIndex=Bt,a(H,Xe),Fe||Re||(Fe=!0,Kr(Ue))),Xe},i.unstable_shouldYield=gt,i.unstable_wrapCallback=function(Xe){var ct=G;return function(){var dt=G;G=ct;try{return Xe.apply(this,arguments)}finally{G=dt}}}})(ix);rx.exports=ix;var vb=rx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xb=Sr,hn=vb;function Ce(i){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+i,h=1;h<arguments.length;h++)a+="&args[]="+encodeURIComponent(arguments[h]);return"Minified React error #"+i+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var nx=new Set,Mc={};function Mo(i,a){Hl(i,a),Hl(i+"Capture",a)}function Hl(i,a){for(Mc[i]=a,i=0;i<a.length;i++)nx.add(a[i])}var Fs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),um=Object.prototype.hasOwnProperty,wb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,R_={},F_={};function bb(i){return um.call(F_,i)?!0:um.call(R_,i)?!1:wb.test(i)?F_[i]=!0:(R_[i]=!0,!1)}function Sb(i,a,h,y){if(h!==null&&h.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return y?!1:h!==null?!h.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Tb(i,a,h,y){if(a===null||typeof a>"u"||Sb(i,a,h,y))return!0;if(y)return!1;if(h!==null)switch(h.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function Mi(i,a,h,y,b,E,S){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=y,this.attributeNamespace=b,this.mustUseProperty=h,this.propertyName=i,this.type=a,this.sanitizeURL=E,this.removeEmptyString=S}var ai={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){ai[i]=new Mi(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var a=i[0];ai[a]=new Mi(a,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){ai[i]=new Mi(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){ai[i]=new Mi(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){ai[i]=new Mi(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){ai[i]=new Mi(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){ai[i]=new Mi(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){ai[i]=new Mi(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){ai[i]=new Mi(i,5,!1,i.toLowerCase(),null,!1,!1)});var sg=/[\-:]([a-z])/g;function ag(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var a=i.replace(sg,ag);ai[a]=new Mi(a,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var a=i.replace(sg,ag);ai[a]=new Mi(a,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var a=i.replace(sg,ag);ai[a]=new Mi(a,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){ai[i]=new Mi(i,1,!1,i.toLowerCase(),null,!1,!1)});ai.xlinkHref=new Mi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){ai[i]=new Mi(i,1,!1,i.toLowerCase(),null,!0,!0)});function og(i,a,h,y){var b=ai.hasOwnProperty(a)?ai[a]:null;(b!==null?b.type!==0:y||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(Tb(a,h,b,y)&&(h=null),y||b===null?bb(a)&&(h===null?i.removeAttribute(a):i.setAttribute(a,""+h)):b.mustUseProperty?i[b.propertyName]=h===null?b.type===3?!1:"":h:(a=b.attributeName,y=b.attributeNamespace,h===null?i.removeAttribute(a):(b=b.type,h=b===3||b===4&&h===!0?"":""+h,y?i.setAttributeNS(y,a,h):i.setAttribute(a,h))))}var js=xb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,id=Symbol.for("react.element"),Pl=Symbol.for("react.portal"),zl=Symbol.for("react.fragment"),lg=Symbol.for("react.strict_mode"),cm=Symbol.for("react.profiler"),sx=Symbol.for("react.provider"),ax=Symbol.for("react.context"),ug=Symbol.for("react.forward_ref"),hm=Symbol.for("react.suspense"),dm=Symbol.for("react.suspense_list"),cg=Symbol.for("react.memo"),Sa=Symbol.for("react.lazy"),ox=Symbol.for("react.offscreen"),B_=Symbol.iterator;function hc(i){return i===null||typeof i!="object"?null:(i=B_&&i[B_]||i["@@iterator"],typeof i=="function"?i:null)}var vr=Object.assign,Ff;function vc(i){if(Ff===void 0)try{throw Error()}catch(h){var a=h.stack.trim().match(/\n( *(at )?)/);Ff=a&&a[1]||""}return`
`+Ff+i}var Bf=!1;function Of(i,a){if(!i||Bf)return"";Bf=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(le){var y=le}Reflect.construct(i,[],a)}else{try{a.call()}catch(le){y=le}i.call(a.prototype)}else{try{throw Error()}catch(le){y=le}i()}}catch(le){if(le&&y&&typeof le.stack=="string"){for(var b=le.stack.split(`
`),E=y.stack.split(`
`),S=b.length-1,d=E.length-1;1<=S&&0<=d&&b[S]!==E[d];)d--;for(;1<=S&&0<=d;S--,d--)if(b[S]!==E[d]){if(S!==1||d!==1)do if(S--,d--,0>d||b[S]!==E[d]){var H=`
`+b[S].replace(" at new "," at ");return i.displayName&&H.includes("<anonymous>")&&(H=H.replace("<anonymous>",i.displayName)),H}while(1<=S&&0<=d);break}}}finally{Bf=!1,Error.prepareStackTrace=h}return(i=i?i.displayName||i.name:"")?vc(i):""}function kb(i){switch(i.tag){case 5:return vc(i.type);case 16:return vc("Lazy");case 13:return vc("Suspense");case 19:return vc("SuspenseList");case 0:case 2:case 15:return i=Of(i.type,!1),i;case 11:return i=Of(i.type.render,!1),i;case 1:return i=Of(i.type,!0),i;default:return""}}function pm(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case zl:return"Fragment";case Pl:return"Portal";case cm:return"Profiler";case lg:return"StrictMode";case hm:return"Suspense";case dm:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case ax:return(i.displayName||"Context")+".Consumer";case sx:return(i._context.displayName||"Context")+".Provider";case ug:var a=i.render;return i=i.displayName,i||(i=a.displayName||a.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case cg:return a=i.displayName||null,a!==null?a:pm(i.type)||"Memo";case Sa:a=i._payload,i=i._init;try{return pm(i(a))}catch{}}return null}function Eb(i){var a=i.type;switch(i.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=a.render,i=i.displayName||i.name||"",a.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pm(a);case 8:return a===lg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function Ba(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function lx(i){var a=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ib(i){var a=lx(i)?"checked":"value",h=Object.getOwnPropertyDescriptor(i.constructor.prototype,a),y=""+i[a];if(!i.hasOwnProperty(a)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var b=h.get,E=h.set;return Object.defineProperty(i,a,{configurable:!0,get:function(){return b.call(this)},set:function(S){y=""+S,E.call(this,S)}}),Object.defineProperty(i,a,{enumerable:h.enumerable}),{getValue:function(){return y},setValue:function(S){y=""+S},stopTracking:function(){i._valueTracker=null,delete i[a]}}}}function nd(i){i._valueTracker||(i._valueTracker=Ib(i))}function ux(i){if(!i)return!1;var a=i._valueTracker;if(!a)return!0;var h=a.getValue(),y="";return i&&(y=lx(i)?i.checked?"true":"false":i.value),i=y,i!==h?(a.setValue(i),!0):!1}function Dd(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function fm(i,a){var h=a.checked;return vr({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:h??i._wrapperState.initialChecked})}function O_(i,a){var h=a.defaultValue==null?"":a.defaultValue,y=a.checked!=null?a.checked:a.defaultChecked;h=Ba(a.value!=null?a.value:h),i._wrapperState={initialChecked:y,initialValue:h,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function cx(i,a){a=a.checked,a!=null&&og(i,"checked",a,!1)}function mm(i,a){cx(i,a);var h=Ba(a.value),y=a.type;if(h!=null)y==="number"?(h===0&&i.value===""||i.value!=h)&&(i.value=""+h):i.value!==""+h&&(i.value=""+h);else if(y==="submit"||y==="reset"){i.removeAttribute("value");return}a.hasOwnProperty("value")?gm(i,a.type,h):a.hasOwnProperty("defaultValue")&&gm(i,a.type,Ba(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(i.defaultChecked=!!a.defaultChecked)}function N_(i,a,h){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var y=a.type;if(!(y!=="submit"&&y!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+i._wrapperState.initialValue,h||a===i.value||(i.value=a),i.defaultValue=a}h=i.name,h!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,h!==""&&(i.name=h)}function gm(i,a,h){(a!=="number"||Dd(i.ownerDocument)!==i)&&(h==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+h&&(i.defaultValue=""+h))}var xc=Array.isArray;function Vl(i,a,h,y){if(i=i.options,a){a={};for(var b=0;b<h.length;b++)a["$"+h[b]]=!0;for(h=0;h<i.length;h++)b=a.hasOwnProperty("$"+i[h].value),i[h].selected!==b&&(i[h].selected=b),b&&y&&(i[h].defaultSelected=!0)}else{for(h=""+Ba(h),a=null,b=0;b<i.length;b++){if(i[b].value===h){i[b].selected=!0,y&&(i[b].defaultSelected=!0);return}a!==null||i[b].disabled||(a=i[b])}a!==null&&(a.selected=!0)}}function ym(i,a){if(a.dangerouslySetInnerHTML!=null)throw Error(Ce(91));return vr({},a,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function j_(i,a){var h=a.value;if(h==null){if(h=a.children,a=a.defaultValue,h!=null){if(a!=null)throw Error(Ce(92));if(xc(h)){if(1<h.length)throw Error(Ce(93));h=h[0]}a=h}a==null&&(a=""),h=a}i._wrapperState={initialValue:Ba(h)}}function hx(i,a){var h=Ba(a.value),y=Ba(a.defaultValue);h!=null&&(h=""+h,h!==i.value&&(i.value=h),a.defaultValue==null&&i.defaultValue!==h&&(i.defaultValue=h)),y!=null&&(i.defaultValue=""+y)}function V_(i){var a=i.textContent;a===i._wrapperState.initialValue&&a!==""&&a!==null&&(i.value=a)}function dx(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _m(i,a){return i==null||i==="http://www.w3.org/1999/xhtml"?dx(a):i==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var sd,px=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,h,y,b){MSApp.execUnsafeLocalFunction(function(){return i(a,h,y,b)})}:i}(function(i,a){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=a;else{for(sd=sd||document.createElement("div"),sd.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=sd.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;a.firstChild;)i.appendChild(a.firstChild)}});function Dc(i,a){if(a){var h=i.firstChild;if(h&&h===i.lastChild&&h.nodeType===3){h.nodeValue=a;return}}i.textContent=a}var Sc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Cb=["Webkit","ms","Moz","O"];Object.keys(Sc).forEach(function(i){Cb.forEach(function(a){a=a+i.charAt(0).toUpperCase()+i.substring(1),Sc[a]=Sc[i]})});function fx(i,a,h){return a==null||typeof a=="boolean"||a===""?"":h||typeof a!="number"||a===0||Sc.hasOwnProperty(i)&&Sc[i]?(""+a).trim():a+"px"}function mx(i,a){i=i.style;for(var h in a)if(a.hasOwnProperty(h)){var y=h.indexOf("--")===0,b=fx(h,a[h],y);h==="float"&&(h="cssFloat"),y?i.setProperty(h,b):i[h]=b}}var Pb=vr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function vm(i,a){if(a){if(Pb[i]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(Ce(137,i));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(Ce(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(Ce(61))}if(a.style!=null&&typeof a.style!="object")throw Error(Ce(62))}}function xm(i,a){if(i.indexOf("-")===-1)return typeof a.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wm=null;function hg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var bm=null,Ul=null,$l=null;function U_(i){if(i=Yc(i)){if(typeof bm!="function")throw Error(Ce(280));var a=i.stateNode;a&&(a=lp(a),bm(i.stateNode,i.type,a))}}function gx(i){Ul?$l?$l.push(i):$l=[i]:Ul=i}function yx(){if(Ul){var i=Ul,a=$l;if($l=Ul=null,U_(i),a)for(i=0;i<a.length;i++)U_(a[i])}}function _x(i,a){return i(a)}function vx(){}var Nf=!1;function xx(i,a,h){if(Nf)return i(a,h);Nf=!0;try{return _x(i,a,h)}finally{Nf=!1,(Ul!==null||$l!==null)&&(vx(),yx())}}function Lc(i,a){var h=i.stateNode;if(h===null)return null;var y=lp(h);if(y===null)return null;h=y[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(i=i.type,y=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!y;break e;default:i=!1}if(i)return null;if(h&&typeof h!="function")throw Error(Ce(231,a,typeof h));return h}var Sm=!1;if(Fs)try{var dc={};Object.defineProperty(dc,"passive",{get:function(){Sm=!0}}),window.addEventListener("test",dc,dc),window.removeEventListener("test",dc,dc)}catch{Sm=!1}function zb(i,a,h,y,b,E,S,d,H){var le=Array.prototype.slice.call(arguments,3);try{a.apply(h,le)}catch(ve){this.onError(ve)}}var Tc=!1,Ld=null,Rd=!1,Tm=null,Ab={onError:function(i){Tc=!0,Ld=i}};function Mb(i,a,h,y,b,E,S,d,H){Tc=!1,Ld=null,zb.apply(Ab,arguments)}function Db(i,a,h,y,b,E,S,d,H){if(Mb.apply(this,arguments),Tc){if(Tc){var le=Ld;Tc=!1,Ld=null}else throw Error(Ce(198));Rd||(Rd=!0,Tm=le)}}function Do(i){var a=i,h=i;if(i.alternate)for(;a.return;)a=a.return;else{i=a;do a=i,a.flags&4098&&(h=a.return),i=a.return;while(i)}return a.tag===3?h:null}function wx(i){if(i.tag===13){var a=i.memoizedState;if(a===null&&(i=i.alternate,i!==null&&(a=i.memoizedState)),a!==null)return a.dehydrated}return null}function $_(i){if(Do(i)!==i)throw Error(Ce(188))}function Lb(i){var a=i.alternate;if(!a){if(a=Do(i),a===null)throw Error(Ce(188));return a!==i?null:i}for(var h=i,y=a;;){var b=h.return;if(b===null)break;var E=b.alternate;if(E===null){if(y=b.return,y!==null){h=y;continue}break}if(b.child===E.child){for(E=b.child;E;){if(E===h)return $_(b),i;if(E===y)return $_(b),a;E=E.sibling}throw Error(Ce(188))}if(h.return!==y.return)h=b,y=E;else{for(var S=!1,d=b.child;d;){if(d===h){S=!0,h=b,y=E;break}if(d===y){S=!0,y=b,h=E;break}d=d.sibling}if(!S){for(d=E.child;d;){if(d===h){S=!0,h=E,y=b;break}if(d===y){S=!0,y=E,h=b;break}d=d.sibling}if(!S)throw Error(Ce(189))}}if(h.alternate!==y)throw Error(Ce(190))}if(h.tag!==3)throw Error(Ce(188));return h.stateNode.current===h?i:a}function bx(i){return i=Lb(i),i!==null?Sx(i):null}function Sx(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var a=Sx(i);if(a!==null)return a;i=i.sibling}return null}var Tx=hn.unstable_scheduleCallback,Z_=hn.unstable_cancelCallback,Rb=hn.unstable_shouldYield,Fb=hn.unstable_requestPaint,Er=hn.unstable_now,Bb=hn.unstable_getCurrentPriorityLevel,dg=hn.unstable_ImmediatePriority,kx=hn.unstable_UserBlockingPriority,Fd=hn.unstable_NormalPriority,Ob=hn.unstable_LowPriority,Ex=hn.unstable_IdlePriority,np=null,os=null;function Nb(i){if(os&&typeof os.onCommitFiberRoot=="function")try{os.onCommitFiberRoot(np,i,void 0,(i.current.flags&128)===128)}catch{}}var $n=Math.clz32?Math.clz32:Ub,jb=Math.log,Vb=Math.LN2;function Ub(i){return i>>>=0,i===0?32:31-(jb(i)/Vb|0)|0}var ad=64,od=4194304;function wc(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Bd(i,a){var h=i.pendingLanes;if(h===0)return 0;var y=0,b=i.suspendedLanes,E=i.pingedLanes,S=h&268435455;if(S!==0){var d=S&~b;d!==0?y=wc(d):(E&=S,E!==0&&(y=wc(E)))}else S=h&~b,S!==0?y=wc(S):E!==0&&(y=wc(E));if(y===0)return 0;if(a!==0&&a!==y&&!(a&b)&&(b=y&-y,E=a&-a,b>=E||b===16&&(E&4194240)!==0))return a;if(y&4&&(y|=h&16),a=i.entangledLanes,a!==0)for(i=i.entanglements,a&=y;0<a;)h=31-$n(a),b=1<<h,y|=i[h],a&=~b;return y}function $b(i,a){switch(i){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zb(i,a){for(var h=i.suspendedLanes,y=i.pingedLanes,b=i.expirationTimes,E=i.pendingLanes;0<E;){var S=31-$n(E),d=1<<S,H=b[S];H===-1?(!(d&h)||d&y)&&(b[S]=$b(d,a)):H<=a&&(i.expiredLanes|=d),E&=~d}}function km(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Ix(){var i=ad;return ad<<=1,!(ad&4194240)&&(ad=64),i}function jf(i){for(var a=[],h=0;31>h;h++)a.push(i);return a}function Kc(i,a,h){i.pendingLanes|=a,a!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,a=31-$n(a),i[a]=h}function qb(i,a){var h=i.pendingLanes&~a;i.pendingLanes=a,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=a,i.mutableReadLanes&=a,i.entangledLanes&=a,a=i.entanglements;var y=i.eventTimes;for(i=i.expirationTimes;0<h;){var b=31-$n(h),E=1<<b;a[b]=0,y[b]=-1,i[b]=-1,h&=~E}}function pg(i,a){var h=i.entangledLanes|=a;for(i=i.entanglements;h;){var y=31-$n(h),b=1<<y;b&a|i[y]&a&&(i[y]|=a),h&=~b}}var Wt=0;function Cx(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Px,fg,zx,Ax,Mx,Em=!1,ld=[],Pa=null,za=null,Aa=null,Rc=new Map,Fc=new Map,ka=[],Gb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function q_(i,a){switch(i){case"focusin":case"focusout":Pa=null;break;case"dragenter":case"dragleave":za=null;break;case"mouseover":case"mouseout":Aa=null;break;case"pointerover":case"pointerout":Rc.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Fc.delete(a.pointerId)}}function pc(i,a,h,y,b,E){return i===null||i.nativeEvent!==E?(i={blockedOn:a,domEventName:h,eventSystemFlags:y,nativeEvent:E,targetContainers:[b]},a!==null&&(a=Yc(a),a!==null&&fg(a)),i):(i.eventSystemFlags|=y,a=i.targetContainers,b!==null&&a.indexOf(b)===-1&&a.push(b),i)}function Hb(i,a,h,y,b){switch(a){case"focusin":return Pa=pc(Pa,i,a,h,y,b),!0;case"dragenter":return za=pc(za,i,a,h,y,b),!0;case"mouseover":return Aa=pc(Aa,i,a,h,y,b),!0;case"pointerover":var E=b.pointerId;return Rc.set(E,pc(Rc.get(E)||null,i,a,h,y,b)),!0;case"gotpointercapture":return E=b.pointerId,Fc.set(E,pc(Fc.get(E)||null,i,a,h,y,b)),!0}return!1}function Dx(i){var a=bo(i.target);if(a!==null){var h=Do(a);if(h!==null){if(a=h.tag,a===13){if(a=wx(h),a!==null){i.blockedOn=a,Mx(i.priority,function(){zx(h)});return}}else if(a===3&&h.stateNode.current.memoizedState.isDehydrated){i.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Sd(i){if(i.blockedOn!==null)return!1;for(var a=i.targetContainers;0<a.length;){var h=Im(i.domEventName,i.eventSystemFlags,a[0],i.nativeEvent);if(h===null){h=i.nativeEvent;var y=new h.constructor(h.type,h);wm=y,h.target.dispatchEvent(y),wm=null}else return a=Yc(h),a!==null&&fg(a),i.blockedOn=h,!1;a.shift()}return!0}function G_(i,a,h){Sd(i)&&h.delete(a)}function Wb(){Em=!1,Pa!==null&&Sd(Pa)&&(Pa=null),za!==null&&Sd(za)&&(za=null),Aa!==null&&Sd(Aa)&&(Aa=null),Rc.forEach(G_),Fc.forEach(G_)}function fc(i,a){i.blockedOn===a&&(i.blockedOn=null,Em||(Em=!0,hn.unstable_scheduleCallback(hn.unstable_NormalPriority,Wb)))}function Bc(i){function a(b){return fc(b,i)}if(0<ld.length){fc(ld[0],i);for(var h=1;h<ld.length;h++){var y=ld[h];y.blockedOn===i&&(y.blockedOn=null)}}for(Pa!==null&&fc(Pa,i),za!==null&&fc(za,i),Aa!==null&&fc(Aa,i),Rc.forEach(a),Fc.forEach(a),h=0;h<ka.length;h++)y=ka[h],y.blockedOn===i&&(y.blockedOn=null);for(;0<ka.length&&(h=ka[0],h.blockedOn===null);)Dx(h),h.blockedOn===null&&ka.shift()}var Zl=js.ReactCurrentBatchConfig,Od=!0;function Xb(i,a,h,y){var b=Wt,E=Zl.transition;Zl.transition=null;try{Wt=1,mg(i,a,h,y)}finally{Wt=b,Zl.transition=E}}function Kb(i,a,h,y){var b=Wt,E=Zl.transition;Zl.transition=null;try{Wt=4,mg(i,a,h,y)}finally{Wt=b,Zl.transition=E}}function mg(i,a,h,y){if(Od){var b=Im(i,a,h,y);if(b===null)Kf(i,a,y,Nd,h),q_(i,y);else if(Hb(b,i,a,h,y))y.stopPropagation();else if(q_(i,y),a&4&&-1<Gb.indexOf(i)){for(;b!==null;){var E=Yc(b);if(E!==null&&Px(E),E=Im(i,a,h,y),E===null&&Kf(i,a,y,Nd,h),E===b)break;b=E}b!==null&&y.stopPropagation()}else Kf(i,a,y,null,h)}}var Nd=null;function Im(i,a,h,y){if(Nd=null,i=hg(y),i=bo(i),i!==null)if(a=Do(i),a===null)i=null;else if(h=a.tag,h===13){if(i=wx(a),i!==null)return i;i=null}else if(h===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null);return Nd=i,null}function Lx(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Bb()){case dg:return 1;case kx:return 4;case Fd:case Ob:return 16;case Ex:return 536870912;default:return 16}default:return 16}}var Ia=null,gg=null,Td=null;function Rx(){if(Td)return Td;var i,a=gg,h=a.length,y,b="value"in Ia?Ia.value:Ia.textContent,E=b.length;for(i=0;i<h&&a[i]===b[i];i++);var S=h-i;for(y=1;y<=S&&a[h-y]===b[E-y];y++);return Td=b.slice(i,1<y?1-y:void 0)}function kd(i){var a=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&a===13&&(i=13)):i=a,i===10&&(i=13),32<=i||i===13?i:0}function ud(){return!0}function H_(){return!1}function pn(i){function a(h,y,b,E,S){this._reactName=h,this._targetInst=b,this.type=y,this.nativeEvent=E,this.target=S,this.currentTarget=null;for(var d in i)i.hasOwnProperty(d)&&(h=i[d],this[d]=h?h(E):E[d]);return this.isDefaultPrevented=(E.defaultPrevented!=null?E.defaultPrevented:E.returnValue===!1)?ud:H_,this.isPropagationStopped=H_,this}return vr(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=ud)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=ud)},persist:function(){},isPersistent:ud}),a}var tu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yg=pn(tu),Jc=vr({},tu,{view:0,detail:0}),Jb=pn(Jc),Vf,Uf,mc,sp=vr({},Jc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_g,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==mc&&(mc&&i.type==="mousemove"?(Vf=i.screenX-mc.screenX,Uf=i.screenY-mc.screenY):Uf=Vf=0,mc=i),Vf)},movementY:function(i){return"movementY"in i?i.movementY:Uf}}),W_=pn(sp),Yb=vr({},sp,{dataTransfer:0}),Qb=pn(Yb),e2=vr({},Jc,{relatedTarget:0}),$f=pn(e2),t2=vr({},tu,{animationName:0,elapsedTime:0,pseudoElement:0}),r2=pn(t2),i2=vr({},tu,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),n2=pn(i2),s2=vr({},tu,{data:0}),X_=pn(s2),a2={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},o2={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},l2={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function u2(i){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(i):(i=l2[i])?!!a[i]:!1}function _g(){return u2}var c2=vr({},Jc,{key:function(i){if(i.key){var a=a2[i.key]||i.key;if(a!=="Unidentified")return a}return i.type==="keypress"?(i=kd(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?o2[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_g,charCode:function(i){return i.type==="keypress"?kd(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?kd(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),h2=pn(c2),d2=vr({},sp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),K_=pn(d2),p2=vr({},Jc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_g}),f2=pn(p2),m2=vr({},tu,{propertyName:0,elapsedTime:0,pseudoElement:0}),g2=pn(m2),y2=vr({},sp,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),_2=pn(y2),v2=[9,13,27,32],vg=Fs&&"CompositionEvent"in window,kc=null;Fs&&"documentMode"in document&&(kc=document.documentMode);var x2=Fs&&"TextEvent"in window&&!kc,Fx=Fs&&(!vg||kc&&8<kc&&11>=kc),J_=" ",Y_=!1;function Bx(i,a){switch(i){case"keyup":return v2.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ox(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Al=!1;function w2(i,a){switch(i){case"compositionend":return Ox(a);case"keypress":return a.which!==32?null:(Y_=!0,J_);case"textInput":return i=a.data,i===J_&&Y_?null:i;default:return null}}function b2(i,a){if(Al)return i==="compositionend"||!vg&&Bx(i,a)?(i=Rx(),Td=gg=Ia=null,Al=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return Fx&&a.locale!=="ko"?null:a.data;default:return null}}var S2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Q_(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a==="input"?!!S2[i.type]:a==="textarea"}function Nx(i,a,h,y){gx(y),a=jd(a,"onChange"),0<a.length&&(h=new yg("onChange","change",null,h,y),i.push({event:h,listeners:a}))}var Ec=null,Oc=null;function T2(i){Kx(i,0)}function ap(i){var a=Ll(i);if(ux(a))return i}function k2(i,a){if(i==="change")return a}var jx=!1;if(Fs){var Zf;if(Fs){var qf="oninput"in document;if(!qf){var ev=document.createElement("div");ev.setAttribute("oninput","return;"),qf=typeof ev.oninput=="function"}Zf=qf}else Zf=!1;jx=Zf&&(!document.documentMode||9<document.documentMode)}function tv(){Ec&&(Ec.detachEvent("onpropertychange",Vx),Oc=Ec=null)}function Vx(i){if(i.propertyName==="value"&&ap(Oc)){var a=[];Nx(a,Oc,i,hg(i)),xx(T2,a)}}function E2(i,a,h){i==="focusin"?(tv(),Ec=a,Oc=h,Ec.attachEvent("onpropertychange",Vx)):i==="focusout"&&tv()}function I2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ap(Oc)}function C2(i,a){if(i==="click")return ap(a)}function P2(i,a){if(i==="input"||i==="change")return ap(a)}function z2(i,a){return i===a&&(i!==0||1/i===1/a)||i!==i&&a!==a}var qn=typeof Object.is=="function"?Object.is:z2;function Nc(i,a){if(qn(i,a))return!0;if(typeof i!="object"||i===null||typeof a!="object"||a===null)return!1;var h=Object.keys(i),y=Object.keys(a);if(h.length!==y.length)return!1;for(y=0;y<h.length;y++){var b=h[y];if(!um.call(a,b)||!qn(i[b],a[b]))return!1}return!0}function rv(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function iv(i,a){var h=rv(i);i=0;for(var y;h;){if(h.nodeType===3){if(y=i+h.textContent.length,i<=a&&y>=a)return{node:h,offset:a-i};i=y}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=rv(h)}}function Ux(i,a){return i&&a?i===a?!0:i&&i.nodeType===3?!1:a&&a.nodeType===3?Ux(i,a.parentNode):"contains"in i?i.contains(a):i.compareDocumentPosition?!!(i.compareDocumentPosition(a)&16):!1:!1}function $x(){for(var i=window,a=Dd();a instanceof i.HTMLIFrameElement;){try{var h=typeof a.contentWindow.location.href=="string"}catch{h=!1}if(h)i=a.contentWindow;else break;a=Dd(i.document)}return a}function xg(i){var a=i&&i.nodeName&&i.nodeName.toLowerCase();return a&&(a==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||a==="textarea"||i.contentEditable==="true")}function A2(i){var a=$x(),h=i.focusedElem,y=i.selectionRange;if(a!==h&&h&&h.ownerDocument&&Ux(h.ownerDocument.documentElement,h)){if(y!==null&&xg(h)){if(a=y.start,i=y.end,i===void 0&&(i=a),"selectionStart"in h)h.selectionStart=a,h.selectionEnd=Math.min(i,h.value.length);else if(i=(a=h.ownerDocument||document)&&a.defaultView||window,i.getSelection){i=i.getSelection();var b=h.textContent.length,E=Math.min(y.start,b);y=y.end===void 0?E:Math.min(y.end,b),!i.extend&&E>y&&(b=y,y=E,E=b),b=iv(h,E);var S=iv(h,y);b&&S&&(i.rangeCount!==1||i.anchorNode!==b.node||i.anchorOffset!==b.offset||i.focusNode!==S.node||i.focusOffset!==S.offset)&&(a=a.createRange(),a.setStart(b.node,b.offset),i.removeAllRanges(),E>y?(i.addRange(a),i.extend(S.node,S.offset)):(a.setEnd(S.node,S.offset),i.addRange(a)))}}for(a=[],i=h;i=i.parentNode;)i.nodeType===1&&a.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof h.focus=="function"&&h.focus(),h=0;h<a.length;h++)i=a[h],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var M2=Fs&&"documentMode"in document&&11>=document.documentMode,Ml=null,Cm=null,Ic=null,Pm=!1;function nv(i,a,h){var y=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;Pm||Ml==null||Ml!==Dd(y)||(y=Ml,"selectionStart"in y&&xg(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),Ic&&Nc(Ic,y)||(Ic=y,y=jd(Cm,"onSelect"),0<y.length&&(a=new yg("onSelect","select",null,a,h),i.push({event:a,listeners:y}),a.target=Ml)))}function cd(i,a){var h={};return h[i.toLowerCase()]=a.toLowerCase(),h["Webkit"+i]="webkit"+a,h["Moz"+i]="moz"+a,h}var Dl={animationend:cd("Animation","AnimationEnd"),animationiteration:cd("Animation","AnimationIteration"),animationstart:cd("Animation","AnimationStart"),transitionend:cd("Transition","TransitionEnd")},Gf={},Zx={};Fs&&(Zx=document.createElement("div").style,"AnimationEvent"in window||(delete Dl.animationend.animation,delete Dl.animationiteration.animation,delete Dl.animationstart.animation),"TransitionEvent"in window||delete Dl.transitionend.transition);function op(i){if(Gf[i])return Gf[i];if(!Dl[i])return i;var a=Dl[i],h;for(h in a)if(a.hasOwnProperty(h)&&h in Zx)return Gf[i]=a[h];return i}var qx=op("animationend"),Gx=op("animationiteration"),Hx=op("animationstart"),Wx=op("transitionend"),Xx=new Map,sv="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Na(i,a){Xx.set(i,a),Mo(a,[i])}for(var Hf=0;Hf<sv.length;Hf++){var Wf=sv[Hf],D2=Wf.toLowerCase(),L2=Wf[0].toUpperCase()+Wf.slice(1);Na(D2,"on"+L2)}Na(qx,"onAnimationEnd");Na(Gx,"onAnimationIteration");Na(Hx,"onAnimationStart");Na("dblclick","onDoubleClick");Na("focusin","onFocus");Na("focusout","onBlur");Na(Wx,"onTransitionEnd");Hl("onMouseEnter",["mouseout","mouseover"]);Hl("onMouseLeave",["mouseout","mouseover"]);Hl("onPointerEnter",["pointerout","pointerover"]);Hl("onPointerLeave",["pointerout","pointerover"]);Mo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mo("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),R2=new Set("cancel close invalid load scroll toggle".split(" ").concat(bc));function av(i,a,h){var y=i.type||"unknown-event";i.currentTarget=h,Db(y,a,void 0,i),i.currentTarget=null}function Kx(i,a){a=(a&4)!==0;for(var h=0;h<i.length;h++){var y=i[h],b=y.event;y=y.listeners;e:{var E=void 0;if(a)for(var S=y.length-1;0<=S;S--){var d=y[S],H=d.instance,le=d.currentTarget;if(d=d.listener,H!==E&&b.isPropagationStopped())break e;av(b,d,le),E=H}else for(S=0;S<y.length;S++){if(d=y[S],H=d.instance,le=d.currentTarget,d=d.listener,H!==E&&b.isPropagationStopped())break e;av(b,d,le),E=H}}}if(Rd)throw i=Tm,Rd=!1,Tm=null,i}function or(i,a){var h=a[Lm];h===void 0&&(h=a[Lm]=new Set);var y=i+"__bubble";h.has(y)||(Jx(a,i,2,!1),h.add(y))}function Xf(i,a,h){var y=0;a&&(y|=4),Jx(h,i,y,a)}var hd="_reactListening"+Math.random().toString(36).slice(2);function jc(i){if(!i[hd]){i[hd]=!0,nx.forEach(function(h){h!=="selectionchange"&&(R2.has(h)||Xf(h,!1,i),Xf(h,!0,i))});var a=i.nodeType===9?i:i.ownerDocument;a===null||a[hd]||(a[hd]=!0,Xf("selectionchange",!1,a))}}function Jx(i,a,h,y){switch(Lx(a)){case 1:var b=Xb;break;case 4:b=Kb;break;default:b=mg}h=b.bind(null,a,h,i),b=void 0,!Sm||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(b=!0),y?b!==void 0?i.addEventListener(a,h,{capture:!0,passive:b}):i.addEventListener(a,h,!0):b!==void 0?i.addEventListener(a,h,{passive:b}):i.addEventListener(a,h,!1)}function Kf(i,a,h,y,b){var E=y;if(!(a&1)&&!(a&2)&&y!==null)e:for(;;){if(y===null)return;var S=y.tag;if(S===3||S===4){var d=y.stateNode.containerInfo;if(d===b||d.nodeType===8&&d.parentNode===b)break;if(S===4)for(S=y.return;S!==null;){var H=S.tag;if((H===3||H===4)&&(H=S.stateNode.containerInfo,H===b||H.nodeType===8&&H.parentNode===b))return;S=S.return}for(;d!==null;){if(S=bo(d),S===null)return;if(H=S.tag,H===5||H===6){y=E=S;continue e}d=d.parentNode}}y=y.return}xx(function(){var le=E,ve=hg(h),ne=[];e:{var G=Xx.get(i);if(G!==void 0){var Re=yg,Fe=i;switch(i){case"keypress":if(kd(h)===0)break e;case"keydown":case"keyup":Re=h2;break;case"focusin":Fe="focus",Re=$f;break;case"focusout":Fe="blur",Re=$f;break;case"beforeblur":case"afterblur":Re=$f;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Re=W_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Re=Qb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Re=f2;break;case qx:case Gx:case Hx:Re=r2;break;case Wx:Re=g2;break;case"scroll":Re=Jb;break;case"wheel":Re=_2;break;case"copy":case"cut":case"paste":Re=n2;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Re=K_}var Ne=(a&4)!==0,It=!Ne&&i==="scroll",ue=Ne?G!==null?G+"Capture":null:G;Ne=[];for(var re=le,de;re!==null;){de=re;var Te=de.stateNode;if(de.tag===5&&Te!==null&&(de=Te,ue!==null&&(Te=Lc(re,ue),Te!=null&&Ne.push(Vc(re,Te,de)))),It)break;re=re.return}0<Ne.length&&(G=new Re(G,Fe,null,h,ve),ne.push({event:G,listeners:Ne}))}}if(!(a&7)){e:{if(G=i==="mouseover"||i==="pointerover",Re=i==="mouseout"||i==="pointerout",G&&h!==wm&&(Fe=h.relatedTarget||h.fromElement)&&(bo(Fe)||Fe[Bs]))break e;if((Re||G)&&(G=ve.window===ve?ve:(G=ve.ownerDocument)?G.defaultView||G.parentWindow:window,Re?(Fe=h.relatedTarget||h.toElement,Re=le,Fe=Fe?bo(Fe):null,Fe!==null&&(It=Do(Fe),Fe!==It||Fe.tag!==5&&Fe.tag!==6)&&(Fe=null)):(Re=null,Fe=le),Re!==Fe)){if(Ne=W_,Te="onMouseLeave",ue="onMouseEnter",re="mouse",(i==="pointerout"||i==="pointerover")&&(Ne=K_,Te="onPointerLeave",ue="onPointerEnter",re="pointer"),It=Re==null?G:Ll(Re),de=Fe==null?G:Ll(Fe),G=new Ne(Te,re+"leave",Re,h,ve),G.target=It,G.relatedTarget=de,Te=null,bo(ve)===le&&(Ne=new Ne(ue,re+"enter",Fe,h,ve),Ne.target=de,Ne.relatedTarget=It,Te=Ne),It=Te,Re&&Fe)t:{for(Ne=Re,ue=Fe,re=0,de=Ne;de;de=Cl(de))re++;for(de=0,Te=ue;Te;Te=Cl(Te))de++;for(;0<re-de;)Ne=Cl(Ne),re--;for(;0<de-re;)ue=Cl(ue),de--;for(;re--;){if(Ne===ue||ue!==null&&Ne===ue.alternate)break t;Ne=Cl(Ne),ue=Cl(ue)}Ne=null}else Ne=null;Re!==null&&ov(ne,G,Re,Ne,!1),Fe!==null&&It!==null&&ov(ne,It,Fe,Ne,!0)}}e:{if(G=le?Ll(le):window,Re=G.nodeName&&G.nodeName.toLowerCase(),Re==="select"||Re==="input"&&G.type==="file")var Ue=k2;else if(Q_(G))if(jx)Ue=P2;else{Ue=I2;var Ge=E2}else(Re=G.nodeName)&&Re.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Ue=C2);if(Ue&&(Ue=Ue(i,le))){Nx(ne,Ue,h,ve);break e}Ge&&Ge(i,G,le),i==="focusout"&&(Ge=G._wrapperState)&&Ge.controlled&&G.type==="number"&&gm(G,"number",G.value)}switch(Ge=le?Ll(le):window,i){case"focusin":(Q_(Ge)||Ge.contentEditable==="true")&&(Ml=Ge,Cm=le,Ic=null);break;case"focusout":Ic=Cm=Ml=null;break;case"mousedown":Pm=!0;break;case"contextmenu":case"mouseup":case"dragend":Pm=!1,nv(ne,h,ve);break;case"selectionchange":if(M2)break;case"keydown":case"keyup":nv(ne,h,ve)}var We;if(vg)e:{switch(i){case"compositionstart":var it="onCompositionStart";break e;case"compositionend":it="onCompositionEnd";break e;case"compositionupdate":it="onCompositionUpdate";break e}it=void 0}else Al?Bx(i,h)&&(it="onCompositionEnd"):i==="keydown"&&h.keyCode===229&&(it="onCompositionStart");it&&(Fx&&h.locale!=="ko"&&(Al||it!=="onCompositionStart"?it==="onCompositionEnd"&&Al&&(We=Rx()):(Ia=ve,gg="value"in Ia?Ia.value:Ia.textContent,Al=!0)),Ge=jd(le,it),0<Ge.length&&(it=new X_(it,i,null,h,ve),ne.push({event:it,listeners:Ge}),We?it.data=We:(We=Ox(h),We!==null&&(it.data=We)))),(We=x2?w2(i,h):b2(i,h))&&(le=jd(le,"onBeforeInput"),0<le.length&&(ve=new X_("onBeforeInput","beforeinput",null,h,ve),ne.push({event:ve,listeners:le}),ve.data=We))}Kx(ne,a)})}function Vc(i,a,h){return{instance:i,listener:a,currentTarget:h}}function jd(i,a){for(var h=a+"Capture",y=[];i!==null;){var b=i,E=b.stateNode;b.tag===5&&E!==null&&(b=E,E=Lc(i,h),E!=null&&y.unshift(Vc(i,E,b)),E=Lc(i,a),E!=null&&y.push(Vc(i,E,b))),i=i.return}return y}function Cl(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function ov(i,a,h,y,b){for(var E=a._reactName,S=[];h!==null&&h!==y;){var d=h,H=d.alternate,le=d.stateNode;if(H!==null&&H===y)break;d.tag===5&&le!==null&&(d=le,b?(H=Lc(h,E),H!=null&&S.unshift(Vc(h,H,d))):b||(H=Lc(h,E),H!=null&&S.push(Vc(h,H,d)))),h=h.return}S.length!==0&&i.push({event:a,listeners:S})}var F2=/\r\n?/g,B2=/\u0000|\uFFFD/g;function lv(i){return(typeof i=="string"?i:""+i).replace(F2,`
`).replace(B2,"")}function dd(i,a,h){if(a=lv(a),lv(i)!==a&&h)throw Error(Ce(425))}function Vd(){}var zm=null,Am=null;function Mm(i,a){return i==="textarea"||i==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Dm=typeof setTimeout=="function"?setTimeout:void 0,O2=typeof clearTimeout=="function"?clearTimeout:void 0,uv=typeof Promise=="function"?Promise:void 0,N2=typeof queueMicrotask=="function"?queueMicrotask:typeof uv<"u"?function(i){return uv.resolve(null).then(i).catch(j2)}:Dm;function j2(i){setTimeout(function(){throw i})}function Jf(i,a){var h=a,y=0;do{var b=h.nextSibling;if(i.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"){if(y===0){i.removeChild(b),Bc(a);return}y--}else h!=="$"&&h!=="$?"&&h!=="$!"||y++;h=b}while(h);Bc(a)}function Ma(i){for(;i!=null;i=i.nextSibling){var a=i.nodeType;if(a===1||a===3)break;if(a===8){if(a=i.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return i}function cv(i){i=i.previousSibling;for(var a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="$"||h==="$!"||h==="$?"){if(a===0)return i;a--}else h==="/$"&&a++}i=i.previousSibling}return null}var ru=Math.random().toString(36).slice(2),as="__reactFiber$"+ru,Uc="__reactProps$"+ru,Bs="__reactContainer$"+ru,Lm="__reactEvents$"+ru,V2="__reactListeners$"+ru,U2="__reactHandles$"+ru;function bo(i){var a=i[as];if(a)return a;for(var h=i.parentNode;h;){if(a=h[Bs]||h[as]){if(h=a.alternate,a.child!==null||h!==null&&h.child!==null)for(i=cv(i);i!==null;){if(h=i[as])return h;i=cv(i)}return a}i=h,h=i.parentNode}return null}function Yc(i){return i=i[as]||i[Bs],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Ll(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(Ce(33))}function lp(i){return i[Uc]||null}var Rm=[],Rl=-1;function ja(i){return{current:i}}function lr(i){0>Rl||(i.current=Rm[Rl],Rm[Rl]=null,Rl--)}function ir(i,a){Rl++,Rm[Rl]=i.current,i.current=a}var Oa={},xi=ja(Oa),qi=ja(!1),Io=Oa;function Wl(i,a){var h=i.type.contextTypes;if(!h)return Oa;var y=i.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===a)return y.__reactInternalMemoizedMaskedChildContext;var b={},E;for(E in h)b[E]=a[E];return y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=a,i.__reactInternalMemoizedMaskedChildContext=b),b}function Gi(i){return i=i.childContextTypes,i!=null}function Ud(){lr(qi),lr(xi)}function hv(i,a,h){if(xi.current!==Oa)throw Error(Ce(168));ir(xi,a),ir(qi,h)}function Yx(i,a,h){var y=i.stateNode;if(a=a.childContextTypes,typeof y.getChildContext!="function")return h;y=y.getChildContext();for(var b in y)if(!(b in a))throw Error(Ce(108,Eb(i)||"Unknown",b));return vr({},h,y)}function $d(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Oa,Io=xi.current,ir(xi,i),ir(qi,qi.current),!0}function dv(i,a,h){var y=i.stateNode;if(!y)throw Error(Ce(169));h?(i=Yx(i,a,Io),y.__reactInternalMemoizedMergedChildContext=i,lr(qi),lr(xi),ir(xi,i)):lr(qi),ir(qi,h)}var Ms=null,up=!1,Yf=!1;function Qx(i){Ms===null?Ms=[i]:Ms.push(i)}function $2(i){up=!0,Qx(i)}function Va(){if(!Yf&&Ms!==null){Yf=!0;var i=0,a=Wt;try{var h=Ms;for(Wt=1;i<h.length;i++){var y=h[i];do y=y(!0);while(y!==null)}Ms=null,up=!1}catch(b){throw Ms!==null&&(Ms=Ms.slice(i+1)),Tx(dg,Va),b}finally{Wt=a,Yf=!1}}return null}var Fl=[],Bl=0,Zd=null,qd=0,kn=[],En=0,Co=null,Ds=1,Ls="";function xo(i,a){Fl[Bl++]=qd,Fl[Bl++]=Zd,Zd=i,qd=a}function e0(i,a,h){kn[En++]=Ds,kn[En++]=Ls,kn[En++]=Co,Co=i;var y=Ds;i=Ls;var b=32-$n(y)-1;y&=~(1<<b),h+=1;var E=32-$n(a)+b;if(30<E){var S=b-b%5;E=(y&(1<<S)-1).toString(32),y>>=S,b-=S,Ds=1<<32-$n(a)+b|h<<b|y,Ls=E+i}else Ds=1<<E|h<<b|y,Ls=i}function wg(i){i.return!==null&&(xo(i,1),e0(i,1,0))}function bg(i){for(;i===Zd;)Zd=Fl[--Bl],Fl[Bl]=null,qd=Fl[--Bl],Fl[Bl]=null;for(;i===Co;)Co=kn[--En],kn[En]=null,Ls=kn[--En],kn[En]=null,Ds=kn[--En],kn[En]=null}var cn=null,un=null,pr=!1,Un=null;function t0(i,a){var h=In(5,null,null,0);h.elementType="DELETED",h.stateNode=a,h.return=i,a=i.deletions,a===null?(i.deletions=[h],i.flags|=16):a.push(h)}function pv(i,a){switch(i.tag){case 5:var h=i.type;return a=a.nodeType!==1||h.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(i.stateNode=a,cn=i,un=Ma(a.firstChild),!0):!1;case 6:return a=i.pendingProps===""||a.nodeType!==3?null:a,a!==null?(i.stateNode=a,cn=i,un=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(h=Co!==null?{id:Ds,overflow:Ls}:null,i.memoizedState={dehydrated:a,treeContext:h,retryLane:1073741824},h=In(18,null,null,0),h.stateNode=a,h.return=i,i.child=h,cn=i,un=null,!0):!1;default:return!1}}function Fm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Bm(i){if(pr){var a=un;if(a){var h=a;if(!pv(i,a)){if(Fm(i))throw Error(Ce(418));a=Ma(h.nextSibling);var y=cn;a&&pv(i,a)?t0(y,h):(i.flags=i.flags&-4097|2,pr=!1,cn=i)}}else{if(Fm(i))throw Error(Ce(418));i.flags=i.flags&-4097|2,pr=!1,cn=i}}}function fv(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;cn=i}function pd(i){if(i!==cn)return!1;if(!pr)return fv(i),pr=!0,!1;var a;if((a=i.tag!==3)&&!(a=i.tag!==5)&&(a=i.type,a=a!=="head"&&a!=="body"&&!Mm(i.type,i.memoizedProps)),a&&(a=un)){if(Fm(i))throw r0(),Error(Ce(418));for(;a;)t0(i,a),a=Ma(a.nextSibling)}if(fv(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Ce(317));e:{for(i=i.nextSibling,a=0;i;){if(i.nodeType===8){var h=i.data;if(h==="/$"){if(a===0){un=Ma(i.nextSibling);break e}a--}else h!=="$"&&h!=="$!"&&h!=="$?"||a++}i=i.nextSibling}un=null}}else un=cn?Ma(i.stateNode.nextSibling):null;return!0}function r0(){for(var i=un;i;)i=Ma(i.nextSibling)}function Xl(){un=cn=null,pr=!1}function Sg(i){Un===null?Un=[i]:Un.push(i)}var Z2=js.ReactCurrentBatchConfig;function gc(i,a,h){if(i=h.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(h._owner){if(h=h._owner,h){if(h.tag!==1)throw Error(Ce(309));var y=h.stateNode}if(!y)throw Error(Ce(147,i));var b=y,E=""+i;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===E?a.ref:(a=function(S){var d=b.refs;S===null?delete d[E]:d[E]=S},a._stringRef=E,a)}if(typeof i!="string")throw Error(Ce(284));if(!h._owner)throw Error(Ce(290,i))}return i}function fd(i,a){throw i=Object.prototype.toString.call(a),Error(Ce(31,i==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":i))}function mv(i){var a=i._init;return a(i._payload)}function i0(i){function a(ue,re){if(i){var de=ue.deletions;de===null?(ue.deletions=[re],ue.flags|=16):de.push(re)}}function h(ue,re){if(!i)return null;for(;re!==null;)a(ue,re),re=re.sibling;return null}function y(ue,re){for(ue=new Map;re!==null;)re.key!==null?ue.set(re.key,re):ue.set(re.index,re),re=re.sibling;return ue}function b(ue,re){return ue=Fa(ue,re),ue.index=0,ue.sibling=null,ue}function E(ue,re,de){return ue.index=de,i?(de=ue.alternate,de!==null?(de=de.index,de<re?(ue.flags|=2,re):de):(ue.flags|=2,re)):(ue.flags|=1048576,re)}function S(ue){return i&&ue.alternate===null&&(ue.flags|=2),ue}function d(ue,re,de,Te){return re===null||re.tag!==6?(re=sm(de,ue.mode,Te),re.return=ue,re):(re=b(re,de),re.return=ue,re)}function H(ue,re,de,Te){var Ue=de.type;return Ue===zl?ve(ue,re,de.props.children,Te,de.key):re!==null&&(re.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===Sa&&mv(Ue)===re.type)?(Te=b(re,de.props),Te.ref=gc(ue,re,de),Te.return=ue,Te):(Te=Md(de.type,de.key,de.props,null,ue.mode,Te),Te.ref=gc(ue,re,de),Te.return=ue,Te)}function le(ue,re,de,Te){return re===null||re.tag!==4||re.stateNode.containerInfo!==de.containerInfo||re.stateNode.implementation!==de.implementation?(re=am(de,ue.mode,Te),re.return=ue,re):(re=b(re,de.children||[]),re.return=ue,re)}function ve(ue,re,de,Te,Ue){return re===null||re.tag!==7?(re=Eo(de,ue.mode,Te,Ue),re.return=ue,re):(re=b(re,de),re.return=ue,re)}function ne(ue,re,de){if(typeof re=="string"&&re!==""||typeof re=="number")return re=sm(""+re,ue.mode,de),re.return=ue,re;if(typeof re=="object"&&re!==null){switch(re.$$typeof){case id:return de=Md(re.type,re.key,re.props,null,ue.mode,de),de.ref=gc(ue,null,re),de.return=ue,de;case Pl:return re=am(re,ue.mode,de),re.return=ue,re;case Sa:var Te=re._init;return ne(ue,Te(re._payload),de)}if(xc(re)||hc(re))return re=Eo(re,ue.mode,de,null),re.return=ue,re;fd(ue,re)}return null}function G(ue,re,de,Te){var Ue=re!==null?re.key:null;if(typeof de=="string"&&de!==""||typeof de=="number")return Ue!==null?null:d(ue,re,""+de,Te);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case id:return de.key===Ue?H(ue,re,de,Te):null;case Pl:return de.key===Ue?le(ue,re,de,Te):null;case Sa:return Ue=de._init,G(ue,re,Ue(de._payload),Te)}if(xc(de)||hc(de))return Ue!==null?null:ve(ue,re,de,Te,null);fd(ue,de)}return null}function Re(ue,re,de,Te,Ue){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return ue=ue.get(de)||null,d(re,ue,""+Te,Ue);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case id:return ue=ue.get(Te.key===null?de:Te.key)||null,H(re,ue,Te,Ue);case Pl:return ue=ue.get(Te.key===null?de:Te.key)||null,le(re,ue,Te,Ue);case Sa:var Ge=Te._init;return Re(ue,re,de,Ge(Te._payload),Ue)}if(xc(Te)||hc(Te))return ue=ue.get(de)||null,ve(re,ue,Te,Ue,null);fd(re,Te)}return null}function Fe(ue,re,de,Te){for(var Ue=null,Ge=null,We=re,it=re=0,Mt=null;We!==null&&it<de.length;it++){We.index>it?(Mt=We,We=null):Mt=We.sibling;var pt=G(ue,We,de[it],Te);if(pt===null){We===null&&(We=Mt);break}i&&We&&pt.alternate===null&&a(ue,We),re=E(pt,re,it),Ge===null?Ue=pt:Ge.sibling=pt,Ge=pt,We=Mt}if(it===de.length)return h(ue,We),pr&&xo(ue,it),Ue;if(We===null){for(;it<de.length;it++)We=ne(ue,de[it],Te),We!==null&&(re=E(We,re,it),Ge===null?Ue=We:Ge.sibling=We,Ge=We);return pr&&xo(ue,it),Ue}for(We=y(ue,We);it<de.length;it++)Mt=Re(We,ue,it,de[it],Te),Mt!==null&&(i&&Mt.alternate!==null&&We.delete(Mt.key===null?it:Mt.key),re=E(Mt,re,it),Ge===null?Ue=Mt:Ge.sibling=Mt,Ge=Mt);return i&&We.forEach(function(gt){return a(ue,gt)}),pr&&xo(ue,it),Ue}function Ne(ue,re,de,Te){var Ue=hc(de);if(typeof Ue!="function")throw Error(Ce(150));if(de=Ue.call(de),de==null)throw Error(Ce(151));for(var Ge=Ue=null,We=re,it=re=0,Mt=null,pt=de.next();We!==null&&!pt.done;it++,pt=de.next()){We.index>it?(Mt=We,We=null):Mt=We.sibling;var gt=G(ue,We,pt.value,Te);if(gt===null){We===null&&(We=Mt);break}i&&We&&gt.alternate===null&&a(ue,We),re=E(gt,re,it),Ge===null?Ue=gt:Ge.sibling=gt,Ge=gt,We=Mt}if(pt.done)return h(ue,We),pr&&xo(ue,it),Ue;if(We===null){for(;!pt.done;it++,pt=de.next())pt=ne(ue,pt.value,Te),pt!==null&&(re=E(pt,re,it),Ge===null?Ue=pt:Ge.sibling=pt,Ge=pt);return pr&&xo(ue,it),Ue}for(We=y(ue,We);!pt.done;it++,pt=de.next())pt=Re(We,ue,it,pt.value,Te),pt!==null&&(i&&pt.alternate!==null&&We.delete(pt.key===null?it:pt.key),re=E(pt,re,it),Ge===null?Ue=pt:Ge.sibling=pt,Ge=pt);return i&&We.forEach(function(fr){return a(ue,fr)}),pr&&xo(ue,it),Ue}function It(ue,re,de,Te){if(typeof de=="object"&&de!==null&&de.type===zl&&de.key===null&&(de=de.props.children),typeof de=="object"&&de!==null){switch(de.$$typeof){case id:e:{for(var Ue=de.key,Ge=re;Ge!==null;){if(Ge.key===Ue){if(Ue=de.type,Ue===zl){if(Ge.tag===7){h(ue,Ge.sibling),re=b(Ge,de.props.children),re.return=ue,ue=re;break e}}else if(Ge.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===Sa&&mv(Ue)===Ge.type){h(ue,Ge.sibling),re=b(Ge,de.props),re.ref=gc(ue,Ge,de),re.return=ue,ue=re;break e}h(ue,Ge);break}else a(ue,Ge);Ge=Ge.sibling}de.type===zl?(re=Eo(de.props.children,ue.mode,Te,de.key),re.return=ue,ue=re):(Te=Md(de.type,de.key,de.props,null,ue.mode,Te),Te.ref=gc(ue,re,de),Te.return=ue,ue=Te)}return S(ue);case Pl:e:{for(Ge=de.key;re!==null;){if(re.key===Ge)if(re.tag===4&&re.stateNode.containerInfo===de.containerInfo&&re.stateNode.implementation===de.implementation){h(ue,re.sibling),re=b(re,de.children||[]),re.return=ue,ue=re;break e}else{h(ue,re);break}else a(ue,re);re=re.sibling}re=am(de,ue.mode,Te),re.return=ue,ue=re}return S(ue);case Sa:return Ge=de._init,It(ue,re,Ge(de._payload),Te)}if(xc(de))return Fe(ue,re,de,Te);if(hc(de))return Ne(ue,re,de,Te);fd(ue,de)}return typeof de=="string"&&de!==""||typeof de=="number"?(de=""+de,re!==null&&re.tag===6?(h(ue,re.sibling),re=b(re,de),re.return=ue,ue=re):(h(ue,re),re=sm(de,ue.mode,Te),re.return=ue,ue=re),S(ue)):h(ue,re)}return It}var Kl=i0(!0),n0=i0(!1),Gd=ja(null),Hd=null,Ol=null,Tg=null;function kg(){Tg=Ol=Hd=null}function Eg(i){var a=Gd.current;lr(Gd),i._currentValue=a}function Om(i,a,h){for(;i!==null;){var y=i.alternate;if((i.childLanes&a)!==a?(i.childLanes|=a,y!==null&&(y.childLanes|=a)):y!==null&&(y.childLanes&a)!==a&&(y.childLanes|=a),i===h)break;i=i.return}}function ql(i,a){Hd=i,Tg=Ol=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&a&&(Zi=!0),i.firstContext=null)}function Pn(i){var a=i._currentValue;if(Tg!==i)if(i={context:i,memoizedValue:a,next:null},Ol===null){if(Hd===null)throw Error(Ce(308));Ol=i,Hd.dependencies={lanes:0,firstContext:i}}else Ol=Ol.next=i;return a}var So=null;function Ig(i){So===null?So=[i]:So.push(i)}function s0(i,a,h,y){var b=a.interleaved;return b===null?(h.next=h,Ig(a)):(h.next=b.next,b.next=h),a.interleaved=h,Os(i,y)}function Os(i,a){i.lanes|=a;var h=i.alternate;for(h!==null&&(h.lanes|=a),h=i,i=i.return;i!==null;)i.childLanes|=a,h=i.alternate,h!==null&&(h.childLanes|=a),h=i,i=i.return;return h.tag===3?h.stateNode:null}var Ta=!1;function Cg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function a0(i,a){i=i.updateQueue,a.updateQueue===i&&(a.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Rs(i,a){return{eventTime:i,lane:a,tag:0,payload:null,callback:null,next:null}}function Da(i,a,h){var y=i.updateQueue;if(y===null)return null;if(y=y.shared,Nt&2){var b=y.pending;return b===null?a.next=a:(a.next=b.next,b.next=a),y.pending=a,Os(i,h)}return b=y.interleaved,b===null?(a.next=a,Ig(y)):(a.next=b.next,b.next=a),y.interleaved=a,Os(i,h)}function Ed(i,a,h){if(a=a.updateQueue,a!==null&&(a=a.shared,(h&4194240)!==0)){var y=a.lanes;y&=i.pendingLanes,h|=y,a.lanes=h,pg(i,h)}}function gv(i,a){var h=i.updateQueue,y=i.alternate;if(y!==null&&(y=y.updateQueue,h===y)){var b=null,E=null;if(h=h.firstBaseUpdate,h!==null){do{var S={eventTime:h.eventTime,lane:h.lane,tag:h.tag,payload:h.payload,callback:h.callback,next:null};E===null?b=E=S:E=E.next=S,h=h.next}while(h!==null);E===null?b=E=a:E=E.next=a}else b=E=a;h={baseState:y.baseState,firstBaseUpdate:b,lastBaseUpdate:E,shared:y.shared,effects:y.effects},i.updateQueue=h;return}i=h.lastBaseUpdate,i===null?h.firstBaseUpdate=a:i.next=a,h.lastBaseUpdate=a}function Wd(i,a,h,y){var b=i.updateQueue;Ta=!1;var E=b.firstBaseUpdate,S=b.lastBaseUpdate,d=b.shared.pending;if(d!==null){b.shared.pending=null;var H=d,le=H.next;H.next=null,S===null?E=le:S.next=le,S=H;var ve=i.alternate;ve!==null&&(ve=ve.updateQueue,d=ve.lastBaseUpdate,d!==S&&(d===null?ve.firstBaseUpdate=le:d.next=le,ve.lastBaseUpdate=H))}if(E!==null){var ne=b.baseState;S=0,ve=le=H=null,d=E;do{var G=d.lane,Re=d.eventTime;if((y&G)===G){ve!==null&&(ve=ve.next={eventTime:Re,lane:0,tag:d.tag,payload:d.payload,callback:d.callback,next:null});e:{var Fe=i,Ne=d;switch(G=a,Re=h,Ne.tag){case 1:if(Fe=Ne.payload,typeof Fe=="function"){ne=Fe.call(Re,ne,G);break e}ne=Fe;break e;case 3:Fe.flags=Fe.flags&-65537|128;case 0:if(Fe=Ne.payload,G=typeof Fe=="function"?Fe.call(Re,ne,G):Fe,G==null)break e;ne=vr({},ne,G);break e;case 2:Ta=!0}}d.callback!==null&&d.lane!==0&&(i.flags|=64,G=b.effects,G===null?b.effects=[d]:G.push(d))}else Re={eventTime:Re,lane:G,tag:d.tag,payload:d.payload,callback:d.callback,next:null},ve===null?(le=ve=Re,H=ne):ve=ve.next=Re,S|=G;if(d=d.next,d===null){if(d=b.shared.pending,d===null)break;G=d,d=G.next,G.next=null,b.lastBaseUpdate=G,b.shared.pending=null}}while(!0);if(ve===null&&(H=ne),b.baseState=H,b.firstBaseUpdate=le,b.lastBaseUpdate=ve,a=b.shared.interleaved,a!==null){b=a;do S|=b.lane,b=b.next;while(b!==a)}else E===null&&(b.shared.lanes=0);zo|=S,i.lanes=S,i.memoizedState=ne}}function yv(i,a,h){if(i=a.effects,a.effects=null,i!==null)for(a=0;a<i.length;a++){var y=i[a],b=y.callback;if(b!==null){if(y.callback=null,y=h,typeof b!="function")throw Error(Ce(191,b));b.call(y)}}}var Qc={},ls=ja(Qc),$c=ja(Qc),Zc=ja(Qc);function To(i){if(i===Qc)throw Error(Ce(174));return i}function Pg(i,a){switch(ir(Zc,a),ir($c,i),ir(ls,Qc),i=a.nodeType,i){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:_m(null,"");break;default:i=i===8?a.parentNode:a,a=i.namespaceURI||null,i=i.tagName,a=_m(a,i)}lr(ls),ir(ls,a)}function Jl(){lr(ls),lr($c),lr(Zc)}function o0(i){To(Zc.current);var a=To(ls.current),h=_m(a,i.type);a!==h&&(ir($c,i),ir(ls,h))}function zg(i){$c.current===i&&(lr(ls),lr($c))}var yr=ja(0);function Xd(i){for(var a=i;a!==null;){if(a.tag===13){var h=a.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||h.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if(a.flags&128)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var Qf=[];function Ag(){for(var i=0;i<Qf.length;i++)Qf[i]._workInProgressVersionPrimary=null;Qf.length=0}var Id=js.ReactCurrentDispatcher,em=js.ReactCurrentBatchConfig,Po=0,_r=null,Fr=null,Wr=null,Kd=!1,Cc=!1,qc=0,q2=0;function yi(){throw Error(Ce(321))}function Mg(i,a){if(a===null)return!1;for(var h=0;h<a.length&&h<i.length;h++)if(!qn(i[h],a[h]))return!1;return!0}function Dg(i,a,h,y,b,E){if(Po=E,_r=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Id.current=i===null||i.memoizedState===null?X2:K2,i=h(y,b),Cc){E=0;do{if(Cc=!1,qc=0,25<=E)throw Error(Ce(301));E+=1,Wr=Fr=null,a.updateQueue=null,Id.current=J2,i=h(y,b)}while(Cc)}if(Id.current=Jd,a=Fr!==null&&Fr.next!==null,Po=0,Wr=Fr=_r=null,Kd=!1,a)throw Error(Ce(300));return i}function Lg(){var i=qc!==0;return qc=0,i}function ss(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Wr===null?_r.memoizedState=Wr=i:Wr=Wr.next=i,Wr}function zn(){if(Fr===null){var i=_r.alternate;i=i!==null?i.memoizedState:null}else i=Fr.next;var a=Wr===null?_r.memoizedState:Wr.next;if(a!==null)Wr=a,Fr=i;else{if(i===null)throw Error(Ce(310));Fr=i,i={memoizedState:Fr.memoizedState,baseState:Fr.baseState,baseQueue:Fr.baseQueue,queue:Fr.queue,next:null},Wr===null?_r.memoizedState=Wr=i:Wr=Wr.next=i}return Wr}function Gc(i,a){return typeof a=="function"?a(i):a}function tm(i){var a=zn(),h=a.queue;if(h===null)throw Error(Ce(311));h.lastRenderedReducer=i;var y=Fr,b=y.baseQueue,E=h.pending;if(E!==null){if(b!==null){var S=b.next;b.next=E.next,E.next=S}y.baseQueue=b=E,h.pending=null}if(b!==null){E=b.next,y=y.baseState;var d=S=null,H=null,le=E;do{var ve=le.lane;if((Po&ve)===ve)H!==null&&(H=H.next={lane:0,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),y=le.hasEagerState?le.eagerState:i(y,le.action);else{var ne={lane:ve,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null};H===null?(d=H=ne,S=y):H=H.next=ne,_r.lanes|=ve,zo|=ve}le=le.next}while(le!==null&&le!==E);H===null?S=y:H.next=d,qn(y,a.memoizedState)||(Zi=!0),a.memoizedState=y,a.baseState=S,a.baseQueue=H,h.lastRenderedState=y}if(i=h.interleaved,i!==null){b=i;do E=b.lane,_r.lanes|=E,zo|=E,b=b.next;while(b!==i)}else b===null&&(h.lanes=0);return[a.memoizedState,h.dispatch]}function rm(i){var a=zn(),h=a.queue;if(h===null)throw Error(Ce(311));h.lastRenderedReducer=i;var y=h.dispatch,b=h.pending,E=a.memoizedState;if(b!==null){h.pending=null;var S=b=b.next;do E=i(E,S.action),S=S.next;while(S!==b);qn(E,a.memoizedState)||(Zi=!0),a.memoizedState=E,a.baseQueue===null&&(a.baseState=E),h.lastRenderedState=E}return[E,y]}function l0(){}function u0(i,a){var h=_r,y=zn(),b=a(),E=!qn(y.memoizedState,b);if(E&&(y.memoizedState=b,Zi=!0),y=y.queue,Rg(d0.bind(null,h,y,i),[i]),y.getSnapshot!==a||E||Wr!==null&&Wr.memoizedState.tag&1){if(h.flags|=2048,Hc(9,h0.bind(null,h,y,b,a),void 0,null),Xr===null)throw Error(Ce(349));Po&30||c0(h,a,b)}return b}function c0(i,a,h){i.flags|=16384,i={getSnapshot:a,value:h},a=_r.updateQueue,a===null?(a={lastEffect:null,stores:null},_r.updateQueue=a,a.stores=[i]):(h=a.stores,h===null?a.stores=[i]:h.push(i))}function h0(i,a,h,y){a.value=h,a.getSnapshot=y,p0(a)&&f0(i)}function d0(i,a,h){return h(function(){p0(a)&&f0(i)})}function p0(i){var a=i.getSnapshot;i=i.value;try{var h=a();return!qn(i,h)}catch{return!0}}function f0(i){var a=Os(i,1);a!==null&&Zn(a,i,1,-1)}function _v(i){var a=ss();return typeof i=="function"&&(i=i()),a.memoizedState=a.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gc,lastRenderedState:i},a.queue=i,i=i.dispatch=W2.bind(null,_r,i),[a.memoizedState,i]}function Hc(i,a,h,y){return i={tag:i,create:a,destroy:h,deps:y,next:null},a=_r.updateQueue,a===null?(a={lastEffect:null,stores:null},_r.updateQueue=a,a.lastEffect=i.next=i):(h=a.lastEffect,h===null?a.lastEffect=i.next=i:(y=h.next,h.next=i,i.next=y,a.lastEffect=i)),i}function m0(){return zn().memoizedState}function Cd(i,a,h,y){var b=ss();_r.flags|=i,b.memoizedState=Hc(1|a,h,void 0,y===void 0?null:y)}function cp(i,a,h,y){var b=zn();y=y===void 0?null:y;var E=void 0;if(Fr!==null){var S=Fr.memoizedState;if(E=S.destroy,y!==null&&Mg(y,S.deps)){b.memoizedState=Hc(a,h,E,y);return}}_r.flags|=i,b.memoizedState=Hc(1|a,h,E,y)}function vv(i,a){return Cd(8390656,8,i,a)}function Rg(i,a){return cp(2048,8,i,a)}function g0(i,a){return cp(4,2,i,a)}function y0(i,a){return cp(4,4,i,a)}function _0(i,a){if(typeof a=="function")return i=i(),a(i),function(){a(null)};if(a!=null)return i=i(),a.current=i,function(){a.current=null}}function v0(i,a,h){return h=h!=null?h.concat([i]):null,cp(4,4,_0.bind(null,a,i),h)}function Fg(){}function x0(i,a){var h=zn();a=a===void 0?null:a;var y=h.memoizedState;return y!==null&&a!==null&&Mg(a,y[1])?y[0]:(h.memoizedState=[i,a],i)}function w0(i,a){var h=zn();a=a===void 0?null:a;var y=h.memoizedState;return y!==null&&a!==null&&Mg(a,y[1])?y[0]:(i=i(),h.memoizedState=[i,a],i)}function b0(i,a,h){return Po&21?(qn(h,a)||(h=Ix(),_r.lanes|=h,zo|=h,i.baseState=!0),a):(i.baseState&&(i.baseState=!1,Zi=!0),i.memoizedState=h)}function G2(i,a){var h=Wt;Wt=h!==0&&4>h?h:4,i(!0);var y=em.transition;em.transition={};try{i(!1),a()}finally{Wt=h,em.transition=y}}function S0(){return zn().memoizedState}function H2(i,a,h){var y=Ra(i);if(h={lane:y,action:h,hasEagerState:!1,eagerState:null,next:null},T0(i))k0(a,h);else if(h=s0(i,a,h,y),h!==null){var b=zi();Zn(h,i,y,b),E0(h,a,y)}}function W2(i,a,h){var y=Ra(i),b={lane:y,action:h,hasEagerState:!1,eagerState:null,next:null};if(T0(i))k0(a,b);else{var E=i.alternate;if(i.lanes===0&&(E===null||E.lanes===0)&&(E=a.lastRenderedReducer,E!==null))try{var S=a.lastRenderedState,d=E(S,h);if(b.hasEagerState=!0,b.eagerState=d,qn(d,S)){var H=a.interleaved;H===null?(b.next=b,Ig(a)):(b.next=H.next,H.next=b),a.interleaved=b;return}}catch{}finally{}h=s0(i,a,b,y),h!==null&&(b=zi(),Zn(h,i,y,b),E0(h,a,y))}}function T0(i){var a=i.alternate;return i===_r||a!==null&&a===_r}function k0(i,a){Cc=Kd=!0;var h=i.pending;h===null?a.next=a:(a.next=h.next,h.next=a),i.pending=a}function E0(i,a,h){if(h&4194240){var y=a.lanes;y&=i.pendingLanes,h|=y,a.lanes=h,pg(i,h)}}var Jd={readContext:Pn,useCallback:yi,useContext:yi,useEffect:yi,useImperativeHandle:yi,useInsertionEffect:yi,useLayoutEffect:yi,useMemo:yi,useReducer:yi,useRef:yi,useState:yi,useDebugValue:yi,useDeferredValue:yi,useTransition:yi,useMutableSource:yi,useSyncExternalStore:yi,useId:yi,unstable_isNewReconciler:!1},X2={readContext:Pn,useCallback:function(i,a){return ss().memoizedState=[i,a===void 0?null:a],i},useContext:Pn,useEffect:vv,useImperativeHandle:function(i,a,h){return h=h!=null?h.concat([i]):null,Cd(4194308,4,_0.bind(null,a,i),h)},useLayoutEffect:function(i,a){return Cd(4194308,4,i,a)},useInsertionEffect:function(i,a){return Cd(4,2,i,a)},useMemo:function(i,a){var h=ss();return a=a===void 0?null:a,i=i(),h.memoizedState=[i,a],i},useReducer:function(i,a,h){var y=ss();return a=h!==void 0?h(a):a,y.memoizedState=y.baseState=a,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:a},y.queue=i,i=i.dispatch=H2.bind(null,_r,i),[y.memoizedState,i]},useRef:function(i){var a=ss();return i={current:i},a.memoizedState=i},useState:_v,useDebugValue:Fg,useDeferredValue:function(i){return ss().memoizedState=i},useTransition:function(){var i=_v(!1),a=i[0];return i=G2.bind(null,i[1]),ss().memoizedState=i,[a,i]},useMutableSource:function(){},useSyncExternalStore:function(i,a,h){var y=_r,b=ss();if(pr){if(h===void 0)throw Error(Ce(407));h=h()}else{if(h=a(),Xr===null)throw Error(Ce(349));Po&30||c0(y,a,h)}b.memoizedState=h;var E={value:h,getSnapshot:a};return b.queue=E,vv(d0.bind(null,y,E,i),[i]),y.flags|=2048,Hc(9,h0.bind(null,y,E,h,a),void 0,null),h},useId:function(){var i=ss(),a=Xr.identifierPrefix;if(pr){var h=Ls,y=Ds;h=(y&~(1<<32-$n(y)-1)).toString(32)+h,a=":"+a+"R"+h,h=qc++,0<h&&(a+="H"+h.toString(32)),a+=":"}else h=q2++,a=":"+a+"r"+h.toString(32)+":";return i.memoizedState=a},unstable_isNewReconciler:!1},K2={readContext:Pn,useCallback:x0,useContext:Pn,useEffect:Rg,useImperativeHandle:v0,useInsertionEffect:g0,useLayoutEffect:y0,useMemo:w0,useReducer:tm,useRef:m0,useState:function(){return tm(Gc)},useDebugValue:Fg,useDeferredValue:function(i){var a=zn();return b0(a,Fr.memoizedState,i)},useTransition:function(){var i=tm(Gc)[0],a=zn().memoizedState;return[i,a]},useMutableSource:l0,useSyncExternalStore:u0,useId:S0,unstable_isNewReconciler:!1},J2={readContext:Pn,useCallback:x0,useContext:Pn,useEffect:Rg,useImperativeHandle:v0,useInsertionEffect:g0,useLayoutEffect:y0,useMemo:w0,useReducer:rm,useRef:m0,useState:function(){return rm(Gc)},useDebugValue:Fg,useDeferredValue:function(i){var a=zn();return Fr===null?a.memoizedState=i:b0(a,Fr.memoizedState,i)},useTransition:function(){var i=rm(Gc)[0],a=zn().memoizedState;return[i,a]},useMutableSource:l0,useSyncExternalStore:u0,useId:S0,unstable_isNewReconciler:!1};function jn(i,a){if(i&&i.defaultProps){a=vr({},a),i=i.defaultProps;for(var h in i)a[h]===void 0&&(a[h]=i[h]);return a}return a}function Nm(i,a,h,y){a=i.memoizedState,h=h(y,a),h=h==null?a:vr({},a,h),i.memoizedState=h,i.lanes===0&&(i.updateQueue.baseState=h)}var hp={isMounted:function(i){return(i=i._reactInternals)?Do(i)===i:!1},enqueueSetState:function(i,a,h){i=i._reactInternals;var y=zi(),b=Ra(i),E=Rs(y,b);E.payload=a,h!=null&&(E.callback=h),a=Da(i,E,b),a!==null&&(Zn(a,i,b,y),Ed(a,i,b))},enqueueReplaceState:function(i,a,h){i=i._reactInternals;var y=zi(),b=Ra(i),E=Rs(y,b);E.tag=1,E.payload=a,h!=null&&(E.callback=h),a=Da(i,E,b),a!==null&&(Zn(a,i,b,y),Ed(a,i,b))},enqueueForceUpdate:function(i,a){i=i._reactInternals;var h=zi(),y=Ra(i),b=Rs(h,y);b.tag=2,a!=null&&(b.callback=a),a=Da(i,b,y),a!==null&&(Zn(a,i,y,h),Ed(a,i,y))}};function xv(i,a,h,y,b,E,S){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(y,E,S):a.prototype&&a.prototype.isPureReactComponent?!Nc(h,y)||!Nc(b,E):!0}function I0(i,a,h){var y=!1,b=Oa,E=a.contextType;return typeof E=="object"&&E!==null?E=Pn(E):(b=Gi(a)?Io:xi.current,y=a.contextTypes,E=(y=y!=null)?Wl(i,b):Oa),a=new a(h,E),i.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=hp,i.stateNode=a,a._reactInternals=i,y&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=b,i.__reactInternalMemoizedMaskedChildContext=E),a}function wv(i,a,h,y){i=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(h,y),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(h,y),a.state!==i&&hp.enqueueReplaceState(a,a.state,null)}function jm(i,a,h,y){var b=i.stateNode;b.props=h,b.state=i.memoizedState,b.refs={},Cg(i);var E=a.contextType;typeof E=="object"&&E!==null?b.context=Pn(E):(E=Gi(a)?Io:xi.current,b.context=Wl(i,E)),b.state=i.memoizedState,E=a.getDerivedStateFromProps,typeof E=="function"&&(Nm(i,a,E,h),b.state=i.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(a=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),a!==b.state&&hp.enqueueReplaceState(b,b.state,null),Wd(i,h,b,y),b.state=i.memoizedState),typeof b.componentDidMount=="function"&&(i.flags|=4194308)}function Yl(i,a){try{var h="",y=a;do h+=kb(y),y=y.return;while(y);var b=h}catch(E){b=`
Error generating stack: `+E.message+`
`+E.stack}return{value:i,source:a,stack:b,digest:null}}function im(i,a,h){return{value:i,source:null,stack:h??null,digest:a??null}}function Vm(i,a){try{console.error(a.value)}catch(h){setTimeout(function(){throw h})}}var Y2=typeof WeakMap=="function"?WeakMap:Map;function C0(i,a,h){h=Rs(-1,h),h.tag=3,h.payload={element:null};var y=a.value;return h.callback=function(){Qd||(Qd=!0,Jm=y),Vm(i,a)},h}function P0(i,a,h){h=Rs(-1,h),h.tag=3;var y=i.type.getDerivedStateFromError;if(typeof y=="function"){var b=a.value;h.payload=function(){return y(b)},h.callback=function(){Vm(i,a)}}var E=i.stateNode;return E!==null&&typeof E.componentDidCatch=="function"&&(h.callback=function(){Vm(i,a),typeof y!="function"&&(La===null?La=new Set([this]):La.add(this));var S=a.stack;this.componentDidCatch(a.value,{componentStack:S!==null?S:""})}),h}function bv(i,a,h){var y=i.pingCache;if(y===null){y=i.pingCache=new Y2;var b=new Set;y.set(a,b)}else b=y.get(a),b===void 0&&(b=new Set,y.set(a,b));b.has(h)||(b.add(h),i=dS.bind(null,i,a,h),a.then(i,i))}function Sv(i){do{var a;if((a=i.tag===13)&&(a=i.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return i;i=i.return}while(i!==null);return null}function Tv(i,a,h,y,b){return i.mode&1?(i.flags|=65536,i.lanes=b,i):(i===a?i.flags|=65536:(i.flags|=128,h.flags|=131072,h.flags&=-52805,h.tag===1&&(h.alternate===null?h.tag=17:(a=Rs(-1,1),a.tag=2,Da(h,a,1))),h.lanes|=1),i)}var Q2=js.ReactCurrentOwner,Zi=!1;function Pi(i,a,h,y){a.child=i===null?n0(a,null,h,y):Kl(a,i.child,h,y)}function kv(i,a,h,y,b){h=h.render;var E=a.ref;return ql(a,b),y=Dg(i,a,h,y,E,b),h=Lg(),i!==null&&!Zi?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~b,Ns(i,a,b)):(pr&&h&&wg(a),a.flags|=1,Pi(i,a,y,b),a.child)}function Ev(i,a,h,y,b){if(i===null){var E=h.type;return typeof E=="function"&&!Zg(E)&&E.defaultProps===void 0&&h.compare===null&&h.defaultProps===void 0?(a.tag=15,a.type=E,z0(i,a,E,y,b)):(i=Md(h.type,null,y,a,a.mode,b),i.ref=a.ref,i.return=a,a.child=i)}if(E=i.child,!(i.lanes&b)){var S=E.memoizedProps;if(h=h.compare,h=h!==null?h:Nc,h(S,y)&&i.ref===a.ref)return Ns(i,a,b)}return a.flags|=1,i=Fa(E,y),i.ref=a.ref,i.return=a,a.child=i}function z0(i,a,h,y,b){if(i!==null){var E=i.memoizedProps;if(Nc(E,y)&&i.ref===a.ref)if(Zi=!1,a.pendingProps=y=E,(i.lanes&b)!==0)i.flags&131072&&(Zi=!0);else return a.lanes=i.lanes,Ns(i,a,b)}return Um(i,a,h,y,b)}function A0(i,a,h){var y=a.pendingProps,b=y.children,E=i!==null?i.memoizedState:null;if(y.mode==="hidden")if(!(a.mode&1))a.memoizedState={baseLanes:0,cachePool:null,transitions:null},ir(jl,ln),ln|=h;else{if(!(h&1073741824))return i=E!==null?E.baseLanes|h:h,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:i,cachePool:null,transitions:null},a.updateQueue=null,ir(jl,ln),ln|=i,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=E!==null?E.baseLanes:h,ir(jl,ln),ln|=y}else E!==null?(y=E.baseLanes|h,a.memoizedState=null):y=h,ir(jl,ln),ln|=y;return Pi(i,a,b,h),a.child}function M0(i,a){var h=a.ref;(i===null&&h!==null||i!==null&&i.ref!==h)&&(a.flags|=512,a.flags|=2097152)}function Um(i,a,h,y,b){var E=Gi(h)?Io:xi.current;return E=Wl(a,E),ql(a,b),h=Dg(i,a,h,y,E,b),y=Lg(),i!==null&&!Zi?(a.updateQueue=i.updateQueue,a.flags&=-2053,i.lanes&=~b,Ns(i,a,b)):(pr&&y&&wg(a),a.flags|=1,Pi(i,a,h,b),a.child)}function Iv(i,a,h,y,b){if(Gi(h)){var E=!0;$d(a)}else E=!1;if(ql(a,b),a.stateNode===null)Pd(i,a),I0(a,h,y),jm(a,h,y,b),y=!0;else if(i===null){var S=a.stateNode,d=a.memoizedProps;S.props=d;var H=S.context,le=h.contextType;typeof le=="object"&&le!==null?le=Pn(le):(le=Gi(h)?Io:xi.current,le=Wl(a,le));var ve=h.getDerivedStateFromProps,ne=typeof ve=="function"||typeof S.getSnapshotBeforeUpdate=="function";ne||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==y||H!==le)&&wv(a,S,y,le),Ta=!1;var G=a.memoizedState;S.state=G,Wd(a,y,S,b),H=a.memoizedState,d!==y||G!==H||qi.current||Ta?(typeof ve=="function"&&(Nm(a,h,ve,y),H=a.memoizedState),(d=Ta||xv(a,h,d,y,G,H,le))?(ne||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(a.flags|=4194308)):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=y,a.memoizedState=H),S.props=y,S.state=H,S.context=le,y=d):(typeof S.componentDidMount=="function"&&(a.flags|=4194308),y=!1)}else{S=a.stateNode,a0(i,a),d=a.memoizedProps,le=a.type===a.elementType?d:jn(a.type,d),S.props=le,ne=a.pendingProps,G=S.context,H=h.contextType,typeof H=="object"&&H!==null?H=Pn(H):(H=Gi(h)?Io:xi.current,H=Wl(a,H));var Re=h.getDerivedStateFromProps;(ve=typeof Re=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(d!==ne||G!==H)&&wv(a,S,y,H),Ta=!1,G=a.memoizedState,S.state=G,Wd(a,y,S,b);var Fe=a.memoizedState;d!==ne||G!==Fe||qi.current||Ta?(typeof Re=="function"&&(Nm(a,h,Re,y),Fe=a.memoizedState),(le=Ta||xv(a,h,le,y,G,Fe,H)||!1)?(ve||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(y,Fe,H),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(y,Fe,H)),typeof S.componentDidUpdate=="function"&&(a.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(a.flags|=1024),a.memoizedProps=y,a.memoizedState=Fe),S.props=y,S.state=Fe,S.context=H,y=le):(typeof S.componentDidUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(a.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||d===i.memoizedProps&&G===i.memoizedState||(a.flags|=1024),y=!1)}return $m(i,a,h,y,E,b)}function $m(i,a,h,y,b,E){M0(i,a);var S=(a.flags&128)!==0;if(!y&&!S)return b&&dv(a,h,!1),Ns(i,a,E);y=a.stateNode,Q2.current=a;var d=S&&typeof h.getDerivedStateFromError!="function"?null:y.render();return a.flags|=1,i!==null&&S?(a.child=Kl(a,i.child,null,E),a.child=Kl(a,null,d,E)):Pi(i,a,d,E),a.memoizedState=y.state,b&&dv(a,h,!0),a.child}function D0(i){var a=i.stateNode;a.pendingContext?hv(i,a.pendingContext,a.pendingContext!==a.context):a.context&&hv(i,a.context,!1),Pg(i,a.containerInfo)}function Cv(i,a,h,y,b){return Xl(),Sg(b),a.flags|=256,Pi(i,a,h,y),a.child}var Zm={dehydrated:null,treeContext:null,retryLane:0};function qm(i){return{baseLanes:i,cachePool:null,transitions:null}}function L0(i,a,h){var y=a.pendingProps,b=yr.current,E=!1,S=(a.flags&128)!==0,d;if((d=S)||(d=i!==null&&i.memoizedState===null?!1:(b&2)!==0),d?(E=!0,a.flags&=-129):(i===null||i.memoizedState!==null)&&(b|=1),ir(yr,b&1),i===null)return Bm(a),i=a.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(a.mode&1?i.data==="$!"?a.lanes=8:a.lanes=1073741824:a.lanes=1,null):(S=y.children,i=y.fallback,E?(y=a.mode,E=a.child,S={mode:"hidden",children:S},!(y&1)&&E!==null?(E.childLanes=0,E.pendingProps=S):E=fp(S,y,0,null),i=Eo(i,y,h,null),E.return=a,i.return=a,E.sibling=i,a.child=E,a.child.memoizedState=qm(h),a.memoizedState=Zm,i):Bg(a,S));if(b=i.memoizedState,b!==null&&(d=b.dehydrated,d!==null))return eS(i,a,S,y,d,b,h);if(E){E=y.fallback,S=a.mode,b=i.child,d=b.sibling;var H={mode:"hidden",children:y.children};return!(S&1)&&a.child!==b?(y=a.child,y.childLanes=0,y.pendingProps=H,a.deletions=null):(y=Fa(b,H),y.subtreeFlags=b.subtreeFlags&14680064),d!==null?E=Fa(d,E):(E=Eo(E,S,h,null),E.flags|=2),E.return=a,y.return=a,y.sibling=E,a.child=y,y=E,E=a.child,S=i.child.memoizedState,S=S===null?qm(h):{baseLanes:S.baseLanes|h,cachePool:null,transitions:S.transitions},E.memoizedState=S,E.childLanes=i.childLanes&~h,a.memoizedState=Zm,y}return E=i.child,i=E.sibling,y=Fa(E,{mode:"visible",children:y.children}),!(a.mode&1)&&(y.lanes=h),y.return=a,y.sibling=null,i!==null&&(h=a.deletions,h===null?(a.deletions=[i],a.flags|=16):h.push(i)),a.child=y,a.memoizedState=null,y}function Bg(i,a){return a=fp({mode:"visible",children:a},i.mode,0,null),a.return=i,i.child=a}function md(i,a,h,y){return y!==null&&Sg(y),Kl(a,i.child,null,h),i=Bg(a,a.pendingProps.children),i.flags|=2,a.memoizedState=null,i}function eS(i,a,h,y,b,E,S){if(h)return a.flags&256?(a.flags&=-257,y=im(Error(Ce(422))),md(i,a,S,y)):a.memoizedState!==null?(a.child=i.child,a.flags|=128,null):(E=y.fallback,b=a.mode,y=fp({mode:"visible",children:y.children},b,0,null),E=Eo(E,b,S,null),E.flags|=2,y.return=a,E.return=a,y.sibling=E,a.child=y,a.mode&1&&Kl(a,i.child,null,S),a.child.memoizedState=qm(S),a.memoizedState=Zm,E);if(!(a.mode&1))return md(i,a,S,null);if(b.data==="$!"){if(y=b.nextSibling&&b.nextSibling.dataset,y)var d=y.dgst;return y=d,E=Error(Ce(419)),y=im(E,y,void 0),md(i,a,S,y)}if(d=(S&i.childLanes)!==0,Zi||d){if(y=Xr,y!==null){switch(S&-S){case 4:b=2;break;case 16:b=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:b=32;break;case 536870912:b=268435456;break;default:b=0}b=b&(y.suspendedLanes|S)?0:b,b!==0&&b!==E.retryLane&&(E.retryLane=b,Os(i,b),Zn(y,i,b,-1))}return $g(),y=im(Error(Ce(421))),md(i,a,S,y)}return b.data==="$?"?(a.flags|=128,a.child=i.child,a=pS.bind(null,i),b._reactRetry=a,null):(i=E.treeContext,un=Ma(b.nextSibling),cn=a,pr=!0,Un=null,i!==null&&(kn[En++]=Ds,kn[En++]=Ls,kn[En++]=Co,Ds=i.id,Ls=i.overflow,Co=a),a=Bg(a,y.children),a.flags|=4096,a)}function Pv(i,a,h){i.lanes|=a;var y=i.alternate;y!==null&&(y.lanes|=a),Om(i.return,a,h)}function nm(i,a,h,y,b){var E=i.memoizedState;E===null?i.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:y,tail:h,tailMode:b}:(E.isBackwards=a,E.rendering=null,E.renderingStartTime=0,E.last=y,E.tail=h,E.tailMode=b)}function R0(i,a,h){var y=a.pendingProps,b=y.revealOrder,E=y.tail;if(Pi(i,a,y.children,h),y=yr.current,y&2)y=y&1|2,a.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=a.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Pv(i,h,a);else if(i.tag===19)Pv(i,h,a);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===a)break e;for(;i.sibling===null;){if(i.return===null||i.return===a)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}y&=1}if(ir(yr,y),!(a.mode&1))a.memoizedState=null;else switch(b){case"forwards":for(h=a.child,b=null;h!==null;)i=h.alternate,i!==null&&Xd(i)===null&&(b=h),h=h.sibling;h=b,h===null?(b=a.child,a.child=null):(b=h.sibling,h.sibling=null),nm(a,!1,b,h,E);break;case"backwards":for(h=null,b=a.child,a.child=null;b!==null;){if(i=b.alternate,i!==null&&Xd(i)===null){a.child=b;break}i=b.sibling,b.sibling=h,h=b,b=i}nm(a,!0,h,null,E);break;case"together":nm(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function Pd(i,a){!(a.mode&1)&&i!==null&&(i.alternate=null,a.alternate=null,a.flags|=2)}function Ns(i,a,h){if(i!==null&&(a.dependencies=i.dependencies),zo|=a.lanes,!(h&a.childLanes))return null;if(i!==null&&a.child!==i.child)throw Error(Ce(153));if(a.child!==null){for(i=a.child,h=Fa(i,i.pendingProps),a.child=h,h.return=a;i.sibling!==null;)i=i.sibling,h=h.sibling=Fa(i,i.pendingProps),h.return=a;h.sibling=null}return a.child}function tS(i,a,h){switch(a.tag){case 3:D0(a),Xl();break;case 5:o0(a);break;case 1:Gi(a.type)&&$d(a);break;case 4:Pg(a,a.stateNode.containerInfo);break;case 10:var y=a.type._context,b=a.memoizedProps.value;ir(Gd,y._currentValue),y._currentValue=b;break;case 13:if(y=a.memoizedState,y!==null)return y.dehydrated!==null?(ir(yr,yr.current&1),a.flags|=128,null):h&a.child.childLanes?L0(i,a,h):(ir(yr,yr.current&1),i=Ns(i,a,h),i!==null?i.sibling:null);ir(yr,yr.current&1);break;case 19:if(y=(h&a.childLanes)!==0,i.flags&128){if(y)return R0(i,a,h);a.flags|=128}if(b=a.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),ir(yr,yr.current),y)break;return null;case 22:case 23:return a.lanes=0,A0(i,a,h)}return Ns(i,a,h)}var F0,Gm,B0,O0;F0=function(i,a){for(var h=a.child;h!==null;){if(h.tag===5||h.tag===6)i.appendChild(h.stateNode);else if(h.tag!==4&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return;h=h.return}h.sibling.return=h.return,h=h.sibling}};Gm=function(){};B0=function(i,a,h,y){var b=i.memoizedProps;if(b!==y){i=a.stateNode,To(ls.current);var E=null;switch(h){case"input":b=fm(i,b),y=fm(i,y),E=[];break;case"select":b=vr({},b,{value:void 0}),y=vr({},y,{value:void 0}),E=[];break;case"textarea":b=ym(i,b),y=ym(i,y),E=[];break;default:typeof b.onClick!="function"&&typeof y.onClick=="function"&&(i.onclick=Vd)}vm(h,y);var S;h=null;for(le in b)if(!y.hasOwnProperty(le)&&b.hasOwnProperty(le)&&b[le]!=null)if(le==="style"){var d=b[le];for(S in d)d.hasOwnProperty(S)&&(h||(h={}),h[S]="")}else le!=="dangerouslySetInnerHTML"&&le!=="children"&&le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&le!=="autoFocus"&&(Mc.hasOwnProperty(le)?E||(E=[]):(E=E||[]).push(le,null));for(le in y){var H=y[le];if(d=b!=null?b[le]:void 0,y.hasOwnProperty(le)&&H!==d&&(H!=null||d!=null))if(le==="style")if(d){for(S in d)!d.hasOwnProperty(S)||H&&H.hasOwnProperty(S)||(h||(h={}),h[S]="");for(S in H)H.hasOwnProperty(S)&&d[S]!==H[S]&&(h||(h={}),h[S]=H[S])}else h||(E||(E=[]),E.push(le,h)),h=H;else le==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,d=d?d.__html:void 0,H!=null&&d!==H&&(E=E||[]).push(le,H)):le==="children"?typeof H!="string"&&typeof H!="number"||(E=E||[]).push(le,""+H):le!=="suppressContentEditableWarning"&&le!=="suppressHydrationWarning"&&(Mc.hasOwnProperty(le)?(H!=null&&le==="onScroll"&&or("scroll",i),E||d===H||(E=[])):(E=E||[]).push(le,H))}h&&(E=E||[]).push("style",h);var le=E;(a.updateQueue=le)&&(a.flags|=4)}};O0=function(i,a,h,y){h!==y&&(a.flags|=4)};function yc(i,a){if(!pr)switch(i.tailMode){case"hidden":a=i.tail;for(var h=null;a!==null;)a.alternate!==null&&(h=a),a=a.sibling;h===null?i.tail=null:h.sibling=null;break;case"collapsed":h=i.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?a||i.tail===null?i.tail=null:i.tail.sibling=null:y.sibling=null}}function _i(i){var a=i.alternate!==null&&i.alternate.child===i.child,h=0,y=0;if(a)for(var b=i.child;b!==null;)h|=b.lanes|b.childLanes,y|=b.subtreeFlags&14680064,y|=b.flags&14680064,b.return=i,b=b.sibling;else for(b=i.child;b!==null;)h|=b.lanes|b.childLanes,y|=b.subtreeFlags,y|=b.flags,b.return=i,b=b.sibling;return i.subtreeFlags|=y,i.childLanes=h,a}function rS(i,a,h){var y=a.pendingProps;switch(bg(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _i(a),null;case 1:return Gi(a.type)&&Ud(),_i(a),null;case 3:return y=a.stateNode,Jl(),lr(qi),lr(xi),Ag(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(i===null||i.child===null)&&(pd(a)?a.flags|=4:i===null||i.memoizedState.isDehydrated&&!(a.flags&256)||(a.flags|=1024,Un!==null&&(eg(Un),Un=null))),Gm(i,a),_i(a),null;case 5:zg(a);var b=To(Zc.current);if(h=a.type,i!==null&&a.stateNode!=null)B0(i,a,h,y,b),i.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!y){if(a.stateNode===null)throw Error(Ce(166));return _i(a),null}if(i=To(ls.current),pd(a)){y=a.stateNode,h=a.type;var E=a.memoizedProps;switch(y[as]=a,y[Uc]=E,i=(a.mode&1)!==0,h){case"dialog":or("cancel",y),or("close",y);break;case"iframe":case"object":case"embed":or("load",y);break;case"video":case"audio":for(b=0;b<bc.length;b++)or(bc[b],y);break;case"source":or("error",y);break;case"img":case"image":case"link":or("error",y),or("load",y);break;case"details":or("toggle",y);break;case"input":O_(y,E),or("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!E.multiple},or("invalid",y);break;case"textarea":j_(y,E),or("invalid",y)}vm(h,E),b=null;for(var S in E)if(E.hasOwnProperty(S)){var d=E[S];S==="children"?typeof d=="string"?y.textContent!==d&&(E.suppressHydrationWarning!==!0&&dd(y.textContent,d,i),b=["children",d]):typeof d=="number"&&y.textContent!==""+d&&(E.suppressHydrationWarning!==!0&&dd(y.textContent,d,i),b=["children",""+d]):Mc.hasOwnProperty(S)&&d!=null&&S==="onScroll"&&or("scroll",y)}switch(h){case"input":nd(y),N_(y,E,!0);break;case"textarea":nd(y),V_(y);break;case"select":case"option":break;default:typeof E.onClick=="function"&&(y.onclick=Vd)}y=b,a.updateQueue=y,y!==null&&(a.flags|=4)}else{S=b.nodeType===9?b:b.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=dx(h)),i==="http://www.w3.org/1999/xhtml"?h==="script"?(i=S.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof y.is=="string"?i=S.createElement(h,{is:y.is}):(i=S.createElement(h),h==="select"&&(S=i,y.multiple?S.multiple=!0:y.size&&(S.size=y.size))):i=S.createElementNS(i,h),i[as]=a,i[Uc]=y,F0(i,a,!1,!1),a.stateNode=i;e:{switch(S=xm(h,y),h){case"dialog":or("cancel",i),or("close",i),b=y;break;case"iframe":case"object":case"embed":or("load",i),b=y;break;case"video":case"audio":for(b=0;b<bc.length;b++)or(bc[b],i);b=y;break;case"source":or("error",i),b=y;break;case"img":case"image":case"link":or("error",i),or("load",i),b=y;break;case"details":or("toggle",i),b=y;break;case"input":O_(i,y),b=fm(i,y),or("invalid",i);break;case"option":b=y;break;case"select":i._wrapperState={wasMultiple:!!y.multiple},b=vr({},y,{value:void 0}),or("invalid",i);break;case"textarea":j_(i,y),b=ym(i,y),or("invalid",i);break;default:b=y}vm(h,b),d=b;for(E in d)if(d.hasOwnProperty(E)){var H=d[E];E==="style"?mx(i,H):E==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,H!=null&&px(i,H)):E==="children"?typeof H=="string"?(h!=="textarea"||H!=="")&&Dc(i,H):typeof H=="number"&&Dc(i,""+H):E!=="suppressContentEditableWarning"&&E!=="suppressHydrationWarning"&&E!=="autoFocus"&&(Mc.hasOwnProperty(E)?H!=null&&E==="onScroll"&&or("scroll",i):H!=null&&og(i,E,H,S))}switch(h){case"input":nd(i),N_(i,y,!1);break;case"textarea":nd(i),V_(i);break;case"option":y.value!=null&&i.setAttribute("value",""+Ba(y.value));break;case"select":i.multiple=!!y.multiple,E=y.value,E!=null?Vl(i,!!y.multiple,E,!1):y.defaultValue!=null&&Vl(i,!!y.multiple,y.defaultValue,!0);break;default:typeof b.onClick=="function"&&(i.onclick=Vd)}switch(h){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return _i(a),null;case 6:if(i&&a.stateNode!=null)O0(i,a,i.memoizedProps,y);else{if(typeof y!="string"&&a.stateNode===null)throw Error(Ce(166));if(h=To(Zc.current),To(ls.current),pd(a)){if(y=a.stateNode,h=a.memoizedProps,y[as]=a,(E=y.nodeValue!==h)&&(i=cn,i!==null))switch(i.tag){case 3:dd(y.nodeValue,h,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&dd(y.nodeValue,h,(i.mode&1)!==0)}E&&(a.flags|=4)}else y=(h.nodeType===9?h:h.ownerDocument).createTextNode(y),y[as]=a,a.stateNode=y}return _i(a),null;case 13:if(lr(yr),y=a.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(pr&&un!==null&&a.mode&1&&!(a.flags&128))r0(),Xl(),a.flags|=98560,E=!1;else if(E=pd(a),y!==null&&y.dehydrated!==null){if(i===null){if(!E)throw Error(Ce(318));if(E=a.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(Ce(317));E[as]=a}else Xl(),!(a.flags&128)&&(a.memoizedState=null),a.flags|=4;_i(a),E=!1}else Un!==null&&(eg(Un),Un=null),E=!0;if(!E)return a.flags&65536?a:null}return a.flags&128?(a.lanes=h,a):(y=y!==null,y!==(i!==null&&i.memoizedState!==null)&&y&&(a.child.flags|=8192,a.mode&1&&(i===null||yr.current&1?Br===0&&(Br=3):$g())),a.updateQueue!==null&&(a.flags|=4),_i(a),null);case 4:return Jl(),Gm(i,a),i===null&&jc(a.stateNode.containerInfo),_i(a),null;case 10:return Eg(a.type._context),_i(a),null;case 17:return Gi(a.type)&&Ud(),_i(a),null;case 19:if(lr(yr),E=a.memoizedState,E===null)return _i(a),null;if(y=(a.flags&128)!==0,S=E.rendering,S===null)if(y)yc(E,!1);else{if(Br!==0||i!==null&&i.flags&128)for(i=a.child;i!==null;){if(S=Xd(i),S!==null){for(a.flags|=128,yc(E,!1),y=S.updateQueue,y!==null&&(a.updateQueue=y,a.flags|=4),a.subtreeFlags=0,y=h,h=a.child;h!==null;)E=h,i=y,E.flags&=14680066,S=E.alternate,S===null?(E.childLanes=0,E.lanes=i,E.child=null,E.subtreeFlags=0,E.memoizedProps=null,E.memoizedState=null,E.updateQueue=null,E.dependencies=null,E.stateNode=null):(E.childLanes=S.childLanes,E.lanes=S.lanes,E.child=S.child,E.subtreeFlags=0,E.deletions=null,E.memoizedProps=S.memoizedProps,E.memoizedState=S.memoizedState,E.updateQueue=S.updateQueue,E.type=S.type,i=S.dependencies,E.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),h=h.sibling;return ir(yr,yr.current&1|2),a.child}i=i.sibling}E.tail!==null&&Er()>Ql&&(a.flags|=128,y=!0,yc(E,!1),a.lanes=4194304)}else{if(!y)if(i=Xd(S),i!==null){if(a.flags|=128,y=!0,h=i.updateQueue,h!==null&&(a.updateQueue=h,a.flags|=4),yc(E,!0),E.tail===null&&E.tailMode==="hidden"&&!S.alternate&&!pr)return _i(a),null}else 2*Er()-E.renderingStartTime>Ql&&h!==1073741824&&(a.flags|=128,y=!0,yc(E,!1),a.lanes=4194304);E.isBackwards?(S.sibling=a.child,a.child=S):(h=E.last,h!==null?h.sibling=S:a.child=S,E.last=S)}return E.tail!==null?(a=E.tail,E.rendering=a,E.tail=a.sibling,E.renderingStartTime=Er(),a.sibling=null,h=yr.current,ir(yr,y?h&1|2:h&1),a):(_i(a),null);case 22:case 23:return Ug(),y=a.memoizedState!==null,i!==null&&i.memoizedState!==null!==y&&(a.flags|=8192),y&&a.mode&1?ln&1073741824&&(_i(a),a.subtreeFlags&6&&(a.flags|=8192)):_i(a),null;case 24:return null;case 25:return null}throw Error(Ce(156,a.tag))}function iS(i,a){switch(bg(a),a.tag){case 1:return Gi(a.type)&&Ud(),i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 3:return Jl(),lr(qi),lr(xi),Ag(),i=a.flags,i&65536&&!(i&128)?(a.flags=i&-65537|128,a):null;case 5:return zg(a),null;case 13:if(lr(yr),i=a.memoizedState,i!==null&&i.dehydrated!==null){if(a.alternate===null)throw Error(Ce(340));Xl()}return i=a.flags,i&65536?(a.flags=i&-65537|128,a):null;case 19:return lr(yr),null;case 4:return Jl(),null;case 10:return Eg(a.type._context),null;case 22:case 23:return Ug(),null;case 24:return null;default:return null}}var gd=!1,vi=!1,nS=typeof WeakSet=="function"?WeakSet:Set,rt=null;function Nl(i,a){var h=i.ref;if(h!==null)if(typeof h=="function")try{h(null)}catch(y){Tr(i,a,y)}else h.current=null}function Hm(i,a,h){try{h()}catch(y){Tr(i,a,y)}}var zv=!1;function sS(i,a){if(zm=Od,i=$x(),xg(i)){if("selectionStart"in i)var h={start:i.selectionStart,end:i.selectionEnd};else e:{h=(h=i.ownerDocument)&&h.defaultView||window;var y=h.getSelection&&h.getSelection();if(y&&y.rangeCount!==0){h=y.anchorNode;var b=y.anchorOffset,E=y.focusNode;y=y.focusOffset;try{h.nodeType,E.nodeType}catch{h=null;break e}var S=0,d=-1,H=-1,le=0,ve=0,ne=i,G=null;t:for(;;){for(var Re;ne!==h||b!==0&&ne.nodeType!==3||(d=S+b),ne!==E||y!==0&&ne.nodeType!==3||(H=S+y),ne.nodeType===3&&(S+=ne.nodeValue.length),(Re=ne.firstChild)!==null;)G=ne,ne=Re;for(;;){if(ne===i)break t;if(G===h&&++le===b&&(d=S),G===E&&++ve===y&&(H=S),(Re=ne.nextSibling)!==null)break;ne=G,G=ne.parentNode}ne=Re}h=d===-1||H===-1?null:{start:d,end:H}}else h=null}h=h||{start:0,end:0}}else h=null;for(Am={focusedElem:i,selectionRange:h},Od=!1,rt=a;rt!==null;)if(a=rt,i=a.child,(a.subtreeFlags&1028)!==0&&i!==null)i.return=a,rt=i;else for(;rt!==null;){a=rt;try{var Fe=a.alternate;if(a.flags&1024)switch(a.tag){case 0:case 11:case 15:break;case 1:if(Fe!==null){var Ne=Fe.memoizedProps,It=Fe.memoizedState,ue=a.stateNode,re=ue.getSnapshotBeforeUpdate(a.elementType===a.type?Ne:jn(a.type,Ne),It);ue.__reactInternalSnapshotBeforeUpdate=re}break;case 3:var de=a.stateNode.containerInfo;de.nodeType===1?de.textContent="":de.nodeType===9&&de.documentElement&&de.removeChild(de.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ce(163))}}catch(Te){Tr(a,a.return,Te)}if(i=a.sibling,i!==null){i.return=a.return,rt=i;break}rt=a.return}return Fe=zv,zv=!1,Fe}function Pc(i,a,h){var y=a.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var b=y=y.next;do{if((b.tag&i)===i){var E=b.destroy;b.destroy=void 0,E!==void 0&&Hm(a,h,E)}b=b.next}while(b!==y)}}function dp(i,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var h=a=a.next;do{if((h.tag&i)===i){var y=h.create;h.destroy=y()}h=h.next}while(h!==a)}}function Wm(i){var a=i.ref;if(a!==null){var h=i.stateNode;switch(i.tag){case 5:i=h;break;default:i=h}typeof a=="function"?a(i):a.current=i}}function N0(i){var a=i.alternate;a!==null&&(i.alternate=null,N0(a)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(a=i.stateNode,a!==null&&(delete a[as],delete a[Uc],delete a[Lm],delete a[V2],delete a[U2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function j0(i){return i.tag===5||i.tag===3||i.tag===4}function Av(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||j0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Xm(i,a,h){var y=i.tag;if(y===5||y===6)i=i.stateNode,a?h.nodeType===8?h.parentNode.insertBefore(i,a):h.insertBefore(i,a):(h.nodeType===8?(a=h.parentNode,a.insertBefore(i,h)):(a=h,a.appendChild(i)),h=h._reactRootContainer,h!=null||a.onclick!==null||(a.onclick=Vd));else if(y!==4&&(i=i.child,i!==null))for(Xm(i,a,h),i=i.sibling;i!==null;)Xm(i,a,h),i=i.sibling}function Km(i,a,h){var y=i.tag;if(y===5||y===6)i=i.stateNode,a?h.insertBefore(i,a):h.appendChild(i);else if(y!==4&&(i=i.child,i!==null))for(Km(i,a,h),i=i.sibling;i!==null;)Km(i,a,h),i=i.sibling}var ni=null,Vn=!1;function ba(i,a,h){for(h=h.child;h!==null;)V0(i,a,h),h=h.sibling}function V0(i,a,h){if(os&&typeof os.onCommitFiberUnmount=="function")try{os.onCommitFiberUnmount(np,h)}catch{}switch(h.tag){case 5:vi||Nl(h,a);case 6:var y=ni,b=Vn;ni=null,ba(i,a,h),ni=y,Vn=b,ni!==null&&(Vn?(i=ni,h=h.stateNode,i.nodeType===8?i.parentNode.removeChild(h):i.removeChild(h)):ni.removeChild(h.stateNode));break;case 18:ni!==null&&(Vn?(i=ni,h=h.stateNode,i.nodeType===8?Jf(i.parentNode,h):i.nodeType===1&&Jf(i,h),Bc(i)):Jf(ni,h.stateNode));break;case 4:y=ni,b=Vn,ni=h.stateNode.containerInfo,Vn=!0,ba(i,a,h),ni=y,Vn=b;break;case 0:case 11:case 14:case 15:if(!vi&&(y=h.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){b=y=y.next;do{var E=b,S=E.destroy;E=E.tag,S!==void 0&&(E&2||E&4)&&Hm(h,a,S),b=b.next}while(b!==y)}ba(i,a,h);break;case 1:if(!vi&&(Nl(h,a),y=h.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=h.memoizedProps,y.state=h.memoizedState,y.componentWillUnmount()}catch(d){Tr(h,a,d)}ba(i,a,h);break;case 21:ba(i,a,h);break;case 22:h.mode&1?(vi=(y=vi)||h.memoizedState!==null,ba(i,a,h),vi=y):ba(i,a,h);break;default:ba(i,a,h)}}function Mv(i){var a=i.updateQueue;if(a!==null){i.updateQueue=null;var h=i.stateNode;h===null&&(h=i.stateNode=new nS),a.forEach(function(y){var b=fS.bind(null,i,y);h.has(y)||(h.add(y),y.then(b,b))})}}function Nn(i,a){var h=a.deletions;if(h!==null)for(var y=0;y<h.length;y++){var b=h[y];try{var E=i,S=a,d=S;e:for(;d!==null;){switch(d.tag){case 5:ni=d.stateNode,Vn=!1;break e;case 3:ni=d.stateNode.containerInfo,Vn=!0;break e;case 4:ni=d.stateNode.containerInfo,Vn=!0;break e}d=d.return}if(ni===null)throw Error(Ce(160));V0(E,S,b),ni=null,Vn=!1;var H=b.alternate;H!==null&&(H.return=null),b.return=null}catch(le){Tr(b,a,le)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)U0(a,i),a=a.sibling}function U0(i,a){var h=i.alternate,y=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Nn(a,i),ns(i),y&4){try{Pc(3,i,i.return),dp(3,i)}catch(Ne){Tr(i,i.return,Ne)}try{Pc(5,i,i.return)}catch(Ne){Tr(i,i.return,Ne)}}break;case 1:Nn(a,i),ns(i),y&512&&h!==null&&Nl(h,h.return);break;case 5:if(Nn(a,i),ns(i),y&512&&h!==null&&Nl(h,h.return),i.flags&32){var b=i.stateNode;try{Dc(b,"")}catch(Ne){Tr(i,i.return,Ne)}}if(y&4&&(b=i.stateNode,b!=null)){var E=i.memoizedProps,S=h!==null?h.memoizedProps:E,d=i.type,H=i.updateQueue;if(i.updateQueue=null,H!==null)try{d==="input"&&E.type==="radio"&&E.name!=null&&cx(b,E),xm(d,S);var le=xm(d,E);for(S=0;S<H.length;S+=2){var ve=H[S],ne=H[S+1];ve==="style"?mx(b,ne):ve==="dangerouslySetInnerHTML"?px(b,ne):ve==="children"?Dc(b,ne):og(b,ve,ne,le)}switch(d){case"input":mm(b,E);break;case"textarea":hx(b,E);break;case"select":var G=b._wrapperState.wasMultiple;b._wrapperState.wasMultiple=!!E.multiple;var Re=E.value;Re!=null?Vl(b,!!E.multiple,Re,!1):G!==!!E.multiple&&(E.defaultValue!=null?Vl(b,!!E.multiple,E.defaultValue,!0):Vl(b,!!E.multiple,E.multiple?[]:"",!1))}b[Uc]=E}catch(Ne){Tr(i,i.return,Ne)}}break;case 6:if(Nn(a,i),ns(i),y&4){if(i.stateNode===null)throw Error(Ce(162));b=i.stateNode,E=i.memoizedProps;try{b.nodeValue=E}catch(Ne){Tr(i,i.return,Ne)}}break;case 3:if(Nn(a,i),ns(i),y&4&&h!==null&&h.memoizedState.isDehydrated)try{Bc(a.containerInfo)}catch(Ne){Tr(i,i.return,Ne)}break;case 4:Nn(a,i),ns(i);break;case 13:Nn(a,i),ns(i),b=i.child,b.flags&8192&&(E=b.memoizedState!==null,b.stateNode.isHidden=E,!E||b.alternate!==null&&b.alternate.memoizedState!==null||(jg=Er())),y&4&&Mv(i);break;case 22:if(ve=h!==null&&h.memoizedState!==null,i.mode&1?(vi=(le=vi)||ve,Nn(a,i),vi=le):Nn(a,i),ns(i),y&8192){if(le=i.memoizedState!==null,(i.stateNode.isHidden=le)&&!ve&&i.mode&1)for(rt=i,ve=i.child;ve!==null;){for(ne=rt=ve;rt!==null;){switch(G=rt,Re=G.child,G.tag){case 0:case 11:case 14:case 15:Pc(4,G,G.return);break;case 1:Nl(G,G.return);var Fe=G.stateNode;if(typeof Fe.componentWillUnmount=="function"){y=G,h=G.return;try{a=y,Fe.props=a.memoizedProps,Fe.state=a.memoizedState,Fe.componentWillUnmount()}catch(Ne){Tr(y,h,Ne)}}break;case 5:Nl(G,G.return);break;case 22:if(G.memoizedState!==null){Lv(ne);continue}}Re!==null?(Re.return=G,rt=Re):Lv(ne)}ve=ve.sibling}e:for(ve=null,ne=i;;){if(ne.tag===5){if(ve===null){ve=ne;try{b=ne.stateNode,le?(E=b.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none"):(d=ne.stateNode,H=ne.memoizedProps.style,S=H!=null&&H.hasOwnProperty("display")?H.display:null,d.style.display=fx("display",S))}catch(Ne){Tr(i,i.return,Ne)}}}else if(ne.tag===6){if(ve===null)try{ne.stateNode.nodeValue=le?"":ne.memoizedProps}catch(Ne){Tr(i,i.return,Ne)}}else if((ne.tag!==22&&ne.tag!==23||ne.memoizedState===null||ne===i)&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===i)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===i)break e;ve===ne&&(ve=null),ne=ne.return}ve===ne&&(ve=null),ne.sibling.return=ne.return,ne=ne.sibling}}break;case 19:Nn(a,i),ns(i),y&4&&Mv(i);break;case 21:break;default:Nn(a,i),ns(i)}}function ns(i){var a=i.flags;if(a&2){try{e:{for(var h=i.return;h!==null;){if(j0(h)){var y=h;break e}h=h.return}throw Error(Ce(160))}switch(y.tag){case 5:var b=y.stateNode;y.flags&32&&(Dc(b,""),y.flags&=-33);var E=Av(i);Km(i,E,b);break;case 3:case 4:var S=y.stateNode.containerInfo,d=Av(i);Xm(i,d,S);break;default:throw Error(Ce(161))}}catch(H){Tr(i,i.return,H)}i.flags&=-3}a&4096&&(i.flags&=-4097)}function aS(i,a,h){rt=i,$0(i)}function $0(i,a,h){for(var y=(i.mode&1)!==0;rt!==null;){var b=rt,E=b.child;if(b.tag===22&&y){var S=b.memoizedState!==null||gd;if(!S){var d=b.alternate,H=d!==null&&d.memoizedState!==null||vi;d=gd;var le=vi;if(gd=S,(vi=H)&&!le)for(rt=b;rt!==null;)S=rt,H=S.child,S.tag===22&&S.memoizedState!==null?Rv(b):H!==null?(H.return=S,rt=H):Rv(b);for(;E!==null;)rt=E,$0(E),E=E.sibling;rt=b,gd=d,vi=le}Dv(i)}else b.subtreeFlags&8772&&E!==null?(E.return=b,rt=E):Dv(i)}}function Dv(i){for(;rt!==null;){var a=rt;if(a.flags&8772){var h=a.alternate;try{if(a.flags&8772)switch(a.tag){case 0:case 11:case 15:vi||dp(5,a);break;case 1:var y=a.stateNode;if(a.flags&4&&!vi)if(h===null)y.componentDidMount();else{var b=a.elementType===a.type?h.memoizedProps:jn(a.type,h.memoizedProps);y.componentDidUpdate(b,h.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var E=a.updateQueue;E!==null&&yv(a,E,y);break;case 3:var S=a.updateQueue;if(S!==null){if(h=null,a.child!==null)switch(a.child.tag){case 5:h=a.child.stateNode;break;case 1:h=a.child.stateNode}yv(a,S,h)}break;case 5:var d=a.stateNode;if(h===null&&a.flags&4){h=d;var H=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":H.autoFocus&&h.focus();break;case"img":H.src&&(h.src=H.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var le=a.alternate;if(le!==null){var ve=le.memoizedState;if(ve!==null){var ne=ve.dehydrated;ne!==null&&Bc(ne)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ce(163))}vi||a.flags&512&&Wm(a)}catch(G){Tr(a,a.return,G)}}if(a===i){rt=null;break}if(h=a.sibling,h!==null){h.return=a.return,rt=h;break}rt=a.return}}function Lv(i){for(;rt!==null;){var a=rt;if(a===i){rt=null;break}var h=a.sibling;if(h!==null){h.return=a.return,rt=h;break}rt=a.return}}function Rv(i){for(;rt!==null;){var a=rt;try{switch(a.tag){case 0:case 11:case 15:var h=a.return;try{dp(4,a)}catch(H){Tr(a,h,H)}break;case 1:var y=a.stateNode;if(typeof y.componentDidMount=="function"){var b=a.return;try{y.componentDidMount()}catch(H){Tr(a,b,H)}}var E=a.return;try{Wm(a)}catch(H){Tr(a,E,H)}break;case 5:var S=a.return;try{Wm(a)}catch(H){Tr(a,S,H)}}}catch(H){Tr(a,a.return,H)}if(a===i){rt=null;break}var d=a.sibling;if(d!==null){d.return=a.return,rt=d;break}rt=a.return}}var oS=Math.ceil,Yd=js.ReactCurrentDispatcher,Og=js.ReactCurrentOwner,Cn=js.ReactCurrentBatchConfig,Nt=0,Xr=null,Mr=null,si=0,ln=0,jl=ja(0),Br=0,Wc=null,zo=0,pp=0,Ng=0,zc=null,$i=null,jg=0,Ql=1/0,As=null,Qd=!1,Jm=null,La=null,yd=!1,Ca=null,ep=0,Ac=0,Ym=null,zd=-1,Ad=0;function zi(){return Nt&6?Er():zd!==-1?zd:zd=Er()}function Ra(i){return i.mode&1?Nt&2&&si!==0?si&-si:Z2.transition!==null?(Ad===0&&(Ad=Ix()),Ad):(i=Wt,i!==0||(i=window.event,i=i===void 0?16:Lx(i.type)),i):1}function Zn(i,a,h,y){if(50<Ac)throw Ac=0,Ym=null,Error(Ce(185));Kc(i,h,y),(!(Nt&2)||i!==Xr)&&(i===Xr&&(!(Nt&2)&&(pp|=h),Br===4&&Ea(i,si)),Hi(i,y),h===1&&Nt===0&&!(a.mode&1)&&(Ql=Er()+500,up&&Va()))}function Hi(i,a){var h=i.callbackNode;Zb(i,a);var y=Bd(i,i===Xr?si:0);if(y===0)h!==null&&Z_(h),i.callbackNode=null,i.callbackPriority=0;else if(a=y&-y,i.callbackPriority!==a){if(h!=null&&Z_(h),a===1)i.tag===0?$2(Fv.bind(null,i)):Qx(Fv.bind(null,i)),N2(function(){!(Nt&6)&&Va()}),h=null;else{switch(Cx(y)){case 1:h=dg;break;case 4:h=kx;break;case 16:h=Fd;break;case 536870912:h=Ex;break;default:h=Fd}h=J0(h,Z0.bind(null,i))}i.callbackPriority=a,i.callbackNode=h}}function Z0(i,a){if(zd=-1,Ad=0,Nt&6)throw Error(Ce(327));var h=i.callbackNode;if(Gl()&&i.callbackNode!==h)return null;var y=Bd(i,i===Xr?si:0);if(y===0)return null;if(y&30||y&i.expiredLanes||a)a=tp(i,y);else{a=y;var b=Nt;Nt|=2;var E=G0();(Xr!==i||si!==a)&&(As=null,Ql=Er()+500,ko(i,a));do try{cS();break}catch(d){q0(i,d)}while(!0);kg(),Yd.current=E,Nt=b,Mr!==null?a=0:(Xr=null,si=0,a=Br)}if(a!==0){if(a===2&&(b=km(i),b!==0&&(y=b,a=Qm(i,b))),a===1)throw h=Wc,ko(i,0),Ea(i,y),Hi(i,Er()),h;if(a===6)Ea(i,y);else{if(b=i.current.alternate,!(y&30)&&!lS(b)&&(a=tp(i,y),a===2&&(E=km(i),E!==0&&(y=E,a=Qm(i,E))),a===1))throw h=Wc,ko(i,0),Ea(i,y),Hi(i,Er()),h;switch(i.finishedWork=b,i.finishedLanes=y,a){case 0:case 1:throw Error(Ce(345));case 2:wo(i,$i,As);break;case 3:if(Ea(i,y),(y&130023424)===y&&(a=jg+500-Er(),10<a)){if(Bd(i,0)!==0)break;if(b=i.suspendedLanes,(b&y)!==y){zi(),i.pingedLanes|=i.suspendedLanes&b;break}i.timeoutHandle=Dm(wo.bind(null,i,$i,As),a);break}wo(i,$i,As);break;case 4:if(Ea(i,y),(y&4194240)===y)break;for(a=i.eventTimes,b=-1;0<y;){var S=31-$n(y);E=1<<S,S=a[S],S>b&&(b=S),y&=~E}if(y=b,y=Er()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*oS(y/1960))-y,10<y){i.timeoutHandle=Dm(wo.bind(null,i,$i,As),y);break}wo(i,$i,As);break;case 5:wo(i,$i,As);break;default:throw Error(Ce(329))}}}return Hi(i,Er()),i.callbackNode===h?Z0.bind(null,i):null}function Qm(i,a){var h=zc;return i.current.memoizedState.isDehydrated&&(ko(i,a).flags|=256),i=tp(i,a),i!==2&&(a=$i,$i=h,a!==null&&eg(a)),i}function eg(i){$i===null?$i=i:$i.push.apply($i,i)}function lS(i){for(var a=i;;){if(a.flags&16384){var h=a.updateQueue;if(h!==null&&(h=h.stores,h!==null))for(var y=0;y<h.length;y++){var b=h[y],E=b.getSnapshot;b=b.value;try{if(!qn(E(),b))return!1}catch{return!1}}}if(h=a.child,a.subtreeFlags&16384&&h!==null)h.return=a,a=h;else{if(a===i)break;for(;a.sibling===null;){if(a.return===null||a.return===i)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ea(i,a){for(a&=~Ng,a&=~pp,i.suspendedLanes|=a,i.pingedLanes&=~a,i=i.expirationTimes;0<a;){var h=31-$n(a),y=1<<h;i[h]=-1,a&=~y}}function Fv(i){if(Nt&6)throw Error(Ce(327));Gl();var a=Bd(i,0);if(!(a&1))return Hi(i,Er()),null;var h=tp(i,a);if(i.tag!==0&&h===2){var y=km(i);y!==0&&(a=y,h=Qm(i,y))}if(h===1)throw h=Wc,ko(i,0),Ea(i,a),Hi(i,Er()),h;if(h===6)throw Error(Ce(345));return i.finishedWork=i.current.alternate,i.finishedLanes=a,wo(i,$i,As),Hi(i,Er()),null}function Vg(i,a){var h=Nt;Nt|=1;try{return i(a)}finally{Nt=h,Nt===0&&(Ql=Er()+500,up&&Va())}}function Ao(i){Ca!==null&&Ca.tag===0&&!(Nt&6)&&Gl();var a=Nt;Nt|=1;var h=Cn.transition,y=Wt;try{if(Cn.transition=null,Wt=1,i)return i()}finally{Wt=y,Cn.transition=h,Nt=a,!(Nt&6)&&Va()}}function Ug(){ln=jl.current,lr(jl)}function ko(i,a){i.finishedWork=null,i.finishedLanes=0;var h=i.timeoutHandle;if(h!==-1&&(i.timeoutHandle=-1,O2(h)),Mr!==null)for(h=Mr.return;h!==null;){var y=h;switch(bg(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&Ud();break;case 3:Jl(),lr(qi),lr(xi),Ag();break;case 5:zg(y);break;case 4:Jl();break;case 13:lr(yr);break;case 19:lr(yr);break;case 10:Eg(y.type._context);break;case 22:case 23:Ug()}h=h.return}if(Xr=i,Mr=i=Fa(i.current,null),si=ln=a,Br=0,Wc=null,Ng=pp=zo=0,$i=zc=null,So!==null){for(a=0;a<So.length;a++)if(h=So[a],y=h.interleaved,y!==null){h.interleaved=null;var b=y.next,E=h.pending;if(E!==null){var S=E.next;E.next=b,y.next=S}h.pending=y}So=null}return i}function q0(i,a){do{var h=Mr;try{if(kg(),Id.current=Jd,Kd){for(var y=_r.memoizedState;y!==null;){var b=y.queue;b!==null&&(b.pending=null),y=y.next}Kd=!1}if(Po=0,Wr=Fr=_r=null,Cc=!1,qc=0,Og.current=null,h===null||h.return===null){Br=1,Wc=a,Mr=null;break}e:{var E=i,S=h.return,d=h,H=a;if(a=si,d.flags|=32768,H!==null&&typeof H=="object"&&typeof H.then=="function"){var le=H,ve=d,ne=ve.tag;if(!(ve.mode&1)&&(ne===0||ne===11||ne===15)){var G=ve.alternate;G?(ve.updateQueue=G.updateQueue,ve.memoizedState=G.memoizedState,ve.lanes=G.lanes):(ve.updateQueue=null,ve.memoizedState=null)}var Re=Sv(S);if(Re!==null){Re.flags&=-257,Tv(Re,S,d,E,a),Re.mode&1&&bv(E,le,a),a=Re,H=le;var Fe=a.updateQueue;if(Fe===null){var Ne=new Set;Ne.add(H),a.updateQueue=Ne}else Fe.add(H);break e}else{if(!(a&1)){bv(E,le,a),$g();break e}H=Error(Ce(426))}}else if(pr&&d.mode&1){var It=Sv(S);if(It!==null){!(It.flags&65536)&&(It.flags|=256),Tv(It,S,d,E,a),Sg(Yl(H,d));break e}}E=H=Yl(H,d),Br!==4&&(Br=2),zc===null?zc=[E]:zc.push(E),E=S;do{switch(E.tag){case 3:E.flags|=65536,a&=-a,E.lanes|=a;var ue=C0(E,H,a);gv(E,ue);break e;case 1:d=H;var re=E.type,de=E.stateNode;if(!(E.flags&128)&&(typeof re.getDerivedStateFromError=="function"||de!==null&&typeof de.componentDidCatch=="function"&&(La===null||!La.has(de)))){E.flags|=65536,a&=-a,E.lanes|=a;var Te=P0(E,d,a);gv(E,Te);break e}}E=E.return}while(E!==null)}W0(h)}catch(Ue){a=Ue,Mr===h&&h!==null&&(Mr=h=h.return);continue}break}while(!0)}function G0(){var i=Yd.current;return Yd.current=Jd,i===null?Jd:i}function $g(){(Br===0||Br===3||Br===2)&&(Br=4),Xr===null||!(zo&268435455)&&!(pp&268435455)||Ea(Xr,si)}function tp(i,a){var h=Nt;Nt|=2;var y=G0();(Xr!==i||si!==a)&&(As=null,ko(i,a));do try{uS();break}catch(b){q0(i,b)}while(!0);if(kg(),Nt=h,Yd.current=y,Mr!==null)throw Error(Ce(261));return Xr=null,si=0,Br}function uS(){for(;Mr!==null;)H0(Mr)}function cS(){for(;Mr!==null&&!Rb();)H0(Mr)}function H0(i){var a=K0(i.alternate,i,ln);i.memoizedProps=i.pendingProps,a===null?W0(i):Mr=a,Og.current=null}function W0(i){var a=i;do{var h=a.alternate;if(i=a.return,a.flags&32768){if(h=iS(h,a),h!==null){h.flags&=32767,Mr=h;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Br=6,Mr=null;return}}else if(h=rS(h,a,ln),h!==null){Mr=h;return}if(a=a.sibling,a!==null){Mr=a;return}Mr=a=i}while(a!==null);Br===0&&(Br=5)}function wo(i,a,h){var y=Wt,b=Cn.transition;try{Cn.transition=null,Wt=1,hS(i,a,h,y)}finally{Cn.transition=b,Wt=y}return null}function hS(i,a,h,y){do Gl();while(Ca!==null);if(Nt&6)throw Error(Ce(327));h=i.finishedWork;var b=i.finishedLanes;if(h===null)return null;if(i.finishedWork=null,i.finishedLanes=0,h===i.current)throw Error(Ce(177));i.callbackNode=null,i.callbackPriority=0;var E=h.lanes|h.childLanes;if(qb(i,E),i===Xr&&(Mr=Xr=null,si=0),!(h.subtreeFlags&2064)&&!(h.flags&2064)||yd||(yd=!0,J0(Fd,function(){return Gl(),null})),E=(h.flags&15990)!==0,h.subtreeFlags&15990||E){E=Cn.transition,Cn.transition=null;var S=Wt;Wt=1;var d=Nt;Nt|=4,Og.current=null,sS(i,h),U0(h,i),A2(Am),Od=!!zm,Am=zm=null,i.current=h,aS(h),Fb(),Nt=d,Wt=S,Cn.transition=E}else i.current=h;if(yd&&(yd=!1,Ca=i,ep=b),E=i.pendingLanes,E===0&&(La=null),Nb(h.stateNode),Hi(i,Er()),a!==null)for(y=i.onRecoverableError,h=0;h<a.length;h++)b=a[h],y(b.value,{componentStack:b.stack,digest:b.digest});if(Qd)throw Qd=!1,i=Jm,Jm=null,i;return ep&1&&i.tag!==0&&Gl(),E=i.pendingLanes,E&1?i===Ym?Ac++:(Ac=0,Ym=i):Ac=0,Va(),null}function Gl(){if(Ca!==null){var i=Cx(ep),a=Cn.transition,h=Wt;try{if(Cn.transition=null,Wt=16>i?16:i,Ca===null)var y=!1;else{if(i=Ca,Ca=null,ep=0,Nt&6)throw Error(Ce(331));var b=Nt;for(Nt|=4,rt=i.current;rt!==null;){var E=rt,S=E.child;if(rt.flags&16){var d=E.deletions;if(d!==null){for(var H=0;H<d.length;H++){var le=d[H];for(rt=le;rt!==null;){var ve=rt;switch(ve.tag){case 0:case 11:case 15:Pc(8,ve,E)}var ne=ve.child;if(ne!==null)ne.return=ve,rt=ne;else for(;rt!==null;){ve=rt;var G=ve.sibling,Re=ve.return;if(N0(ve),ve===le){rt=null;break}if(G!==null){G.return=Re,rt=G;break}rt=Re}}}var Fe=E.alternate;if(Fe!==null){var Ne=Fe.child;if(Ne!==null){Fe.child=null;do{var It=Ne.sibling;Ne.sibling=null,Ne=It}while(Ne!==null)}}rt=E}}if(E.subtreeFlags&2064&&S!==null)S.return=E,rt=S;else e:for(;rt!==null;){if(E=rt,E.flags&2048)switch(E.tag){case 0:case 11:case 15:Pc(9,E,E.return)}var ue=E.sibling;if(ue!==null){ue.return=E.return,rt=ue;break e}rt=E.return}}var re=i.current;for(rt=re;rt!==null;){S=rt;var de=S.child;if(S.subtreeFlags&2064&&de!==null)de.return=S,rt=de;else e:for(S=re;rt!==null;){if(d=rt,d.flags&2048)try{switch(d.tag){case 0:case 11:case 15:dp(9,d)}}catch(Ue){Tr(d,d.return,Ue)}if(d===S){rt=null;break e}var Te=d.sibling;if(Te!==null){Te.return=d.return,rt=Te;break e}rt=d.return}}if(Nt=b,Va(),os&&typeof os.onPostCommitFiberRoot=="function")try{os.onPostCommitFiberRoot(np,i)}catch{}y=!0}return y}finally{Wt=h,Cn.transition=a}}return!1}function Bv(i,a,h){a=Yl(h,a),a=C0(i,a,1),i=Da(i,a,1),a=zi(),i!==null&&(Kc(i,1,a),Hi(i,a))}function Tr(i,a,h){if(i.tag===3)Bv(i,i,h);else for(;a!==null;){if(a.tag===3){Bv(a,i,h);break}else if(a.tag===1){var y=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(La===null||!La.has(y))){i=Yl(h,i),i=P0(a,i,1),a=Da(a,i,1),i=zi(),a!==null&&(Kc(a,1,i),Hi(a,i));break}}a=a.return}}function dS(i,a,h){var y=i.pingCache;y!==null&&y.delete(a),a=zi(),i.pingedLanes|=i.suspendedLanes&h,Xr===i&&(si&h)===h&&(Br===4||Br===3&&(si&130023424)===si&&500>Er()-jg?ko(i,0):Ng|=h),Hi(i,a)}function X0(i,a){a===0&&(i.mode&1?(a=od,od<<=1,!(od&130023424)&&(od=4194304)):a=1);var h=zi();i=Os(i,a),i!==null&&(Kc(i,a,h),Hi(i,h))}function pS(i){var a=i.memoizedState,h=0;a!==null&&(h=a.retryLane),X0(i,h)}function fS(i,a){var h=0;switch(i.tag){case 13:var y=i.stateNode,b=i.memoizedState;b!==null&&(h=b.retryLane);break;case 19:y=i.stateNode;break;default:throw Error(Ce(314))}y!==null&&y.delete(a),X0(i,h)}var K0;K0=function(i,a,h){if(i!==null)if(i.memoizedProps!==a.pendingProps||qi.current)Zi=!0;else{if(!(i.lanes&h)&&!(a.flags&128))return Zi=!1,tS(i,a,h);Zi=!!(i.flags&131072)}else Zi=!1,pr&&a.flags&1048576&&e0(a,qd,a.index);switch(a.lanes=0,a.tag){case 2:var y=a.type;Pd(i,a),i=a.pendingProps;var b=Wl(a,xi.current);ql(a,h),b=Dg(null,a,y,i,b,h);var E=Lg();return a.flags|=1,typeof b=="object"&&b!==null&&typeof b.render=="function"&&b.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,Gi(y)?(E=!0,$d(a)):E=!1,a.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,Cg(a),b.updater=hp,a.stateNode=b,b._reactInternals=a,jm(a,y,i,h),a=$m(null,a,y,!0,E,h)):(a.tag=0,pr&&E&&wg(a),Pi(null,a,b,h),a=a.child),a;case 16:y=a.elementType;e:{switch(Pd(i,a),i=a.pendingProps,b=y._init,y=b(y._payload),a.type=y,b=a.tag=gS(y),i=jn(y,i),b){case 0:a=Um(null,a,y,i,h);break e;case 1:a=Iv(null,a,y,i,h);break e;case 11:a=kv(null,a,y,i,h);break e;case 14:a=Ev(null,a,y,jn(y.type,i),h);break e}throw Error(Ce(306,y,""))}return a;case 0:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:jn(y,b),Um(i,a,y,b,h);case 1:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:jn(y,b),Iv(i,a,y,b,h);case 3:e:{if(D0(a),i===null)throw Error(Ce(387));y=a.pendingProps,E=a.memoizedState,b=E.element,a0(i,a),Wd(a,y,null,h);var S=a.memoizedState;if(y=S.element,E.isDehydrated)if(E={element:y,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},a.updateQueue.baseState=E,a.memoizedState=E,a.flags&256){b=Yl(Error(Ce(423)),a),a=Cv(i,a,y,h,b);break e}else if(y!==b){b=Yl(Error(Ce(424)),a),a=Cv(i,a,y,h,b);break e}else for(un=Ma(a.stateNode.containerInfo.firstChild),cn=a,pr=!0,Un=null,h=n0(a,null,y,h),a.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Xl(),y===b){a=Ns(i,a,h);break e}Pi(i,a,y,h)}a=a.child}return a;case 5:return o0(a),i===null&&Bm(a),y=a.type,b=a.pendingProps,E=i!==null?i.memoizedProps:null,S=b.children,Mm(y,b)?S=null:E!==null&&Mm(y,E)&&(a.flags|=32),M0(i,a),Pi(i,a,S,h),a.child;case 6:return i===null&&Bm(a),null;case 13:return L0(i,a,h);case 4:return Pg(a,a.stateNode.containerInfo),y=a.pendingProps,i===null?a.child=Kl(a,null,y,h):Pi(i,a,y,h),a.child;case 11:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:jn(y,b),kv(i,a,y,b,h);case 7:return Pi(i,a,a.pendingProps,h),a.child;case 8:return Pi(i,a,a.pendingProps.children,h),a.child;case 12:return Pi(i,a,a.pendingProps.children,h),a.child;case 10:e:{if(y=a.type._context,b=a.pendingProps,E=a.memoizedProps,S=b.value,ir(Gd,y._currentValue),y._currentValue=S,E!==null)if(qn(E.value,S)){if(E.children===b.children&&!qi.current){a=Ns(i,a,h);break e}}else for(E=a.child,E!==null&&(E.return=a);E!==null;){var d=E.dependencies;if(d!==null){S=E.child;for(var H=d.firstContext;H!==null;){if(H.context===y){if(E.tag===1){H=Rs(-1,h&-h),H.tag=2;var le=E.updateQueue;if(le!==null){le=le.shared;var ve=le.pending;ve===null?H.next=H:(H.next=ve.next,ve.next=H),le.pending=H}}E.lanes|=h,H=E.alternate,H!==null&&(H.lanes|=h),Om(E.return,h,a),d.lanes|=h;break}H=H.next}}else if(E.tag===10)S=E.type===a.type?null:E.child;else if(E.tag===18){if(S=E.return,S===null)throw Error(Ce(341));S.lanes|=h,d=S.alternate,d!==null&&(d.lanes|=h),Om(S,h,a),S=E.sibling}else S=E.child;if(S!==null)S.return=E;else for(S=E;S!==null;){if(S===a){S=null;break}if(E=S.sibling,E!==null){E.return=S.return,S=E;break}S=S.return}E=S}Pi(i,a,b.children,h),a=a.child}return a;case 9:return b=a.type,y=a.pendingProps.children,ql(a,h),b=Pn(b),y=y(b),a.flags|=1,Pi(i,a,y,h),a.child;case 14:return y=a.type,b=jn(y,a.pendingProps),b=jn(y.type,b),Ev(i,a,y,b,h);case 15:return z0(i,a,a.type,a.pendingProps,h);case 17:return y=a.type,b=a.pendingProps,b=a.elementType===y?b:jn(y,b),Pd(i,a),a.tag=1,Gi(y)?(i=!0,$d(a)):i=!1,ql(a,h),I0(a,y,b),jm(a,y,b,h),$m(null,a,y,!0,i,h);case 19:return R0(i,a,h);case 22:return A0(i,a,h)}throw Error(Ce(156,a.tag))};function J0(i,a){return Tx(i,a)}function mS(i,a,h,y){this.tag=i,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function In(i,a,h,y){return new mS(i,a,h,y)}function Zg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function gS(i){if(typeof i=="function")return Zg(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ug)return 11;if(i===cg)return 14}return 2}function Fa(i,a){var h=i.alternate;return h===null?(h=In(i.tag,a,i.key,i.mode),h.elementType=i.elementType,h.type=i.type,h.stateNode=i.stateNode,h.alternate=i,i.alternate=h):(h.pendingProps=a,h.type=i.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=i.flags&14680064,h.childLanes=i.childLanes,h.lanes=i.lanes,h.child=i.child,h.memoizedProps=i.memoizedProps,h.memoizedState=i.memoizedState,h.updateQueue=i.updateQueue,a=i.dependencies,h.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},h.sibling=i.sibling,h.index=i.index,h.ref=i.ref,h}function Md(i,a,h,y,b,E){var S=2;if(y=i,typeof i=="function")Zg(i)&&(S=1);else if(typeof i=="string")S=5;else e:switch(i){case zl:return Eo(h.children,b,E,a);case lg:S=8,b|=8;break;case cm:return i=In(12,h,a,b|2),i.elementType=cm,i.lanes=E,i;case hm:return i=In(13,h,a,b),i.elementType=hm,i.lanes=E,i;case dm:return i=In(19,h,a,b),i.elementType=dm,i.lanes=E,i;case ox:return fp(h,b,E,a);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case sx:S=10;break e;case ax:S=9;break e;case ug:S=11;break e;case cg:S=14;break e;case Sa:S=16,y=null;break e}throw Error(Ce(130,i==null?i:typeof i,""))}return a=In(S,h,a,b),a.elementType=i,a.type=y,a.lanes=E,a}function Eo(i,a,h,y){return i=In(7,i,y,a),i.lanes=h,i}function fp(i,a,h,y){return i=In(22,i,y,a),i.elementType=ox,i.lanes=h,i.stateNode={isHidden:!1},i}function sm(i,a,h){return i=In(6,i,null,a),i.lanes=h,i}function am(i,a,h){return a=In(4,i.children!==null?i.children:[],i.key,a),a.lanes=h,a.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},a}function yS(i,a,h,y,b){this.tag=a,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jf(0),this.expirationTimes=jf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jf(0),this.identifierPrefix=y,this.onRecoverableError=b,this.mutableSourceEagerHydrationData=null}function qg(i,a,h,y,b,E,S,d,H){return i=new yS(i,a,h,d,H),a===1?(a=1,E===!0&&(a|=8)):a=0,E=In(3,null,null,a),i.current=E,E.stateNode=i,E.memoizedState={element:y,isDehydrated:h,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cg(E),i}function _S(i,a,h){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pl,key:y==null?null:""+y,children:i,containerInfo:a,implementation:h}}function Y0(i){if(!i)return Oa;i=i._reactInternals;e:{if(Do(i)!==i||i.tag!==1)throw Error(Ce(170));var a=i;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(Gi(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(Ce(171))}if(i.tag===1){var h=i.type;if(Gi(h))return Yx(i,h,a)}return a}function Q0(i,a,h,y,b,E,S,d,H){return i=qg(h,y,!0,i,b,E,S,d,H),i.context=Y0(null),h=i.current,y=zi(),b=Ra(h),E=Rs(y,b),E.callback=a??null,Da(h,E,b),i.current.lanes=b,Kc(i,b,y),Hi(i,y),i}function mp(i,a,h,y){var b=a.current,E=zi(),S=Ra(b);return h=Y0(h),a.context===null?a.context=h:a.pendingContext=h,a=Rs(E,S),a.payload={element:i},y=y===void 0?null:y,y!==null&&(a.callback=y),i=Da(b,a,S),i!==null&&(Zn(i,b,S,E),Ed(i,b,S)),S}function rp(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Ov(i,a){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var h=i.retryLane;i.retryLane=h!==0&&h<a?h:a}}function Gg(i,a){Ov(i,a),(i=i.alternate)&&Ov(i,a)}function vS(){return null}var e1=typeof reportError=="function"?reportError:function(i){console.error(i)};function Hg(i){this._internalRoot=i}gp.prototype.render=Hg.prototype.render=function(i){var a=this._internalRoot;if(a===null)throw Error(Ce(409));mp(i,a,null,null)};gp.prototype.unmount=Hg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var a=i.containerInfo;Ao(function(){mp(null,i,null,null)}),a[Bs]=null}};function gp(i){this._internalRoot=i}gp.prototype.unstable_scheduleHydration=function(i){if(i){var a=Ax();i={blockedOn:null,target:i,priority:a};for(var h=0;h<ka.length&&a!==0&&a<ka[h].priority;h++);ka.splice(h,0,i),h===0&&Dx(i)}};function Wg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function yp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function Nv(){}function xS(i,a,h,y,b){if(b){if(typeof y=="function"){var E=y;y=function(){var le=rp(S);E.call(le)}}var S=Q0(a,y,i,0,null,!1,!1,"",Nv);return i._reactRootContainer=S,i[Bs]=S.current,jc(i.nodeType===8?i.parentNode:i),Ao(),S}for(;b=i.lastChild;)i.removeChild(b);if(typeof y=="function"){var d=y;y=function(){var le=rp(H);d.call(le)}}var H=qg(i,0,!1,null,null,!1,!1,"",Nv);return i._reactRootContainer=H,i[Bs]=H.current,jc(i.nodeType===8?i.parentNode:i),Ao(function(){mp(a,H,h,y)}),H}function _p(i,a,h,y,b){var E=h._reactRootContainer;if(E){var S=E;if(typeof b=="function"){var d=b;b=function(){var H=rp(S);d.call(H)}}mp(a,S,i,b)}else S=xS(h,a,i,b,y);return rp(S)}Px=function(i){switch(i.tag){case 3:var a=i.stateNode;if(a.current.memoizedState.isDehydrated){var h=wc(a.pendingLanes);h!==0&&(pg(a,h|1),Hi(a,Er()),!(Nt&6)&&(Ql=Er()+500,Va()))}break;case 13:Ao(function(){var y=Os(i,1);if(y!==null){var b=zi();Zn(y,i,1,b)}}),Gg(i,1)}};fg=function(i){if(i.tag===13){var a=Os(i,134217728);if(a!==null){var h=zi();Zn(a,i,134217728,h)}Gg(i,134217728)}};zx=function(i){if(i.tag===13){var a=Ra(i),h=Os(i,a);if(h!==null){var y=zi();Zn(h,i,a,y)}Gg(i,a)}};Ax=function(){return Wt};Mx=function(i,a){var h=Wt;try{return Wt=i,a()}finally{Wt=h}};bm=function(i,a,h){switch(a){case"input":if(mm(i,h),a=h.name,h.type==="radio"&&a!=null){for(h=i;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<h.length;a++){var y=h[a];if(y!==i&&y.form===i.form){var b=lp(y);if(!b)throw Error(Ce(90));ux(y),mm(y,b)}}}break;case"textarea":hx(i,h);break;case"select":a=h.value,a!=null&&Vl(i,!!h.multiple,a,!1)}};_x=Vg;vx=Ao;var wS={usingClientEntryPoint:!1,Events:[Yc,Ll,lp,gx,yx,Vg]},_c={findFiberByHostInstance:bo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bS={bundleType:_c.bundleType,version:_c.version,rendererPackageName:_c.rendererPackageName,rendererConfig:_c.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:js.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=bx(i),i===null?null:i.stateNode},findFiberByHostInstance:_c.findFiberByHostInstance||vS,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _d=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_d.isDisabled&&_d.supportsFiber)try{np=_d.inject(bS),os=_d}catch{}}dn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wS;dn.createPortal=function(i,a){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Wg(a))throw Error(Ce(200));return _S(i,a,null,h)};dn.createRoot=function(i,a){if(!Wg(i))throw Error(Ce(299));var h=!1,y="",b=e1;return a!=null&&(a.unstable_strictMode===!0&&(h=!0),a.identifierPrefix!==void 0&&(y=a.identifierPrefix),a.onRecoverableError!==void 0&&(b=a.onRecoverableError)),a=qg(i,1,!1,null,null,h,!1,y,b),i[Bs]=a.current,jc(i.nodeType===8?i.parentNode:i),new Hg(a)};dn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var a=i._reactInternals;if(a===void 0)throw typeof i.render=="function"?Error(Ce(188)):(i=Object.keys(i).join(","),Error(Ce(268,i)));return i=bx(a),i=i===null?null:i.stateNode,i};dn.flushSync=function(i){return Ao(i)};dn.hydrate=function(i,a,h){if(!yp(a))throw Error(Ce(200));return _p(null,i,a,!0,h)};dn.hydrateRoot=function(i,a,h){if(!Wg(i))throw Error(Ce(405));var y=h!=null&&h.hydratedSources||null,b=!1,E="",S=e1;if(h!=null&&(h.unstable_strictMode===!0&&(b=!0),h.identifierPrefix!==void 0&&(E=h.identifierPrefix),h.onRecoverableError!==void 0&&(S=h.onRecoverableError)),a=Q0(a,null,i,1,h??null,b,!1,E,S),i[Bs]=a.current,jc(i),y)for(i=0;i<y.length;i++)h=y[i],b=h._getVersion,b=b(h._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[h,b]:a.mutableSourceEagerHydrationData.push(h,b);return new gp(a)};dn.render=function(i,a,h){if(!yp(a))throw Error(Ce(200));return _p(null,i,a,!1,h)};dn.unmountComponentAtNode=function(i){if(!yp(i))throw Error(Ce(40));return i._reactRootContainer?(Ao(function(){_p(null,null,i,!1,function(){i._reactRootContainer=null,i[Bs]=null})}),!0):!1};dn.unstable_batchedUpdates=Vg;dn.unstable_renderSubtreeIntoContainer=function(i,a,h,y){if(!yp(h))throw Error(Ce(200));if(i==null||i._reactInternals===void 0)throw Error(Ce(38));return _p(i,a,h,!1,y)};dn.version="18.3.1-next-f1338f8080-20240426";function t1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t1)}catch(i){console.error(i)}}t1(),tx.exports=dn;var SS=tx.exports,jv=SS;lm.createRoot=jv.createRoot,lm.hydrateRoot=jv.hydrateRoot;var r1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(i,a){(function(h,y){i.exports=y()})(Kw,function(){var h={},y={};function b(S,d,H){if(y[S]=H,S==="index"){var le="var sharedModule = {}; ("+y.shared+")(sharedModule); ("+y.worker+")(sharedModule);",ve={};return y.shared(ve),y.index(h,ve),typeof window<"u"&&h.setWorkerUrl(window.URL.createObjectURL(new Blob([le],{type:"text/javascript"}))),h}}b("shared",["exports"],function(S){function d(r,t,n,o){return new(n||(n=Promise))(function(c,m){function g(k){try{x(o.next(k))}catch(I){m(I)}}function _(k){try{x(o.throw(k))}catch(I){m(I)}}function x(k){var I;k.done?c(k.value):(I=k.value,I instanceof n?I:new n(function(P){P(I)})).then(g,_)}x((o=o.apply(r,t||[])).next())})}function H(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}typeof SuppressedError=="function"&&SuppressedError;var le=ve;function ve(r,t){this.x=r,this.y=t}ve.prototype={clone:function(){return new ve(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,t){return this.clone()._rotateAround(r,t)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var t=r.x-this.x,n=r.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,t){return Math.atan2(this.x*t-this.y*r,this.x*r+this.y*t)},_matMult:function(r){var t=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=t,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var t=Math.cos(r),n=Math.sin(r),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(r,t){var n=Math.cos(r),o=Math.sin(r),c=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ve.convert=function(r){return r instanceof ve?r:Array.isArray(r)?new ve(r[0],r[1]):r};var ne=H(le),G=Re;function Re(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}Re.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,_=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:_=n,n=.5*(_-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var Fe=H(G);let Ne,It;function ue(){return Ne==null&&(Ne=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ne}function re(){if(It==null&&(It=!1,ue())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const c=4*o;t.fillStyle=`rgb(${c},${c+1},${c+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){It=!0;break}}}return It||!1}function de(r,t,n,o){const c=new Fe(r,t,n,o);return m=>c.solve(m)}const Te=de(.25,.1,.25,1);function Ue(r,t,n){return Math.min(n,Math.max(t,r))}function Ge(r,t,n){const o=n-t,c=((r-t)%o+o)%o+t;return c===t?n:c}function We(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}let it=1;function Mt(r,t,n){const o={};for(const c in r)o[c]=t.call(this,r[c],c,r);return o}function pt(r,t,n){const o={};for(const c in r)t.call(this,r[c],c,r)&&(o[c]=r[c]);return o}function gt(r){return Array.isArray(r)?r.map(gt):typeof r=="object"&&r?Mt(r,gt):r}const fr={};function Xt(r){fr[r]||(typeof console<"u"&&console.warn(r),fr[r]=!0)}function ur(r,t,n){return(n.y-r.y)*(t.x-r.x)>(t.y-r.y)*(n.x-r.x)}function wt(r){return typeof WorkerGlobalScope<"u"&&r!==void 0&&r instanceof WorkerGlobalScope}let Kr=null;function Or(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const Xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ct(r,t,n,o,c){return d(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(r,{timestamp:0});try{const g=m==null?void 0:m.format;if(!g||!g.startsWith("BGR")&&!g.startsWith("RGB"))throw new Error(`Unrecognized format ${g}`);const _=g.startsWith("BGR"),x=new Uint8ClampedArray(o*c*4);if(yield m.copyTo(x,function(k,I,P,M,R){const B=4*Math.max(-I,0),O=(Math.max(0,P)-P)*M*4+B,$=4*M,X=Math.max(0,I),he=Math.max(0,P);return{rect:{x:X,y:he,width:Math.min(k.width,I+M)-X,height:Math.min(k.height,P+R)-he},layout:[{offset:O,stride:$}]}}(r,t,n,o,c)),_)for(let k=0;k<x.length;k+=4){const I=x[k];x[k]=x[k+2],x[k+2]=I}return x}finally{m.close()}})}let dt,Tt;const Bt="AbortError";function oi(){return new Error(Bt)}const Ir={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jr(r){return Ir.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]}const Nr="global-dispatcher";class ke extends Error{constructor(t,n,o,c){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=c}}const Kt=()=>wt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,fn=function(r,t){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){const o=Jr(r.url);if(o)return o(r,t);if(wt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,targetMapId:Nr},t)}if(!(/^file:/.test(n=r.url)||/^file:/.test(Kt())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,c){return d(this,void 0,void 0,function*(){const m=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:Kt(),signal:c.signal});o.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");const g=yield fetch(m);if(!g.ok){const k=yield g.blob();throw new ke(g.status,g.statusText,o.url,k)}let _;_=o.type==="arrayBuffer"||o.type==="image"?g.arrayBuffer():o.type==="json"?g.json():g.text();const x=yield _;if(c.signal.aborted)throw oi();return{data:x,cacheControl:g.headers.get("Cache-Control"),expires:g.headers.get("Expires")}})}(r,t);if(wt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:r,mustQueue:!0,targetMapId:Nr},t)}var n;return function(o,c){return new Promise((m,g)=>{var _;const x=new XMLHttpRequest;x.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(x.responseType="arraybuffer");for(const k in o.headers)x.setRequestHeader(k,o.headers[k]);o.type==="json"&&(x.responseType="text",!((_=o.headers)===null||_===void 0)&&_.Accept||x.setRequestHeader("Accept","application/json")),x.withCredentials=o.credentials==="include",x.onerror=()=>{g(new Error(x.statusText))},x.onload=()=>{if(!c.signal.aborted)if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){let k=x.response;if(o.type==="json")try{k=JSON.parse(x.response)}catch(I){return void g(I)}m({data:k,cacheControl:x.getResponseHeader("Cache-Control"),expires:x.getResponseHeader("Expires")})}else{const k=new Blob([x.response],{type:x.getResponseHeader("Content-Type")});g(new ke(x.status,x.statusText,o.url,k))}},c.signal.addEventListener("abort",()=>{x.abort(),g(oi())}),x.send(o.body)})}(r,t)};function An(r){if(!r||r.indexOf("://")<=0||r.indexOf("data:image/")===0||r.indexOf("blob:")===0)return!0;const t=new URL(r),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function us(r,t,n){n[r]&&n[r].indexOf(t)!==-1||(n[r]=n[r]||[],n[r].push(t))}function Di(r,t,n){if(n&&n[r]){const o=n[r].indexOf(t);o!==-1&&n[r].splice(o,1)}}class Ct{constructor(t,n={}){We(this,n),this.type=t}}class Gn extends Ct{constructor(t,n={}){super("error",We({error:t},n))}}class Vs{on(t,n){return this._listeners=this._listeners||{},us(t,n,this._listeners),this}off(t,n){return Di(t,n,this._listeners),Di(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},us(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new Ct(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const _ of c)_.call(this,t);const m=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const _ of m)Di(o,_,this._oneTimeListeners),_.call(this,t);const g=this._eventedParent;g&&(We(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(t))}else t instanceof Gn&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var me={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const cs=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ua(r,t){const n={};for(const o in r)o!=="ref"&&(n[o]=r[o]);return cs.forEach(o=>{o in t&&(n[o]=t[o])}),n}function Rt(r,t){if(Array.isArray(r)){if(!Array.isArray(t)||r.length!==t.length)return!1;for(let n=0;n<r.length;n++)if(!Rt(r[n],t[n]))return!1;return!0}if(typeof r=="object"&&r!==null&&t!==null){if(typeof t!="object"||Object.keys(r).length!==Object.keys(t).length)return!1;for(const n in r)if(!Rt(r[n],t[n]))return!1;return!0}return r===t}function nr(r,t){r.push(t)}function $a(r,t,n){nr(n,{command:"addSource",args:[r,t[r]]})}function Hn(r,t,n){nr(t,{command:"removeSource",args:[r]}),n[r]=!0}function Mn(r,t,n,o){Hn(r,n,o),$a(r,t,n)}function Us(r,t,n){let o;for(o in r[n])if(Object.prototype.hasOwnProperty.call(r[n],o)&&o!=="data"&&!Rt(r[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!Rt(r[n][o],t[n][o]))return!1;return!0}function Li(r,t,n,o,c,m){r=r||{},t=t||{};for(const g in r)Object.prototype.hasOwnProperty.call(r,g)&&(Rt(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}));for(const g in t)Object.prototype.hasOwnProperty.call(t,g)&&!Object.prototype.hasOwnProperty.call(r,g)&&(Rt(r[g],t[g])||n.push({command:m,args:[o,g,t[g],c]}))}function Za(r){return r.id}function qa(r,t){return r[t.id]=t,r}class Ie{constructor(t,n,o,c){this.message=(t?`${t}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function mn(r,...t){for(const n of t)for(const o in n)r[o]=n[o];return r}class Yr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class gn{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(t){return new gn(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Wn={kind:"null"},Me={kind:"number"},_t={kind:"string"},ot={kind:"boolean"},li={kind:"color"},Wi={kind:"object"},ft={kind:"value"},yn={kind:"collator"},Dn={kind:"formatted"},Xn={kind:"padding"},_n={kind:"resolvedImage"},W={kind:"variableAnchorOffsetCollection"};function L(r,t){return{kind:"array",itemType:r,N:t}}function D(r){if(r.kind==="array"){const t=D(r.itemType);return typeof r.N=="number"?`array<${t}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${t}>`}return r.kind}const N=[Wn,Me,_t,ot,li,Dn,Wi,L(ft),Xn,_n,W];function Z(r,t){if(t.kind==="error")return null;if(r.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Z(r.itemType,t.itemType))&&(typeof r.N!="number"||r.N===t.N))return null}else{if(r.kind===t.kind)return null;if(r.kind==="value"){for(const n of N)if(!Z(n,t))return null}}return`Expected ${D(r)} but found ${D(t)} instead.`}function te(r,t){return t.some(n=>n.kind===r.kind)}function se(r,t){return t.some(n=>n==="null"?r===null:n==="array"?Array.isArray(r):n==="object"?r&&!Array.isArray(r)&&typeof r=="object":n===typeof r)}function ce(r,t){return r.kind==="array"&&t.kind==="array"?r.itemType.kind===t.itemType.kind&&typeof r.N=="number":r.kind===t.kind}const Y=.96422,ye=.82521,be=4/29,fe=6/29,Pe=3*fe*fe,tt=fe*fe*fe,nt=Math.PI/180,Pt=180/Math.PI;function mt(r){return(r%=360)<0&&(r+=360),r}function zt([r,t,n,o]){let c,m;const g=xr((.2225045*(r=bt(r))+.7168786*(t=bt(t))+.0606169*(n=bt(n)))/1);r===t&&t===n?c=m=g:(c=xr((.4360747*r+.3850649*t+.1430804*n)/Y),m=xr((.0139322*r+.0971045*t+.7141733*n)/ye));const _=116*g-16;return[_<0?0:_,500*(c-g),200*(g-m),o]}function bt(r){return r<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function xr(r){return r>tt?Math.pow(r,1/3):r/Pe+be}function sr([r,t,n,o]){let c=(r+16)/116,m=isNaN(t)?c:c+t/500,g=isNaN(n)?c:c-n/200;return c=1*jt(c),m=Y*jt(m),g=ye*jt(g),[vt(3.1338561*m-1.6168667*c-.4906146*g),vt(-.9787684*m+1.9161415*c+.033454*g),vt(.0719453*m-.2289914*c+1.4052427*g),o]}function vt(r){return(r=r<=.00304?12.92*r:1.055*Math.pow(r,1/2.4)-.055)<0?0:r>1?1:r}function jt(r){return r>fe?r*r*r:Pe*(r-be)}function rr(r){return parseInt(r.padEnd(2,r),16)/255}function Cr(r,t){return Dr(t?r/100:r,0,1)}function Dr(r,t,n){return Math.min(Math.max(t,r),n)}function Qr(r){return!r.some(Number.isNaN)}const $s={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Vt{constructor(t,n,o,c=1,m=!0){this.r=t,this.g=n,this.b=o,this.a=c,m||(this.r*=c,this.g*=c,this.b*=c,c||this.overwriteGetter("rgb",[t,n,o,c]))}static parse(t){if(t instanceof Vt)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const c=$s[o];if(c){const[g,_,x]=c;return[g/255,_/255,x/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const g=o.length<6?1:2;let _=1;return[rr(o.slice(_,_+=g)),rr(o.slice(_,_+=g)),rr(o.slice(_,_+=g)),rr(o.slice(_,_+g)||"ff")]}if(o.startsWith("rgb")){const g=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,x,k,I,P,M,R,B,O,$,X,he]=g,ee=[I||" ",R||" ",$].join("");if(ee==="  "||ee==="  /"||ee===",,"||ee===",,,"){const oe=[k,M,O].join(""),ge=oe==="%%%"?100:oe===""?255:0;if(ge){const Se=[Dr(+x/ge,0,1),Dr(+P/ge,0,1),Dr(+B/ge,0,1),X?Cr(+X,he):1];if(Qr(Se))return Se}}return}}const m=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[g,_,x,k,I,P,M,R,B]=m,O=[x||" ",I||" ",M].join("");if(O==="  "||O==="  /"||O===",,"||O===",,,"){const $=[+_,Dr(+k,0,100),Dr(+P,0,100),R?Cr(+R,B):1];if(Qr($))return function([X,he,ee,oe]){function ge(Se){const Ve=(Se+X/30)%12,st=he*Math.min(ee,1-ee);return ee-st*Math.max(-1,Math.min(Ve-3,9-Ve,1))}return X=mt(X),he/=100,ee/=100,[ge(0),ge(8),ge(4),oe]}($)}}}(t);return n?new Vt(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:c}=this,m=c||1/0;return this.overwriteGetter("rgb",[t/m,n/m,o/m,c])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,c,m]=zt(t),g=Math.sqrt(o*o+c*c);return[Math.round(1e4*g)?mt(Math.atan2(c,o)*Pt):NaN,g,n,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zt(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,c]=this.rgb;return`rgba(${[t,n,o].map(m=>Math.round(255*m)).join(",")},${c})`}}Vt.black=new Vt(0,0,0,1),Vt.white=new Vt(1,1,1,1),Vt.transparent=new Vt(0,0,0,0),Vt.red=new Vt(1,0,0,1);class iu{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class nu{constructor(t,n,o,c,m){this.text=t,this.image=n,this.scale=o,this.fontStack=c,this.textColor=m}}class wi{constructor(t){this.sections=t}static fromString(t){return new wi([new nu(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof wi?t:wi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class bi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof bi)return t;if(typeof t=="number")return new bi([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new bi(t)}}toString(){return JSON.stringify(this.values)}}const vp=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ri{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ri)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],c=t[n+1];if(typeof o!="string"||!vp.has(o)||!Array.isArray(c)||c.length!==2||typeof c[0]!="number"||typeof c[1]!="number")return}return new Ri(t)}}toString(){return JSON.stringify(this.values)}}class Si{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Si({name:t,available:!1}):null}}function Zs(r,t,n,o){return typeof r=="number"&&r>=0&&r<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[r,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[r,t,n,o]:[r,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hs(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Vt||r instanceof iu||r instanceof wi||r instanceof bi||r instanceof Ri||r instanceof Si)return!0;if(Array.isArray(r)){for(const t of r)if(!hs(t))return!1;return!0}if(typeof r=="object"){for(const t in r)if(!hs(r[t]))return!1;return!0}return!1}function wr(r){if(r===null)return Wn;if(typeof r=="string")return _t;if(typeof r=="boolean")return ot;if(typeof r=="number")return Me;if(r instanceof Vt)return li;if(r instanceof iu)return yn;if(r instanceof wi)return Dn;if(r instanceof bi)return Xn;if(r instanceof Ri)return W;if(r instanceof Si)return _n;if(Array.isArray(r)){const t=r.length;let n;for(const o of r){const c=wr(o);if(n){if(n===c)continue;n=ft;break}n=c}return L(n||ft,t)}return Wi}function Ga(r){const t=typeof r;return r===null?"":t==="string"||t==="number"||t==="boolean"?String(r):r instanceof Vt||r instanceof wi||r instanceof bi||r instanceof Ri||r instanceof Si?r.toString():JSON.stringify(r)}class Xi{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!hs(t[1]))return n.error("invalid value");const o=t[1];let c=wr(o);const m=n.expectedType;return c.kind!=="array"||c.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(c=m),new Xi(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class mr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const Lo={string:_t,number:Me,boolean:ot,object:Wi};class Ki{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,c=1;const m=t[0];if(m==="array"){let _,x;if(t.length>2){const k=t[1];if(typeof k!="string"||!(k in Lo)||k==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);_=Lo[k],c++}else _=ft;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);x=t[2],c++}o=L(_,x)}else{if(!Lo[m])throw new Error(`Types doesn't contain name = ${m}`);o=Lo[m]}const g=[];for(;c<t.length;c++){const _=n.parse(t[c],c,ft);if(!_)return null;g.push(_)}return new Ki(o,g)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!Z(this.type,wr(o)))return o;if(n===this.args.length-1)throw new mr(`Expected value to be of type ${D(this.type)}, but found ${D(wr(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const su={"to-boolean":ot,"to-color":li,"to-number":Me,"to-string":_t};class Ji{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!su[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const c=su[o],m=[];for(let g=1;g<t.length;g++){const _=n.parse(t[g],g,ft);if(!_)return null;m.push(_)}return new Ji(c,m)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const c of this.args){if(n=c.evaluate(t),o=null,n instanceof Vt)return n;if(typeof n=="string"){const m=t.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Zs(n[0],n[1],n[2],n[3]),!o))return new Vt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new mr(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const c=bi.parse(n);if(c)return c}throw new mr(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const c=Ri.parse(n);if(c)return c}throw new mr(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new mr(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return wi.fromString(Ga(this.args[0].evaluate(t)));case"resolvedImage":return Si.fromString(Ga(this.args[0].evaluate(t)));default:return Ga(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const xp=["Unknown","Point","LineString","Polygon"];class Ro{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?xp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Vt.parse(t)),n}}class ds{constructor(t,n,o=[],c,m=new gn,g=[]){this.registry=t,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=m,this.errors=g,this.expectedType=c,this._isConstant=n}parse(t,n,o,c,m={}){return n?this.concat(n,o,c)._parse(t,m):this._parse(t,m)}_parse(t,n){function o(c,m,g){return g==="assert"?new Ki(m,[c]):g==="coerce"?new Ji(m,[c]):c}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=t[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[c];if(m){let g=m.parse(t,this);if(!g)return null;if(this.expectedType){const _=this.expectedType,x=g.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string")if(_.kind!=="padding"||x.kind!=="value"&&x.kind!=="number"&&x.kind!=="array")if(_.kind!=="variableAnchorOffsetCollection"||x.kind!=="value"&&x.kind!=="array"){if(this.checkSubtype(_,x))return null}else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"coerce");else g=o(g,_,n.typeAnnotation||"assert")}if(!(g instanceof Xi)&&g.type.kind!=="resolvedImage"&&this._isConstant(g)){const _=new Ro;try{g=new Xi(g.type,g.evaluate(_))}catch(x){return this.error(x.message),null}}return g}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const c=typeof t=="number"?this.path.concat(t):this.path,m=o?this.scope.concat(o):this.scope;return new ds(this.registry,this._isConstant,c,n||null,m,this.errors)}error(t,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Yr(o,t))}checkSubtype(t,n){const o=Z(t,n);return o&&this.error(o),o}}class Kn{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let m=1;m<t.length-1;m+=2){const g=t[m];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,m);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const _=n.parse(t[m+1],m+1);if(!_)return null;o.push([g,_])}const c=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return c?new Kn(o,c):null}outputDefined(){return this.result.outputDefined()}}class Ft{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new Ft(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class au{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Me),c=n.parse(t[2],2,L(n.expectedType||ft));return o&&c?new au(c.type.itemType,o,c):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new mr(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new mr(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new mr(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ou{constructor(t,n){this.type=ot,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,ft),c=n.parse(t[2],2,ft);return o&&c?te(o.type,[ot,_t,Me,Wn,ft])?new ou(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!se(n,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${D(wr(n))} instead.`);if(!se(o,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${D(wr(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class qs{constructor(t,n,o){this.type=Me,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,ft),c=n.parse(t[2],2,ft);if(!o||!c)return null;if(!te(o.type,[ot,_t,Me,Wn,ft]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,Me);return m?new qs(o,c,m):null}return new qs(o,c)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!se(n,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${D(wr(n))} instead.`);let c;if(this.fromIndex&&(c=this.fromIndex.evaluate(t)),se(o,["string"])){const m=o.indexOf(n,c);return m===-1?-1:[...o.slice(0,m)].length}if(se(o,["array"]))return o.indexOf(n,c);throw new mr(`Expected second argument to be of type array or string, but found ${D(wr(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class lu{constructor(t,n,o,c,m,g){this.inputType=t,this.type=n,this.input=o,this.cases=c,this.outputs=m,this.otherwise=g}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const m={},g=[];for(let k=2;k<t.length-1;k+=2){let I=t[k];const P=t[k+1];Array.isArray(I)||(I=[I]);const M=n.concat(k);if(I.length===0)return M.error("Expected at least one branch label.");for(const B of I){if(typeof B!="number"&&typeof B!="string")return M.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return M.error("Numeric branch labels must be integer values.");if(o){if(M.checkSubtype(o,wr(B)))return null}else o=wr(B);if(m[String(B)]!==void 0)return M.error("Branch labels must be unique.");m[String(B)]=g.length}const R=n.parse(P,k,c);if(!R)return null;c=c||R.type,g.push(R)}const _=n.parse(t[1],1,ft);if(!_)return null;const x=n.parse(t[t.length-1],t.length-1,c);return x?_.type.kind!=="value"&&n.concat(1).checkSubtype(o,_.type)?null:new lu(o,c,_,m,g,x):null}evaluate(t){const n=this.input.evaluate(t);return(wr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Fo{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let g=1;g<t.length-1;g+=2){const _=n.parse(t[g],g,ot);if(!_)return null;const x=n.parse(t[g+1],g+1,o);if(!x)return null;c.push([_,x]),o=o||x.type}const m=n.parse(t[t.length-1],t.length-1,o);if(!m)return null;if(!o)throw new Error("Can't infer output type");return new Fo(o,c,m)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Ha{constructor(t,n,o,c){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,ft),c=n.parse(t[2],2,Me);if(!o||!c)return null;if(!te(o.type,[L(ft),_t,ft]))return n.error(`Expected first argument to be of type array or string, but found ${D(o.type)} instead`);if(t.length===4){const m=n.parse(t[3],3,Me);return m?new Ha(o.type,o,c,m):null}return new Ha(o.type,o,c)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let c;if(this.endIndex&&(c=this.endIndex.evaluate(t)),se(n,["string"]))return[...n].slice(o,c).join("");if(se(n,["array"]))return n.slice(o,c);throw new mr(`Expected first argument to be of type array or string, but found ${D(wr(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Bo(r,t){const n=r.length-1;let o,c,m=0,g=n,_=0;for(;m<=g;)if(_=Math.floor((m+g)/2),o=r[_],c=r[_+1],o<=t){if(_===n||t<c)return _;m=_+1}else{if(!(o>t))throw new mr("Input is not a number.");g=_-1}return 0}class Gs{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[c,m]of o)this.labels.push(c),this.outputs.push(m)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Me);if(!o)return null;const c=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let g=1;g<t.length;g+=2){const _=g===1?-1/0:t[g],x=t[g+1],k=g,I=g+1;if(typeof _!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(c.length&&c[c.length-1][0]>=_)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const P=n.parse(x,I,m);if(!P)return null;m=m||P.type,c.push([_,P])}return new Gs(m,o,c)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;return c>=n[m-1]?o[m-1].evaluate(t):o[Bo(n,c)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function eh(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var wp=th;function th(r,t,n,o){this.cx=3*r,this.bx=3*(n-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=t,this.p2x=n,this.p2y=o}th.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,t){if(t===void 0&&(t=1e-6),r<0)return 0;if(r>1)return 1;for(var n=r,o=0;o<8;o++){var c=this.sampleCurveX(n)-r;if(Math.abs(c)<t)return n;var m=this.sampleCurveDerivativeX(n);if(Math.abs(m)<1e-6)break;n-=c/m}var g=0,_=1;for(n=r,o=0;o<20&&(c=this.sampleCurveX(n),!(Math.abs(c-r)<t));o++)r>c?g=n:_=n,n=.5*(_-g)+g;return n},solve:function(r,t){return this.sampleCurveY(this.solveCurveX(r,t))}};var bp=eh(wp);function ps(r,t,n){return r+n*(t-r)}function Wa(r,t,n){return r.map((o,c)=>ps(o,t[c],n))}const ui={number:ps,color:function(r,t,n,o="rgb"){switch(o){case"rgb":{const[c,m,g,_]=Wa(r.rgb,t.rgb,n);return new Vt(c,m,g,_,!1)}case"hcl":{const[c,m,g,_]=r.hcl,[x,k,I,P]=t.hcl;let M,R;if(isNaN(c)||isNaN(x))isNaN(c)?isNaN(x)?M=NaN:(M=x,g!==1&&g!==0||(R=k)):(M=c,I!==1&&I!==0||(R=m));else{let he=x-c;x>c&&he>180?he-=360:x<c&&c-x>180&&(he+=360),M=c+n*he}const[B,O,$,X]=function([he,ee,oe,ge]){return he=isNaN(he)?0:he*nt,sr([oe,Math.cos(he)*ee,Math.sin(he)*ee,ge])}([M,R??ps(m,k,n),ps(g,I,n),ps(_,P,n)]);return new Vt(B,O,$,X,!1)}case"lab":{const[c,m,g,_]=sr(Wa(r.lab,t.lab,n));return new Vt(c,m,g,_,!1)}}},array:Wa,padding:function(r,t,n){return new bi(Wa(r.values,t.values,n))},variableAnchorOffsetCollection:function(r,t,n){const o=r.values,c=t.values;if(o.length!==c.length)throw new mr(`Cannot interpolate values of different length. from: ${r.toString()}, to: ${t.toString()}`);const m=[];for(let g=0;g<o.length;g+=2){if(o[g]!==c[g])throw new mr(`Cannot interpolate values containing mismatched anchors. from[${g}]: ${o[g]}, to[${g}]: ${c[g]}`);m.push(o[g]);const[_,x]=o[g+1],[k,I]=c[g+1];m.push([ps(_,k,n),ps(x,I,n)])}return new Ri(m)}};class ci{constructor(t,n,o,c,m){this.type=t,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[g,_]of m)this.labels.push(g),this.outputs.push(_)}static interpolationFactor(t,n,o,c){let m=0;if(t.name==="exponential")m=Oo(n,t.base,o,c);else if(t.name==="linear")m=Oo(n,1,o,c);else if(t.name==="cubic-bezier"){const g=t.controlPoints;m=new bp(g[0],g[1],g[2],g[3]).solve(Oo(n,1,o,c))}return m}static parse(t,n){let[o,c,m,...g]=t;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const k=c[1];if(typeof k!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:k}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const k=c.slice(1);if(k.length!==4||k.some(I=>typeof I!="number"||I<0||I>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:k}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Me),!m)return null;const _=[];let x=null;o==="interpolate-hcl"||o==="interpolate-lab"?x=li:n.expectedType&&n.expectedType.kind!=="value"&&(x=n.expectedType);for(let k=0;k<g.length;k+=2){const I=g[k],P=g[k+1],M=k+3,R=k+4;if(typeof I!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(_.length&&_[_.length-1][0]>=I)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const B=n.parse(P,R,x);if(!B)return null;x=x||B.type,_.push([I,B])}return ce(x,Me)||ce(x,li)||ce(x,Xn)||ce(x,W)||ce(x,L(Me))?new ci(x,o,c,m,_):n.error(`Type ${D(x)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const c=this.input.evaluate(t);if(c<=n[0])return o[0].evaluate(t);const m=n.length;if(c>=n[m-1])return o[m-1].evaluate(t);const g=Bo(n,c),_=ci.interpolationFactor(this.interpolation,c,n[g],n[g+1]),x=o[g].evaluate(t),k=o[g+1].evaluate(t);switch(this.operator){case"interpolate":return ui[this.type.kind](x,k,_);case"interpolate-hcl":return ui.color(x,k,_,"hcl");case"interpolate-lab":return ui.color(x,k,_,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Oo(r,t,n,o){const c=o-n,m=r-n;return c===0?0:t===1?m/c:(Math.pow(t,m)-1)/(Math.pow(t,c)-1)}class No{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const m=[];for(const _ of t.slice(1)){const x=n.parse(_,1+m.length,o,void 0,{typeAnnotation:"omit"});if(!x)return null;o=o||x.type,m.push(x)}if(!o)throw new Error("No output type");const g=c&&m.some(_=>Z(c,_.type));return new No(g?ft:o,m)}evaluate(t){let n,o=null,c=0;for(const m of this.args)if(c++,o=m.evaluate(t),o&&o instanceof Si&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function jo(r,t){return r==="=="||r==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function rh(r,t,n,o){return o.compare(t,n)===0}function Hs(r,t,n){const o=r!=="=="&&r!=="!=";return class i1{constructor(m,g,_){this.type=ot,this.lhs=m,this.rhs=g,this.collator=_,this.hasUntypedArgument=m.type.kind==="value"||g.type.kind==="value"}static parse(m,g){if(m.length!==3&&m.length!==4)return g.error("Expected two or three arguments.");const _=m[0];let x=g.parse(m[1],1,ft);if(!x)return null;if(!jo(_,x.type))return g.concat(1).error(`"${_}" comparisons are not supported for type '${D(x.type)}'.`);let k=g.parse(m[2],2,ft);if(!k)return null;if(!jo(_,k.type))return g.concat(2).error(`"${_}" comparisons are not supported for type '${D(k.type)}'.`);if(x.type.kind!==k.type.kind&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error(`Cannot compare types '${D(x.type)}' and '${D(k.type)}'.`);o&&(x.type.kind==="value"&&k.type.kind!=="value"?x=new Ki(k.type,[x]):x.type.kind!=="value"&&k.type.kind==="value"&&(k=new Ki(x.type,[k])));let I=null;if(m.length===4){if(x.type.kind!=="string"&&k.type.kind!=="string"&&x.type.kind!=="value"&&k.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(I=g.parse(m[3],3,yn),!I)return null}return new i1(x,k,I)}evaluate(m){const g=this.lhs.evaluate(m),_=this.rhs.evaluate(m);if(o&&this.hasUntypedArgument){const x=wr(g),k=wr(_);if(x.kind!==k.kind||x.kind!=="string"&&x.kind!=="number")throw new mr(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${x.kind}, ${k.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const x=wr(g),k=wr(_);if(x.kind!=="string"||k.kind!=="string")return t(m,g,_)}return this.collator?n(m,g,_,this.collator.evaluate(m)):t(m,g,_)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Sp=Hs("==",function(r,t,n){return t===n},rh),ih=Hs("!=",function(r,t,n){return t!==n},function(r,t,n,o){return!rh(0,t,n,o)}),nh=Hs("<",function(r,t,n){return t<n},function(r,t,n,o){return o.compare(t,n)<0}),Tp=Hs(">",function(r,t,n){return t>n},function(r,t,n,o){return o.compare(t,n)>0}),kp=Hs("<=",function(r,t,n){return t<=n},function(r,t,n,o){return o.compare(t,n)<=0}),sh=Hs(">=",function(r,t,n){return t>=n},function(r,t,n,o){return o.compare(t,n)>=0});class Xa{constructor(t,n,o){this.type=yn,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ot);if(!c)return null;const m=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ot);if(!m)return null;let g=null;return o.locale&&(g=n.parse(o.locale,1,_t),!g)?null:new Xa(c,m,g)}evaluate(t){return new iu(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class uu{constructor(t,n,o,c,m){this.type=_t,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=m}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Me);if(!o)return null;const c=t[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let m=null;if(c.locale&&(m=n.parse(c.locale,1,_t),!m))return null;let g=null;if(c.currency&&(g=n.parse(c.currency,1,_t),!g))return null;let _=null;if(c["min-fraction-digits"]&&(_=n.parse(c["min-fraction-digits"],1,Me),!_))return null;let x=null;return c["max-fraction-digits"]&&(x=n.parse(c["max-fraction-digits"],1,Me),!x)?null:new uu(o,m,g,_,x)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Vo{constructor(t){this.type=Dn,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let m=!1;for(let g=1;g<=t.length-1;++g){const _=t[g];if(m&&typeof _=="object"&&!Array.isArray(_)){m=!1;let x=null;if(_["font-scale"]&&(x=n.parse(_["font-scale"],1,Me),!x))return null;let k=null;if(_["text-font"]&&(k=n.parse(_["text-font"],1,L(_t)),!k))return null;let I=null;if(_["text-color"]&&(I=n.parse(_["text-color"],1,li),!I))return null;const P=c[c.length-1];P.scale=x,P.font=k,P.textColor=I}else{const x=n.parse(t[g],1,ft);if(!x)return null;const k=x.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,c.push({content:x,scale:null,font:null,textColor:null})}}return new Vo(c)}evaluate(t){return new wi(this.sections.map(n=>{const o=n.content.evaluate(t);return wr(o)===_n?new nu("",o,null,null,null):new nu(Ga(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class cu{constructor(t){this.type=_n,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,_t);return o?new cu(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=Si.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class hu{constructor(t){this.type=Me,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${D(o.type)} instead.`):new hu(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new mr(`Expected value to be of type string or array, but found ${D(wr(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const vn=8192;function Ep(r,t){const n=(180+r[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,c=Math.pow(2,t.z);return[Math.round(n*c*vn),Math.round(o*c*vn)]}function du(r,t){const n=Math.pow(2,t.z);return[(c=(r[0]/vn+t.x)/n,360*c-180),(o=(r[1]/vn+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,c}function fs(r,t){r[0]=Math.min(r[0],t[0]),r[1]=Math.min(r[1],t[1]),r[2]=Math.max(r[2],t[0]),r[3]=Math.max(r[3],t[1])}function Jn(r,t){return!(r[0]<=t[0]||r[2]>=t[2]||r[1]<=t[1]||r[3]>=t[3])}function Ot(r,t,n){const o=r[0]-t[0],c=r[1]-t[1],m=r[0]-n[0],g=r[1]-n[1];return o*g-m*c==0&&o*m<=0&&c*g<=0}function Uo(r,t,n,o){return(c=[o[0]-n[0],o[1]-n[1]])[0]*(m=[t[0]-r[0],t[1]-r[1]])[1]-c[1]*m[0]!=0&&!(!oh(r,t,n,o)||!oh(n,o,r,t));var c,m}function Ip(r,t,n){for(const o of n)for(let c=0;c<o.length-1;++c)if(Uo(r,t,o[c],o[c+1]))return!0;return!1}function Ws(r,t,n=!1){let o=!1;for(const _ of t)for(let x=0;x<_.length-1;x++){if(Ot(r,_[x],_[x+1]))return n;(m=_[x])[1]>(c=r)[1]!=(g=_[x+1])[1]>c[1]&&c[0]<(g[0]-m[0])*(c[1]-m[1])/(g[1]-m[1])+m[0]&&(o=!o)}var c,m,g;return o}function Cp(r,t){for(const n of t)if(Ws(r,n))return!0;return!1}function ah(r,t){for(const n of r)if(!Ws(n,t))return!1;for(let n=0;n<r.length-1;++n)if(Ip(r[n],r[n+1],t))return!1;return!0}function Pp(r,t){for(const n of t)if(ah(r,n))return!0;return!1}function oh(r,t,n,o){const c=o[0]-n[0],m=o[1]-n[1],g=(r[0]-n[0])*m-c*(r[1]-n[1]),_=(t[0]-n[0])*m-c*(t[1]-n[1]);return g>0&&_<0||g<0&&_>0}function pu(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=[];for(let g=0;g<r[c].length;g++){const _=Ep(r[c][g],n);fs(t,_),m.push(_)}o.push(m)}return o}function lh(r,t,n){const o=[];for(let c=0;c<r.length;c++){const m=pu(r[c],t,n);o.push(m)}return o}function uh(r,t,n,o){if(r[0]<n[0]||r[0]>n[2]){const c=.5*o;let m=r[0]-n[0]>c?-o:n[0]-r[0]>c?o:0;m===0&&(m=r[0]-n[2]>c?-o:n[2]-r[0]>c?o:0),r[0]+=m}fs(t,r)}function ch(r,t,n,o){const c=Math.pow(2,o.z)*vn,m=[o.x*vn,o.y*vn],g=[];for(const _ of r)for(const x of _){const k=[x.x+m[0],x.y+m[1]];uh(k,t,n,c),g.push(k)}return g}function hh(r,t,n,o){const c=Math.pow(2,o.z)*vn,m=[o.x*vn,o.y*vn],g=[];for(const x of r){const k=[];for(const I of x){const P=[I.x+m[0],I.y+m[1]];fs(t,P),k.push(P)}g.push(k)}if(t[2]-t[0]<=c/2){(_=t)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const x of g)for(const k of x)uh(k,t,n,c)}var _;return g}class ms{constructor(t,n){this.type=ot,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(hs(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const c=[];for(const m of o.features){const{type:g,coordinates:_}=m.geometry;g==="Polygon"&&c.push(_),g==="MultiPolygon"&&c.push(..._)}if(c.length)return new ms(o,{type:"MultiPolygon",coordinates:c})}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new ms(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new ms(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=pu(o.coordinates,m,g),x=ch(n.geometry(),c,m,g);if(!Jn(c,m))return!1;for(const k of x)if(!Ws(k,_))return!1}if(o.type==="MultiPolygon"){const _=lh(o.coordinates,m,g),x=ch(n.geometry(),c,m,g);if(!Jn(c,m))return!1;for(const k of x)if(!Cp(k,_))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(o.type==="Polygon"){const _=pu(o.coordinates,m,g),x=hh(n.geometry(),c,m,g);if(!Jn(c,m))return!1;for(const k of x)if(!ah(k,_))return!1}if(o.type==="MultiPolygon"){const _=lh(o.coordinates,m,g),x=hh(n.geometry(),c,m,g);if(!Jn(c,m))return!1;for(const k of x)if(!Pp(k,_))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let dh=class{constructor(r=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=r,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(r){this.data.push(r),this._up(this.length++)}pop(){if(this.length===0)return;const r=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:t,compare:n}=this,o=t[r];for(;r>0;){const c=r-1>>1,m=t[c];if(n(o,m)>=0)break;t[r]=m,r=c}t[r]=o}_down(r){const{data:t,compare:n}=this,o=this.length>>1,c=t[r];for(;r<o;){let m=1+(r<<1);const g=m+1;if(g<this.length&&n(t[g],t[m])<0&&(m=g),n(t[m],c)>=0)break;t[r]=t[m],r=m}t[r]=c}};function zp(r,t,n,o,c){ph(r,t,n,o||r.length-1,c||Ap)}function ph(r,t,n,o,c){for(;o>n;){if(o-n>600){var m=o-n+1,g=t-n+1,_=Math.log(m),x=.5*Math.exp(2*_/3),k=.5*Math.sqrt(_*x*(m-x)/m)*(g-m/2<0?-1:1);ph(r,t,Math.max(n,Math.floor(t-g*x/m+k)),Math.min(o,Math.floor(t+(m-g)*x/m+k)),c)}var I=r[t],P=n,M=o;for(Ka(r,n,t),c(r[o],I)>0&&Ka(r,n,o);P<M;){for(Ka(r,P,M),P++,M--;c(r[P],I)<0;)P++;for(;c(r[M],I)>0;)M--}c(r[n],I)===0?Ka(r,n,M):Ka(r,++M,o),M<=t&&(n=M+1),t<=M&&(o=M-1)}}function Ka(r,t,n){var o=r[t];r[t]=r[n],r[n]=o}function Ap(r,t){return r<t?-1:r>t?1:0}function $o(r,t){if(r.length<=1)return[r];const n=[];let o,c;for(const m of r){const g=Dp(m);g!==0&&(m.area=Math.abs(g),c===void 0&&(c=g<0),c===g<0?(o&&n.push(o),o=[m]):o.push(m))}if(o&&n.push(o),t>1)for(let m=0;m<n.length;m++)n[m].length<=t||(zp(n[m],t,1,n[m].length-1,Mp),n[m]=n[m].slice(0,t));return n}function Mp(r,t){return t.area-r.area}function Dp(r){let t=0;for(let n,o,c=0,m=r.length,g=m-1;c<m;g=c++)n=r[c],o=r[g],t+=(o.x-n.x)*(n.y+o.y);return t}const fh=1/298.257223563,mh=fh*(2-fh),gh=Math.PI/180;class fu{constructor(t){const n=6378.137*gh*1e3,o=Math.cos(t*gh),c=1/(1-mh*(1-o*o)),m=Math.sqrt(c);this.kx=n*m*o,this.ky=n*m*c*(1-mh)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,c=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+c*c)}pointOnLine(t,n){let o,c,m,g,_=1/0;for(let x=0;x<t.length-1;x++){let k=t[x][0],I=t[x][1],P=this.wrap(t[x+1][0]-k)*this.kx,M=(t[x+1][1]-I)*this.ky,R=0;P===0&&M===0||(R=(this.wrap(n[0]-k)*this.kx*P+(n[1]-I)*this.ky*M)/(P*P+M*M),R>1?(k=t[x+1][0],I=t[x+1][1]):R>0&&(k+=P/this.kx*R,I+=M/this.ky*R)),P=this.wrap(n[0]-k)*this.kx,M=(n[1]-I)*this.ky;const B=P*P+M*M;B<_&&(_=B,o=k,c=I,m=x,g=R)}return{point:[o,c],index:m,t:Math.max(0,Math.min(1,g))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function yh(r,t){return t[0]-r[0]}function Zo(r){return r[1]-r[0]+1}function Ln(r,t){return r[1]>=r[0]&&r[1]<t}function mu(r,t){if(r[0]>r[1])return[null,null];const n=Zo(r);if(t){if(n===2)return[r,null];const c=Math.floor(n/2);return[[r[0],r[0]+c],[r[0]+c,r[1]]]}if(n===1)return[r,null];const o=Math.floor(n/2)-1;return[[r[0],r[0]+o],[r[0]+o+1,r[1]]]}function gu(r,t){if(!Ln(t,r.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)fs(n,r[o]);return n}function yu(r){const t=[1/0,1/0,-1/0,-1/0];for(const n of r)for(const o of n)fs(t,o);return t}function qo(r){return r[0]!==-1/0&&r[1]!==-1/0&&r[2]!==1/0&&r[3]!==1/0}function _u(r,t,n){if(!qo(r)||!qo(t))return NaN;let o=0,c=0;return r[2]<t[0]&&(o=t[0]-r[2]),r[0]>t[2]&&(o=r[0]-t[2]),r[1]>t[3]&&(c=r[1]-t[3]),r[3]<t[1]&&(c=t[1]-r[3]),n.distance([0,0],[o,c])}function gs(r,t,n){const o=n.pointOnLine(t,r);return n.distance(r,o.point)}function vu(r,t,n,o,c){const m=Math.min(gs(r,[n,o],c),gs(t,[n,o],c)),g=Math.min(gs(n,[r,t],c),gs(o,[r,t],c));return Math.min(m,g)}function Lp(r,t,n,o,c){if(!Ln(t,r.length)||!Ln(o,n.length))return 1/0;let m=1/0;for(let g=t[0];g<t[1];++g){const _=r[g],x=r[g+1];for(let k=o[0];k<o[1];++k){const I=n[k],P=n[k+1];if(Uo(_,x,I,P))return 0;m=Math.min(m,vu(_,x,I,P,c))}}return m}function cr(r,t,n,o,c){if(!Ln(t,r.length)||!Ln(o,n.length))return NaN;let m=1/0;for(let g=t[0];g<=t[1];++g)for(let _=o[0];_<=o[1];++_)if(m=Math.min(m,c.distance(r[g],n[_])),m===0)return m;return m}function Rp(r,t,n){if(Ws(r,t,!0))return 0;let o=1/0;for(const c of t){const m=c[0],g=c[c.length-1];if(m!==g&&(o=Math.min(o,gs(r,[g,m],n)),o===0))return o;const _=n.pointOnLine(c,r);if(o=Math.min(o,n.distance(r,_.point)),o===0)return o}return o}function xt(r,t,n,o){if(!Ln(t,r.length))return NaN;for(let m=t[0];m<=t[1];++m)if(Ws(r[m],n,!0))return 0;let c=1/0;for(let m=t[0];m<t[1];++m){const g=r[m],_=r[m+1];for(const x of n)for(let k=0,I=x.length,P=I-1;k<I;P=k++){const M=x[P],R=x[k];if(Uo(g,_,M,R))return 0;c=Math.min(c,vu(g,_,M,R,o))}}return c}function Go(r,t){for(const n of r)for(const o of n)if(Ws(o,t,!0))return!0;return!1}function Gt(r,t,n,o=1/0){const c=yu(r),m=yu(t);if(o!==1/0&&_u(c,m,n)>=o)return o;if(Jn(c,m)){if(Go(r,t))return 0}else if(Go(t,r))return 0;let g=1/0;for(const _ of r)for(let x=0,k=_.length,I=k-1;x<k;I=x++){const P=_[I],M=_[x];for(const R of t)for(let B=0,O=R.length,$=O-1;B<O;$=B++){const X=R[$],he=R[B];if(Uo(P,M,X,he))return 0;g=Math.min(g,vu(P,M,X,he,n))}}return g}function Ut(r,t,n,o,c,m){if(!m)return;const g=_u(gu(o,m),c,n);g<t&&r.push([g,m,[0,0]])}function ys(r,t,n,o,c,m,g){if(!m||!g)return;const _=_u(gu(o,m),gu(c,g),n);_<t&&r.push([_,m,g])}function Ja(r,t,n,o,c=1/0){let m=Math.min(o.distance(r[0],n[0][0]),c);if(m===0)return m;const g=new dh([[0,[0,r.length-1],[0,0]]],yh),_=yu(n);for(;g.length>0;){const x=g.pop();if(x[0]>=m)continue;const k=x[1],I=t?50:100;if(Zo(k)<=I){if(!Ln(k,r.length))return NaN;if(t){const P=xt(r,k,n,o);if(isNaN(P)||P===0)return P;m=Math.min(m,P)}else for(let P=k[0];P<=k[1];++P){const M=Rp(r[P],n,o);if(m=Math.min(m,M),m===0)return 0}}else{const P=mu(k,t);Ut(g,m,o,r,_,P[0]),Ut(g,m,o,r,_,P[1])}}return m}function Ya(r,t,n,o,c,m=1/0){let g=Math.min(m,c.distance(r[0],n[0]));if(g===0)return g;const _=new dh([[0,[0,r.length-1],[0,n.length-1]]],yh);for(;_.length>0;){const x=_.pop();if(x[0]>=g)continue;const k=x[1],I=x[2],P=t?50:100,M=o?50:100;if(Zo(k)<=P&&Zo(I)<=M){if(!Ln(k,r.length)&&Ln(I,n.length))return NaN;let R;if(t&&o)R=Lp(r,k,n,I,c),g=Math.min(g,R);else if(t&&!o){const B=r.slice(k[0],k[1]+1);for(let O=I[0];O<=I[1];++O)if(R=gs(n[O],B,c),g=Math.min(g,R),g===0)return g}else if(!t&&o){const B=n.slice(I[0],I[1]+1);for(let O=k[0];O<=k[1];++O)if(R=gs(r[O],B,c),g=Math.min(g,R),g===0)return g}else R=cr(r,k,n,I,c),g=Math.min(g,R)}else{const R=mu(k,t),B=mu(I,o);ys(_,g,c,r,n,R[0],B[0]),ys(_,g,c,r,n,R[0],B[1]),ys(_,g,c,r,n,R[1],B[0]),ys(_,g,c,r,n,R[1],B[1])}}return g}function xu(r){return r.type==="MultiPolygon"?r.coordinates.map(t=>({type:"Polygon",coordinates:t})):r.type==="MultiLineString"?r.coordinates.map(t=>({type:"LineString",coordinates:t})):r.type==="MultiPoint"?r.coordinates.map(t=>({type:"Point",coordinates:t})):[r]}class _s{constructor(t,n){this.type=Me,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(hs(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new _s(o,o.features.map(c=>xu(c.geometry)).flat());if(o.type==="Feature")return new _s(o,xu(o.geometry));if("type"in o&&"coordinates"in o)return new _s(o,xu(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const c=n.geometry(),m=c.flat().map(x=>du([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new fu(m[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,Ya(m,!1,[x.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,Ya(m,!1,x.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,Ja(m,!1,x.coordinates,g,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const c=n.geometry(),m=c.flat().map(x=>du([x.x,x.y],n.canonical));if(c.length===0)return NaN;const g=new fu(m[0][1]);let _=1/0;for(const x of o){switch(x.type){case"Point":_=Math.min(_,Ya(m,!0,[x.coordinates],!1,g,_));break;case"LineString":_=Math.min(_,Ya(m,!0,x.coordinates,!0,g,_));break;case"Polygon":_=Math.min(_,Ja(m,!0,x.coordinates,g,_))}if(_===0)return _}return _}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const c=n.geometry();if(c.length===0||c[0].length===0)return NaN;const m=$o(c,0).map(x=>x.map(k=>k.map(I=>du([I.x,I.y],n.canonical)))),g=new fu(m[0][0][0][1]);let _=1/0;for(const x of o)for(const k of m){switch(x.type){case"Point":_=Math.min(_,Ja([x.coordinates],!1,k,g,_));break;case"LineString":_=Math.min(_,Ja(x.coordinates,!0,k,g,_));break;case"Polygon":_=Math.min(_,Gt(k,x.coordinates,g,_))}if(_===0)return _}return _}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Xs={"==":Sp,"!=":ih,">":Tp,"<":nh,">=":sh,"<=":kp,array:Ki,at:au,boolean:Ki,case:Fo,coalesce:No,collator:Xa,format:Vo,image:cu,in:ou,"index-of":qs,interpolate:ci,"interpolate-hcl":ci,"interpolate-lab":ci,length:hu,let:Kn,literal:Xi,match:lu,number:Ki,"number-format":uu,object:Ki,slice:Ha,step:Gs,string:Ki,"to-boolean":Ji,"to-color":Ji,"to-number":Ji,"to-string":Ji,var:Ft,within:ms,distance:_s};class Fi{constructor(t,n,o,c){this.name=t,this.type=n,this._evaluate=o,this.args=c}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],c=Fi.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(c)?c[0]:c.type,g=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,_=g.filter(([k])=>!Array.isArray(k)||k.length===t.length-1);let x=null;for(const[k,I]of _){x=new ds(n.registry,Qa,n.path,null,n.scope);const P=[];let M=!1;for(let R=1;R<t.length;R++){const B=t[R],O=Array.isArray(k)?k[R-1]:k.type,$=x.parse(B,1+P.length,O);if(!$){M=!0;break}P.push($)}if(!M)if(Array.isArray(k)&&k.length!==P.length)x.error(`Expected ${k.length} arguments, but found ${P.length} instead.`);else{for(let R=0;R<P.length;R++){const B=Array.isArray(k)?k[R]:k.type,O=P[R];x.concat(R+1).checkSubtype(B,O.type)}if(x.errors.length===0)return new Fi(o,m,I,P)}}if(_.length===1)n.errors.push(...x.errors);else{const k=(_.length?_:g).map(([P])=>{return M=P,Array.isArray(M)?`(${M.map(D).join(", ")})`:`(${D(M.type)}...)`;var M}).join(" | "),I=[];for(let P=1;P<t.length;P++){const M=n.parse(t[P],1+I.length);if(!M)return null;I.push(D(M.type))}n.error(`Expected arguments of type ${k}, but found (${I.join(", ")}) instead.`)}return null}static register(t,n){Fi.definitions=n;for(const o in n)t[o]=Fi}}function wu(r,[t,n,o,c]){t=t.evaluate(r),n=n.evaluate(r),o=o.evaluate(r);const m=c?c.evaluate(r):1,g=Zs(t,n,o,m);if(g)throw new mr(g);return new Vt(t/255,n/255,o/255,m,!1)}function bu(r,t){return r in t}function Su(r,t){const n=t[r];return n===void 0?null:n}function vs(r){return{type:r}}function Qa(r){if(r instanceof Ft)return Qa(r.boundExpression);if(r instanceof Fi&&r.name==="error"||r instanceof Xa||r instanceof ms||r instanceof _s)return!1;const t=r instanceof Ji||r instanceof Ki;let n=!0;return r.eachChild(o=>{n=t?n&&Qa(o):n&&o instanceof Xi}),!!n&&eo(r)&&to(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function eo(r){if(r instanceof Fi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ms||r instanceof _s)return!1;let t=!0;return r.eachChild(n=>{t&&!eo(n)&&(t=!1)}),t}function Ks(r){if(r instanceof Fi&&r.name==="feature-state")return!1;let t=!0;return r.eachChild(n=>{t&&!Ks(n)&&(t=!1)}),t}function to(r,t){if(r instanceof Fi&&t.indexOf(r.name)>=0)return!1;let n=!0;return r.eachChild(o=>{n&&!to(o,t)&&(n=!1)}),n}function Ho(r){return{result:"success",value:r}}function Js(r){return{result:"error",value:r}}function Ys(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function _h(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Tu(r){return!!r.expression&&r.expression.interpolated}function Dt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Wo(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Fp(r){return r}function vh(r,t){const n=t.type==="color",o=r.stops&&typeof r.stops[0][0]=="object",c=o||!(o||r.property!==void 0),m=r.type||(Tu(t)?"exponential":"interval");if(n||t.type==="padding"){const I=n?Vt.parse:bi.parse;(r=mn({},r)).stops&&(r.stops=r.stops.map(P=>[P[0],I(P[1])])),r.default=I(r.default?r.default:t.default)}if(r.colorSpace&&(g=r.colorSpace)!=="rgb"&&g!=="hcl"&&g!=="lab")throw new Error(`Unknown color space: "${r.colorSpace}"`);var g;let _,x,k;if(m==="exponential")_=wh;else if(m==="interval")_=Xo;else if(m==="categorical"){_=xh,x=Object.create(null);for(const I of r.stops)x[I[0]]=I[1];k=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);_=bh}if(o){const I={},P=[];for(let B=0;B<r.stops.length;B++){const O=r.stops[B],$=O[0].zoom;I[$]===void 0&&(I[$]={zoom:$,type:r.type,property:r.property,default:r.default,stops:[]},P.push($)),I[$].stops.push([O[0].value,O[1]])}const M=[];for(const B of P)M.push([I[B].zoom,vh(I[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:ci.interpolationFactor.bind(void 0,R),zoomStops:M.map(B=>B[0]),evaluate:({zoom:B},O)=>wh({stops:M,base:r.base},t,B).evaluate(B,O)}}if(c){const I=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:ci.interpolationFactor.bind(void 0,I),zoomStops:r.stops.map(P=>P[0]),evaluate:({zoom:P})=>_(r,t,P,x,k)}}return{kind:"source",evaluate(I,P){const M=P&&P.properties?P.properties[r.property]:void 0;return M===void 0?Qs(r.default,t.default):_(r,t,M,x,k)}}}function Qs(r,t,n){return r!==void 0?r:t!==void 0?t:n!==void 0?n:void 0}function xh(r,t,n,o,c){return Qs(typeof n===c?o[n]:void 0,r.default,t.default)}function Xo(r,t,n){if(Dt(n)!=="number")return Qs(r.default,t.default);const o=r.stops.length;if(o===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[o-1][0])return r.stops[o-1][1];const c=Bo(r.stops.map(m=>m[0]),n);return r.stops[c][1]}function wh(r,t,n){const o=r.base!==void 0?r.base:1;if(Dt(n)!=="number")return Qs(r.default,t.default);const c=r.stops.length;if(c===1||n<=r.stops[0][0])return r.stops[0][1];if(n>=r.stops[c-1][0])return r.stops[c-1][1];const m=Bo(r.stops.map(I=>I[0]),n),g=function(I,P,M,R){const B=R-M,O=I-M;return B===0?0:P===1?O/B:(Math.pow(P,O)-1)/(Math.pow(P,B)-1)}(n,o,r.stops[m][0],r.stops[m+1][0]),_=r.stops[m][1],x=r.stops[m+1][1],k=ui[t.type]||Fp;return typeof _.evaluate=="function"?{evaluate(...I){const P=_.evaluate.apply(void 0,I),M=x.evaluate.apply(void 0,I);if(P!==void 0&&M!==void 0)return k(P,M,g,r.colorSpace)}}:k(_,x,g,r.colorSpace)}function bh(r,t,n){switch(t.type){case"color":n=Vt.parse(n);break;case"formatted":n=wi.fromString(n.toString());break;case"resolvedImage":n=Si.fromString(n.toString());break;case"padding":n=bi.parse(n);break;default:Dt(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Qs(n,r.default,t.default)}Fi.register(Xs,{error:[{kind:"error"},[_t],(r,[t])=>{throw new mr(t.evaluate(r))}],typeof:[_t,[ft],(r,[t])=>D(wr(t.evaluate(r)))],"to-rgba":[L(Me,4),[li],(r,[t])=>{const[n,o,c,m]=t.evaluate(r).rgb;return[255*n,255*o,255*c,m]}],rgb:[li,[Me,Me,Me],wu],rgba:[li,[Me,Me,Me,Me],wu],has:{type:ot,overloads:[[[_t],(r,[t])=>bu(t.evaluate(r),r.properties())],[[_t,Wi],(r,[t,n])=>bu(t.evaluate(r),n.evaluate(r))]]},get:{type:ft,overloads:[[[_t],(r,[t])=>Su(t.evaluate(r),r.properties())],[[_t,Wi],(r,[t,n])=>Su(t.evaluate(r),n.evaluate(r))]]},"feature-state":[ft,[_t],(r,[t])=>Su(t.evaluate(r),r.featureState||{})],properties:[Wi,[],r=>r.properties()],"geometry-type":[_t,[],r=>r.geometryType()],id:[ft,[],r=>r.id()],zoom:[Me,[],r=>r.globals.zoom],"heatmap-density":[Me,[],r=>r.globals.heatmapDensity||0],"line-progress":[Me,[],r=>r.globals.lineProgress||0],accumulated:[ft,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Me,vs(Me),(r,t)=>{let n=0;for(const o of t)n+=o.evaluate(r);return n}],"*":[Me,vs(Me),(r,t)=>{let n=1;for(const o of t)n*=o.evaluate(r);return n}],"-":{type:Me,overloads:[[[Me,Me],(r,[t,n])=>t.evaluate(r)-n.evaluate(r)],[[Me],(r,[t])=>-t.evaluate(r)]]},"/":[Me,[Me,Me],(r,[t,n])=>t.evaluate(r)/n.evaluate(r)],"%":[Me,[Me,Me],(r,[t,n])=>t.evaluate(r)%n.evaluate(r)],ln2:[Me,[],()=>Math.LN2],pi:[Me,[],()=>Math.PI],e:[Me,[],()=>Math.E],"^":[Me,[Me,Me],(r,[t,n])=>Math.pow(t.evaluate(r),n.evaluate(r))],sqrt:[Me,[Me],(r,[t])=>Math.sqrt(t.evaluate(r))],log10:[Me,[Me],(r,[t])=>Math.log(t.evaluate(r))/Math.LN10],ln:[Me,[Me],(r,[t])=>Math.log(t.evaluate(r))],log2:[Me,[Me],(r,[t])=>Math.log(t.evaluate(r))/Math.LN2],sin:[Me,[Me],(r,[t])=>Math.sin(t.evaluate(r))],cos:[Me,[Me],(r,[t])=>Math.cos(t.evaluate(r))],tan:[Me,[Me],(r,[t])=>Math.tan(t.evaluate(r))],asin:[Me,[Me],(r,[t])=>Math.asin(t.evaluate(r))],acos:[Me,[Me],(r,[t])=>Math.acos(t.evaluate(r))],atan:[Me,[Me],(r,[t])=>Math.atan(t.evaluate(r))],min:[Me,vs(Me),(r,t)=>Math.min(...t.map(n=>n.evaluate(r)))],max:[Me,vs(Me),(r,t)=>Math.max(...t.map(n=>n.evaluate(r)))],abs:[Me,[Me],(r,[t])=>Math.abs(t.evaluate(r))],round:[Me,[Me],(r,[t])=>{const n=t.evaluate(r);return n<0?-Math.round(-n):Math.round(n)}],floor:[Me,[Me],(r,[t])=>Math.floor(t.evaluate(r))],ceil:[Me,[Me],(r,[t])=>Math.ceil(t.evaluate(r))],"filter-==":[ot,[_t,ft],(r,[t,n])=>r.properties()[t.value]===n.value],"filter-id-==":[ot,[ft],(r,[t])=>r.id()===t.value],"filter-type-==":[ot,[_t],(r,[t])=>r.geometryType()===t.value],"filter-<":[ot,[_t,ft],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[ot,[ft],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[ot,[_t,ft],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[ot,[ft],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[ot,[_t,ft],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[ot,[ft],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[ot,[_t,ft],(r,[t,n])=>{const o=r.properties()[t.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[ot,[ft],(r,[t])=>{const n=r.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[ot,[ft],(r,[t])=>t.value in r.properties()],"filter-has-id":[ot,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ot,[L(_t)],(r,[t])=>t.value.indexOf(r.geometryType())>=0],"filter-id-in":[ot,[L(ft)],(r,[t])=>t.value.indexOf(r.id())>=0],"filter-in-small":[ot,[_t,L(ft)],(r,[t,n])=>n.value.indexOf(r.properties()[t.value])>=0],"filter-in-large":[ot,[_t,L(ft)],(r,[t,n])=>function(o,c,m,g){for(;m<=g;){const _=m+g>>1;if(c[_]===o)return!0;c[_]>o?g=_-1:m=_+1}return!1}(r.properties()[t.value],n.value,0,n.value.length-1)],all:{type:ot,overloads:[[[ot,ot],(r,[t,n])=>t.evaluate(r)&&n.evaluate(r)],[vs(ot),(r,t)=>{for(const n of t)if(!n.evaluate(r))return!1;return!0}]]},any:{type:ot,overloads:[[[ot,ot],(r,[t,n])=>t.evaluate(r)||n.evaluate(r)],[vs(ot),(r,t)=>{for(const n of t)if(n.evaluate(r))return!0;return!1}]]},"!":[ot,[ot],(r,[t])=>!t.evaluate(r)],"is-supported-script":[ot,[_t],(r,[t])=>{const n=r.globals&&r.globals.isSupportedScript;return!n||n(t.evaluate(r))}],upcase:[_t,[_t],(r,[t])=>t.evaluate(r).toUpperCase()],downcase:[_t,[_t],(r,[t])=>t.evaluate(r).toLowerCase()],concat:[_t,vs(ft),(r,t)=>t.map(n=>Ga(n.evaluate(r))).join("")],"resolved-locale":[_t,[yn],(r,[t])=>t.evaluate(r).resolvedLocale()]});class Ko{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new Ro,this._defaultValue=n?(o=n).type==="color"&&Wo(o.default)?new Vt(0,0,0,0):o.type==="color"?Vt.parse(o.default)||null:o.type==="padding"?bi.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Ri.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,c,m,g){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Jo(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Xs}function ea(r,t){const n=new ds(Xs,Qa,[],t?function(c){const m={color:li,string:_t,number:Me,enum:_t,boolean:ot,formatted:Dn,padding:Xn,resolvedImage:_n,variableAnchorOffsetCollection:W};return c.type==="array"?L(m[c.value]||ft,c.length):m[c.type]}(t):void 0),o=n.parse(r,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?Ho(new Ko(o,t)):Js(n.errors)}class ta{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!Ks(n.expression)}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}}class ra{constructor(t,n,o,c){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!Ks(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(t,n,o,c,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,c,m,g)}evaluate(t,n,o,c,m,g){return this._styleExpression.evaluate(t,n,o,c,m,g)}interpolationFactor(t,n,o){return this.interpolationType?ci.interpolationFactor(this.interpolationType,t,n,o):0}}function ku(r,t){const n=ea(r,t);if(n.result==="error")return n;const o=n.value.expression,c=eo(o);if(!c&&!Ys(t))return Js([new Yr("","data expressions not supported")]);const m=to(o,["zoom"]);if(!m&&!_h(t))return Js([new Yr("","zoom expressions not supported")]);const g=ro(o);return g||m?g instanceof Yr?Js([g]):g instanceof ci&&!Tu(t)?Js([new Yr("",'"interpolate" expressions cannot be used with this property')]):Ho(g?new ra(c?"camera":"composite",n.value,g.labels,g instanceof ci?g.interpolation:void 0):new ta(c?"constant":"source",n.value)):Js([new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ia{constructor(t,n){this._parameters=t,this._specification=n,mn(this,vh(this._parameters,this._specification))}static deserialize(t){return new ia(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ro(r){let t=null;if(r instanceof Kn)t=ro(r.result);else if(r instanceof No){for(const n of r.args)if(t=ro(n),t)break}else(r instanceof Gs||r instanceof ci)&&r.input instanceof Fi&&r.input.name==="zoom"&&(t=r);return t instanceof Yr||r.eachChild(n=>{const o=ro(n);o instanceof Yr?t=o:!t&&o?t=new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Yo(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const t of r.slice(1))if(!Yo(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Qo={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Eu(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Yo(r)||(r=el(r));const t=ea(r,Qo);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>t.value.evaluate(n,o,{},c),needGeometry:Sh(r)}}function Bp(r,t){return r<t?-1:r>t?1:0}function Sh(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let t=1;t<r.length;t++)if(Sh(r[t]))return!0;return!1}function el(r){if(!r)return!0;const t=r[0];return r.length<=1?t!=="any":t==="=="?Iu(r[1],r[2],"=="):t==="!="?jr(Iu(r[1],r[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Iu(r[1],r[2],t):t==="any"?(n=r.slice(1),["any"].concat(n.map(el))):t==="all"?["all"].concat(r.slice(1).map(el)):t==="none"?["all"].concat(r.slice(1).map(el).map(jr)):t==="in"?io(r[1],r.slice(2)):t==="!in"?jr(io(r[1],r.slice(2))):t==="has"?no(r[1]):t!=="!has"||jr(no(r[1]));var n}function Iu(r,t,n){switch(r){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,r,t]}}function io(r,t){if(t.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",r,["literal",t.sort(Bp)]]:["filter-in-small",r,["literal",t]]}}function no(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function jr(r){return["!",r]}function xs(r){const t=typeof r;if(t==="number"||t==="boolean"||t==="string"||r==null)return JSON.stringify(r);if(Array.isArray(r)){let c="[";for(const m of r)c+=`${xs(m)},`;return`${c}]`}const n=Object.keys(r).sort();let o="{";for(let c=0;c<n.length;c++)o+=`${JSON.stringify(n[c])}:${xs(r[n[c]])},`;return`${o}}`}function Th(r){let t="";for(const n of cs)t+=`/${xs(r[n])}`;return t}function kh(r){const t=r.value;return t?[new Ie(r.key,t,"constants have been deprecated as of v8")]:[]}function hr(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Yi(r){if(Array.isArray(r))return r.map(Yi);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const t={};for(const n in r)t[n]=Yi(r[n]);return t}return hr(r)}function Ti(r){const t=r.key,n=r.value,o=r.valueSpec||{},c=r.objectElementValidators||{},m=r.style,g=r.styleSpec,_=r.validateSpec;let x=[];const k=Dt(n);if(k!=="object")return[new Ie(t,n,`object expected, ${k} found`)];for(const I in n){const P=I.split(".")[0],M=o[P]||o["*"];let R;if(c[P])R=c[P];else if(o[P])R=_;else if(c["*"])R=c["*"];else{if(!o["*"]){x.push(new Ie(t,n[I],`unknown property "${I}"`));continue}R=_}x=x.concat(R({key:(t&&`${t}.`)+I,value:n[I],valueSpec:M,style:m,styleSpec:g,object:n,objectKey:I,validateSpec:_},n))}for(const I in o)c[I]||o[I].required&&o[I].default===void 0&&n[I]===void 0&&x.push(new Ie(t,n,`missing required property "${I}"`));return x}function so(r){const t=r.value,n=r.valueSpec,o=r.style,c=r.styleSpec,m=r.key,g=r.arrayElementValidator||r.validateSpec;if(Dt(t)!=="array")return[new Ie(m,t,`array expected, ${Dt(t)} found`)];if(n.length&&t.length!==n.length)return[new Ie(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ie(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let _={type:n.value,values:n.values};c.$version<7&&(_.function=n.function),Dt(n.value)==="object"&&(_=n.value);let x=[];for(let k=0;k<t.length;k++)x=x.concat(g({array:t,arrayIndex:k,value:t[k],valueSpec:_,validateSpec:r.validateSpec,style:o,styleSpec:c,key:`${m}[${k}]`}));return x}function Cu(r){const t=r.key,n=r.value,o=r.valueSpec;let c=Dt(n);return c==="number"&&n!=n&&(c="NaN"),c!=="number"?[new Ie(t,n,`number expected, ${c} found`)]:"minimum"in o&&n<o.minimum?[new Ie(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ie(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function tl(r){const t=r.valueSpec,n=hr(r.value.type);let o,c,m,g={};const _=n!=="categorical"&&r.value.property===void 0,x=!_,k=Dt(r.value.stops)==="array"&&Dt(r.value.stops[0])==="array"&&Dt(r.value.stops[0][0])==="object",I=Ti({key:r.key,value:r.value,valueSpec:r.styleSpec.function,validateSpec:r.validateSpec,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new Ie(R.key,R.value,'identity function may not have a "stops" property')];let B=[];const O=R.value;return B=B.concat(so({key:R.key,value:O,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:P})),Dt(O)==="array"&&O.length===0&&B.push(new Ie(R.key,O,"array must have at least one stop")),B},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&_&&I.push(new Ie(r.key,r.value,'missing required property "property"')),n==="identity"||r.value.stops||I.push(new Ie(r.key,r.value,'missing required property "stops"')),n==="exponential"&&r.valueSpec.expression&&!Tu(r.valueSpec)&&I.push(new Ie(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(x&&!Ys(r.valueSpec)?I.push(new Ie(r.key,r.value,"property functions not supported")):_&&!_h(r.valueSpec)&&I.push(new Ie(r.key,r.value,"zoom functions not supported"))),n!=="categorical"&&!k||r.value.property!==void 0||I.push(new Ie(r.key,r.value,'"property" property is required')),I;function P(R){let B=[];const O=R.value,$=R.key;if(Dt(O)!=="array")return[new Ie($,O,`array expected, ${Dt(O)} found`)];if(O.length!==2)return[new Ie($,O,`array length 2 expected, length ${O.length} found`)];if(k){if(Dt(O[0])!=="object")return[new Ie($,O,`object expected, ${Dt(O[0])} found`)];if(O[0].zoom===void 0)return[new Ie($,O,"object stop key must have zoom")];if(O[0].value===void 0)return[new Ie($,O,"object stop key must have value")];if(m&&m>hr(O[0].zoom))return[new Ie($,O[0].zoom,"stop zoom values must appear in ascending order")];hr(O[0].zoom)!==m&&(m=hr(O[0].zoom),c=void 0,g={}),B=B.concat(Ti({key:`${$}[0]`,value:O[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Cu,value:M}}))}else B=B.concat(M({key:`${$}[0]`,value:O[0],validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},O));return Jo(Yi(O[1]))?B.concat([new Ie(`${$}[1]`,O[1],"expressions are not allowed in function stops.")]):B.concat(R.validateSpec({key:`${$}[1]`,value:O[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function M(R,B){const O=Dt(R.value),$=hr(R.value),X=R.value!==null?R.value:B;if(o){if(O!==o)return[new Ie(R.key,X,`${O} stop domain type must match previous stop domain type ${o}`)]}else o=O;if(O!=="number"&&O!=="string"&&O!=="boolean")return[new Ie(R.key,X,"stop domain value must be a number, string, or boolean")];if(O!=="number"&&n!=="categorical"){let he=`number expected, ${O} found`;return Ys(t)&&n===void 0&&(he+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(R.key,X,he)]}return n!=="categorical"||O!=="number"||isFinite($)&&Math.floor($)===$?n!=="categorical"&&O==="number"&&c!==void 0&&$<c?[new Ie(R.key,X,"stop domain values must appear in ascending order")]:(c=$,n==="categorical"&&$ in g?[new Ie(R.key,X,"stop domain values must be unique")]:(g[$]=!0,[])):[new Ie(R.key,X,`integer expected, found ${$}`)]}}function na(r){const t=(r.expressionContext==="property"?ku:ea)(Yi(r.value),r.valueSpec);if(t.result==="error")return t.value.map(o=>new Ie(`${r.key}${o.key}`,r.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!n.outputDefined())return[new Ie(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Ks(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Ks(n))return[new Ie(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!to(n,["zoom","feature-state"]))return[new Ie(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!eo(n))return[new Ie(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Rn(r){const t=r.key,n=r.value,o=r.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(hr(n))===-1&&c.push(new Ie(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(hr(n))===-1&&c.push(new Ie(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Pu(r){return Yo(Yi(r.value))?na(mn({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):rl(r)}function rl(r){const t=r.value,n=r.key;if(Dt(t)!=="array")return[new Ie(n,t,`array expected, ${Dt(t)} found`)];const o=r.styleSpec;let c,m=[];if(t.length<1)return[new Ie(n,t,"filter array must have at least 1 element")];switch(m=m.concat(Rn({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:r.style,styleSpec:r.styleSpec})),hr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&hr(t[1])==="$type"&&m.push(new Ie(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&m.push(new Ie(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(c=Dt(t[1]),c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`)));for(let g=2;g<t.length;g++)c=Dt(t[g]),hr(t[1])==="$type"?m=m.concat(Rn({key:`${n}[${g}]`,value:t[g],valueSpec:o.geometry_type,style:r.style,styleSpec:r.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&m.push(new Ie(`${n}[${g}]`,t[g],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let g=1;g<t.length;g++)m=m.concat(rl({key:`${n}[${g}]`,value:t[g],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":c=Dt(t[1]),t.length!==2?m.push(new Ie(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):c!=="string"&&m.push(new Ie(`${n}[1]`,t[1],`string expected, ${c} found`))}return m}function zu(r,t){const n=r.key,o=r.validateSpec,c=r.style,m=r.styleSpec,g=r.value,_=r.objectKey,x=m[`${t}_${r.layerType}`];if(!x)return[];const k=_.match(/^(.*)-transition$/);if(t==="paint"&&k&&x[k[1]]&&x[k[1]].transition)return o({key:n,value:g,valueSpec:m.transition,style:c,styleSpec:m});const I=r.valueSpec||x[_];if(!I)return[new Ie(n,g,`unknown property "${_}"`)];let P;if(Dt(g)==="string"&&Ys(I)&&!I.tokens&&(P=/^{([^}]+)}$/.exec(g)))return[new Ie(n,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(P[1])} }\`.`)];const M=[];return r.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&M.push(new Ie(n,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Wo(Yi(g))&&hr(g.type)==="identity"&&M.push(new Ie(n,g,'"text-font" does not support identity functions'))),M.concat(o({key:r.key,value:g,valueSpec:I,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:_}))}function il(r){return zu(r,"paint")}function Au(r){return zu(r,"layout")}function Mu(r){let t=[];const n=r.value,o=r.key,c=r.style,m=r.styleSpec;n.type||n.ref||t.push(new Ie(o,n,'either "type" or "ref" is required'));let g=hr(n.type);const _=hr(n.ref);if(n.id){const x=hr(n.id);for(let k=0;k<r.arrayIndex;k++){const I=c.layers[k];hr(I.id)===x&&t.push(new Ie(o,n.id,`duplicate layer id "${n.id}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let x;["type","source","source-layer","filter","layout"].forEach(k=>{k in n&&t.push(new Ie(o,n[k],`"${k}" is prohibited for ref layers`))}),c.layers.forEach(k=>{hr(k.id)===_&&(x=k)}),x?x.ref?t.push(new Ie(o,n.ref,"ref cannot reference another ref layer")):g=hr(x.type):t.push(new Ie(o,n.ref,`ref layer "${_}" not found`))}else if(g!=="background")if(n.source){const x=c.sources&&c.sources[n.source],k=x&&hr(x.type);x?k==="vector"&&g==="raster"?t.push(new Ie(o,n.source,`layer "${n.id}" requires a raster source`)):k!=="raster-dem"&&g==="hillshade"?t.push(new Ie(o,n.source,`layer "${n.id}" requires a raster-dem source`)):k==="raster"&&g!=="raster"?t.push(new Ie(o,n.source,`layer "${n.id}" requires a vector source`)):k!=="vector"||n["source-layer"]?k==="raster-dem"&&g!=="hillshade"?t.push(new Ie(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!n.paint||!n.paint["line-gradient"]||k==="geojson"&&x.lineMetrics||t.push(new Ie(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ie(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ie(o,n.source,`source "${n.source}" not found`))}else t.push(new Ie(o,n,'missing required property "source"'));return t=t.concat(Ti({key:o,value:n,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,objectElementValidators:{"*":()=>[],type:()=>r.validateSpec({key:`${o}.type`,value:n.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,validateSpec:r.validateSpec,object:n,objectKey:"type"}),filter:Pu,layout:x=>Ti({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>Au(mn({layerType:g},k))}}),paint:x=>Ti({layer:n,key:x.key,value:x.value,style:x.style,styleSpec:x.styleSpec,validateSpec:x.validateSpec,objectElementValidators:{"*":k=>il(mn({layerType:g},k))}})}})),t}function ws(r){const t=r.value,n=r.key,o=Dt(t);return o!=="string"?[new Ie(n,t,`string expected, ${o} found`)]:[]}const nl={promoteId:function({key:r,value:t}){if(Dt(t)==="string")return ws({key:r,value:t});{const n=[];for(const o in t)n.push(...ws({key:`${r}.${o}`,value:t[o]}));return n}}};function ao(r){const t=r.value,n=r.key,o=r.styleSpec,c=r.style,m=r.validateSpec;if(!t.type)return[new Ie(n,t,'"type" is required')];const g=hr(t.type);let _;switch(g){case"vector":case"raster":return _=Ti({key:n,value:t,valueSpec:o[`source_${g.replace("-","_")}`],style:r.style,styleSpec:o,objectElementValidators:nl,validateSpec:m}),_;case"raster-dem":return _=function(x){var k;const I=(k=x.sourceName)!==null&&k!==void 0?k:"",P=x.value,M=x.styleSpec,R=M.source_raster_dem,B=x.style;let O=[];const $=Dt(P);if(P===void 0)return O;if($!=="object")return O.push(new Ie("source_raster_dem",P,`object expected, ${$} found`)),O;const X=hr(P.encoding)==="custom",he=["redFactor","greenFactor","blueFactor","baseShift"],ee=x.value.encoding?`"${x.value.encoding}"`:"Default";for(const oe in P)!X&&he.includes(oe)?O.push(new Ie(oe,P[oe],`In "${I}": "${oe}" is only valid when "encoding" is set to "custom". ${ee} encoding found`)):R[oe]?O=O.concat(x.validateSpec({key:oe,value:P[oe],valueSpec:R[oe],validateSpec:x.validateSpec,style:B,styleSpec:M})):O.push(new Ie(oe,P[oe],`unknown property "${oe}"`));return O}({sourceName:n,value:t,style:r.style,styleSpec:o,validateSpec:m}),_;case"geojson":if(_=Ti({key:n,value:t,valueSpec:o.source_geojson,style:c,styleSpec:o,validateSpec:m,objectElementValidators:nl}),t.cluster)for(const x in t.clusterProperties){const[k,I]=t.clusterProperties[x],P=typeof k=="string"?[k,["accumulated"],["get",x]]:k;_.push(...na({key:`${n}.${x}.map`,value:I,expressionContext:"cluster-map"})),_.push(...na({key:`${n}.${x}.reduce`,value:P,expressionContext:"cluster-reduce"}))}return _;case"video":return Ti({key:n,value:t,valueSpec:o.source_video,style:c,validateSpec:m,styleSpec:o});case"image":return Ti({key:n,value:t,valueSpec:o.source_image,style:c,validateSpec:m,styleSpec:o});case"canvas":return[new Ie(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Rn({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Du(r){const t=r.value,n=r.styleSpec,o=n.light,c=r.style;let m=[];const g=Dt(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("light",t,`object expected, ${g} found`)]),m;for(const _ in t){const x=_.match(/^(.*)-transition$/);m=m.concat(x&&o[x[1]]&&o[x[1]].transition?r.validateSpec({key:_,value:t[_],valueSpec:n.transition,validateSpec:r.validateSpec,style:c,styleSpec:n}):o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)])}return m}function Lu(r){const t=r.value,n=r.styleSpec,o=n.sky,c=r.style,m=Dt(t);if(t===void 0)return[];if(m!=="object")return[new Ie("sky",t,`object expected, ${m} found`)];let g=[];for(const _ in t)g=g.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)]);return g}function Ru(r){const t=r.value,n=r.styleSpec,o=n.terrain,c=r.style;let m=[];const g=Dt(t);if(t===void 0)return m;if(g!=="object")return m=m.concat([new Ie("terrain",t,`object expected, ${g} found`)]),m;for(const _ in t)m=m.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],validateSpec:r.validateSpec,style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)]);return m}function Fu(r){let t=[];const n=r.value,o=r.key;if(Array.isArray(n)){const c=[],m=[];for(const g in n)n[g].id&&c.includes(n[g].id)&&t.push(new Ie(o,n,`all the sprites' ids must be unique, but ${n[g].id} is duplicated`)),c.push(n[g].id),n[g].url&&m.includes(n[g].url)&&t.push(new Ie(o,n,`all the sprites' URLs must be unique, but ${n[g].url} is duplicated`)),m.push(n[g].url),t=t.concat(Ti({key:`${o}[${g}]`,value:n[g],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:r.validateSpec}));return t}return ws({key:o,value:n})}const sl={"*":()=>[],array:so,boolean:function(r){const t=r.value,n=r.key,o=Dt(t);return o!=="boolean"?[new Ie(n,t,`boolean expected, ${o} found`)]:[]},number:Cu,color:function(r){const t=r.key,n=r.value,o=Dt(n);return o!=="string"?[new Ie(t,n,`color expected, ${o} found`)]:Vt.parse(String(n))?[]:[new Ie(t,n,`color expected, "${n}" found`)]},constants:kh,enum:Rn,filter:Pu,function:tl,layer:Mu,object:Ti,source:ao,light:Du,sky:Lu,terrain:Ru,projection:function(r){const t=r.value,n=r.styleSpec,o=n.projection,c=r.style,m=Dt(t);if(t===void 0)return[];if(m!=="object")return[new Ie("projection",t,`object expected, ${m} found`)];let g=[];for(const _ in t)g=g.concat(o[_]?r.validateSpec({key:_,value:t[_],valueSpec:o[_],style:c,styleSpec:n}):[new Ie(_,t[_],`unknown property "${_}"`)]);return g},string:ws,formatted:function(r){return ws(r).length===0?[]:na(r)},resolvedImage:function(r){return ws(r).length===0?[]:na(r)},padding:function(r){const t=r.key,n=r.value;if(Dt(n)==="array"){if(n.length<1||n.length>4)return[new Ie(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let c=[];for(let m=0;m<n.length;m++)c=c.concat(r.validateSpec({key:`${t}[${m}]`,value:n[m],validateSpec:r.validateSpec,valueSpec:o}));return c}return Cu({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(r){const t=r.key,n=r.value,o=Dt(n),c=r.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ie(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let g=0;g<n.length;g+=2)m=m.concat(Rn({key:`${t}[${g}]`,value:n[g],valueSpec:c.layout_symbol["text-anchor"]})),m=m.concat(so({key:`${t}[${g+1}]`,value:n[g+1],valueSpec:{length:2,value:"number"},validateSpec:r.validateSpec,style:r.style,styleSpec:c}));return m},sprite:Fu};function oo(r){const t=r.value,n=r.valueSpec,o=r.styleSpec;return r.validateSpec=oo,n.expression&&Wo(hr(t))?tl(r):n.expression&&Jo(Yi(t))?na(r):n.type&&sl[n.type]?sl[n.type](r):Ti(mn({},r,{valueSpec:n.type?o[n.type]:n}))}function Eh(r){const t=r.value,n=r.key,o=ws(r);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ie(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ie(n,t,'"glyphs" url must include a "{range}" token'))),o}function Bi(r,t=me){let n=[];return n=n.concat(oo({key:"",value:r,valueSpec:t.$root,styleSpec:t,style:r,validateSpec:oo,objectElementValidators:{glyphs:Eh,"*":()=>[]}})),r.constants&&(n=n.concat(kh({key:"constants",value:r.constants}))),Bu(n)}function xn(r){return function(t){return r({...t,validateSpec:oo})}}function Bu(r){return[].concat(r).sort((t,n)=>t.line-n.line)}function Qi(r){return function(...t){return Bu(r.apply(this,t))}}Bi.source=Qi(xn(ao)),Bi.sprite=Qi(xn(Fu)),Bi.glyphs=Qi(xn(Eh)),Bi.light=Qi(xn(Du)),Bi.sky=Qi(xn(Lu)),Bi.terrain=Qi(xn(Ru)),Bi.layer=Qi(xn(Mu)),Bi.filter=Qi(xn(Pu)),Bi.paintProperty=Qi(xn(il)),Bi.layoutProperty=Qi(xn(Au));const bs=Bi,Op=bs.light,Np=bs.sky,Ih=bs.paintProperty,Ch=bs.layoutProperty;function Ou(r,t){let n=!1;if(t&&t.length)for(const o of t)r.fire(new Gn(new Error(o.message))),n=!0;return n}class sa{constructor(t,n,o){const c=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const g=new Int32Array(this.arrayBuffer);t=g[0],this.d=(n=g[1])+2*(o=g[2]);for(let x=0;x<this.d*this.d;x++){const k=g[3+x],I=g[3+x+1];c.push(k===I?null:g.subarray(k,I))}const _=g[3+c.length+1];this.keys=g.subarray(g[3+c.length],_),this.bboxes=g.subarray(_),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let g=0;g<this.d*this.d;g++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const m=o/n*t;this.min=-m,this.max=t+m}insert(t,n,o,c,m){this._forEachCell(n,o,c,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,c,m,g){this.cells[m].push(g)}query(t,n,o,c,m){const g=this.min,_=this.max;if(t<=g&&n<=g&&_<=o&&_<=c&&!m)return Array.prototype.slice.call(this.keys);{const x=[];return this._forEachCell(t,n,o,c,this._queryCell,x,{},m),x}}_queryCell(t,n,o,c,m,g,_,x){const k=this.cells[m];if(k!==null){const I=this.keys,P=this.bboxes;for(let M=0;M<k.length;M++){const R=k[M];if(_[R]===void 0){const B=4*R;(x?x(P[B+0],P[B+1],P[B+2],P[B+3]):t<=P[B+2]&&n<=P[B+3]&&o>=P[B+0]&&c>=P[B+1])?(_[R]=!0,g.push(I[R])):_[R]=!1}}}}_forEachCell(t,n,o,c,m,g,_,x){const k=this._convertToCellCoord(t),I=this._convertToCellCoord(n),P=this._convertToCellCoord(o),M=this._convertToCellCoord(c);for(let R=k;R<=P;R++)for(let B=I;B<=M;B++){const O=this.d*B+R;if((!x||x(this._convertFromCellCoord(R),this._convertFromCellCoord(B),this._convertFromCellCoord(R+1),this._convertFromCellCoord(B+1)))&&m.call(this,t,n,o,c,O,g,_,x))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let g=0;g<this.cells.length;g++)o+=this.cells[g].length;const c=new Int32Array(n+o+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;let m=n;for(let g=0;g<t.length;g++){const _=t[g];c[3+g]=m,c.set(_,m),m+=_.length}return c[3+t.length]=m,c.set(this.keys,m),m+=this.keys.length,c[3+t.length+1]=m,c.set(this.bboxes,m),m+=this.bboxes.length,c.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new sa(t.buffer)}}const Oi={};function qe(r,t,n={}){if(Oi[r])throw new Error(`${r} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:r,writeable:!1}),Oi[r]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}qe("Object",Object),qe("TransferableGridIndex",sa),qe("Color",Vt),qe("Error",Error),qe("AJAXError",ke),qe("ResolvedImage",Si),qe("StylePropertyFunction",ia),qe("StyleExpression",Ko,{omit:["_evaluator"]}),qe("ZoomDependentExpression",ra),qe("ZoomConstantExpression",ta),qe("CompoundExpression",Fi,{omit:["_evaluate"]});for(const r in Xs)Xs[r]._classRegistryKey||qe(`Expression_${r}`,Xs[r]);function al(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function Nu(r){return r.$name||r.constructor._classRegistryKey}function Ph(r){return!function(t){if(t===null||typeof t!="object")return!1;const n=Nu(t);return!(!n||n==="Object")}(r)&&(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||r instanceof Error||al(r)||Or(r)||ArrayBuffer.isView(r)||r instanceof ImageData)}function aa(r,t){if(Ph(r))return(al(r)||Or(r))&&t&&t.push(r),ArrayBuffer.isView(r)&&t&&t.push(r.buffer),r instanceof ImageData&&t&&t.push(r.data.buffer),r;if(Array.isArray(r)){const m=[];for(const g of r)m.push(aa(g,t));return m}if(typeof r!="object")throw new Error("can't serialize object of type "+typeof r);const n=Nu(r);if(!n)throw new Error(`can't serialize object of unregistered class ${r.constructor.name}`);if(!Oi[n])throw new Error(`${n} is not registered.`);const{klass:o}=Oi[n],c=o.serialize?o.serialize(r,t):{};if(o.serialize){if(t&&c===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Oi[n].omit.indexOf(m)>=0)continue;const g=r[m];c[m]=Oi[n].shallow.indexOf(m)>=0?g:aa(g,t)}r instanceof Error&&(c.message=r.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(c.$name=n),c}function oa(r){if(Ph(r))return r;if(Array.isArray(r))return r.map(oa);if(typeof r!="object")throw new Error("can't deserialize object of type "+typeof r);const t=Nu(r)||"Object";if(!Oi[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Oi[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(r);const o=Object.create(n.prototype);for(const c of Object.keys(r)){if(c==="$name")continue;const m=r[c];o[c]=Oi[t].shallow.indexOf(c)>=0?m:oa(m)}return o}class ju{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const kt={"Latin-1 Supplement":r=>r>=128&&r<=255,"Hangul Jamo":r=>r>=4352&&r<=4607,Khmer:r=>r>=6016&&r<=6143,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Katakana:r=>r>=12448&&r<=12543,Kanbun:r=>r>=12688&&r<=12703,"CJK Strokes":r=>r>=12736&&r<=12783,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"Private Use Area":r=>r>=57344&&r<=63743,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Vu(r){for(const t of r)if($u(t.charCodeAt(0)))return!0;return!1}function jp(r){for(const t of r)if(!la(t.charCodeAt(0)))return!1;return!0}function Uu(r){const t=r.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Vp=Uu(["Arab","Dupl","Mong","Ougr","Syrc"]);function la(r){return!Vp.test(String.fromCodePoint(r))}const zh=Uu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function $u(r){return!(r!==746&&r!==747&&(r<4352||!(kt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||kt["CJK Compatibility"](r)||kt["CJK Strokes"](r)||!(!kt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||kt["Enclosed CJK Letters and Months"](r)||kt["Ideographic Description Characters"](r)||kt.Kanbun(r)||kt.Katakana(r)&&r!==12540||!(!kt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!kt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||kt["Vertical Forms"](r)||kt["Yijing Hexagram Symbols"](r)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(r))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(r))||zh.test(String.fromCodePoint(r)))))}function Ah(r){return!($u(r)||function(t){return!!(kt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||kt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||kt["Letterlike Symbols"](t)||kt["Number Forms"](t)||kt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||kt["Control Pictures"](t)&&t!==9251||kt["Optical Character Recognition"](t)||kt["Enclosed Alphanumerics"](t)||kt["Geometric Shapes"](t)||kt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||kt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||kt["CJK Symbols and Punctuation"](t)||kt.Katakana(t)||kt["Private Use Area"](t)||kt["CJK Compatibility Forms"](t)||kt["Small Form Variants"](t)||kt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(r))}const Up=Uu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Zu(r){return Up.test(String.fromCodePoint(r))}function $p(r,t){return!(!t&&Zu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||kt.Khmer(r))}function Zp(r){for(const t of r)if(Zu(t.charCodeAt(0)))return!0;return!1}const ki=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(r){this.pluginStatus=r.pluginStatus,this.pluginURL=r.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(r){this.applyArabicShaping=r.applyArabicShaping,this.processBidirectionalText=r.processBidirectionalText,this.processStyledBidirectionalText=r.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Jt{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ju,this.transition={})}isSupportedScript(t){return function(n,o){for(const c of n)if(!$p(c.charCodeAt(0),o))return!1;return!0}(t,ki.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class ua{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,c){if(Wo(o))return new ia(o,c);if(Jo(o)){const m=ku(o,c);if(m.result==="error")throw new Error(m.value.map(g=>`${g.key}: ${g.message}`).join(", "));return m.value}{let m=o;return c.type==="color"&&typeof o=="string"?m=Vt.parse(o):c.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?c.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(m=Ri.parse(o)):m=bi.parse(o),{kind:"constant",evaluate:()=>m}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class ol{constructor(t){this.property=t,this.value=new ua(t,void 0)}transitioned(t,n){return new Mh(this.property,this.value,n,We({},t.transition,this.transition),t.now)}untransitioned(){return new Mh(this.property,this.value,null,{},0)}}class ll{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return gt(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ol(this._values[t].property)),this._values[t].value=new ua(this._values[t].property,n===null?void 0:gt(n))}getTransition(t){return gt(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new ol(this._values[t].property)),this._values[t].transition=gt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const c=this.getTransition(n);c!==void 0&&(t[`${n}-transition`]=c)}return t}transitioned(t,n){const o=new lo(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(t,n._values[c]);return o}untransitioned(){const t=new lo(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class Mh{constructor(t,n,o,c,m){this.property=t,this.value=n,this.begin=m+c.delay||0,this.end=this.begin+c.duration||0,t.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const c=t.now||0,m=this.value.possiblyEvaluate(t,n,o),g=this.prior;if(g){if(c>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(c<this.begin)return g.possiblyEvaluate(t,n,o);{const _=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,n,o),m,function(x){if(x<=0)return 0;if(x>=1)return 1;const k=x*x,I=k*x;return 4*(x<.5?I:3*(x-k)+I-.75)}(_))}}return m}}class lo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const c=new co(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class uo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return gt(this._values[t].value)}setValue(t,n){this._values[t]=new ua(this._values[t].property,n===null?void 0:gt(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const c=new co(this._properties);for(const m of Object.keys(this._values))c._values[m]=this._values[m].possiblyEvaluate(t,n,o);return c}}class wn{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,c){return this.property.evaluate(this.value,this.parameters,t,n,o,c)}}class co{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ke{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const c=ui[this.specification.type];return c?c(t,n,o):t}}class at{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,c){return new wn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,c)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new wn(this,{kind:"constant",value:void 0},t.parameters);const c=ui[this.specification.type];if(c){const m=c(t.value.value,n.value.value,o);return new wn(this,{kind:"constant",value:m},t.parameters)}return t}evaluate(t,n,o,c,m,g){return t.kind==="constant"?t.value:t.evaluate(n,o,c,m,g)}}class ul extends at{possiblyEvaluate(t,n,o,c){if(t.value===void 0)return new wn(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c),g=t.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,_=this._calculate(g,g,g,n);return new wn(this,{kind:"constant",value:_},n)}if(t.expression.kind==="camera"){const m=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new wn(this,{kind:"constant",value:m},n)}return new wn(this,t.expression,n)}evaluate(t,n,o,c,m,g){if(t.kind==="source"){const _=t.evaluate(n,o,c,m,g);return this._calculate(_,_,_,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,c),t.evaluate({zoom:Math.floor(n.zoom)},o,c),t.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):t.value}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class cl{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){if(t.value!==void 0){if(t.expression.kind==="constant"){const m=t.expression.evaluate(n,null,{},o,c);return this._calculate(m,m,m,n)}return this._calculate(t.expression.evaluate(new Jt(Math.floor(n.zoom-1),n)),t.expression.evaluate(new Jt(Math.floor(n.zoom),n)),t.expression.evaluate(new Jt(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class qu{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,c){return!!t.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new ua(o,void 0),m=this.defaultTransitionablePropertyValues[n]=new ol(o);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}qe("DataDrivenProperty",at),qe("DataConstantProperty",Ke),qe("CrossFadedDataDrivenProperty",ul),qe("CrossFadedProperty",cl),qe("ColorRampProperty",qu);const e="-transition";class s extends Vs{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new uo(n.layout)),n.paint)){this._transitionablePaint=new ll(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new co(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Ch,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Ih,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const c=this._transitionablePaint._values[t],m=c.property.specification["property-type"]==="cross-faded-data-driven",g=c.value.isDataDriven(),_=c.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value;return x.isDataDriven()||g||m||this._handleOverridablePaintPropertyUpdate(t,_,x)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),pt(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,c,m={}){return(!m||m.validate!==!1)&&Ou(this,t.call(bs,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof wn&&Ys(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class u{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class p{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function v(r,t=1){let n=0,o=0;return{members:r.map(c=>{const m=l[c.type].BYTES_PER_ELEMENT,g=n=w(n,Math.max(t,m)),_=c.components||1;return o=Math.max(o,m),n+=m*_,{name:c.name,type:c.type,components:_,offset:g}}),size:w(n,Math.max(o,t)),alignment:t}}function w(r,t){return Math.ceil(r/t)*t}class T extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.int16[c+0]=n,this.int16[c+1]=o,t}}T.prototype.bytesPerElement=4,qe("StructArrayLayout2i4",T);class C extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.int16[m+0]=n,this.int16[m+1]=o,this.int16[m+2]=c,t}}C.prototype.bytesPerElement=6,qe("StructArrayLayout3i6",C);class z extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=c,this.int16[g+3]=m,t}}z.prototype.bytesPerElement=8,qe("StructArrayLayout4i8",z);class A extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=_,t}}A.prototype.bytesPerElement=12,qe("StructArrayLayout2i4i12",A);class F extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=4*t,k=8*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.uint8[k+4]=c,this.uint8[k+5]=m,this.uint8[k+6]=g,this.uint8[k+7]=_,t}}F.prototype.bytesPerElement=8,qe("StructArrayLayout2i4ub8",F);class j extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.float32[c+0]=n,this.float32[c+1]=o,t}}j.prototype.bytesPerElement=8,qe("StructArrayLayout2f8",j);class V extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,k,I){const P=this.length;return this.resize(P+1),this.emplace(P,t,n,o,c,m,g,_,x,k,I)}emplace(t,n,o,c,m,g,_,x,k,I,P){const M=10*t;return this.uint16[M+0]=n,this.uint16[M+1]=o,this.uint16[M+2]=c,this.uint16[M+3]=m,this.uint16[M+4]=g,this.uint16[M+5]=_,this.uint16[M+6]=x,this.uint16[M+7]=k,this.uint16[M+8]=I,this.uint16[M+9]=P,t}}V.prototype.bytesPerElement=20,qe("StructArrayLayout10ui20",V);class q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,k,I,P,M){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,o,c,m,g,_,x,k,I,P,M)}emplace(t,n,o,c,m,g,_,x,k,I,P,M,R){const B=12*t;return this.int16[B+0]=n,this.int16[B+1]=o,this.int16[B+2]=c,this.int16[B+3]=m,this.uint16[B+4]=g,this.uint16[B+5]=_,this.uint16[B+6]=x,this.uint16[B+7]=k,this.int16[B+8]=I,this.int16[B+9]=P,this.int16[B+10]=M,this.int16[B+11]=R,t}}q.prototype.bytesPerElement=24,qe("StructArrayLayout4i4ui4i24",q);class K extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.float32[m+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}K.prototype.bytesPerElement=12,qe("StructArrayLayout3f12",K);class J extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}J.prototype.bytesPerElement=4,qe("StructArrayLayout1ul4",J);class Q extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,k){const I=this.length;return this.resize(I+1),this.emplace(I,t,n,o,c,m,g,_,x,k)}emplace(t,n,o,c,m,g,_,x,k,I){const P=10*t,M=5*t;return this.int16[P+0]=n,this.int16[P+1]=o,this.int16[P+2]=c,this.int16[P+3]=m,this.int16[P+4]=g,this.int16[P+5]=_,this.uint32[M+3]=x,this.uint16[P+8]=k,this.uint16[P+9]=I,t}}Q.prototype.bytesPerElement=20,qe("StructArrayLayout6i1ul2ui20",Q);class U extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=6*t;return this.int16[x+0]=n,this.int16[x+1]=o,this.int16[x+2]=c,this.int16[x+3]=m,this.int16[x+4]=g,this.int16[x+5]=_,t}}U.prototype.bytesPerElement=12,qe("StructArrayLayout2i2i2i12",U);class ie extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,c,m)}emplace(t,n,o,c,m,g){const _=4*t,x=8*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=c,this.int16[x+6]=m,this.int16[x+7]=g,t}}ie.prototype.bytesPerElement=16,qe("StructArrayLayout2f1f2i16",ie);class ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,c,m,g)}emplace(t,n,o,c,m,g,_){const x=16*t,k=4*t,I=8*t;return this.uint8[x+0]=n,this.uint8[x+1]=o,this.float32[k+1]=c,this.float32[k+2]=m,this.int16[I+6]=g,this.int16[I+7]=_,t}}ae.prototype.bytesPerElement=16,qe("StructArrayLayout2ub2f2i16",ae);class pe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[m+0]=n,this.uint16[m+1]=o,this.uint16[m+2]=c,t}}pe.prototype.bytesPerElement=6,qe("StructArrayLayout3ui6",pe);class xe extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,k,I,P,M,R,B,O,$,X){const he=this.length;return this.resize(he+1),this.emplace(he,t,n,o,c,m,g,_,x,k,I,P,M,R,B,O,$,X)}emplace(t,n,o,c,m,g,_,x,k,I,P,M,R,B,O,$,X,he){const ee=24*t,oe=12*t,ge=48*t;return this.int16[ee+0]=n,this.int16[ee+1]=o,this.uint16[ee+2]=c,this.uint16[ee+3]=m,this.uint32[oe+2]=g,this.uint32[oe+3]=_,this.uint32[oe+4]=x,this.uint16[ee+10]=k,this.uint16[ee+11]=I,this.uint16[ee+12]=P,this.float32[oe+7]=M,this.float32[oe+8]=R,this.uint8[ge+36]=B,this.uint8[ge+37]=O,this.uint8[ge+38]=$,this.uint32[oe+10]=X,this.int16[ee+22]=he,t}}xe.prototype.bytesPerElement=48,qe("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",xe);class Ee extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c,m,g,_,x,k,I,P,M,R,B,O,$,X,he,ee,oe,ge,Se,Ve,st,Oe,Le,Qe,He){const Ze=this.length;return this.resize(Ze+1),this.emplace(Ze,t,n,o,c,m,g,_,x,k,I,P,M,R,B,O,$,X,he,ee,oe,ge,Se,Ve,st,Oe,Le,Qe,He)}emplace(t,n,o,c,m,g,_,x,k,I,P,M,R,B,O,$,X,he,ee,oe,ge,Se,Ve,st,Oe,Le,Qe,He,Ze){const _e=32*t,et=16*t;return this.int16[_e+0]=n,this.int16[_e+1]=o,this.int16[_e+2]=c,this.int16[_e+3]=m,this.int16[_e+4]=g,this.int16[_e+5]=_,this.int16[_e+6]=x,this.int16[_e+7]=k,this.uint16[_e+8]=I,this.uint16[_e+9]=P,this.uint16[_e+10]=M,this.uint16[_e+11]=R,this.uint16[_e+12]=B,this.uint16[_e+13]=O,this.uint16[_e+14]=$,this.uint16[_e+15]=X,this.uint16[_e+16]=he,this.uint16[_e+17]=ee,this.uint16[_e+18]=oe,this.uint16[_e+19]=ge,this.uint16[_e+20]=Se,this.uint16[_e+21]=Ve,this.uint16[_e+22]=st,this.uint32[et+12]=Oe,this.float32[et+13]=Le,this.float32[et+14]=Qe,this.uint16[_e+30]=He,this.uint16[_e+31]=Ze,t}}Ee.prototype.bytesPerElement=64,qe("StructArrayLayout8i15ui1ul2f2ui64",Ee);class Be extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Be.prototype.bytesPerElement=4,qe("StructArrayLayout1f4",Be);class $e extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=3*t;return this.uint16[6*t+0]=n,this.float32[m+1]=o,this.float32[m+2]=c,t}}$e.prototype.bytesPerElement=12,qe("StructArrayLayout1ui2f12",$e);class Ae extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,t,n,o)}emplace(t,n,o,c){const m=4*t;return this.uint32[2*t+0]=n,this.uint16[m+2]=o,this.uint16[m+3]=c,t}}Ae.prototype.bytesPerElement=8,qe("StructArrayLayout1ul2ui8",Ae);class ze extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const c=2*t;return this.uint16[c+0]=n,this.uint16[c+1]=o,t}}ze.prototype.bytesPerElement=4,qe("StructArrayLayout2ui4",ze);class Je extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Je.prototype.bytesPerElement=2,qe("StructArrayLayout1ui2",Je);class ht extends p{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,c){const m=this.length;return this.resize(m+1),this.emplace(m,t,n,o,c)}emplace(t,n,o,c,m){const g=4*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=m,t}}ht.prototype.bytesPerElement=16,qe("StructArrayLayout4f16",ht);class De extends u{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ne(this.anchorPointX,this.anchorPointY)}}De.prototype.size=20;class je extends Q{get(t){return new De(this,t)}}qe("CollisionBoxArray",je);class lt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}lt.prototype.size=48;class Yt extends xe{get(t){return new lt(this,t)}}qe("PlacedSymbolArray",Yt);class yt extends u{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}yt.prototype.size=64;class St extends Ee{get(t){return new yt(this,t)}}qe("SymbolInstanceArray",St);class Qt extends Be{getoffsetX(t){return this.float32[1*t+0]}}qe("GlyphOffsetArray",Qt);class Vr extends C{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}qe("SymbolLineVertexArray",Vr);class en extends u{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}en.prototype.size=12;class er extends $e{get(t){return new en(this,t)}}qe("TextAnchorOffsetArray",er);class hi extends u{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}hi.prototype.size=8;class ei extends Ae{get(t){return new hi(this,t)}}qe("FeatureIndexArray",ei);class Ur extends T{}class ti extends T{}class bn extends T{}class ca extends A{}class hl extends F{}class ha extends j{}class Ni extends V{}class dl extends q{}class Gu extends K{}class ji extends J{}class Vi extends U{}class Yn extends ae{}class tn extends pe{}class Lr extends ze{}const $r=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ei}=$r;class Et{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,c){let m=this.segments[this.segments.length-1];return t>Et.MAX_VERTEX_ARRAY_LENGTH&&Xt(`Max vertices per segment is ${Et.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!m||m.vertexLength+t>Et.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==c)&&(m={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(m.sortKey=c),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,c){return new Et([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}function Ss(r,t){return 256*(r=Ue(Math.floor(r),0,255))+Ue(Math.floor(t),0,255)}Et.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,qe("SegmentVector",Et);const da=v([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var pa={exports:{}},Dh={exports:{}};Dh.exports=function(r,t){var n,o,c,m,g,_,x,k;for(o=r.length-(n=3&r.length),c=t,g=3432918353,_=461845907,k=0;k<o;)x=255&r.charCodeAt(k)|(255&r.charCodeAt(++k))<<8|(255&r.charCodeAt(++k))<<16|(255&r.charCodeAt(++k))<<24,++k,c=27492+(65535&(m=5*(65535&(c=(c^=x=(65535&(x=(x=(65535&x)*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(x=0,n){case 3:x^=(255&r.charCodeAt(k+2))<<16;case 2:x^=(255&r.charCodeAt(k+1))<<8;case 1:c^=x=(65535&(x=(x=(65535&(x^=255&r.charCodeAt(k)))*g+(((x>>>16)*g&65535)<<16)&4294967295)<<15|x>>>17))*_+(((x>>>16)*_&65535)<<16)&4294967295}return c^=r.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0};var qp=Dh.exports,Lh={exports:{}};Lh.exports=function(r,t){for(var n,o=r.length,c=t^o,m=0;o>=4;)n=1540483477*(65535&(n=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++m;switch(o){case 3:c^=(255&r.charCodeAt(m+2))<<16;case 2:c^=(255&r.charCodeAt(m+1))<<8;case 1:c=1540483477*(65535&(c^=255&r.charCodeAt(m)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0};var Qn=qp,Rh=Lh.exports;pa.exports=Qn,pa.exports.murmur3=Qn,pa.exports.murmur2=Rh;var pl=H(pa.exports);class ho{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,c){this.ids.push(fl(t)),this.positions.push(n,o,c)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=fl(t);let o=0,c=this.ids.length-1;for(;o<c;){const g=o+c>>1;this.ids[g]>=n?c=g:o=g+1}const m=[];for(;this.ids[o]===n;)m.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return m}static serialize(t,n){const o=new Float64Array(t.ids),c=new Uint32Array(t.positions);return ml(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(t){const n=new ho;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function fl(r){const t=+r;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:pl(String(r))}function ml(r,t,n,o){for(;n<o;){const c=r[n+o>>1];let m=n-1,g=o+1;for(;;){do m++;while(r[m]<c);do g--;while(r[g]>c);if(m>=g)break;fa(r,m,g),fa(t,3*m,3*g),fa(t,3*m+1,3*g+1),fa(t,3*m+2,3*g+2)}g-n<o-g?(ml(r,t,n,g),n=g+1):(ml(r,t,g+1,o),o=g)}}function fa(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}qe("FeaturePositionMap",ho);class po{constructor(t,n){this.gl=t.gl,this.location=n}}class Fh extends po{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Xg extends po{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Kg extends po{constructor(t,n){super(t,n),this.current=Vt.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const n1=new Float32Array(16);function Gp(r){return[Ss(255*r.r,255*r.g),Ss(255*r.b,255*r.a)]}class Hu{constructor(t,n,o){this.value=t,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Kg(t,n):new Fh(t,n)}}class gl{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,c){const m=c==="u_pattern_to"?this.patternTo:c==="u_pattern_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new Xg(t,n):new Fh(t,n)}}class Ts{constructor(t,n,o,c){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(t,n,o,c,m){const g=this.paintVertexArray.length,_=this.expression.evaluate(new Jt(0),n,{},c,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,_)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(t,n,m)}_setPaintValue(t,n,o){if(this.type==="color"){const c=Gp(o);for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,c[0],c[1])}else{for(let c=t;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fn{constructor(t,n,o,c,m,g){this.expression=t,this.uniformNames=n.map(_=>`u_${_}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map(_=>({name:`a_${_}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(t,n,o,c,m){const g=this.expression.evaluate(new Jt(this.zoom),n,{},c,[],m),_=this.expression.evaluate(new Jt(this.zoom+1),n,{},c,[],m),x=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(x,t,g,_)}updatePaintArray(t,n,o,c){const m=this.expression.evaluate({zoom:this.zoom},o,c),g=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(t,n,m,g)}_setPaintValue(t,n,o,c){if(this.type==="color"){const m=Gp(o),g=Gp(c);for(let _=t;_<n;_++)this.paintVertexArray.emplace(_,m[0],m[1],g[0],g[1])}else{for(let m=t;m<n;m++)this.paintVertexArray.emplace(m,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Ue(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(c)}getBinding(t,n,o){return new Fh(t,n)}}class ma{constructor(t,n,o,c,m,g){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=c,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(t,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(c,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,c,m){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],m)}_setPaintValues(t,n,o,c){if(!c||!o)return;const{min:m,mid:g,max:_}=o,x=c[m],k=c[g],I=c[_];if(x&&k&&I)for(let P=t;P<n;P++)this.zoomInPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],k.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,k.tl[0],k.tl[1],k.br[0],k.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],k.pixelRatio,I.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,da.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,da.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Jg{constructor(t,n,o){this.binders={},this._buffers=[];const c=[];for(const m in t.paint._values){if(!o(m))continue;const g=t.paint.get(m);if(!(g instanceof wn&&Ys(g.property.specification)))continue;const _=s1(m,t.type),x=g.value,k=g.property.specification.type,I=g.property.useIntegerZoom,P=g.property.specification["property-type"],M=P==="cross-faded"||P==="cross-faded-data-driven";if(x.kind==="constant")this.binders[m]=M?new gl(x.value,_):new Hu(x.value,_,k),c.push(`/u_${m}`);else if(x.kind==="source"||M){const R=Yg(m,k,"source");this.binders[m]=M?new ma(x,k,I,n,R,t.id):new Ts(x,_,k,R),c.push(`/a_${m}`)}else{const R=Yg(m,k,"composite");this.binders[m]=new Fn(x,_,k,I,n,R),c.push(`/z_${m}`)}}this.cacheKey=c.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof Ts||n instanceof Fn?n.maxValue:0}populatePaintArrays(t,n,o,c,m){for(const g in this.binders){const _=this.binders[g];(_ instanceof Ts||_ instanceof Fn||_ instanceof ma)&&_.populatePaintArray(t,n,o,c,m)}}setConstantPatternPositions(t,n){for(const o in this.binders){const c=this.binders[o];c instanceof gl&&c.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,c,m){let g=!1;for(const _ in t){const x=n.getPositions(_);for(const k of x){const I=o.feature(k.index);for(const P in this.binders){const M=this.binders[P];if((M instanceof Ts||M instanceof Fn||M instanceof ma)&&M.expression.isStateDependent===!0){const R=c.paint.get(P);M.expression=R.value,M.updatePaintArray(k.start,k.end,I,t[_],m),g=!0}}}}return g}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Hu||o instanceof gl)&&t.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Ts||o instanceof Fn)for(let c=0;c<o.paintVertexAttributes.length;c++)t.push(o.paintVertexAttributes[c].name);else if(o instanceof ma)for(let c=0;c<da.members.length;c++)t.push(da.members[c].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Hu||o instanceof gl||o instanceof Fn)for(const c of o.uniformNames)t.push(c)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const c in this.binders){const m=this.binders[c];if(m instanceof Hu||m instanceof gl||m instanceof Fn){for(const g of m.uniformNames)if(n[g]){const _=m.getBinding(t,n[g],g);o.push({name:g,property:c,binding:_})}}}return o}setUniforms(t,n,o,c){for(const{name:m,property:g,binding:_}of n)this.binders[g].setUniform(_,c,o.get(g),m)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof ma){const c=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof Ts||o instanceof Fn)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof Ts||o instanceof Fn||o instanceof ma)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof Ts||n instanceof Fn||n instanceof ma)&&n.destroy()}}}class fo{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const c of t)this.programConfigurations[c.id]=new Jg(c,n,o);this.needsUpload=!1,this._featureMap=new ho,this._bufferOffset=0}populatePaintArrays(t,n,o,c,m,g){for(const _ in this.programConfigurations)this.programConfigurations[_].populatePaintArrays(t,n,c,m,g);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,c){for(const m of o)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,n,m,c)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function s1(r,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${t}-`,"").replace(/-/g,"_")]}function Yg(r,t,n){const o={color:{source:j,composite:ht},number:{source:Be,composite:j}},c=function(m){return{"line-pattern":{source:Ni,composite:Ni},"fill-pattern":{source:Ni,composite:Ni},"fill-extrusion-pattern":{source:Ni,composite:Ni}}[m]}(r);return c&&c[n]||o[t][n]}qe("ConstantBinder",Hu),qe("CrossFadedConstantBinder",gl),qe("SourceExpressionBinder",Ts),qe("CrossFadedCompositeBinder",ma),qe("CompositeExpressionBinder",Fn),qe("ProgramConfiguration",Jg,{omit:["_buffers"]}),qe("ProgramConfigurationSet",fo);const br=8192,Hp=Math.pow(2,14)-1,Qg=-Hp-1;function mo(r){const t=br/r.extent,n=r.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let m=0;m<c.length;m++){const g=c[m],_=Math.round(g.x*t),x=Math.round(g.y*t);g.x=Ue(_,Qg,Hp),g.y=Ue(x,Qg,Hp),(_<g.x||_>g.x+1||x<g.y||x>g.y+1)&&Xt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function go(r,t){return{type:r.type,id:r.id,properties:r.properties,geometry:t?mo(r):[]}}function Bh(r,t,n,o,c){r.emplaceBack(2*t+(o+1)/2,2*n+(c+1)/2)}class Wp{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ti,this.indexArray=new tn,this.segments=new Et,this.programConfigurations=new fo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const c=this.layers[0],m=[];let g=null,_=!1;c.type==="circle"&&(g=c.layout.get("circle-sort-key"),_=!g.isConstant());for(const{feature:x,id:k,index:I,sourceLayerIndex:P}of t){const M=this.layers[0]._featureFilter.needGeometry,R=go(x,M);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),R,o))continue;const B=_?g.evaluate(R,{},o):void 0,O={id:k,properties:x.properties,type:x.type,sourceLayerIndex:P,index:I,geometry:M?R.geometry:mo(x),patterns:{},sortKey:B};m.push(O)}_&&m.sort((x,k)=>x.sortKey-k.sortKey);for(const x of m){const{geometry:k,index:I,sourceLayerIndex:P}=x,M=t[I].feature;this.addFeature(x,k,I,o),n.featureIndex.insert(M,k,I,P,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ei),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,c){for(const m of n)for(const g of m){const _=g.x,x=g.y;if(_<0||_>=br||x<0||x>=br)continue;const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),I=k.vertexLength;Bh(this.layoutVertexArray,_,x,-1,-1),Bh(this.layoutVertexArray,_,x,1,-1),Bh(this.layoutVertexArray,_,x,1,1),Bh(this.layoutVertexArray,_,x,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},c)}}function ey(r,t){for(let n=0;n<r.length;n++)if(yl(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(yl(r,t[n]))return!0;return!!Xp(r,t)}function a1(r,t,n){return!!yl(r,t)||!!Kp(t,r,n)}function ty(r,t){if(r.length===1)return iy(t,r[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let c=0;c<o.length;c++)if(yl(r,o[c]))return!0}for(let n=0;n<r.length;n++)if(iy(t,r[n]))return!0;for(let n=0;n<t.length;n++)if(Xp(r,t[n]))return!0;return!1}function o1(r,t,n){if(r.length>1){if(Xp(r,t))return!0;for(let o=0;o<t.length;o++)if(Kp(t[o],r,n))return!0}for(let o=0;o<r.length;o++)if(Kp(r[o],t,n))return!0;return!1}function Xp(r,t){if(r.length===0||t.length===0)return!1;for(let n=0;n<r.length-1;n++){const o=r[n],c=r[n+1];for(let m=0;m<t.length-1;m++)if(l1(o,c,t[m],t[m+1]))return!0}return!1}function l1(r,t,n,o){return ur(r,n,o)!==ur(t,n,o)&&ur(r,t,n)!==ur(r,t,o)}function Kp(r,t,n){const o=n*n;if(t.length===1)return r.distSqr(t[0])<o;for(let c=1;c<t.length;c++)if(ry(r,t[c-1],t[c])<o)return!0;return!1}function ry(r,t,n){const o=t.distSqr(n);if(o===0)return r.distSqr(t);const c=((r.x-t.x)*(n.x-t.x)+(r.y-t.y)*(n.y-t.y))/o;return r.distSqr(c<0?t:c>1?n:n.sub(t)._mult(c)._add(t))}function iy(r,t){let n,o,c,m=!1;for(let g=0;g<r.length;g++){n=r[g];for(let _=0,x=n.length-1;_<n.length;x=_++)o=n[_],c=n[x],o.y>t.y!=c.y>t.y&&t.x<(c.x-o.x)*(t.y-o.y)/(c.y-o.y)+o.x&&(m=!m)}return m}function yl(r,t){let n=!1;for(let o=0,c=r.length-1;o<r.length;c=o++){const m=r[o],g=r[c];m.y>t.y!=g.y>t.y&&t.x<(g.x-m.x)*(t.y-m.y)/(g.y-m.y)+m.x&&(n=!n)}return n}function u1(r,t,n){const o=n[0],c=n[2];if(r.x<o.x&&t.x<o.x||r.x>c.x&&t.x>c.x||r.y<o.y&&t.y<o.y||r.y>c.y&&t.y>c.y)return!1;const m=ur(r,t,n[0]);return m!==ur(r,t,n[1])||m!==ur(r,t,n[2])||m!==ur(r,t,n[3])}function Wu(r,t,n){const o=t.paint.get(r).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(r)}function Oh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Nh(r,t,n,o,c){if(!t[0]&&!t[1])return r;const m=ne.convert(t)._mult(c);n==="viewport"&&m._rotate(-o);const g=[];for(let _=0;_<r.length;_++)g.push(r[_].sub(m));return g}let ny,sy;qe("CircleBucket",Wp,{omit:["layers"]});var c1={get paint(){return sy=sy||new f({"circle-radius":new at(me.paint_circle["circle-radius"]),"circle-color":new at(me.paint_circle["circle-color"]),"circle-blur":new at(me.paint_circle["circle-blur"]),"circle-opacity":new at(me.paint_circle["circle-opacity"]),"circle-translate":new Ke(me.paint_circle["circle-translate"]),"circle-translate-anchor":new Ke(me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ke(me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ke(me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(me.paint_circle["circle-stroke-opacity"])})},get layout(){return ny=ny||new f({"circle-sort-key":new at(me.layout_circle["circle-sort-key"])})}},di=1e-6,_l=typeof Float32Array<"u"?Float32Array:Array;function Jp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ay(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3],_=t[4],x=t[5],k=t[6],I=t[7],P=t[8],M=t[9],R=t[10],B=t[11],O=t[12],$=t[13],X=t[14],he=t[15],ee=n[0],oe=n[1],ge=n[2],Se=n[3];return r[0]=ee*o+oe*_+ge*P+Se*O,r[1]=ee*c+oe*x+ge*M+Se*$,r[2]=ee*m+oe*k+ge*R+Se*X,r[3]=ee*g+oe*I+ge*B+Se*he,r[4]=(ee=n[4])*o+(oe=n[5])*_+(ge=n[6])*P+(Se=n[7])*O,r[5]=ee*c+oe*x+ge*M+Se*$,r[6]=ee*m+oe*k+ge*R+Se*X,r[7]=ee*g+oe*I+ge*B+Se*he,r[8]=(ee=n[8])*o+(oe=n[9])*_+(ge=n[10])*P+(Se=n[11])*O,r[9]=ee*c+oe*x+ge*M+Se*$,r[10]=ee*m+oe*k+ge*R+Se*X,r[11]=ee*g+oe*I+ge*B+Se*he,r[12]=(ee=n[12])*o+(oe=n[13])*_+(ge=n[14])*P+(Se=n[15])*O,r[13]=ee*c+oe*x+ge*M+Se*$,r[14]=ee*m+oe*k+ge*R+Se*X,r[15]=ee*g+oe*I+ge*B+Se*he,r}Math.hypot||(Math.hypot=function(){for(var r=0,t=arguments.length;t--;)r+=arguments[t]*arguments[t];return Math.sqrt(r)});var Xu,h1=ay;function jh(r,t,n){var o=t[0],c=t[1],m=t[2],g=t[3];return r[0]=n[0]*o+n[4]*c+n[8]*m+n[12]*g,r[1]=n[1]*o+n[5]*c+n[9]*m+n[13]*g,r[2]=n[2]*o+n[6]*c+n[10]*m+n[14]*g,r[3]=n[3]*o+n[7]*c+n[11]*m+n[15]*g,r}Xu=new _l(4),_l!=Float32Array&&(Xu[0]=0,Xu[1]=0,Xu[2]=0,Xu[3]=0);class d1 extends s{constructor(t){super(t,c1)}createBucket(t){return new Wp(t)}queryRadius(t){const n=t;return Wu("circle-radius",this,n)+Wu("circle-stroke-width",this,n)+Oh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,c,m,g,_,x){const k=Nh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,_),I=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),P=this.paint.get("circle-pitch-alignment")==="map",M=P?k:function(B,O){return B.map($=>oy($,O))}(k,x),R=P?I*_:I;for(const B of c)for(const O of B){const $=P?O:oy(O,x);let X=R;const he=jh([],[O.x,O.y,0,1],x);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=he[3]/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=g.cameraToCenterDistance/he[3]),a1(M,$,X))return!0}return!1}}function oy(r,t){const n=jh([],[r.x,r.y,0,1],t);return new ne(n[0]/n[3],n[1]/n[3])}class ly extends Wp{}let uy;qe("HeatmapBucket",ly,{omit:["layers"]});var p1={get paint(){return uy=uy||new f({"heatmap-radius":new at(me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ke(me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new qu(me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ke(me.paint_heatmap["heatmap-opacity"])})}};function Yp(r,{width:t,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${c.length} but got: ${t*n*o}`)}else c=new Uint8Array(t*n*o);return r.width=t,r.height=n,r.data=c,r}function cy(r,{width:t,height:n},o){if(t===r.width&&n===r.height)return;const c=Yp({},{width:t,height:n},o);Qp(r,c,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,t),height:Math.min(r.height,n)},o),r.width=t,r.height=n,r.data=c.data}function Qp(r,t,n,o,c,m){if(c.width===0||c.height===0)return t;if(c.width>r.width||c.height>r.height||n.x>r.width-c.width||n.y>r.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>t.width||c.height>t.height||o.x>t.width-c.width||o.y>t.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const g=r.data,_=t.data;if(g===_)throw new Error("srcData equals dstData, so image is already copied");for(let x=0;x<c.height;x++){const k=((n.y+x)*r.width+n.x)*m,I=((o.y+x)*t.width+o.x)*m;for(let P=0;P<c.width*m;P++)_[I+P]=g[k+P]}return t}class Ku{constructor(t,n){Yp(this,t,1,n)}resize(t){cy(this,t,1)}clone(){return new Ku({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){Qp(t,n,o,c,m,1)}}class rn{constructor(t,n){Yp(this,t,4,n)}resize(t){cy(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new rn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,c,m){Qp(t,n,o,c,m,4)}}function hy(r){const t={},n=r.resolution||256,o=r.clips?r.clips.length:1,c=r.image||new rn({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(g,_,x)=>{t[r.evaluationKey]=x;const k=r.expression.evaluate(t);c.data[g+_+0]=Math.floor(255*k.r/k.a),c.data[g+_+1]=Math.floor(255*k.g/k.a),c.data[g+_+2]=Math.floor(255*k.b/k.a),c.data[g+_+3]=Math.floor(255*k.a)};if(r.clips)for(let g=0,_=0;g<o;++g,_+=4*n)for(let x=0,k=0;x<n;x++,k+=4){const I=x/(n-1),{start:P,end:M}=r.clips[g];m(_,k,P*(1-I)+M*I)}else for(let g=0,_=0;g<n;g++,_+=4)m(0,_,g/(n-1));return c}qe("AlphaImage",Ku),qe("RGBAImage",rn);const ef="big-fb";class f1 extends s{createBucket(t){return new ly(t)}constructor(t){super(t,p1),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ef)&&this.heatmapFbos.delete(ef)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let dy;var m1={get paint(){return dy=dy||new f({"hillshade-illumination-direction":new Ke(me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ke(me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ke(me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ke(me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ke(me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ke(me.paint_hillshade["hillshade-accent-color"])})}};class g1 extends s{constructor(t){super(t,m1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const y1=v([{name:"a_pos",components:2,type:"Int16"}],4),{members:_1}=y1;function py(r,t,n=2){const o=t&&t.length,c=o?t[0]*n:r.length;let m=fy(r,0,c,n,!0);const g=[];if(!m||m.next===m.prev)return g;let _,x,k;if(o&&(m=function(I,P,M,R){const B=[];for(let O=0,$=P.length;O<$;O++){const X=fy(I,P[O]*R,O<$-1?P[O+1]*R:I.length,R,!1);X===X.next&&(X.steiner=!0),B.push(E1(X))}B.sort(S1);for(let O=0;O<B.length;O++)M=T1(B[O],M);return M}(r,t,m,n)),r.length>80*n){_=1/0,x=1/0;let I=-1/0,P=-1/0;for(let M=n;M<c;M+=n){const R=r[M],B=r[M+1];R<_&&(_=R),B<x&&(x=B),R>I&&(I=R),B>P&&(P=B)}k=Math.max(I-_,P-x),k=k!==0?32767/k:0}return Ju(m,g,n,_,x,k,0),g}function fy(r,t,n,o,c){let m;if(c===function(g,_,x,k){let I=0;for(let P=_,M=x-k;P<x;P+=k)I+=(g[M]-g[P])*(g[P+1]+g[M+1]),M=P;return I}(r,t,n,o)>0)for(let g=t;g<n;g+=o)m=yy(g/o|0,r[g],r[g+1],m);else for(let g=n-o;g>=t;g-=o)m=yy(g/o|0,r[g],r[g+1],m);return m&&Vh(m,m.next)&&(Qu(m),m=m.next),m}function yo(r,t){if(!r)return r;t||(t=r);let n,o=r;do if(n=!1,o.steiner||!Vh(o,o.next)&&gr(o.prev,o,o.next)!==0)o=o.next;else{if(Qu(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function Ju(r,t,n,o,c,m,g){if(!r)return;!g&&m&&function(x,k,I,P){let M=x;do M.z===0&&(M.z=tf(M.x,M.y,k,I,P)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==x);M.prevZ.nextZ=null,M.prevZ=null,function(R){let B,O=1;do{let $,X=R;R=null;let he=null;for(B=0;X;){B++;let ee=X,oe=0;for(let Se=0;Se<O&&(oe++,ee=ee.nextZ,ee);Se++);let ge=O;for(;oe>0||ge>0&&ee;)oe!==0&&(ge===0||!ee||X.z<=ee.z)?($=X,X=X.nextZ,oe--):($=ee,ee=ee.nextZ,ge--),he?he.nextZ=$:R=$,$.prevZ=he,he=$;X=ee}he.nextZ=null,O*=2}while(B>1)}(M)}(r,o,c,m);let _=r;for(;r.prev!==r.next;){const x=r.prev,k=r.next;if(m?x1(r,o,c,m):v1(r))t.push(x.i,r.i,k.i),Qu(r),r=k.next,_=k.next;else if((r=k)===_){g?g===1?Ju(r=w1(yo(r),t),t,n,o,c,m,2):g===2&&b1(r,t,n,o,c,m):Ju(yo(r),t,n,o,c,m,1);break}}}function v1(r){const t=r.prev,n=r,o=r.next;if(gr(t,n,o)>=0)return!1;const c=t.x,m=n.x,g=o.x,_=t.y,x=n.y,k=o.y,I=c<m?c<g?c:g:m<g?m:g,P=_<x?_<k?_:k:x<k?x:k,M=c>m?c>g?c:g:m>g?m:g,R=_>x?_>k?_:k:x>k?x:k;let B=o.next;for(;B!==t;){if(B.x>=I&&B.x<=M&&B.y>=P&&B.y<=R&&vl(c,_,m,x,g,k,B.x,B.y)&&gr(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function x1(r,t,n,o){const c=r.prev,m=r,g=r.next;if(gr(c,m,g)>=0)return!1;const _=c.x,x=m.x,k=g.x,I=c.y,P=m.y,M=g.y,R=_<x?_<k?_:k:x<k?x:k,B=I<P?I<M?I:M:P<M?P:M,O=_>x?_>k?_:k:x>k?x:k,$=I>P?I>M?I:M:P>M?P:M,X=tf(R,B,t,n,o),he=tf(O,$,t,n,o);let ee=r.prevZ,oe=r.nextZ;for(;ee&&ee.z>=X&&oe&&oe.z<=he;){if(ee.x>=R&&ee.x<=O&&ee.y>=B&&ee.y<=$&&ee!==c&&ee!==g&&vl(_,I,x,P,k,M,ee.x,ee.y)&&gr(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,oe.x>=R&&oe.x<=O&&oe.y>=B&&oe.y<=$&&oe!==c&&oe!==g&&vl(_,I,x,P,k,M,oe.x,oe.y)&&gr(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;ee&&ee.z>=X;){if(ee.x>=R&&ee.x<=O&&ee.y>=B&&ee.y<=$&&ee!==c&&ee!==g&&vl(_,I,x,P,k,M,ee.x,ee.y)&&gr(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;oe&&oe.z<=he;){if(oe.x>=R&&oe.x<=O&&oe.y>=B&&oe.y<=$&&oe!==c&&oe!==g&&vl(_,I,x,P,k,M,oe.x,oe.y)&&gr(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function w1(r,t){let n=r;do{const o=n.prev,c=n.next.next;!Vh(o,c)&&my(o,n,n.next,c)&&Yu(o,c)&&Yu(c,o)&&(t.push(o.i,n.i,c.i),Qu(n),Qu(n.next),n=r=c),n=n.next}while(n!==r);return yo(n)}function b1(r,t,n,o,c,m){let g=r;do{let _=g.next.next;for(;_!==g.prev;){if(g.i!==_.i&&I1(g,_)){let x=gy(g,_);return g=yo(g,g.next),x=yo(x,x.next),Ju(g,t,n,o,c,m,0),void Ju(x,t,n,o,c,m,0)}_=_.next}g=g.next}while(g!==r)}function S1(r,t){return r.x-t.x}function T1(r,t){const n=function(c,m){let g=m;const _=c.x,x=c.y;let k,I=-1/0;do{if(x<=g.y&&x>=g.next.y&&g.next.y!==g.y){const O=g.x+(x-g.y)*(g.next.x-g.x)/(g.next.y-g.y);if(O<=_&&O>I&&(I=O,k=g.x<g.next.x?g:g.next,O===_))return k}g=g.next}while(g!==m);if(!k)return null;const P=k,M=k.x,R=k.y;let B=1/0;g=k;do{if(_>=g.x&&g.x>=M&&_!==g.x&&vl(x<R?_:I,x,M,R,x<R?I:_,x,g.x,g.y)){const O=Math.abs(x-g.y)/(_-g.x);Yu(g,c)&&(O<B||O===B&&(g.x>k.x||g.x===k.x&&k1(k,g)))&&(k=g,B=O)}g=g.next}while(g!==P);return k}(r,t);if(!n)return t;const o=gy(n,r);return yo(o,o.next),yo(n,n.next)}function k1(r,t){return gr(r.prev,r,t.prev)<0&&gr(t.next,r,r.next)<0}function tf(r,t,n,o,c){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-n)*c|0)|r<<8))|r<<4))|r<<2))|r<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*c|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function E1(r){let t=r,n=r;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==r);return n}function vl(r,t,n,o,c,m,g,_){return(c-g)*(t-_)>=(r-g)*(m-_)&&(r-g)*(o-_)>=(n-g)*(t-_)&&(n-g)*(m-_)>=(c-g)*(o-_)}function I1(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!function(n,o){let c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&my(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(r,t)&&(Yu(r,t)&&Yu(t,r)&&function(n,o){let c=n,m=!1;const g=(n.x+o.x)/2,_=(n.y+o.y)/2;do c.y>_!=c.next.y>_&&c.next.y!==c.y&&g<(c.next.x-c.x)*(_-c.y)/(c.next.y-c.y)+c.x&&(m=!m),c=c.next;while(c!==n);return m}(r,t)&&(gr(r.prev,r,t.prev)||gr(r,t.prev,t))||Vh(r,t)&&gr(r.prev,r,r.next)>0&&gr(t.prev,t,t.next)>0)}function gr(r,t,n){return(t.y-r.y)*(n.x-t.x)-(t.x-r.x)*(n.y-t.y)}function Vh(r,t){return r.x===t.x&&r.y===t.y}function my(r,t,n,o){const c=$h(gr(r,t,n)),m=$h(gr(r,t,o)),g=$h(gr(n,o,r)),_=$h(gr(n,o,t));return c!==m&&g!==_||!(c!==0||!Uh(r,n,t))||!(m!==0||!Uh(r,o,t))||!(g!==0||!Uh(n,r,o))||!(_!==0||!Uh(n,t,o))}function Uh(r,t,n){return t.x<=Math.max(r.x,n.x)&&t.x>=Math.min(r.x,n.x)&&t.y<=Math.max(r.y,n.y)&&t.y>=Math.min(r.y,n.y)}function $h(r){return r>0?1:r<0?-1:0}function Yu(r,t){return gr(r.prev,r,r.next)<0?gr(r,t,r.next)>=0&&gr(r,r.prev,t)>=0:gr(r,t,r.prev)<0||gr(r,r.next,t)<0}function gy(r,t){const n=rf(r.i,r.x,r.y),o=rf(t.i,t.x,t.y),c=r.next,m=t.prev;return r.next=t,t.prev=r,n.next=c,c.prev=n,o.next=n,n.prev=o,m.next=o,o.prev=m,o}function yy(r,t,n,o){const c=rf(r,t,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function Qu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function rf(r,t,n){return{i:r,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function nf(r,t,n){const o=n.patternDependencies;let c=!1;for(const m of t){const g=m.paint.get(`${r}-pattern`);g.isConstant()||(c=!0);const _=g.constantOr(null);_&&(c=!0,o[_.to]=!0,o[_.from]=!0)}return c}function sf(r,t,n,o,c){const m=c.patternDependencies;for(const g of t){const _=g.paint.get(`${r}-pattern`).value;if(_.kind!=="constant"){let x=_.evaluate({zoom:o-1},n,{},c.availableImages),k=_.evaluate({zoom:o},n,{},c.availableImages),I=_.evaluate({zoom:o+1},n,{},c.availableImages);x=x&&x.name?x.name:x,k=k&&k.name?k.name:k,I=I&&I.name?I.name:I,m[x]=!0,m[k]=!0,m[I]=!0,n.patterns[g.id]={min:x,mid:k,max:I}}}return n}class af{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new bn,this.indexArray=new tn,this.indexArray2=new Lr,this.programConfigurations=new fo(t.layers,t.zoom),this.segments=new Et,this.segments2=new Et,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=nf("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:x,index:k,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,M=go(_,P);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),M,o))continue;const R=m?c.evaluate(M,{},o,n.availableImages):void 0,B={id:x,properties:_.properties,type:_.type,sourceLayerIndex:I,index:k,geometry:P?M.geometry:mo(_),patterns:{},sortKey:R};g.push(B)}m&&g.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of g){const{geometry:x,index:k,sourceLayerIndex:I}=_;if(this.hasPattern){const P=sf("fill",this.layers,_,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(_,x,k,o,{});n.featureIndex.insert(t[k].feature,x,k,I,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_1),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,c,m){for(const g of $o(n,500)){let _=0;for(const R of g)_+=R.length;const x=this.segments.prepareSegment(_,this.layoutVertexArray,this.indexArray),k=x.vertexLength,I=[],P=[];for(const R of g){if(R.length===0)continue;R!==g[0]&&P.push(I.length/2);const B=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),O=B.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(O+R.length-1,O),I.push(R[0].x),I.push(R[0].y);for(let $=1;$<R.length;$++)this.layoutVertexArray.emplaceBack(R[$].x,R[$].y),this.indexArray2.emplaceBack(O+$-1,O+$),I.push(R[$].x),I.push(R[$].y);B.vertexLength+=R.length,B.primitiveLength+=R.length}const M=py(I,P);for(let R=0;R<M.length;R+=3)this.indexArray.emplaceBack(k+M[R],k+M[R+1],k+M[R+2]);x.vertexLength+=_,x.primitiveLength+=M.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}let _y,vy;qe("FillBucket",af,{omit:["layers","patternFeatures"]});var C1={get paint(){return vy=vy||new f({"fill-antialias":new Ke(me.paint_fill["fill-antialias"]),"fill-opacity":new at(me.paint_fill["fill-opacity"]),"fill-color":new at(me.paint_fill["fill-color"]),"fill-outline-color":new at(me.paint_fill["fill-outline-color"]),"fill-translate":new Ke(me.paint_fill["fill-translate"]),"fill-translate-anchor":new Ke(me.paint_fill["fill-translate-anchor"]),"fill-pattern":new ul(me.paint_fill["fill-pattern"])})},get layout(){return _y=_y||new f({"fill-sort-key":new at(me.layout_fill["fill-sort-key"])})}};class P1 extends s{constructor(t){super(t,C1)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new af(t)}queryRadius(){return Oh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,c,m,g,_){return ty(Nh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,_),c)}isTileClipped(){return!0}}const z1=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),A1=v([{name:"a_centroid",components:2,type:"Int16"}],4),{members:M1}=z1;var ga={},D1=le,xy=xl;function xl(r,t,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=r,this._geometry=-1,this._keys=o,this._values=c,r.readFields(L1,this,t)}function L1(r,t,n){r==1?t.id=n.readVarint():r==2?function(o,c){for(var m=o.readVarint()+o.pos;o.pos<m;){var g=c._keys[o.readVarint()],_=c._values[o.readVarint()];c.properties[g]=_}}(n,t):r==3?t.type=n.readVarint():r==4&&(t._geometry=n.pos)}function R1(r){for(var t,n,o=0,c=0,m=r.length,g=m-1;c<m;g=c++)o+=((n=r[g]).x-(t=r[c]).x)*(t.y+n.y);return o}xl.types=["Unknown","Point","LineString","Polygon"],xl.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var t,n=r.readVarint()+r.pos,o=1,c=0,m=0,g=0,_=[];r.pos<n;){if(c<=0){var x=r.readVarint();o=7&x,c=x>>3}if(c--,o===1||o===2)m+=r.readSVarint(),g+=r.readSVarint(),o===1&&(t&&_.push(t),t=[]),t.push(new D1(m,g));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&_.push(t),_},xl.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var t=r.readVarint()+r.pos,n=1,o=0,c=0,m=0,g=1/0,_=-1/0,x=1/0,k=-1/0;r.pos<t;){if(o<=0){var I=r.readVarint();n=7&I,o=I>>3}if(o--,n===1||n===2)(c+=r.readSVarint())<g&&(g=c),c>_&&(_=c),(m+=r.readSVarint())<x&&(x=m),m>k&&(k=m);else if(n!==7)throw new Error("unknown command "+n)}return[g,x,_,k]},xl.prototype.toGeoJSON=function(r,t,n){var o,c,m=this.extent*Math.pow(2,n),g=this.extent*r,_=this.extent*t,x=this.loadGeometry(),k=xl.types[this.type];function I(R){for(var B=0;B<R.length;B++){var O=R[B];R[B]=[360*(O.x+g)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+_)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(o=0;o<x.length;o++)P[o]=x[o][0];I(x=P);break;case 2:for(o=0;o<x.length;o++)I(x[o]);break;case 3:for(x=function(R){var B=R.length;if(B<=1)return[R];for(var O,$,X=[],he=0;he<B;he++){var ee=R1(R[he]);ee!==0&&($===void 0&&($=ee<0),$===ee<0?(O&&X.push(O),O=[R[he]]):O.push(R[he]))}return O&&X.push(O),X}(x),o=0;o<x.length;o++)for(c=0;c<x[o].length;c++)I(x[o][c])}x.length===1?x=x[0]:k="Multi"+k;var M={type:"Feature",geometry:{type:k,coordinates:x},properties:this.properties};return"id"in this&&(M.id=this.id),M};var F1=xy,wy=by;function by(r,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(B1,this,t),this.length=this._features.length}function B1(r,t,n){r===15?t.version=n.readVarint():r===1?t.name=n.readString():r===5?t.extent=n.readVarint():r===2?t._features.push(n.pos):r===3?t._keys.push(n.readString()):r===4&&t._values.push(function(o){for(var c=null,m=o.readVarint()+o.pos;o.pos<m;){var g=o.readVarint()>>3;c=g===1?o.readString():g===2?o.readFloat():g===3?o.readDouble():g===4?o.readVarint64():g===5?o.readVarint():g===6?o.readSVarint():g===7?o.readBoolean():null}return c}(n))}by.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var t=this._pbf.readVarint()+this._pbf.pos;return new F1(this._pbf,t,this.extent,this._keys,this._values)};var O1=wy;function N1(r,t,n){if(r===3){var o=new O1(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}ga.VectorTile=function(r,t){this.layers=r.readFields(N1,{},t)},ga.VectorTileFeature=xy,ga.VectorTileLayer=wy;const j1=ga.VectorTileFeature.types,of=Math.pow(2,13);function ec(r,t,n,o,c,m,g,_){r.emplaceBack(t,n,2*Math.floor(o*of)+g,c*of*2,m*of*2,Math.round(_))}class lf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ca,this.centroidVertexArray=new Ur,this.indexArray=new tn,this.programConfigurations=new fo(t.layers,t.zoom),this.segments=new Et,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=nf("fill-extrusion",this.layers,n);for(const{feature:c,id:m,index:g,sourceLayerIndex:_}of t){const x=this.layers[0]._featureFilter.needGeometry,k=go(c,x);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),k,o))continue;const I={id:m,sourceLayerIndex:_,index:g,geometry:x?k.geometry:mo(c),properties:c.properties,type:c.type,patterns:{}};this.hasPattern?this.features.push(sf("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,g,o,{}),n.featureIndex.insert(c,I.geometry,g,_,this.index,!0)}}addFeatures(t,n,o){for(const c of this.features){const{geometry:m}=c;this.addFeature(c,m,c.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,M1),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,A1.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,c,m){for(const g of $o(n,500)){const _={x:0,y:0,vertexCount:0};let x=0;for(const B of g)x+=B.length;let k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const B of g){if(B.length===0||U1(B))continue;let O=0;for(let $=0;$<B.length;$++){const X=B[$];if($>=1){const he=B[$-1];if(!V1(X,he)){k.vertexLength+4>Et.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ee=X.sub(he)._perp()._unit(),oe=he.dist(X);O+oe>32768&&(O=0),ec(this.layoutVertexArray,X.x,X.y,ee.x,ee.y,0,0,O),ec(this.layoutVertexArray,X.x,X.y,ee.x,ee.y,0,1,O),_.x+=2*X.x,_.y+=2*X.y,_.vertexCount+=2,O+=oe,ec(this.layoutVertexArray,he.x,he.y,ee.x,ee.y,0,0,O),ec(this.layoutVertexArray,he.x,he.y,ee.x,ee.y,0,1,O),_.x+=2*he.x,_.y+=2*he.y,_.vertexCount+=2;const ge=k.vertexLength;this.indexArray.emplaceBack(ge,ge+2,ge+1),this.indexArray.emplaceBack(ge+1,ge+2,ge+3),k.vertexLength+=4,k.primitiveLength+=2}}}}if(k.vertexLength+x>Et.MAX_VERTEX_ARRAY_LENGTH&&(k=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray)),j1[t.type]!=="Polygon")continue;const I=[],P=[],M=k.vertexLength;for(const B of g)if(B.length!==0){B!==g[0]&&P.push(I.length/2);for(let O=0;O<B.length;O++){const $=B[O];ec(this.layoutVertexArray,$.x,$.y,0,0,1,1,0),_.x+=$.x,_.y+=$.y,_.vertexCount+=1,I.push($.x),I.push($.y)}}const R=py(I,P);for(let B=0;B<R.length;B+=3)this.indexArray.emplaceBack(M+R[B],M+R[B+2],M+R[B+1]);k.primitiveLength+=R.length/3,k.vertexLength+=x;for(let B=0;B<_.vertexCount;B++){const O=Math.floor(_.x/_.vertexCount),$=Math.floor(_.y/_.vertexCount);this.centroidVertexArray.emplaceBack(O,$)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}}function V1(r,t){return r.x===t.x&&(r.x<0||r.x>br)||r.y===t.y&&(r.y<0||r.y>br)}function U1(r){return r.every(t=>t.x<0)||r.every(t=>t.x>br)||r.every(t=>t.y<0)||r.every(t=>t.y>br)}let Sy;qe("FillExtrusionBucket",lf,{omit:["layers","features"]});var $1={get paint(){return Sy=Sy||new f({"fill-extrusion-opacity":new Ke(me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ke(me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ke(me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ul(me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ke(me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Z1 extends s{constructor(t){super(t,$1)}createBucket(t){return new lf(t)}queryRadius(){return Oh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,c,m,g,_,x){const k=Nh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,_),I=this.paint.get("fill-extrusion-height").evaluate(n,o),P=this.paint.get("fill-extrusion-base").evaluate(n,o),M=function(B,O,$,X){const he=[];for(const ee of B){const oe=[ee.x,ee.y,0,1];jh(oe,oe,O),he.push(new ne(oe[0]/oe[3],oe[1]/oe[3]))}return he}(k,x),R=function(B,O,$,X){const he=[],ee=[],oe=X[8]*O,ge=X[9]*O,Se=X[10]*O,Ve=X[11]*O,st=X[8]*$,Oe=X[9]*$,Le=X[10]*$,Qe=X[11]*$;for(const He of B){const Ze=[],_e=[];for(const et of He){const Ye=et.x,ut=et.y,qt=X[0]*Ye+X[4]*ut+X[12],Zt=X[1]*Ye+X[5]*ut+X[13],Pr=X[2]*Ye+X[6]*ut+X[14],Sn=X[3]*Ye+X[7]*ut+X[15],qr=Pr+Se,zr=Sn+Ve,pi=qt+st,fi=Zt+Oe,mi=Pr+Le,dr=Sn+Qe,Ar=new ne((qt+oe)/zr,(Zt+ge)/zr);Ar.z=qr/zr,Ze.push(Ar);const ri=new ne(pi/dr,fi/dr);ri.z=mi/dr,_e.push(ri)}he.push(Ze),ee.push(_e)}return[he,ee]}(c,P,I,x);return function(B,O,$){let X=1/0;ty($,O)&&(X=Ty($,O[0]));for(let he=0;he<O.length;he++){const ee=O[he],oe=B[he];for(let ge=0;ge<ee.length-1;ge++){const Se=ee[ge],Ve=[Se,ee[ge+1],oe[ge+1],oe[ge],Se];ey($,Ve)&&(X=Math.min(X,Ty($,Ve)))}}return X!==1/0&&X}(R[0],R[1],M)}}function tc(r,t){return r.x*t.x+r.y*t.y}function Ty(r,t){if(r.length===1){let n=0;const o=t[n++];let c;for(;!c||o.equals(c);)if(c=t[n++],!c)return 1/0;for(;n<t.length;n++){const m=t[n],g=r[0],_=c.sub(o),x=m.sub(o),k=g.sub(o),I=tc(_,_),P=tc(_,x),M=tc(x,x),R=tc(k,_),B=tc(k,x),O=I*M-P*P,$=(M*R-P*B)/O,X=(I*B-P*R)/O,he=o.z*(1-$-X)+c.z*$+m.z*X;if(isFinite(he))return he}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const q1=v([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:G1}=q1,H1=v([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:W1}=H1,X1=ga.VectorTileFeature.types,K1=Math.cos(Math.PI/180*37.5),ky=Math.pow(2,14)/.5;class uf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new hl,this.layoutVertexArray2=new ha,this.indexArray=new tn,this.programConfigurations=new fo(t.layers,t.zoom),this.segments=new Et,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=nf("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),m=!c.isConstant(),g=[];for(const{feature:_,id:x,index:k,sourceLayerIndex:I}of t){const P=this.layers[0]._featureFilter.needGeometry,M=go(_,P);if(!this.layers[0]._featureFilter.filter(new Jt(this.zoom),M,o))continue;const R=m?c.evaluate(M,{},o):void 0,B={id:x,properties:_.properties,type:_.type,sourceLayerIndex:I,index:k,geometry:P?M.geometry:mo(_),patterns:{},sortKey:R};g.push(B)}m&&g.sort((_,x)=>_.sortKey-x.sortKey);for(const _ of g){const{geometry:x,index:k,sourceLayerIndex:I}=_;if(this.hasPattern){const P=sf("line",this.layers,_,this.zoom,n);this.patternFeatures.push(P)}else this.addFeature(_,x,k,o,{});n.featureIndex.insert(t[k].feature,x,k,I,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,W1)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,G1),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,c,m){const g=this.layers[0].layout,_=g.get("line-join").evaluate(t,{}),x=g.get("line-cap"),k=g.get("line-miter-limit"),I=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const P of n)this.addLine(P,t,_,x,k,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,m,c)}addLine(t,n,o,c,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let X=0;X<t.length-1;X++)this.totalDistance+=t[X].dist(t[X+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const _=X1[n.type]==="Polygon";let x=t.length;for(;x>=2&&t[x-1].equals(t[x-2]);)x--;let k=0;for(;k<x-1&&t[k].equals(t[k+1]);)k++;if(x<(_?3:2))return;o==="bevel"&&(m=1.05);const I=this.overscaling<=16?15*br/(512*this.overscaling):0,P=this.segments.prepareSegment(10*x,this.layoutVertexArray,this.indexArray);let M,R,B,O,$;this.e1=this.e2=-1,_&&(M=t[x-2],$=t[k].sub(M)._unit()._perp());for(let X=k;X<x;X++){if(B=X===x-1?_?t[k+1]:void 0:t[X+1],B&&t[X].equals(B))continue;$&&(O=$),M&&(R=M),M=t[X],$=B?B.sub(M)._unit()._perp():O,O=O||$;let he=O.add($);he.x===0&&he.y===0||he._unit();const ee=O.x*$.x+O.y*$.y,oe=he.x*$.x+he.y*$.y,ge=oe!==0?1/oe:1/0,Se=2*Math.sqrt(2-2*oe),Ve=oe<K1&&R&&B,st=O.x*$.y-O.y*$.x>0;if(Ve&&X>k){const Qe=M.dist(R);if(Qe>2*I){const He=M.sub(M.sub(R)._mult(I/Qe)._round());this.updateDistance(R,He),this.addCurrentVertex(He,O,0,0,P),R=He}}const Oe=R&&B;let Le=Oe?o:_?"butt":c;if(Oe&&Le==="round"&&(ge<g?Le="miter":ge<=2&&(Le="fakeround")),Le==="miter"&&ge>m&&(Le="bevel"),Le==="bevel"&&(ge>2&&(Le="flipbevel"),ge<m&&(Le="miter")),R&&this.updateDistance(R,M),Le==="miter")he._mult(ge),this.addCurrentVertex(M,he,0,0,P);else if(Le==="flipbevel"){if(ge>100)he=$.mult(-1);else{const Qe=ge*O.add($).mag()/O.sub($).mag();he._perp()._mult(Qe*(st?-1:1))}this.addCurrentVertex(M,he,0,0,P),this.addCurrentVertex(M,he.mult(-1),0,0,P)}else if(Le==="bevel"||Le==="fakeround"){const Qe=-Math.sqrt(ge*ge-1),He=st?Qe:0,Ze=st?0:Qe;if(R&&this.addCurrentVertex(M,O,He,Ze,P),Le==="fakeround"){const _e=Math.round(180*Se/Math.PI/20);for(let et=1;et<_e;et++){let Ye=et/_e;if(Ye!==.5){const qt=Ye-.5;Ye+=Ye*qt*(Ye-1)*((1.0904+ee*(ee*(3.55645-1.43519*ee)-3.2452))*qt*qt+(.848013+ee*(.215638*ee-1.06021)))}const ut=$.sub(O)._mult(Ye)._add(O)._unit()._mult(st?-1:1);this.addHalfVertex(M,ut.x,ut.y,!1,st,0,P)}}B&&this.addCurrentVertex(M,$,-He,-Ze,P)}else if(Le==="butt")this.addCurrentVertex(M,he,0,0,P);else if(Le==="square"){const Qe=R?1:-1;this.addCurrentVertex(M,he,Qe,Qe,P)}else Le==="round"&&(R&&(this.addCurrentVertex(M,O,0,0,P),this.addCurrentVertex(M,O,1,1,P,!0)),B&&(this.addCurrentVertex(M,$,-1,-1,P,!0),this.addCurrentVertex(M,$,0,0,P)));if(Ve&&X<x-1){const Qe=M.dist(B);if(Qe>2*I){const He=M.add(B.sub(M)._mult(I/Qe)._round());this.updateDistance(M,He),this.addCurrentVertex(He,$,0,0,P),M=He}}}}addCurrentVertex(t,n,o,c,m,g=!1){const _=n.y*c-n.x,x=-n.y-n.x*c;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,g,!1,o,m),this.addHalfVertex(t,_,x,g,!0,-c,m),this.distance>ky/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,c,m,g))}addHalfVertex({x:t,y:n},o,c,m,g,_,x){const k=.5*(this.lineClips?this.scaledDistance*(ky-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(m?1:0),(n<<1)+(g?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(_===0?0:_<0?-1:1)|(63&k)<<2,k>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),x.primitiveLength++),g?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let Ey,Iy;qe("LineBucket",uf,{omit:["layers","patternFeatures"]});var Cy={get paint(){return Iy=Iy||new f({"line-opacity":new at(me.paint_line["line-opacity"]),"line-color":new at(me.paint_line["line-color"]),"line-translate":new Ke(me.paint_line["line-translate"]),"line-translate-anchor":new Ke(me.paint_line["line-translate-anchor"]),"line-width":new at(me.paint_line["line-width"]),"line-gap-width":new at(me.paint_line["line-gap-width"]),"line-offset":new at(me.paint_line["line-offset"]),"line-blur":new at(me.paint_line["line-blur"]),"line-dasharray":new cl(me.paint_line["line-dasharray"]),"line-pattern":new ul(me.paint_line["line-pattern"]),"line-gradient":new qu(me.paint_line["line-gradient"])})},get layout(){return Ey=Ey||new f({"line-cap":new Ke(me.layout_line["line-cap"]),"line-join":new at(me.layout_line["line-join"]),"line-miter-limit":new Ke(me.layout_line["line-miter-limit"]),"line-round-limit":new Ke(me.layout_line["line-round-limit"]),"line-sort-key":new at(me.layout_line["line-sort-key"])})}};class J1 extends at{possiblyEvaluate(t,n){return n=new Jt(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,c){return n=We({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,c)}}let Zh;class Y1 extends s{constructor(t){super(t,Cy),this.gradientVersion=0,Zh||(Zh=new J1(Cy.paint.properties["line-width"].specification),Zh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Gs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=Zh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new uf(t)}queryRadius(t){const n=t,o=Py(Wu("line-width",this,n),Wu("line-gap-width",this,n)),c=Wu("line-offset",this,n);return o/2+Math.abs(c)+Oh(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,c,m,g,_){const x=Nh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,_),k=_/2*Py(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),I=this.paint.get("line-offset").evaluate(n,o);return I&&(c=function(P,M){const R=[];for(let B=0;B<P.length;B++){const O=P[B],$=[];for(let X=0;X<O.length;X++){const he=O[X-1],ee=O[X],oe=O[X+1],ge=X===0?new ne(0,0):ee.sub(he)._unit()._perp(),Se=X===O.length-1?new ne(0,0):oe.sub(ee)._unit()._perp(),Ve=ge._add(Se)._unit(),st=Ve.x*Se.x+Ve.y*Se.y;st!==0&&Ve._mult(1/st),$.push(Ve._mult(M)._add(ee))}R.push($)}return R}(c,I*_)),function(P,M,R){for(let B=0;B<M.length;B++){const O=M[B];if(P.length>=3){for(let $=0;$<O.length;$++)if(yl(P,O[$]))return!0}if(o1(P,O,R))return!0}return!1}(x,c,k)}isTileClipped(){return!0}}function Py(r,t){return t>0?t+2*r:r}const Q1=v([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ew=v([{name:"a_projected_pos",components:3,type:"Float32"}],4);v([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tw=v([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);v([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zy=v([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rw=v([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function iw(r,t,n){return r.sections.forEach(o=>{o.text=function(c,m,g){const _=m.layout.get("text-transform").evaluate(g,{});return _==="uppercase"?c=c.toLocaleUpperCase():_==="lowercase"&&(c=c.toLocaleLowerCase()),ki.applyArabicShaping&&(c=ki.applyArabicShaping(c)),c}(o.text,t,n)}),r}v([{name:"triangle",components:3,type:"Uint16"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),v([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),v([{type:"Float32",name:"offsetX"}]),v([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),v([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const rc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var kr=24,Ay=$t,My=function(r,t,n,o,c){var m,g,_=8*c-o-1,x=(1<<_)-1,k=x>>1,I=-7,P=c-1,M=-1,R=r[t+P];for(P+=M,m=R&(1<<-I)-1,R>>=-I,I+=_;I>0;m=256*m+r[t+P],P+=M,I-=8);for(g=m&(1<<-I)-1,m>>=-I,I+=o;I>0;g=256*g+r[t+P],P+=M,I-=8);if(m===0)m=1-k;else{if(m===x)return g?NaN:1/0*(R?-1:1);g+=Math.pow(2,o),m-=k}return(R?-1:1)*g*Math.pow(2,m-o)},Dy=function(r,t,n,o,c,m){var g,_,x,k=8*m-c-1,I=(1<<k)-1,P=I>>1,M=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,B=1,O=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(_=isNaN(t)?1:0,g=I):(g=Math.floor(Math.log(t)/Math.LN2),t*(x=Math.pow(2,-g))<1&&(g--,x*=2),(t+=g+P>=1?M/x:M*Math.pow(2,1-P))*x>=2&&(g++,x/=2),g+P>=I?(_=0,g=I):g+P>=1?(_=(t*x-1)*Math.pow(2,c),g+=P):(_=t*Math.pow(2,P-1)*Math.pow(2,c),g=0));c>=8;r[n+R]=255&_,R+=B,_/=256,c-=8);for(g=g<<c|_,k+=c;k>0;r[n+R]=255&g,R+=B,g/=256,k-=8);r[n+R-B]|=128*O};function $t(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}$t.Varint=0,$t.Fixed64=1,$t.Bytes=2,$t.Fixed32=5;var cf=4294967296,Ly=1/cf,Ry=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function ks(r){return r.type===$t.Bytes?r.readVarint()+r.pos:r.pos+1}function wl(r,t,n){return n?4294967296*t+(r>>>0):4294967296*(t>>>0)+(r>>>0)}function Fy(r,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=r;c--)n.buf[c+o]=n.buf[c]}function nw(r,t){for(var n=0;n<r.length;n++)t.writeVarint(r[n])}function sw(r,t){for(var n=0;n<r.length;n++)t.writeSVarint(r[n])}function aw(r,t){for(var n=0;n<r.length;n++)t.writeFloat(r[n])}function ow(r,t){for(var n=0;n<r.length;n++)t.writeDouble(r[n])}function lw(r,t){for(var n=0;n<r.length;n++)t.writeBoolean(r[n])}function uw(r,t){for(var n=0;n<r.length;n++)t.writeFixed32(r[n])}function cw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed32(r[n])}function hw(r,t){for(var n=0;n<r.length;n++)t.writeFixed64(r[n])}function dw(r,t){for(var n=0;n<r.length;n++)t.writeSFixed64(r[n])}function qh(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+16777216*r[t+3]}function bl(r,t,n){r[n]=t,r[n+1]=t>>>8,r[n+2]=t>>>16,r[n+3]=t>>>24}function By(r,t){return(r[t]|r[t+1]<<8|r[t+2]<<16)+(r[t+3]<<24)}$t.prototype={destroy:function(){this.buf=null},readFields:function(r,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,m=this.pos;this.type=7&o,r(c,t,this),this.pos===m&&this.skip(o)}return t},readMessage:function(r,t){return this.readFields(r,t,this.readVarint()+this.pos)},readFixed32:function(){var r=qh(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=By(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=qh(this.buf,this.pos)+qh(this.buf,this.pos+4)*cf;return this.pos+=8,r},readSFixed64:function(){var r=qh(this.buf,this.pos)+By(this.buf,this.pos+4)*cf;return this.pos+=8,r},readFloat:function(){var r=My(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=My(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(c,m,g){var _,x,k=g.buf;if(_=(112&(x=k[g.pos++]))>>4,x<128||(_|=(127&(x=k[g.pos++]))<<3,x<128)||(_|=(127&(x=k[g.pos++]))<<10,x<128)||(_|=(127&(x=k[g.pos++]))<<17,x<128)||(_|=(127&(x=k[g.pos++]))<<24,x<128)||(_|=(1&(x=k[g.pos++]))<<31,x<128))return wl(c,_,m);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,t=this.pos;return this.pos=r,r-t>=12&&Ry?function(n,o,c){return Ry.decode(n.subarray(o,c))}(this.buf,t,r):function(n,o,c){for(var m="",g=o;g<c;){var _,x,k,I=n[g],P=null,M=I>239?4:I>223?3:I>191?2:1;if(g+M>c)break;M===1?I<128&&(P=I):M===2?(192&(_=n[g+1]))==128&&(P=(31&I)<<6|63&_)<=127&&(P=null):M===3?(x=n[g+2],(192&(_=n[g+1]))==128&&(192&x)==128&&((P=(15&I)<<12|(63&_)<<6|63&x)<=2047||P>=55296&&P<=57343)&&(P=null)):M===4&&(x=n[g+2],k=n[g+3],(192&(_=n[g+1]))==128&&(192&x)==128&&(192&k)==128&&((P=(15&I)<<18|(63&_)<<12|(63&x)<<6|63&k)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,M=1):P>65535&&(P-=65536,m+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),m+=String.fromCharCode(P),g+=M}return m}(this.buf,t,r)},readBytes:function(){var r=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,r);return this.pos=r,t},readPackedVarint:function(r,t){if(this.type!==$t.Bytes)return r.push(this.readVarint(t));var n=ks(this);for(r=r||[];this.pos<n;)r.push(this.readVarint(t));return r},readPackedSVarint:function(r){if(this.type!==$t.Bytes)return r.push(this.readSVarint());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==$t.Bytes)return r.push(this.readBoolean());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==$t.Bytes)return r.push(this.readFloat());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==$t.Bytes)return r.push(this.readDouble());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==$t.Bytes)return r.push(this.readFixed32());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==$t.Bytes)return r.push(this.readSFixed32());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==$t.Bytes)return r.push(this.readFixed64());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==$t.Bytes)return r.push(this.readSFixed64());var t=ks(this);for(r=r||[];this.pos<t;)r.push(this.readSFixed64());return r},skip:function(r){var t=7&r;if(t===$t.Varint)for(;this.buf[this.pos++]>127;);else if(t===$t.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$t.Fixed32)this.pos+=4;else{if(t!==$t.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(r,t){this.writeVarint(r<<3|t)},realloc:function(r){for(var t=this.length||16;t<this.pos+r;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),bl(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),bl(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),bl(this.buf,-1&r,this.pos),bl(this.buf,Math.floor(r*Ly),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),bl(this.buf,-1&r,this.pos),bl(this.buf,Math.floor(r*Ly),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(t,n){var o,c;if(t>=0?(o=t%4294967296|0,c=t/4294967296|0):(c=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,c=c+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(m,g,_){_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,m>>>=7,_.buf[_.pos++]=127&m|128,_.buf[_.pos]=127&(m>>>=7)}(o,0,n),function(m,g){var _=(7&m)<<4;g.buf[g.pos++]|=_|((m>>>=3)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m|((m>>>=7)?128:0),m&&(g.buf[g.pos++]=127&m)))))}(c,n)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var t=this.pos;this.pos=function(o,c,m){for(var g,_,x=0;x<c.length;x++){if((g=c.charCodeAt(x))>55295&&g<57344){if(!_){g>56319||x+1===c.length?(o[m++]=239,o[m++]=191,o[m++]=189):_=g;continue}if(g<56320){o[m++]=239,o[m++]=191,o[m++]=189,_=g;continue}g=_-55296<<10|g-56320|65536,_=null}else _&&(o[m++]=239,o[m++]=191,o[m++]=189,_=null);g<128?o[m++]=g:(g<2048?o[m++]=g>>6|192:(g<65536?o[m++]=g>>12|224:(o[m++]=g>>18|240,o[m++]=g>>12&63|128),o[m++]=g>>6&63|128),o[m++]=63&g|128)}return m}(this.buf,r,this.pos);var n=this.pos-t;n>=128&&Fy(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(r){this.realloc(4),Dy(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Dy(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var t=r.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=r[n]},writeRawMessage:function(r,t){this.pos++;var n=this.pos;r(t,this);var o=this.pos-n;o>=128&&Fy(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(r,t,n){this.writeTag(r,$t.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(r,t){t.length&&this.writeMessage(r,nw,t)},writePackedSVarint:function(r,t){t.length&&this.writeMessage(r,sw,t)},writePackedBoolean:function(r,t){t.length&&this.writeMessage(r,lw,t)},writePackedFloat:function(r,t){t.length&&this.writeMessage(r,aw,t)},writePackedDouble:function(r,t){t.length&&this.writeMessage(r,ow,t)},writePackedFixed32:function(r,t){t.length&&this.writeMessage(r,uw,t)},writePackedSFixed32:function(r,t){t.length&&this.writeMessage(r,cw,t)},writePackedFixed64:function(r,t){t.length&&this.writeMessage(r,hw,t)},writePackedSFixed64:function(r,t){t.length&&this.writeMessage(r,dw,t)},writeBytesField:function(r,t){this.writeTag(r,$t.Bytes),this.writeBytes(t)},writeFixed32Field:function(r,t){this.writeTag(r,$t.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(r,t){this.writeTag(r,$t.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(r,t){this.writeTag(r,$t.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(r,t){this.writeTag(r,$t.Fixed64),this.writeSFixed64(t)},writeVarintField:function(r,t){this.writeTag(r,$t.Varint),this.writeVarint(t)},writeSVarintField:function(r,t){this.writeTag(r,$t.Varint),this.writeSVarint(t)},writeStringField:function(r,t){this.writeTag(r,$t.Bytes),this.writeString(t)},writeFloatField:function(r,t){this.writeTag(r,$t.Fixed32),this.writeFloat(t)},writeDoubleField:function(r,t){this.writeTag(r,$t.Fixed64),this.writeDouble(t)},writeBooleanField:function(r,t){this.writeVarintField(r,!!t)}};var hf=H(Ay);const df=3;function pw(r,t,n){r===1&&n.readMessage(fw,t)}function fw(r,t,n){if(r===3){const{id:o,bitmap:c,width:m,height:g,left:_,top:x,advance:k}=n.readMessage(mw,{});t.push({id:o,bitmap:new Ku({width:m+2*df,height:g+2*df},c),metrics:{width:m,height:g,left:_,top:x,advance:k}})}}function mw(r,t,n){r===1?t.id=n.readVarint():r===2?t.bitmap=n.readBytes():r===3?t.width=n.readVarint():r===4?t.height=n.readVarint():r===5?t.left=n.readSVarint():r===6?t.top=n.readSVarint():r===7&&(t.advance=n.readVarint())}const Oy=df;function Ny(r){let t=0,n=0;for(const g of r)t+=g.w*g.h,n=Math.max(n,g.w);r.sort((g,_)=>_.h-g.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let c=0,m=0;for(const g of r)for(let _=o.length-1;_>=0;_--){const x=o[_];if(!(g.w>x.w||g.h>x.h)){if(g.x=x.x,g.y=x.y,m=Math.max(m,g.y+g.h),c=Math.max(c,g.x+g.w),g.w===x.w&&g.h===x.h){const k=o.pop();_<o.length&&(o[_]=k)}else g.h===x.h?(x.x+=g.w,x.w-=g.w):g.w===x.w?(x.y+=g.h,x.h-=g.h):(o.push({x:x.x+g.w,y:x.y,w:x.w-g.w,h:g.h}),x.y+=g.h,x.h-=g.h);break}}return{w:c,h:m,fill:t/(c*m)||0}}const Ii=1;class pf{constructor(t,{pixelRatio:n,version:o,stretchX:c,stretchY:m,content:g,textFitWidth:_,textFitHeight:x}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=c,this.stretchY=m,this.content=g,this.version=o,this.textFitWidth=_,this.textFitHeight=x}get tl(){return[this.paddedRect.x+Ii,this.paddedRect.y+Ii]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ii,this.paddedRect.y+this.paddedRect.h-Ii]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ii)/this.pixelRatio,(this.paddedRect.h-2*Ii)/this.pixelRatio]}}class jy{constructor(t,n){const o={},c={};this.haveRenderCallbacks=[];const m=[];this.addImages(t,o,m),this.addImages(n,c,m);const{w:g,h:_}=Ny(m),x=new rn({width:g||1,height:_||1});for(const k in t){const I=t[k],P=o[k].paddedRect;rn.copy(I.data,x,{x:0,y:0},{x:P.x+Ii,y:P.y+Ii},I.data)}for(const k in n){const I=n[k],P=c[k].paddedRect,M=P.x+Ii,R=P.y+Ii,B=I.data.width,O=I.data.height;rn.copy(I.data,x,{x:0,y:0},{x:M,y:R},I.data),rn.copy(I.data,x,{x:0,y:O-1},{x:M,y:R-1},{width:B,height:1}),rn.copy(I.data,x,{x:0,y:0},{x:M,y:R+O},{width:B,height:1}),rn.copy(I.data,x,{x:B-1,y:0},{x:M-1,y:R},{width:1,height:O}),rn.copy(I.data,x,{x:0,y:0},{x:M+B,y:R},{width:1,height:O})}this.image=x,this.iconPositions=o,this.patternPositions=c}addImages(t,n,o){for(const c in t){const m=t[c],g={x:0,y:0,w:m.data.width+2*Ii,h:m.data.height+2*Ii};o.push(g),n[c]=new pf(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[c,m]=t.tl;o.update(n.data,void 0,{x:c,y:m})}}var ya;qe("ImagePosition",pf),qe("ImageAtlas",jy),S.ah=void 0,(ya=S.ah||(S.ah={}))[ya.none=0]="none",ya[ya.horizontal=1]="horizontal",ya[ya.vertical=2]="vertical",ya[ya.horizontalOnly=3]="horizontalOnly";const ic=-17;class nc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new nc;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new nc;return n.imageName=t,n}}class Sl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Sl;for(let c=0;c<t.sections.length;c++){const m=t.sections[c];m.image?o.addImageSection(m):o.addTextSection(m,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const c=t.charCodeAt(o+1)||null,m=t.charCodeAt(o-1)||null;n+=c&&Ah(c)&&!rc[t[o+1]]||m&&Ah(m)&&!rc[t[o-1]]||!rc[t[o]]?t[o]:rc[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Hh[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Hh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Sl;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(nc.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let c=0;c<t.text.length;++c)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void Xt("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(nc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Xt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gh(r,t,n,o,c,m,g,_,x,k,I,P,M,R,B){const O=Sl.fromFeature(r,c);let $;P===S.ah.vertical&&O.verticalizePunctuation();const{processBidirectionalText:X,processStyledBidirectionalText:he}=ki;if(X&&O.sections.length===1){$=[];const ge=X(O.toString(),ff(O,k,m,t,o,R));for(const Se of ge){const Ve=new Sl;Ve.text=Se,Ve.sections=O.sections;for(let st=0;st<Se.length;st++)Ve.sectionIndex.push(0);$.push(Ve)}}else if(he){$=[];const ge=he(O.text,O.sectionIndex,ff(O,k,m,t,o,R));for(const Se of ge){const Ve=new Sl;Ve.text=Se[0],Ve.sectionIndex=Se[1],Ve.sections=O.sections,$.push(Ve)}}else $=function(ge,Se){const Ve=[],st=ge.text;let Oe=0;for(const Le of Se)Ve.push(ge.substring(Oe,Le)),Oe=Le;return Oe<st.length&&Ve.push(ge.substring(Oe,st.length)),Ve}(O,ff(O,k,m,t,o,R));const ee=[],oe={positionedLines:ee,text:O.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1};return function(ge,Se,Ve,st,Oe,Le,Qe,He,Ze,_e,et,Ye){let ut=0,qt=ic,Zt=0,Pr=0;const Sn=He==="right"?1:He==="left"?0:.5;let qr=0;for(const dr of Oe){dr.trim();const Ar=dr.getMaxScale(),ri=(Ar-1)*kr,Gr={positionedGlyphs:[],lineOffset:0};ge.positionedLines[qr]=Gr;const gi=Gr.positionedGlyphs;let Hr=0;if(!dr.length()){qt+=Le,++qr;continue}for(let Ci=0;Ci<dr.length();Ci++){const Lt=dr.getSection(Ci),Ht=dr.getSectionIndex(Ci),tr=dr.getCharCode(Ci);let Ui=0,ar=null,Il=null,ts=null,rs=kr;const Tn=!(Ze===S.ah.horizontal||!et&&!$u(tr)||et&&(Hh[tr]||(zr=tr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(zr)))));if(Lt.imageName){const an=st[Lt.imageName];if(!an)continue;ts=Lt.imageName,ge.iconsInText=ge.iconsInText||!0,Il=an.paddedRect;const Rr=an.displaySize;Lt.scale=Lt.scale*kr/Ye,ar={width:Rr[0],height:Rr[1],left:Ii,top:-Oy,advance:Tn?Rr[1]:Rr[0]},Ui=ri+(kr-Rr[1]*Lt.scale),rs=ar.advance;const Es=Tn?Rr[0]*Lt.scale-kr*Ar:Rr[1]*Lt.scale-kr*Ar;Es>0&&Es>Hr&&(Hr=Es)}else{const an=Ve[Lt.fontStack],Rr=an&&an[tr];if(Rr&&Rr.rect)Il=Rr.rect,ar=Rr.metrics;else{const Es=Se[Lt.fontStack],cc=Es&&Es[tr];if(!cc)continue;ar=cc.metrics}Ui=(Ar-Lt.scale)*kr}Tn?(ge.verticalizable=!0,gi.push({glyph:tr,imageName:ts,x:ut,y:qt+Ui,vertical:Tn,scale:Lt.scale,fontStack:Lt.fontStack,sectionIndex:Ht,metrics:ar,rect:Il}),ut+=rs*Lt.scale+_e):(gi.push({glyph:tr,imageName:ts,x:ut,y:qt+Ui,vertical:Tn,scale:Lt.scale,fontStack:Lt.fontStack,sectionIndex:Ht,metrics:ar,rect:Il}),ut+=ar.advance*Lt.scale+_e)}gi.length!==0&&(Zt=Math.max(ut-_e,Zt),vw(gi,0,gi.length-1,Sn,Hr)),ut=0;const sn=Le*Ar+Hr;Gr.lineOffset=Math.max(Hr,ri),qt+=sn,Pr=Math.max(sn,Pr),++qr}var zr;const pi=qt-ic,{horizontalAlign:fi,verticalAlign:mi}=mf(Qe);(function(dr,Ar,ri,Gr,gi,Hr,sn,Ci,Lt){const Ht=(Ar-ri)*gi;let tr=0;tr=Hr!==sn?-Ci*Gr-ic:(-Gr*Lt+.5)*sn;for(const Ui of dr)for(const ar of Ui.positionedGlyphs)ar.x+=Ht,ar.y+=tr})(ge.positionedLines,Sn,fi,mi,Zt,Pr,Le,pi,Oe.length),ge.top+=-mi*pi,ge.bottom=ge.top+pi,ge.left+=-fi*Zt,ge.right=ge.left+Zt}(oe,t,n,o,$,g,_,x,P,k,M,B),!function(ge){for(const Se of ge)if(Se.positionedGlyphs.length!==0)return!1;return!0}(ee)&&oe}const Hh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},gw={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},yw={40:!0};function Vy(r,t,n,o,c,m){if(t.imageName){const g=o[t.imageName];return g?g.displaySize[0]*t.scale*kr/m+c:0}{const g=n[t.fontStack],_=g&&g[r];return _?_.metrics.advance*t.scale+c:0}}function Uy(r,t,n,o){const c=Math.pow(r-t,2);return o?r<t?c/2:2*c:c+Math.abs(n)*n}function _w(r,t,n){let o=0;return r===10&&(o-=1e4),n&&(o+=150),r!==40&&r!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function $y(r,t,n,o,c,m){let g=null,_=Uy(t,n,c,m);for(const x of o){const k=Uy(t-x.x,n,c,m)+x.badness;k<=_&&(g=x,_=k)}return{index:r,x:t,priorBreak:g,badness:_}}function Zy(r){return r?Zy(r.priorBreak).concat(r.index):[]}function ff(r,t,n,o,c,m){if(!r)return[];const g=[],_=function(P,M,R,B,O,$){let X=0;for(let he=0;he<P.length();he++){const ee=P.getSection(he);X+=Vy(P.getCharCode(he),ee,B,O,M,$)}return X/Math.max(1,Math.ceil(X/R))}(r,t,n,o,c,m),x=r.text.indexOf("")>=0;let k=0;for(let P=0;P<r.length();P++){const M=r.getSection(P),R=r.getCharCode(P);if(Hh[R]||(k+=Vy(R,M,o,c,t,m)),P<r.length()-1){const B=!((I=R)<11904)&&(!!kt["CJK Compatibility Forms"](I)||!!kt["CJK Compatibility"](I)||!!kt["CJK Strokes"](I)||!!kt["CJK Symbols and Punctuation"](I)||!!kt["Enclosed CJK Letters and Months"](I)||!!kt["Halfwidth and Fullwidth Forms"](I)||!!kt["Ideographic Description Characters"](I)||!!kt["Vertical Forms"](I)||zh.test(String.fromCodePoint(I)));(gw[R]||B||M.imageName||P!==r.length()-2&&yw[r.getCharCode(P+1)])&&g.push($y(P+1,k,_,g,_w(R,r.getCharCode(P+1),B&&x),!1))}}var I;return Zy($y(r.length(),k,_,g,0,!0))}function mf(r){let t=.5,n=.5;switch(r){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function vw(r,t,n,o,c){if(!o&&!c)return;const m=r[n],g=(r[n].x+m.metrics.advance*m.scale)*o;for(let _=t;_<=n;_++)r[_].x-=g,r[_].y+=c}function xw(r,t,n){const{horizontalAlign:o,verticalAlign:c}=mf(n),m=t[0]-r.displaySize[0]*o,g=t[1]-r.displaySize[1]*c;return{image:r,top:g,bottom:g+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function qy(r){var t,n;let o=r.left,c=r.top,m=r.right-o,g=r.bottom-c;const _=(t=r.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",x=(n=r.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",k=(r.image.content[2]-r.image.content[0])/(r.image.content[3]-r.image.content[1]);if(x==="proportional"){if(_==="stretchOnly"&&m/g<k||_==="proportional"){const I=Math.ceil(g*k);o*=I/m,m=I}}else if(_==="proportional"&&x==="stretchOnly"&&k!==0&&m/g>k){const I=Math.ceil(m/k);c*=I/g,g=I}return{x1:o,y1:c,x2:o+m,y2:c+g}}function Gy(r,t,n,o,c,m){const g=r.image;let _;if(g.content){const $=g.content,X=g.pixelRatio||1;_=[$[0]/X,$[1]/X,g.displaySize[0]-$[2]/X,g.displaySize[1]-$[3]/X]}const x=t.left*m,k=t.right*m;let I,P,M,R;n==="width"||n==="both"?(R=c[0]+x-o[3],P=c[0]+k+o[1]):(R=c[0]+(x+k-g.displaySize[0])/2,P=R+g.displaySize[0]);const B=t.top*m,O=t.bottom*m;return n==="height"||n==="both"?(I=c[1]+B-o[0],M=c[1]+O+o[2]):(I=c[1]+(B+O-g.displaySize[1])/2,M=I+g.displaySize[1]),{image:g,top:I,right:P,bottom:M,left:R,collisionPadding:_}}const sc=255,es=128,_a=sc*es;function Hy(r,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Jt(r+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let m=0;for(;m<o.length&&o[m]<=r;)m++;m=Math.max(0,m-1);let g=m;for(;g<o.length&&o[g]<r+1;)g++;g=Math.min(o.length-1,g);const _=o[m],x=o[g];return n.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:x,interpolationType:c}:{kind:"camera",minZoom:_,maxZoom:x,minSize:n.evaluate(new Jt(_)),maxSize:n.evaluate(new Jt(x)),interpolationType:c}}}function gf(r,t,n){let o="never";const c=r.get(t);return c?o=c:r.get(n)&&(o="always"),o}const ww=ga.VectorTileFeature.types,bw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wh(r,t,n,o,c,m,g,_,x,k,I,P,M){const R=_?Math.min(_a,Math.round(_[0])):0,B=_?Math.min(_a,Math.round(_[1])):0;r.emplaceBack(t,n,Math.round(32*o),Math.round(32*c),m,g,(R<<1)+(x?1:0),B,16*k,16*I,256*P,256*M)}function yf(r,t,n){r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n),r.emplaceBack(t.x,t.y,n)}function Sw(r){for(const t of r.sections)if(Zp(t.text))return!0;return!1}class _f{constructor(t){this.layoutVertexArray=new dl,this.indexArray=new tn,this.programConfigurations=t,this.segments=new Et,this.dynamicLayoutVertexArray=new Gu,this.opacityVertexArray=new ji,this.hasVisibleVertices=!1,this.placedSymbolArray=new Yt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Q1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ew.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,bw,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}qe("SymbolBuffers",_f);class vf{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Et,this.collisionVertexArray=new Yn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,tw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}qe("CollisionBuffers",vf);class Tl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(g=>g.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Jp([]),this.placementViewportMatrix=Jp([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hy(this.zoom,n["text-size"]),this.iconSizeData=Hy(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),m=o.get("symbol-z-order");this.canOverlap=gf(o,"text-overlap","text-allow-overlap")!=="never"||gf(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!c.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(g=>S.ah[g])),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=t.sourceID}createArrays(){this.text=new _f(new fo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new _f(new fo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new Qt,this.lineVertexArray=new Vr,this.symbolInstances=new St,this.textAnchorOffsets=new er}calculateGlyphDependencies(t,n,o,c,m){for(let g=0;g<t.length;g++)if(n[t.charCodeAt(g)]=!0,(o||c)&&m){const _=rc[t.charAt(g)];_&&(n[_.charCodeAt(0)]=!0)}}populate(t,n,o){const c=this.layers[0],m=c.layout,g=m.get("text-font"),_=m.get("text-field"),x=m.get("icon-image"),k=(_.value.kind!=="constant"||_.value.value instanceof wi&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),I=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,P=m.get("symbol-sort-key");if(this.features=[],!k&&!I)return;const M=n.iconDependencies,R=n.glyphDependencies,B=n.availableImages,O=new Jt(this.zoom);for(const{feature:$,id:X,index:he,sourceLayerIndex:ee}of t){const oe=c._featureFilter.needGeometry,ge=go($,oe);if(!c._featureFilter.filter(O,ge,o))continue;let Se,Ve;if(oe||(ge.geometry=mo($)),k){const Oe=c.getValueAndResolveTokens("text-field",ge,o,B),Le=wi.factory(Oe),Qe=this.hasRTLText=this.hasRTLText||Sw(Le);(!Qe||ki.getRTLTextPluginStatus()==="unavailable"||Qe&&ki.isParsed())&&(Se=iw(Le,c,ge))}if(I){const Oe=c.getValueAndResolveTokens("icon-image",ge,o,B);Ve=Oe instanceof Si?Oe:Si.fromString(Oe)}if(!Se&&!Ve)continue;const st=this.sortFeaturesByKey?P.evaluate(ge,{},o):void 0;if(this.features.push({id:X,text:Se,icon:Ve,index:he,sourceLayerIndex:ee,geometry:ge.geometry,properties:$.properties,type:ww[$.type],sortKey:st}),Ve&&(M[Ve.name]=!0),Se){const Oe=g.evaluate(ge,{},o).join(","),Le=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(S.ah.vertical)>=0;for(const Qe of Se.sections)if(Qe.image)M[Qe.image.name]=!0;else{const He=Vu(Se.toString()),Ze=Qe.fontStack||Oe,_e=R[Ze]=R[Ze]||{};this.calculateGlyphDependencies(Qe.text,_e,Le,this.allowVerticalPlacement,He)}}}m.get("symbol-placement")==="line"&&(this.features=function($){const X={},he={},ee=[];let oe=0;function ge(Oe){ee.push($[Oe]),oe++}function Se(Oe,Le,Qe){const He=he[Oe];return delete he[Oe],he[Le]=He,ee[He].geometry[0].pop(),ee[He].geometry[0]=ee[He].geometry[0].concat(Qe[0]),He}function Ve(Oe,Le,Qe){const He=X[Le];return delete X[Le],X[Oe]=He,ee[He].geometry[0].shift(),ee[He].geometry[0]=Qe[0].concat(ee[He].geometry[0]),He}function st(Oe,Le,Qe){const He=Qe?Le[0][Le[0].length-1]:Le[0][0];return`${Oe}:${He.x}:${He.y}`}for(let Oe=0;Oe<$.length;Oe++){const Le=$[Oe],Qe=Le.geometry,He=Le.text?Le.text.toString():null;if(!He){ge(Oe);continue}const Ze=st(He,Qe),_e=st(He,Qe,!0);if(Ze in he&&_e in X&&he[Ze]!==X[_e]){const et=Ve(Ze,_e,Qe),Ye=Se(Ze,_e,ee[et].geometry);delete X[Ze],delete he[_e],he[st(He,ee[Ye].geometry,!0)]=Ye,ee[et].geometry=null}else Ze in he?Se(Ze,_e,Qe):_e in X?Ve(Ze,_e,Qe):(ge(Oe),X[Ze]=oe-1,he[_e]=oe-1)}return ee.filter(Oe=>Oe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort(($,X)=>$.sortKey-X.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let c=t.dist(n[t.segment+1]),m=t.dist(n[t.segment]);const g={};for(let _=t.segment+1;_<n.length;_++)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:c},_<n.length-1&&(c+=n[_+1].dist(n[_]));for(let _=t.segment||0;_>=0;_--)g[_]={x:n[_].x,y:n[_].y,tileUnitDistanceFromAnchor:m},_>0&&(m+=n[_-1].dist(n[_]));for(let _=0;_<n.length;_++){const x=g[_];this.lineVertexArray.emplaceBack(x.x,x.y,x.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,c,m,g,_,x,k,I,P,M){const R=t.indexArray,B=t.layoutVertexArray,O=t.segments.prepareSegment(4*n.length,B,R,this.canOverlap?g.sortKey:void 0),$=this.glyphOffsetArray.length,X=O.vertexLength,he=this.allowVerticalPlacement&&_===S.ah.vertical?Math.PI/2:0,ee=g.text&&g.text.sections;for(let oe=0;oe<n.length;oe++){const{tl:ge,tr:Se,bl:Ve,br:st,tex:Oe,pixelOffsetTL:Le,pixelOffsetBR:Qe,minFontScaleX:He,minFontScaleY:Ze,glyphOffset:_e,isSDF:et,sectionIndex:Ye}=n[oe],ut=O.vertexLength,qt=_e[1];Wh(B,x.x,x.y,ge.x,qt+ge.y,Oe.x,Oe.y,o,et,Le.x,Le.y,He,Ze),Wh(B,x.x,x.y,Se.x,qt+Se.y,Oe.x+Oe.w,Oe.y,o,et,Qe.x,Le.y,He,Ze),Wh(B,x.x,x.y,Ve.x,qt+Ve.y,Oe.x,Oe.y+Oe.h,o,et,Le.x,Qe.y,He,Ze),Wh(B,x.x,x.y,st.x,qt+st.y,Oe.x+Oe.w,Oe.y+Oe.h,o,et,Qe.x,Qe.y,He,Ze),yf(t.dynamicLayoutVertexArray,x,he),R.emplaceBack(ut,ut+1,ut+2),R.emplaceBack(ut+1,ut+2,ut+3),O.vertexLength+=4,O.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_e[0]),oe!==n.length-1&&Ye===n[oe+1].sectionIndex||t.programConfigurations.populatePaintArrays(B.length,g,g.index,{},M,ee&&ee[Ye])}t.placedSymbolArray.emplaceBack(x.x,x.y,$,this.glyphOffsetArray.length-$,X,k,I,x.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],_,0,!1,0,P)}_addCollisionDebugVertex(t,n,o,c,m,g){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,c,m,Math.round(g.x),Math.round(g.y))}addCollisionDebugVertices(t,n,o,c,m,g,_){const x=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=x.vertexLength,I=m.layoutVertexArray,P=m.collisionVertexArray,M=_.anchorX,R=_.anchorY;this._addCollisionDebugVertex(I,P,g,M,R,new ne(t,n)),this._addCollisionDebugVertex(I,P,g,M,R,new ne(o,n)),this._addCollisionDebugVertex(I,P,g,M,R,new ne(o,c)),this._addCollisionDebugVertex(I,P,g,M,R,new ne(t,c)),x.vertexLength+=4;const B=m.indexArray;B.emplaceBack(k,k+1),B.emplaceBack(k+1,k+2),B.emplaceBack(k+2,k+3),B.emplaceBack(k+3,k),x.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,c){for(let m=t;m<n;m++){const g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,c?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vf(Vi,zy.members,Lr),this.iconCollisionBox=new vf(Vi,zy.members,Lr);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,c,m,g,_,x,k){const I={};for(let P=n;P<o;P++){const M=t.get(P);I.textBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.textFeatureIndex=M.featureIndex;break}for(let P=c;P<m;P++){const M=t.get(P);I.verticalTextBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.verticalTextFeatureIndex=M.featureIndex;break}for(let P=g;P<_;P++){const M=t.get(P);I.iconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.iconFeatureIndex=M.featureIndex;break}for(let P=x;P<k;P++){const M=t.get(P);I.verticalIconBox={x1:M.x1,y1:M.y1,x2:M.x2,y2:M.y2,anchorPointX:M.anchorPointX,anchorPointY:M.anchorPointY},I.verticalIconFeatureIndex=M.featureIndex;break}return I}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let m=o.vertexStartIndex;m<c;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),c=[],m=[],g=[];for(let _=0;_<this.symbolInstances.length;++_){g.push(_);const x=this.symbolInstances.get(_);c.push(0|Math.round(n*x.anchorX+o*x.anchorY)),m.push(x.featureIndex)}return g.sort((_,x)=>c[_]-c[x]||m[x]-m[_]),g}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,m,g)=>{c>=0&&g.indexOf(c)===m&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Wy,Xy;qe("SymbolBucket",Tl,{omit:["layers","collisionBoxArray","features","compareText"]}),Tl.MAX_GLYPHS=65535,Tl.addDynamicAttributes=yf;var xf={get paint(){return Xy=Xy||new f({"icon-opacity":new at(me.paint_symbol["icon-opacity"]),"icon-color":new at(me.paint_symbol["icon-color"]),"icon-halo-color":new at(me.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(me.paint_symbol["icon-halo-blur"]),"icon-translate":new Ke(me.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ke(me.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(me.paint_symbol["text-opacity"]),"text-color":new at(me.paint_symbol["text-color"],{runtimeType:li,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new at(me.paint_symbol["text-halo-color"]),"text-halo-width":new at(me.paint_symbol["text-halo-width"]),"text-halo-blur":new at(me.paint_symbol["text-halo-blur"]),"text-translate":new Ke(me.paint_symbol["text-translate"]),"text-translate-anchor":new Ke(me.paint_symbol["text-translate-anchor"])})},get layout(){return Wy=Wy||new f({"symbol-placement":new Ke(me.layout_symbol["symbol-placement"]),"symbol-spacing":new Ke(me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ke(me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ke(me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ke(me.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ke(me.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ke(me.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ke(me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ke(me.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(me.layout_symbol["icon-size"]),"icon-text-fit":new Ke(me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ke(me.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(me.layout_symbol["icon-image"]),"icon-rotate":new at(me.layout_symbol["icon-rotate"]),"icon-padding":new at(me.layout_symbol["icon-padding"]),"icon-keep-upright":new Ke(me.layout_symbol["icon-keep-upright"]),"icon-offset":new at(me.layout_symbol["icon-offset"]),"icon-anchor":new at(me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ke(me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ke(me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ke(me.layout_symbol["text-rotation-alignment"]),"text-field":new at(me.layout_symbol["text-field"]),"text-font":new at(me.layout_symbol["text-font"]),"text-size":new at(me.layout_symbol["text-size"]),"text-max-width":new at(me.layout_symbol["text-max-width"]),"text-line-height":new Ke(me.layout_symbol["text-line-height"]),"text-letter-spacing":new at(me.layout_symbol["text-letter-spacing"]),"text-justify":new at(me.layout_symbol["text-justify"]),"text-radial-offset":new at(me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ke(me.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new at(me.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new at(me.layout_symbol["text-anchor"]),"text-max-angle":new Ke(me.layout_symbol["text-max-angle"]),"text-writing-mode":new Ke(me.layout_symbol["text-writing-mode"]),"text-rotate":new at(me.layout_symbol["text-rotate"]),"text-padding":new Ke(me.layout_symbol["text-padding"]),"text-keep-upright":new Ke(me.layout_symbol["text-keep-upright"]),"text-transform":new at(me.layout_symbol["text-transform"]),"text-offset":new at(me.layout_symbol["text-offset"]),"text-allow-overlap":new Ke(me.layout_symbol["text-allow-overlap"]),"text-overlap":new Ke(me.layout_symbol["text-overlap"]),"text-ignore-placement":new Ke(me.layout_symbol["text-ignore-placement"]),"text-optional":new Ke(me.layout_symbol["text-optional"])})}};class Ky{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Wn,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}qe("FormatSectionOverride",Ky,{omit:["defaultValue"]});class Xh extends s{constructor(t){super(t,xf)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const m of o)c.indexOf(m)<0&&c.push(m);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,c){const m=this.layout.get(t).evaluate(n,{},o,c),g=this._unevaluatedLayout._values[t];return g.isDataDriven()||Jo(g.value)||!m?m:function(_,x){return x.replace(/{([^{}]+)}/g,(k,I)=>_&&I in _?String(_[I]):"")}(n.properties,m)}createBucket(t){return new Tl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of xf.paint.overridableProperties){if(!Xh.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Ky(n),c=new Ko(o,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new ta("source",c):new ra("composite",c,n.value.zoomStops),this.paint._values[t]=new wn(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Xh.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),c=xf.paint.properties[n];let m=!1;const g=_=>{for(const x of _)if(c.overrides&&c.overrides.hasOverride(x))return void(m=!0)};if(o.value.kind==="constant"&&o.value.value instanceof wi)g(o.value.value.sections);else if(o.value.kind==="source"){const _=k=>{m||(k instanceof Xi&&wr(k.value)===Dn?g(k.value.sections):k instanceof Vo?g(k.sections):k.eachChild(_))},x=o.value;x._styleExpression&&_(x._styleExpression.expression)}return m}}let Jy;var Tw={get paint(){return Jy=Jy||new f({"background-color":new Ke(me.paint_background["background-color"]),"background-pattern":new cl(me.paint_background["background-pattern"]),"background-opacity":new Ke(me.paint_background["background-opacity"])})}};class kw extends s{constructor(t){super(t,Tw)}}let Yy;var Ew={get paint(){return Yy=Yy||new f({"raster-opacity":new Ke(me.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ke(me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ke(me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ke(me.paint_raster["raster-brightness-max"]),"raster-saturation":new Ke(me.paint_raster["raster-saturation"]),"raster-contrast":new Ke(me.paint_raster["raster-contrast"]),"raster-resampling":new Ke(me.paint_raster["raster-resampling"]),"raster-fade-duration":new Ke(me.paint_raster["raster-fade-duration"])})}};class Iw extends s{constructor(t){super(t,Ew)}}class Cw extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Pw{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const wf=63710088e-1;class va{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new va(Ge(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,c=t.lat*n,m=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((t.lng-this.lng)*n);return wf*Math.acos(Math.min(m,1))}static convert(t){if(t instanceof va)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new va(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new va(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Qy=2*Math.PI*wf;function e_(r){return Qy*Math.cos(r*Math.PI/180)}function t_(r){return(180+r)/360}function r_(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function i_(r,t){return r/e_(t)}function bf(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class ac{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=va.convert(t);return new ac(t_(o.lng),r_(o.lat),i_(n,o.lat))}toLngLat(){return new va(360*this.x-180,bf(this.y))}toAltitude(){return this.z*e_(bf(this.y))}meterInMercatorCoordinateUnits(){return 1/Qy*(t=bf(this.y),1/Math.cos(t*Math.PI/180));var t}}function n_(r,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[r*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Sf{constructor(t,n,o){if(!function(c,m,g){return!(c<0||c>25||g<0||g>=Math.pow(2,c)||m<0||m>=Math.pow(2,c))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=oc(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const c=(g=this.y,_=this.z,x=n_(256*(m=this.x),256*(g=Math.pow(2,_)-g-1),_),k=n_(256*(m+1),256*(g+1),_),x[0]+","+x[1]+","+k[0]+","+k[1]);var m,g,_,x,k;const I=function(P,M,R){let B,O="";for(let $=P;$>0;$--)B=1<<$-1,O+=(M&B?1:0)+(R&B?2:0);return O}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,c)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new ne((t.x*n-this.x)*br,(t.y*n-this.y)*br)}toString(){return`${this.z}/${this.x}/${this.y}`}}class s_{constructor(t,n){this.wrap=t,this.canonical=n,this.key=oc(t,n.z,n.z,n.x,n.y)}}class nn{constructor(t,n,o,c,m){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Sf(o,+c,+m),this.key=oc(n,t,o,c,m)}clone(){return new nn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new nn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nn(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?oc(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):oc(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new nn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new nn(n,this.wrap,n,o,c),new nn(n,this.wrap,n,o+1,c),new nn(n,this.wrap,n,o,c+1),new nn(n,this.wrap,n,o+1,c+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new nn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new nn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new s_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new ac(t.x-this.wrap,t.y))}}function oc(r,t,n,o,c){(r*=2)<0&&(r=-1*r-1);const m=1<<n;return(m*m*r+m*c+o).toString(36)+n.toString(36)+t.toString(36)}qe("CanonicalTileID",Sf),qe("OverscaledTileID",nn,{omit:["posMatrix"]});class a_{constructor(t,n,o,c=1,m=1,g=1,_=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Xt(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const x=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=c,this.greenFactor=m,this.blueFactor=g,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let k=0;k<x;k++)this.data[this._idx(-1,k)]=this.data[this._idx(0,k)],this.data[this._idx(x,k)]=this.data[this._idx(x-1,k)],this.data[this._idx(k,-1)]=this.data[this._idx(k,0)],this.data[this._idx(k,x)]=this.data[this._idx(k,x-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(x,-1)]=this.data[this._idx(x-1,0)],this.data[this._idx(-1,x)]=this.data[this._idx(0,x-1)],this.data[this._idx(x,x)]=this.data[this._idx(x-1,x-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let k=0;k<x;k++)for(let I=0;I<x;I++){const P=this.get(k,I);P>this.max&&(this.max=P),P<this.min&&(this.min=P)}}get(t,n){const o=new Uint8Array(this.data.buffer),c=4*this._idx(t,n);return this.unpack(o[c],o[c+1],o[c+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new rn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,m=n*this.dim+this.dim,g=o*this.dim,_=o*this.dim+this.dim;switch(n){case-1:c=m-1;break;case 1:m=c+1}switch(o){case-1:g=_-1;break;case 1:_=g+1}const x=-n*this.dim,k=-o*this.dim;for(let I=g;I<_;I++)for(let P=c;P<m;P++)this.data[this._idx(P,I)]=t.data[this._idx(P+x,I+k)]}}qe("DEMData",a_);class o_{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class l_{constructor(t,n,o,c,m){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=c,this.properties=t.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class u_{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new sa(br,16,0),this.grid3D=new sa(br,16,0),this.featureIndexArray=new ei,this.promoteId=n}insert(t,n,o,c,m,g){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,m);const x=g?this.grid3D:this.grid;for(let k=0;k<n.length;k++){const I=n[k],P=[1/0,1/0,-1/0,-1/0];for(let M=0;M<I.length;M++){const R=I[M];P[0]=Math.min(P[0],R.x),P[1]=Math.min(P[1],R.y),P[2]=Math.max(P[2],R.x),P[3]=Math.max(P[3],R.y)}P[0]<br&&P[1]<br&&P[2]>=0&&P[3]>=0&&x.insert(_,P[0],P[1],P[2],P[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ga.VectorTile(new hf(this.rawTileData)).layers,this.sourceLayerCoder=new o_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,c){this.loadVTLayers();const m=t.params||{},g=br/t.tileSize/t.scale,_=Eu(m.filter),x=t.queryGeometry,k=t.queryPadding*g,I=h_(x),P=this.grid.query(I.minX-k,I.minY-k,I.maxX+k,I.maxY+k),M=h_(t.cameraQueryGeometry),R=this.grid3D.query(M.minX-k,M.minY-k,M.maxX+k,M.maxY+k,($,X,he,ee)=>function(oe,ge,Se,Ve,st){for(const Le of oe)if(ge<=Le.x&&Se<=Le.y&&Ve>=Le.x&&st>=Le.y)return!0;const Oe=[new ne(ge,Se),new ne(ge,st),new ne(Ve,st),new ne(Ve,Se)];if(oe.length>2){for(const Le of Oe)if(yl(oe,Le))return!0}for(let Le=0;Le<oe.length-1;Le++)if(u1(oe[Le],oe[Le+1],Oe))return!0;return!1}(t.cameraQueryGeometry,$-k,X-k,he+k,ee+k));for(const $ of R)P.push($);P.sort(zw);const B={};let O;for(let $=0;$<P.length;$++){const X=P[$];if(X===O)continue;O=X;const he=this.featureIndexArray.get(X);let ee=null;this.loadMatchingFeature(B,he.bucketIndex,he.sourceLayerIndex,he.featureIndex,_,m.layers,m.availableImages,n,o,c,(oe,ge,Se)=>(ee||(ee=mo(oe)),ge.queryIntersectsFeature(x,oe,Se,ee,this.z,t.transform,g,t.pixelPosMatrix)))}return B}loadMatchingFeature(t,n,o,c,m,g,_,x,k,I,P){const M=this.bucketLayerIDs[n];if(g&&!function($,X){for(let he=0;he<$.length;he++)if(X.indexOf($[he])>=0)return!0;return!1}(g,M))return;const R=this.sourceLayerCoder.decode(o),B=this.vtLayers[R].feature(c);if(m.needGeometry){const $=go(B,!0);if(!m.filter(new Jt(this.tileID.overscaledZ),$,this.tileID.canonical))return}else if(!m.filter(new Jt(this.tileID.overscaledZ),B))return;const O=this.getId(B,R);for(let $=0;$<M.length;$++){const X=M[$];if(g&&g.indexOf(X)<0)continue;const he=x[X];if(!he)continue;let ee={};O&&I&&(ee=I.getState(he.sourceLayer||"_geojsonTileLayer",O));const oe=We({},k[X]);oe.paint=c_(oe.paint,he.paint,B,ee,_),oe.layout=c_(oe.layout,he.layout,B,ee,_);const ge=!P||P(B,he,ee);if(!ge)continue;const Se=new l_(B,this.z,this.x,this.y,O);Se.layer=oe;let Ve=t[X];Ve===void 0&&(Ve=t[X]=[]),Ve.push({featureIndex:c,feature:Se,intersectionZ:ge})}}lookupSymbolFeatures(t,n,o,c,m,g,_,x){const k={};this.loadVTLayers();const I=Eu(m);for(const P of t)this.loadMatchingFeature(k,o,c,P,I,g,_,x,n);return k}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function c_(r,t,n,o,c){return Mt(r,(m,g)=>{const _=t instanceof co?t.get(g):null;return _&&_.evaluate?_.evaluate(n,o,c):_})}function h_(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return{minX:t,minY:n,maxX:o,maxY:c}}function zw(r,t){return t-r}function d_(r,t,n,o,c){const m=[];for(let g=0;g<r.length;g++){const _=r[g];let x;for(let k=0;k<_.length-1;k++){let I=_[k],P=_[k+1];I.x<t&&P.x<t||(I.x<t?I=new ne(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<t&&(P=new ne(t,I.y+(t-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<n&&P.y<n||(I.y<n?I=new ne(I.x+(n-I.y)/(P.y-I.y)*(P.x-I.x),n)._round():P.y<n&&(P=new ne(I.x+(n-I.y)/(P.y-I.y)*(P.x-I.x),n)._round()),I.x>=o&&P.x>=o||(I.x>=o?I=new ne(o,I.y+(o-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=o&&(P=new ne(o,I.y+(o-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=c&&P.y>=c||(I.y>=c?I=new ne(I.x+(c-I.y)/(P.y-I.y)*(P.x-I.x),c)._round():P.y>=c&&(P=new ne(I.x+(c-I.y)/(P.y-I.y)*(P.x-I.x),c)._round()),x&&I.equals(x[x.length-1])||(x=[I],m.push(x)),x.push(P)))))}}return m}qe("FeatureIndex",u_,{omit:["rawTileData","sourceLayerCoder"]});class xa extends ne{constructor(t,n,o,c){super(t,n),this.angle=o,c!==void 0&&(this.segment=c)}clone(){return new xa(this.x,this.y,this.angle,this.segment)}}function p_(r,t,n,o,c){if(t.segment===void 0||n===0)return!0;let m=t,g=t.segment+1,_=0;for(;_>-n/2;){if(g--,g<0)return!1;_-=r[g].dist(m),m=r[g]}_+=r[g].dist(r[g+1]),g++;const x=[];let k=0;for(;_<n/2;){const I=r[g],P=r[g+1];if(!P)return!1;let M=r[g-1].angleTo(I)-I.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:_,angleDelta:M}),k+=M;_-x[0].distance>o;)k-=x.shift().angleDelta;if(k>c)return!1;g++,_+=I.dist(P)}return!0}function f_(r){let t=0;for(let n=0;n<r.length-1;n++)t+=r[n].dist(r[n+1]);return t}function m_(r,t,n){return r?.6*t*n:0}function g_(r,t){return Math.max(r?r.right-r.left:0,t?t.right-t.left:0)}function Aw(r,t,n,o,c,m){const g=m_(n,c,m),_=g_(n,o)*m;let x=0;const k=f_(r)/2;for(let I=0;I<r.length-1;I++){const P=r[I],M=r[I+1],R=P.dist(M);if(x+R>k){const B=(k-x)/R,O=ui.number(P.x,M.x,B),$=ui.number(P.y,M.y,B),X=new xa(O,$,M.angleTo(P),I);return X._round(),!g||p_(r,X,_,g,t)?X:void 0}x+=R}}function Mw(r,t,n,o,c,m,g,_,x){const k=m_(o,m,g),I=g_(o,c),P=I*g,M=r[0].x===0||r[0].x===x||r[0].y===0||r[0].y===x;return t-P<t/4&&(t=P+t/4),y_(r,M?t/2*_%t:(I/2+2*m)*g*_%t,t,k,n,P,M,!1,x)}function y_(r,t,n,o,c,m,g,_,x){const k=m/2,I=f_(r);let P=0,M=t-n,R=[];for(let B=0;B<r.length-1;B++){const O=r[B],$=r[B+1],X=O.dist($),he=$.angleTo(O);for(;M+n<P+X;){M+=n;const ee=(M-P)/X,oe=ui.number(O.x,$.x,ee),ge=ui.number(O.y,$.y,ee);if(oe>=0&&oe<x&&ge>=0&&ge<x&&M-k>=0&&M+k<=I){const Se=new xa(oe,ge,he,B);Se._round(),o&&!p_(r,Se,m,o,c)||R.push(Se)}}P+=X}return _||R.length||g||(R=y_(r,P/2,n,o,c,m,g,!0,x)),R}qe("Anchor",xa);const kl=Ii;function __(r,t,n,o){const c=[],m=r.image,g=m.pixelRatio,_=m.paddedRect.w-2*kl,x=m.paddedRect.h-2*kl;let k={x1:r.left,y1:r.top,x2:r.right,y2:r.bottom};const I=m.stretchX||[[0,_]],P=m.stretchY||[[0,x]],M=(_e,et)=>_e+et[1]-et[0],R=I.reduce(M,0),B=P.reduce(M,0),O=_-R,$=x-B;let X=0,he=R,ee=0,oe=B,ge=0,Se=O,Ve=0,st=$;if(m.content&&o){const _e=m.content,et=_e[2]-_e[0],Ye=_e[3]-_e[1];(m.textFitWidth||m.textFitHeight)&&(k=qy(r)),X=Kh(I,0,_e[0]),ee=Kh(P,0,_e[1]),he=Kh(I,_e[0],_e[2]),oe=Kh(P,_e[1],_e[3]),ge=_e[0]-X,Ve=_e[1]-ee,Se=et-he,st=Ye-oe}const Oe=k.x1,Le=k.y1,Qe=k.x2-Oe,He=k.y2-Le,Ze=(_e,et,Ye,ut)=>{const qt=Jh(_e.stretch-X,he,Qe,Oe),Zt=Yh(_e.fixed-ge,Se,_e.stretch,R),Pr=Jh(et.stretch-ee,oe,He,Le),Sn=Yh(et.fixed-Ve,st,et.stretch,B),qr=Jh(Ye.stretch-X,he,Qe,Oe),zr=Yh(Ye.fixed-ge,Se,Ye.stretch,R),pi=Jh(ut.stretch-ee,oe,He,Le),fi=Yh(ut.fixed-Ve,st,ut.stretch,B),mi=new ne(qt,Pr),dr=new ne(qr,Pr),Ar=new ne(qr,pi),ri=new ne(qt,pi),Gr=new ne(Zt/g,Sn/g),gi=new ne(zr/g,fi/g),Hr=t*Math.PI/180;if(Hr){const Lt=Math.sin(Hr),Ht=Math.cos(Hr),tr=[Ht,-Lt,Lt,Ht];mi._matMult(tr),dr._matMult(tr),ri._matMult(tr),Ar._matMult(tr)}const sn=_e.stretch+_e.fixed,Ci=et.stretch+et.fixed;return{tl:mi,tr:dr,bl:ri,br:Ar,tex:{x:m.paddedRect.x+kl+sn,y:m.paddedRect.y+kl+Ci,w:Ye.stretch+Ye.fixed-sn,h:ut.stretch+ut.fixed-Ci},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gr,pixelOffsetBR:gi,minFontScaleX:Se/g/Qe,minFontScaleY:st/g/He,isSDF:n}};if(o&&(m.stretchX||m.stretchY)){const _e=v_(I,O,R),et=v_(P,$,B);for(let Ye=0;Ye<_e.length-1;Ye++){const ut=_e[Ye],qt=_e[Ye+1];for(let Zt=0;Zt<et.length-1;Zt++)c.push(Ze(ut,et[Zt],qt,et[Zt+1]))}}else c.push(Ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:x+1}));return c}function Kh(r,t,n){let o=0;for(const c of r)o+=Math.max(t,Math.min(n,c[1]))-Math.max(t,Math.min(n,c[0]));return o}function v_(r,t,n){const o=[{fixed:-kl,stretch:0}];for(const[c,m]of r){const g=o[o.length-1];o.push({fixed:c-g.stretch,stretch:g.stretch}),o.push({fixed:c-g.stretch,stretch:g.stretch+(m-c)})}return o.push({fixed:t+kl,stretch:n}),o}function Jh(r,t,n,o){return r/t*n+o}function Yh(r,t,n,o){return r-t*n/o}class Qh{constructor(t,n,o,c,m,g,_,x,k,I){var P;if(this.boxStartIndex=t.length,k){let M=g.top,R=g.bottom;const B=g.collisionPadding;B&&(M-=B[1],R+=B[3]);let O=R-M;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{const M=!((P=g.image)===null||P===void 0)&&P.content&&(g.image.textFitWidth||g.image.textFitHeight)?qy(g):{x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};M.y1=M.y1*_-x[0],M.y2=M.y2*_+x[2],M.x1=M.x1*_-x[3],M.x2=M.x2*_+x[1];const R=g.collisionPadding;if(R&&(M.x1-=R[0]*_,M.y1-=R[1]*_,M.x2+=R[2]*_,M.y2+=R[3]*_),I){const B=new ne(M.x1,M.y1),O=new ne(M.x2,M.y1),$=new ne(M.x1,M.y2),X=new ne(M.x2,M.y2),he=I*Math.PI/180;B._rotate(he),O._rotate(he),$._rotate(he),X._rotate(he),M.x1=Math.min(B.x,O.x,$.x,X.x),M.x2=Math.max(B.x,O.x,$.x,X.x),M.y1=Math.min(B.y,O.y,$.y,X.y),M.y2=Math.max(B.y,O.y,$.y,X.y)}t.emplaceBack(n.x,n.y,M.x1,M.y1,M.x2,M.y2,o,c,m)}this.boxEndIndex=t.length}}class Dw{constructor(t=[],n=(o,c)=>o<c?-1:o>c?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,c=n[t];for(;t>0;){const m=t-1>>1,g=n[m];if(o(c,g)>=0)break;n[t]=g,t=m}n[t]=c}_down(t){const{data:n,compare:o}=this,c=this.length>>1,m=n[t];for(;t<c;){let g=1+(t<<1);const _=g+1;if(_<this.length&&o(n[_],n[g])<0&&(g=_),o(n[g],m)>=0)break;n[t]=n[g],t=g}n[t]=m}}function Lw(r,t=1,n=!1){let o=1/0,c=1/0,m=-1/0,g=-1/0;const _=r[0];for(let R=0;R<_.length;R++){const B=_[R];(!R||B.x<o)&&(o=B.x),(!R||B.y<c)&&(c=B.y),(!R||B.x>m)&&(m=B.x),(!R||B.y>g)&&(g=B.y)}const x=Math.min(m-o,g-c);let k=x/2;const I=new Dw([],Rw);if(x===0)return new ne(o,c);for(let R=o;R<m;R+=x)for(let B=c;B<g;B+=x)I.push(new El(R+k,B+k,k,r));let P=function(R){let B=0,O=0,$=0;const X=R[0];for(let he=0,ee=X.length,oe=ee-1;he<ee;oe=he++){const ge=X[he],Se=X[oe],Ve=ge.x*Se.y-Se.x*ge.y;O+=(ge.x+Se.x)*Ve,$+=(ge.y+Se.y)*Ve,B+=3*Ve}return new El(O/B,$/B,0,R)}(r),M=I.length;for(;I.length;){const R=I.pop();(R.d>P.d||!P.d)&&(P=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,M)),R.max-P.d<=t||(k=R.h/2,I.push(new El(R.p.x-k,R.p.y-k,k,r)),I.push(new El(R.p.x+k,R.p.y-k,k,r)),I.push(new El(R.p.x-k,R.p.y+k,k,r)),I.push(new El(R.p.x+k,R.p.y+k,k,r)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function Rw(r,t){return t.max-r.max}function El(r,t,n,o){this.p=new ne(r,t),this.h=n,this.d=function(c,m){let g=!1,_=1/0;for(let x=0;x<m.length;x++){const k=m[x];for(let I=0,P=k.length,M=P-1;I<P;M=I++){const R=k[I],B=k[M];R.y>c.y!=B.y>c.y&&c.x<(B.x-R.x)*(c.y-R.y)/(B.y-R.y)+R.x&&(g=!g),_=Math.min(_,ry(c,R,B))}}return(g?1:-1)*Math.sqrt(_)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Zr;S.aq=void 0,(Zr=S.aq||(S.aq={}))[Zr.center=1]="center",Zr[Zr.left=2]="left",Zr[Zr.right=3]="right",Zr[Zr.top=4]="top",Zr[Zr.bottom=5]="bottom",Zr[Zr["top-left"]=6]="top-left",Zr[Zr["top-right"]=7]="top-right",Zr[Zr["bottom-left"]=8]="bottom-left",Zr[Zr["bottom-right"]=9]="bottom-right";const wa=7,Tf=Number.POSITIVE_INFINITY;function x_(r,t){return t[1]!==Tf?function(n,o,c){let m=0,g=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":g=c-wa;break;case"bottom-right":case"bottom-left":case"bottom":g=-c+wa}switch(n){case"top-right":case"bottom-right":case"right":m=-o;break;case"top-left":case"bottom-left":case"left":m=o}return[m,g]}(r,t[0],t[1]):function(n,o){let c=0,m=0;o<0&&(o=0);const g=o/Math.SQRT2;switch(n){case"top-right":case"top-left":m=g-wa;break;case"bottom-right":case"bottom-left":m=-g+wa;break;case"bottom":m=-o+wa;break;case"top":m=o-wa}switch(n){case"top-right":case"bottom-right":c=-g;break;case"top-left":case"bottom-left":c=g;break;case"left":c=o;break;case"right":c=-o}return[c,m]}(r,t[0])}function w_(r,t,n){var o;const c=r.layout,m=(o=c.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(m){const _=m.values,x=[];for(let k=0;k<_.length;k+=2){const I=x[k]=_[k],P=_[k+1].map(M=>M*kr);I.startsWith("top")?P[1]-=wa:I.startsWith("bottom")&&(P[1]+=wa),x[k+1]=P}return new Ri(x)}const g=c.get("text-variable-anchor");if(g){let _;_=r._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[c.get("text-radial-offset").evaluate(t,{},n)*kr,Tf]:c.get("text-offset").evaluate(t,{},n).map(k=>k*kr);const x=[];for(const k of g)x.push(k,x_(k,_));return new Ri(x)}return null}function kf(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Fw(r,t,n,o,c,m,g,_,x,k,I){let P=m.textMaxSize.evaluate(t,{});P===void 0&&(P=g);const M=r.layers[0].layout,R=M.get("icon-offset").evaluate(t,{},I),B=S_(n.horizontal),O=g/24,$=r.tilePixelRatio*O,X=r.tilePixelRatio*P/24,he=r.tilePixelRatio*_,ee=r.tilePixelRatio*M.get("symbol-spacing"),oe=M.get("text-padding")*r.tilePixelRatio,ge=function(_e,et,Ye,ut=1){const qt=_e.get("icon-padding").evaluate(et,{},Ye),Zt=qt&&qt.values;return[Zt[0]*ut,Zt[1]*ut,Zt[2]*ut,Zt[3]*ut]}(M,t,I,r.tilePixelRatio),Se=M.get("text-max-angle")/180*Math.PI,Ve=M.get("text-rotation-alignment")!=="viewport"&&M.get("symbol-placement")!=="point",st=M.get("icon-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Oe=M.get("symbol-placement"),Le=ee/2,Qe=M.get("icon-text-fit");let He;o&&Qe!=="none"&&(r.allowVerticalPlacement&&n.vertical&&(He=Gy(o,n.vertical,Qe,M.get("icon-text-fit-padding"),R,O)),B&&(o=Gy(o,B,Qe,M.get("icon-text-fit-padding"),R,O)));const Ze=(_e,et)=>{et.x<0||et.x>=br||et.y<0||et.y>=br||function(Ye,ut,qt,Zt,Pr,Sn,qr,zr,pi,fi,mi,dr,Ar,ri,Gr,gi,Hr,sn,Ci,Lt,Ht,tr,Ui,ar,Il){const ts=Ye.addToLineVertexArray(ut,qt);let rs,Tn,an,Rr,Es=0,cc=0,I_=0,C_=0,Df=-1,Lf=-1;const Is={};let P_=pl("");if(Ye.allowVerticalPlacement&&Zt.vertical){const ii=zr.layout.get("text-rotate").evaluate(Ht,{},ar)+90;an=new Qh(pi,ut,fi,mi,dr,Zt.vertical,Ar,ri,Gr,ii),qr&&(Rr=new Qh(pi,ut,fi,mi,dr,qr,Hr,sn,Gr,ii))}if(Pr){const ii=zr.layout.get("icon-rotate").evaluate(Ht,{}),on=zr.layout.get("icon-text-fit")!=="none",_o=__(Pr,ii,Ui,on),On=qr?__(qr,ii,Ui,on):void 0;Tn=new Qh(pi,ut,fi,mi,dr,Pr,Hr,sn,!1,ii),Es=4*_o.length;const vo=Ye.iconSizeData;let is=null;vo.kind==="source"?(is=[es*zr.layout.get("icon-size").evaluate(Ht,{})],is[0]>_a&&Xt(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${sc}. Reduce your "icon-size".`)):vo.kind==="composite"&&(is=[es*tr.compositeIconSizes[0].evaluate(Ht,{},ar),es*tr.compositeIconSizes[1].evaluate(Ht,{},ar)],(is[0]>_a||is[1]>_a)&&Xt(`${Ye.layerIds[0]}: Value for "icon-size" is >= ${sc}. Reduce your "icon-size".`)),Ye.addSymbols(Ye.icon,_o,is,Lt,Ci,Ht,S.ah.none,ut,ts.lineStartIndex,ts.lineLength,-1,ar),Df=Ye.icon.placedSymbolArray.length-1,On&&(cc=4*On.length,Ye.addSymbols(Ye.icon,On,is,Lt,Ci,Ht,S.ah.vertical,ut,ts.lineStartIndex,ts.lineLength,-1,ar),Lf=Ye.icon.placedSymbolArray.length-1)}const z_=Object.keys(Zt.horizontal);for(const ii of z_){const on=Zt.horizontal[ii];if(!rs){P_=pl(on.text);const On=zr.layout.get("text-rotate").evaluate(Ht,{},ar);rs=new Qh(pi,ut,fi,mi,dr,on,Ar,ri,Gr,On)}const _o=on.positionedLines.length===1;if(I_+=b_(Ye,ut,on,Sn,zr,Gr,Ht,gi,ts,Zt.vertical?S.ah.horizontal:S.ah.horizontalOnly,_o?z_:[ii],Is,Df,tr,ar),_o)break}Zt.vertical&&(C_+=b_(Ye,ut,Zt.vertical,Sn,zr,Gr,Ht,gi,ts,S.ah.vertical,["vertical"],Is,Lf,tr,ar));const Nw=rs?rs.boxStartIndex:Ye.collisionBoxArray.length,jw=rs?rs.boxEndIndex:Ye.collisionBoxArray.length,Vw=an?an.boxStartIndex:Ye.collisionBoxArray.length,Uw=an?an.boxEndIndex:Ye.collisionBoxArray.length,$w=Tn?Tn.boxStartIndex:Ye.collisionBoxArray.length,Zw=Tn?Tn.boxEndIndex:Ye.collisionBoxArray.length,qw=Rr?Rr.boxStartIndex:Ye.collisionBoxArray.length,Gw=Rr?Rr.boxEndIndex:Ye.collisionBoxArray.length;let Bn=-1;const td=(ii,on)=>ii&&ii.circleDiameter?Math.max(ii.circleDiameter,on):on;Bn=td(rs,Bn),Bn=td(an,Bn),Bn=td(Tn,Bn),Bn=td(Rr,Bn);const A_=Bn>-1?1:0;A_&&(Bn*=Il/kr),Ye.glyphOffsetArray.length>=Tl.MAX_GLYPHS&&Xt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ht.sortKey!==void 0&&Ye.addToSortKeyRanges(Ye.symbolInstances.length,Ht.sortKey);const Hw=w_(zr,Ht,ar),[Ww,Xw]=function(ii,on){const _o=ii.length,On=on==null?void 0:on.values;if((On==null?void 0:On.length)>0)for(let vo=0;vo<On.length;vo+=2){const is=On[vo+1];ii.emplaceBack(S.aq[On[vo]],is[0],is[1])}return[_o,ii.length]}(Ye.textAnchorOffsets,Hw);Ye.symbolInstances.emplaceBack(ut.x,ut.y,Is.right>=0?Is.right:-1,Is.center>=0?Is.center:-1,Is.left>=0?Is.left:-1,Is.vertical||-1,Df,Lf,P_,Nw,jw,Vw,Uw,$w,Zw,qw,Gw,fi,I_,C_,Es,cc,A_,0,Ar,Bn,Ww,Xw)}(r,et,_e,n,o,c,He,r.layers[0],r.collisionBoxArray,t.index,t.sourceLayerIndex,r.index,$,[oe,oe,oe,oe],Ve,x,he,ge,st,R,t,m,k,I,g)};if(Oe==="line")for(const _e of d_(t.geometry,0,0,br,br)){const et=Mw(_e,ee,Se,n.vertical||B,o,24,X,r.overscaling,br);for(const Ye of et)B&&Bw(r,B.text,Le,Ye)||Ze(_e,Ye)}else if(Oe==="line-center"){for(const _e of t.geometry)if(_e.length>1){const et=Aw(_e,Se,n.vertical||B,o,24,X);et&&Ze(_e,et)}}else if(t.type==="Polygon")for(const _e of $o(t.geometry,0)){const et=Lw(_e,16);Ze(_e[0],new xa(et.x,et.y,0))}else if(t.type==="LineString")for(const _e of t.geometry)Ze(_e,new xa(_e[0].x,_e[0].y,0));else if(t.type==="Point")for(const _e of t.geometry)for(const et of _e)Ze([et],new xa(et.x,et.y,0))}function b_(r,t,n,o,c,m,g,_,x,k,I,P,M,R,B){const O=function(he,ee,oe,ge,Se,Ve,st,Oe){const Le=ge.layout.get("text-rotate").evaluate(Ve,{})*Math.PI/180,Qe=[];for(const He of ee.positionedLines)for(const Ze of He.positionedGlyphs){if(!Ze.rect)continue;const _e=Ze.rect||{};let et=Oy+1,Ye=!0,ut=1,qt=0;const Zt=(Se||Oe)&&Ze.vertical,Pr=Ze.metrics.advance*Ze.scale/2;if(Oe&&ee.verticalizable&&(qt=He.lineOffset/2-(Ze.imageName?-(kr-Ze.metrics.width*Ze.scale)/2:(Ze.scale-1)*kr)),Ze.imageName){const Lt=st[Ze.imageName];Ye=Lt.sdf,ut=Lt.pixelRatio,et=Ii/ut}const Sn=Se?[Ze.x+Pr,Ze.y]:[0,0];let qr=Se?[0,0]:[Ze.x+Pr+oe[0],Ze.y+oe[1]-qt],zr=[0,0];Zt&&(zr=qr,qr=[0,0]);const pi=Ze.metrics.isDoubleResolution?2:1,fi=(Ze.metrics.left-et)*Ze.scale-Pr+qr[0],mi=(-Ze.metrics.top-et)*Ze.scale+qr[1],dr=fi+_e.w/pi*Ze.scale/ut,Ar=mi+_e.h/pi*Ze.scale/ut,ri=new ne(fi,mi),Gr=new ne(dr,mi),gi=new ne(fi,Ar),Hr=new ne(dr,Ar);if(Zt){const Lt=new ne(-Pr,Pr-ic),Ht=-Math.PI/2,tr=kr/2-Pr,Ui=new ne(5-ic-tr,-(Ze.imageName?tr:0)),ar=new ne(...zr);ri._rotateAround(Ht,Lt)._add(Ui)._add(ar),Gr._rotateAround(Ht,Lt)._add(Ui)._add(ar),gi._rotateAround(Ht,Lt)._add(Ui)._add(ar),Hr._rotateAround(Ht,Lt)._add(Ui)._add(ar)}if(Le){const Lt=Math.sin(Le),Ht=Math.cos(Le),tr=[Ht,-Lt,Lt,Ht];ri._matMult(tr),Gr._matMult(tr),gi._matMult(tr),Hr._matMult(tr)}const sn=new ne(0,0),Ci=new ne(0,0);Qe.push({tl:ri,tr:Gr,bl:gi,br:Hr,tex:_e,writingMode:ee.writingMode,glyphOffset:Sn,sectionIndex:Ze.sectionIndex,isSDF:Ye,pixelOffsetTL:sn,pixelOffsetBR:Ci,minFontScaleX:0,minFontScaleY:0})}return Qe}(0,n,_,c,m,g,o,r.allowVerticalPlacement),$=r.textSizeData;let X=null;$.kind==="source"?(X=[es*c.layout.get("text-size").evaluate(g,{})],X[0]>_a&&Xt(`${r.layerIds[0]}: Value for "text-size" is >= ${sc}. Reduce your "text-size".`)):$.kind==="composite"&&(X=[es*R.compositeTextSizes[0].evaluate(g,{},B),es*R.compositeTextSizes[1].evaluate(g,{},B)],(X[0]>_a||X[1]>_a)&&Xt(`${r.layerIds[0]}: Value for "text-size" is >= ${sc}. Reduce your "text-size".`)),r.addSymbols(r.text,O,X,_,m,g,k,t,x.lineStartIndex,x.lineLength,M,B);for(const he of I)P[he]=r.text.placedSymbolArray.length-1;return 4*O.length}function S_(r){for(const t in r)return r[t];return null}function Bw(r,t,n,o){const c=r.compareText;if(t in c){const m=c[t];for(let g=m.length-1;g>=0;g--)if(o.dist(m[g])<n)return!0}else c[t]=[];return c[t].push(o),!1}const T_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ef{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const c=o>>4;if(c!==1)throw new Error(`Got v${c} data when expected v1.`);const m=T_[15&o];if(!m)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(t,2,1),[_]=new Uint32Array(t,4,1);return new Ef(_,g,m,t)}constructor(t,n=64,o=Float64Array,c){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const m=T_.indexOf(this.ArrayType),g=2*t*this.ArrayType.BYTES_PER_ELEMENT,_=t*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-_%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${o}.`);c&&c instanceof ArrayBuffer?(this.data=c,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+g+_+x),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+_+x,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return If(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:g,nodeSize:_}=this,x=[0,m.length-1,0],k=[];for(;x.length;){const I=x.pop()||0,P=x.pop()||0,M=x.pop()||0;if(P-M<=_){for(let $=M;$<=P;$++){const X=g[2*$],he=g[2*$+1];X>=t&&X<=o&&he>=n&&he<=c&&k.push(m[$])}continue}const R=M+P>>1,B=g[2*R],O=g[2*R+1];B>=t&&B<=o&&O>=n&&O<=c&&k.push(m[R]),(I===0?t<=B:n<=O)&&(x.push(M),x.push(R-1),x.push(1-I)),(I===0?o>=B:c>=O)&&(x.push(R+1),x.push(P),x.push(1-I))}return k}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:m,nodeSize:g}=this,_=[0,c.length-1,0],x=[],k=o*o;for(;_.length;){const I=_.pop()||0,P=_.pop()||0,M=_.pop()||0;if(P-M<=g){for(let $=M;$<=P;$++)E_(m[2*$],m[2*$+1],t,n)<=k&&x.push(c[$]);continue}const R=M+P>>1,B=m[2*R],O=m[2*R+1];E_(B,O,t,n)<=k&&x.push(c[R]),(I===0?t-o<=B:n-o<=O)&&(_.push(M),_.push(R-1),_.push(1-I)),(I===0?t+o>=B:n+o>=O)&&(_.push(R+1),_.push(P),_.push(1-I))}return x}}function If(r,t,n,o,c,m){if(c-o<=n)return;const g=o+c>>1;k_(r,t,g,o,c,m),If(r,t,n,o,g-1,1-m),If(r,t,n,g+1,c,1-m)}function k_(r,t,n,o,c,m){for(;c>o;){if(c-o>600){const k=c-o+1,I=n-o+1,P=Math.log(k),M=.5*Math.exp(2*P/3),R=.5*Math.sqrt(P*M*(k-M)/k)*(I-k/2<0?-1:1);k_(r,t,n,Math.max(o,Math.floor(n-I*M/k+R)),Math.min(c,Math.floor(n+(k-I)*M/k+R)),m)}const g=t[2*n+m];let _=o,x=c;for(lc(r,t,o,n),t[2*c+m]>g&&lc(r,t,o,c);_<x;){for(lc(r,t,_,x),_++,x--;t[2*_+m]<g;)_++;for(;t[2*x+m]>g;)x--}t[2*o+m]===g?lc(r,t,o,x):(x++,lc(r,t,x,c)),x<=n&&(o=x+1),n<=x&&(c=x-1)}}function lc(r,t,n,o){Cf(r,n,o),Cf(t,2*n,2*o),Cf(t,2*n+1,2*o+1)}function Cf(r,t,n){const o=r[t];r[t]=r[n],r[n]=o}function E_(r,t,n,o){const c=r-n,m=t-o;return c*c+m*m}var Pf;S.bg=void 0,(Pf=S.bg||(S.bg={})).create="create",Pf.load="load",Pf.fullLoad="fullLoad";let ed=null,uc=[];const zf=1e3/60,Af="loadTime",Mf="fullLoadTime",Ow={mark(r){performance.mark(r)},frame(r){const t=r;ed!=null&&uc.push(t-ed),ed=t},clearMetrics(){ed=null,uc=[],performance.clearMeasures(Af),performance.clearMeasures(Mf);for(const r in S.bg)performance.clearMarks(S.bg[r])},getPerformanceMetrics(){performance.measure(Af,S.bg.create,S.bg.load),performance.measure(Mf,S.bg.create,S.bg.fullLoad);const r=performance.getEntriesByName(Af)[0].duration,t=performance.getEntriesByName(Mf)[0].duration,n=uc.length,o=1/(uc.reduce((m,g)=>m+g,0)/n/1e3),c=uc.filter(m=>m>zf).reduce((m,g)=>m+(g-zf)/zf,0);return{loadTime:r,fullLoadTime:t,fps:o,percentDroppedFrames:c/(n+c)*100,totalFrames:n}}};S.$=class extends z{},S.A=_l,S.B=Np,S.C=function(r){if(Kr==null){const t=r.navigator?r.navigator.userAgent:null;Kr=!!r.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Kr},S.D=Ke,S.E=Vs,S.F=class{constructor(r,t){this.target=r,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Pw(()=>this.process()),this.subscription=function(n,o,c,m){return n.addEventListener(o,c,!1),{unsubscribe:()=>{n.removeEventListener(o,c,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=wt(self)?r:window}registerMessageHandler(r,t){this.messageHandlers[r]=t}sendAsync(r,t){return new Promise((n,o)=>{const c=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[c]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[c];const _={id:c,type:"<cancel>",origin:location.origin,targetMapId:r.targetMapId,sourceMapId:this.mapId};this.target.postMessage(_)},{once:!0});const m=[],g=Object.assign(Object.assign({},r),{id:c,sourceMapId:this.mapId,origin:location.origin,data:aa(r.data,m)});this.target.postMessage(g,{transfer:m})})}receive(r){const t=r.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(wt(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const r=this.taskQueue.shift(),t=this.tasks[r];delete this.tasks[r],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(r,t)}processTask(r,t){return d(this,void 0,void 0,function*(){if(t.type==="<response>"){const c=this.resolveRejects[r];return delete this.resolveRejects[r],c?void(t.error?c.reject(oa(t.error)):c.resolve(oa(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(r,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=oa(t.data),o=new AbortController;this.abortControllers[r]=o;try{const c=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(r,null,c)}catch(c){this.completeTask(r,c)}})}completeTask(r,t,n){const o=[];delete this.abortControllers[r];const c={id:r,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?aa(t):null,data:aa(n,o)};this.target.postMessage(c,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},S.G=Nr,S.H=function(){var r=new _l(16);return _l!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},S.I=pf,S.J=function(r,t,n){var o,c,m,g,_,x,k,I,P,M,R,B,O=n[0],$=n[1],X=n[2];return t===r?(r[12]=t[0]*O+t[4]*$+t[8]*X+t[12],r[13]=t[1]*O+t[5]*$+t[9]*X+t[13],r[14]=t[2]*O+t[6]*$+t[10]*X+t[14],r[15]=t[3]*O+t[7]*$+t[11]*X+t[15]):(c=t[1],m=t[2],g=t[3],_=t[4],x=t[5],k=t[6],I=t[7],P=t[8],M=t[9],R=t[10],B=t[11],r[0]=o=t[0],r[1]=c,r[2]=m,r[3]=g,r[4]=_,r[5]=x,r[6]=k,r[7]=I,r[8]=P,r[9]=M,r[10]=R,r[11]=B,r[12]=o*O+_*$+P*X+t[12],r[13]=c*O+x*$+M*X+t[13],r[14]=m*O+k*$+R*X+t[14],r[15]=g*O+I*$+B*X+t[15]),r},S.K=function(r,t,n){var o=n[0],c=n[1],m=n[2];return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=t[3]*o,r[4]=t[4]*c,r[5]=t[5]*c,r[6]=t[6]*c,r[7]=t[7]*c,r[8]=t[8]*m,r[9]=t[9]*m,r[10]=t[10]*m,r[11]=t[11]*m,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.L=ay,S.M=function(r,t){const n={};for(let o=0;o<t.length;o++){const c=t[o];c in r&&(n[c]=r[c])}return n},S.N=va,S.O=t_,S.P=ne,S.Q=r_,S.R=rn,S.S=nn,S.T=ll,S.U=ue,S.V=re,S.W=ct,S.X=br,S.Y=v,S.Z=ac,S._=d,S.a=Ir,S.a$=function(r,t){var n=r[0],o=r[1],c=r[2],m=r[3],g=r[4],_=r[5],x=r[6],k=r[7],I=r[8],P=r[9],M=r[10],R=r[11],B=r[12],O=r[13],$=r[14],X=r[15],he=t[0],ee=t[1],oe=t[2],ge=t[3],Se=t[4],Ve=t[5],st=t[6],Oe=t[7],Le=t[8],Qe=t[9],He=t[10],Ze=t[11],_e=t[12],et=t[13],Ye=t[14],ut=t[15];return Math.abs(n-he)<=di*Math.max(1,Math.abs(n),Math.abs(he))&&Math.abs(o-ee)<=di*Math.max(1,Math.abs(o),Math.abs(ee))&&Math.abs(c-oe)<=di*Math.max(1,Math.abs(c),Math.abs(oe))&&Math.abs(m-ge)<=di*Math.max(1,Math.abs(m),Math.abs(ge))&&Math.abs(g-Se)<=di*Math.max(1,Math.abs(g),Math.abs(Se))&&Math.abs(_-Ve)<=di*Math.max(1,Math.abs(_),Math.abs(Ve))&&Math.abs(x-st)<=di*Math.max(1,Math.abs(x),Math.abs(st))&&Math.abs(k-Oe)<=di*Math.max(1,Math.abs(k),Math.abs(Oe))&&Math.abs(I-Le)<=di*Math.max(1,Math.abs(I),Math.abs(Le))&&Math.abs(P-Qe)<=di*Math.max(1,Math.abs(P),Math.abs(Qe))&&Math.abs(M-He)<=di*Math.max(1,Math.abs(M),Math.abs(He))&&Math.abs(R-Ze)<=di*Math.max(1,Math.abs(R),Math.abs(Ze))&&Math.abs(B-_e)<=di*Math.max(1,Math.abs(B),Math.abs(_e))&&Math.abs(O-et)<=di*Math.max(1,Math.abs(O),Math.abs(et))&&Math.abs($-Ye)<=di*Math.max(1,Math.abs($),Math.abs(Ye))&&Math.abs(X-ut)<=di*Math.max(1,Math.abs(X),Math.abs(ut))},S.a0=Et,S.a1=Sf,S.a2=Ie,S.a3=r=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of r){const c=window.document.createElement("source");An(o)||(t.crossOrigin="Anonymous"),c.src=o,t.appendChild(c)}})},S.a4=function(){return it++},S.a5=je,S.a6=Tl,S.a7=Eu,S.a8=go,S.a9=l_,S.aA=function(r){if(r.type==="custom")return new Cw(r);switch(r.type){case"background":return new kw(r);case"circle":return new d1(r);case"fill":return new P1(r);case"fill-extrusion":return new Z1(r);case"heatmap":return new f1(r);case"hillshade":return new g1(r);case"line":return new Y1(r);case"raster":return new Iw(r);case"symbol":return new Xh(r)}},S.aB=gt,S.aC=function(r,t){if(!r)return[{command:"setStyle",args:[t]}];let n=[];try{if(!Rt(r.version,t.version))return[{command:"setStyle",args:[t]}];Rt(r.center,t.center)||n.push({command:"setCenter",args:[t.center]}),Rt(r.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),Rt(r.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),Rt(r.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),Rt(r.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),Rt(r.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),Rt(r.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),Rt(r.light,t.light)||n.push({command:"setLight",args:[t.light]}),Rt(r.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),Rt(r.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),Rt(r.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},c=[];(function(g,_,x,k){let I;for(I in _=_||{},g=g||{})Object.prototype.hasOwnProperty.call(g,I)&&(Object.prototype.hasOwnProperty.call(_,I)||Hn(I,x,k));for(I in _)Object.prototype.hasOwnProperty.call(_,I)&&(Object.prototype.hasOwnProperty.call(g,I)?Rt(g[I],_[I])||(g[I].type==="geojson"&&_[I].type==="geojson"&&Us(g,_,I)?nr(x,{command:"setGeoJSONSourceData",args:[I,_[I].data]}):Mn(I,_,x,k)):$a(I,_,x))})(r.sources,t.sources,c,o);const m=[];r.layers&&r.layers.forEach(g=>{"source"in g&&o[g.source]?n.push({command:"removeLayer",args:[g.id]}):m.push(g)}),n=n.concat(c),function(g,_,x){_=_||[];const k=(g=g||[]).map(Za),I=_.map(Za),P=g.reduce(qa,{}),M=_.reduce(qa,{}),R=k.slice(),B=Object.create(null);let O,$,X,he,ee;for(let oe=0,ge=0;oe<k.length;oe++)O=k[oe],Object.prototype.hasOwnProperty.call(M,O)?ge++:(nr(x,{command:"removeLayer",args:[O]}),R.splice(R.indexOf(O,ge),1));for(let oe=0,ge=0;oe<I.length;oe++)O=I[I.length-1-oe],R[R.length-1-oe]!==O&&(Object.prototype.hasOwnProperty.call(P,O)?(nr(x,{command:"removeLayer",args:[O]}),R.splice(R.lastIndexOf(O,R.length-ge),1)):ge++,he=R[R.length-oe],nr(x,{command:"addLayer",args:[M[O],he]}),R.splice(R.length-oe,0,O),B[O]=!0);for(let oe=0;oe<I.length;oe++)if(O=I[oe],$=P[O],X=M[O],!B[O]&&!Rt($,X))if(Rt($.source,X.source)&&Rt($["source-layer"],X["source-layer"])&&Rt($.type,X.type)){for(ee in Li($.layout,X.layout,x,O,null,"setLayoutProperty"),Li($.paint,X.paint,x,O,null,"setPaintProperty"),Rt($.filter,X.filter)||nr(x,{command:"setFilter",args:[O,X.filter]}),Rt($.minzoom,X.minzoom)&&Rt($.maxzoom,X.maxzoom)||nr(x,{command:"setLayerZoomRange",args:[O,X.minzoom,X.maxzoom]}),$)Object.prototype.hasOwnProperty.call($,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Li($[ee],X[ee],x,O,ee.slice(6),"setPaintProperty"):Rt($[ee],X[ee])||nr(x,{command:"setLayerProperty",args:[O,ee,X[ee]]}));for(ee in X)Object.prototype.hasOwnProperty.call(X,ee)&&!Object.prototype.hasOwnProperty.call($,ee)&&ee!=="layout"&&ee!=="paint"&&ee!=="filter"&&ee!=="metadata"&&ee!=="minzoom"&&ee!=="maxzoom"&&(ee.indexOf("paint.")===0?Li($[ee],X[ee],x,O,ee.slice(6),"setPaintProperty"):Rt($[ee],X[ee])||nr(x,{command:"setLayerProperty",args:[O,ee,X[ee]]}))}else nr(x,{command:"removeLayer",args:[O]}),he=R[R.lastIndexOf(O)+1],nr(x,{command:"addLayer",args:[X,he]})}(m,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},S.aD=function(r){const t=[],n=r.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),r.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},S.aE=function r(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!r(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!r(t[o],n[o]))return!1;return!0}return t===n},S.aF=Mt,S.aG=pt,S.aH=class extends po{constructor(r,t){super(r,t),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},S.aI=Fh,S.aJ=class extends po{constructor(r,t){super(r,t),this.current=n1}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let t=1;t<16;t++)if(r[t]!==this.current[t]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},S.aK=Xg,S.aL=Kg,S.aM=Vt,S.aN=class extends po{constructor(r,t){super(r,t),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},S.aO=class extends po{constructor(r,t){super(r,t),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},S.aP=function(r,t,n,o,c,m,g){var _=1/(t-n),x=1/(o-c),k=1/(m-g);return r[0]=-2*_,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*k,r[11]=0,r[12]=(t+n)*_,r[13]=(c+o)*x,r[14]=(g+m)*k,r[15]=1,r},S.aQ=h1,S.aR=class extends ie{},S.aS=rw,S.aT=class extends pe{},S.aU=ef,S.aV=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},S.aW=hy,S.aX=Ur,S.aY=tn,S.aZ=class extends Je{},S.a_=function(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]},S.aa=function(r){const t={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,m)=>{const g=c||m;return t[o]=!g||g.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},S.ab=function(r,t){const n=[];for(const o in r)o in t||n.push(o);return n},S.ac=Ue,S.ad=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[0],g=t[1],_=t[2],x=t[3],k=t[4],I=t[5],P=t[6],M=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=m*c+k*o,r[1]=g*c+I*o,r[2]=_*c+P*o,r[3]=x*c+M*o,r[4]=k*c-m*o,r[5]=I*c-g*o,r[6]=P*c-_*o,r[7]=M*c-x*o,r},S.ae=function(r){var t=new _l(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},S.af=jh,S.ag=function(r,t){let n=0,o=0;if(r.kind==="constant")o=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:c,minZoom:m,maxZoom:g}=r,_=c?Ue(ci.interpolationFactor(c,t,m,g),0,1):0;r.kind==="camera"?o=ui.number(r.minSize,r.maxSize,_):n=_}return{uSizeT:n,uSize:o}},S.ai=function(r,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:c}){return r.kind==="source"?o/es:r.kind==="composite"?ui.number(o/es,c/es,n):t},S.aj=yf,S.ak=function(r,t,n,o){const c=t.y-r.y,m=t.x-r.x,g=o.y-n.y,_=o.x-n.x,x=g*m-_*c;if(x===0)return null;const k=(_*(r.y-n.y)-g*(r.x-n.x))/x;return new ne(r.x+k*m,r.y+k*c)},S.al=d_,S.am=ey,S.an=Jp,S.ao=function(r){let t=1/0,n=1/0,o=-1/0,c=-1/0;for(const m of r)t=Math.min(t,m.x),n=Math.min(n,m.y),o=Math.max(o,m.x),c=Math.max(c,m.y);return[t,n,o,c]},S.ap=kr,S.ar=gf,S.as=function(r,t){var n=t[0],o=t[1],c=t[2],m=t[3],g=t[4],_=t[5],x=t[6],k=t[7],I=t[8],P=t[9],M=t[10],R=t[11],B=t[12],O=t[13],$=t[14],X=t[15],he=n*_-o*g,ee=n*x-c*g,oe=n*k-m*g,ge=o*x-c*_,Se=o*k-m*_,Ve=c*k-m*x,st=I*O-P*B,Oe=I*$-M*B,Le=I*X-R*B,Qe=P*$-M*O,He=P*X-R*O,Ze=M*X-R*$,_e=he*Ze-ee*He+oe*Qe+ge*Le-Se*Oe+Ve*st;return _e?(r[0]=(_*Ze-x*He+k*Qe)*(_e=1/_e),r[1]=(c*He-o*Ze-m*Qe)*_e,r[2]=(O*Ve-$*Se+X*ge)*_e,r[3]=(M*Se-P*Ve-R*ge)*_e,r[4]=(x*Le-g*Ze-k*Oe)*_e,r[5]=(n*Ze-c*Le+m*Oe)*_e,r[6]=($*oe-B*Ve-X*ee)*_e,r[7]=(I*Ve-M*oe+R*ee)*_e,r[8]=(g*He-_*Le+k*st)*_e,r[9]=(o*Le-n*He-m*st)*_e,r[10]=(B*Se-O*oe+X*he)*_e,r[11]=(P*oe-I*Se-R*he)*_e,r[12]=(_*Oe-g*Qe-x*st)*_e,r[13]=(n*Qe-o*Oe+c*st)*_e,r[14]=(O*ee-B*ge-$*he)*_e,r[15]=(I*ge-P*ee+M*he)*_e,r):null},S.at=kf,S.au=mf,S.av=Ef,S.aw=function(){const r={},t=me.$version;for(const n in me.$root){const o=me.$root[n];if(o.required){let c=null;c=n==="version"?t:o.type==="array"?[]:{},c!=null&&(r[n]=c)}}return r},S.ax=ju,S.ay=Kt,S.az=function(r){r=r.slice();const t=Object.create(null);for(let n=0;n<r.length;n++)t[r[n].id]=r[n];for(let n=0;n<r.length;n++)"ref"in r[n]&&(r[n]=Ua(r[n],t[r[n].ref]));return r},S.b=Or,S.b0=function(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},S.b1=function(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r},S.b2=function(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]},S.b3=Ge,S.b4=s_,S.b5=i_,S.b6=function(r,t,n,o,c){var m,g=1/Math.tan(t/2);return r[0]=g/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=g,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,c!=null&&c!==1/0?(r[10]=(c+o)*(m=1/(o-c)),r[14]=2*c*o*m):(r[10]=-1,r[14]=-2*o),r},S.b7=function(r,t,n){var o=Math.sin(n),c=Math.cos(n),m=t[4],g=t[5],_=t[6],x=t[7],k=t[8],I=t[9],P=t[10],M=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=m*c+k*o,r[5]=g*c+I*o,r[6]=_*c+P*o,r[7]=x*c+M*o,r[8]=k*c-m*o,r[9]=I*c-g*o,r[10]=P*c-_*o,r[11]=M*c-x*o,r},S.b8=de,S.b9=Te,S.bA=Ay,S.bB=function(r){return r.message===Bt},S.bC=ea,S.bD=ki,S.ba=function(r){return r*Math.PI/180},S.bb=function(r,t){const{x:n,y:o}=ac.fromLngLat(t);return!(r<0||r>25||o<0||o>=1||n<0||n>=1)},S.bc=function(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},S.bd=class extends C{},S.be=wf,S.bf=Ow,S.bh=ke,S.bi=function(r,t){Ir.REGISTERED_PROTOCOLS[r]=t},S.bj=function(r){delete Ir.REGISTERED_PROTOCOLS[r]},S.bk=function(r,t){const n={};for(let c=0;c<r.length;c++){const m=t&&t[r[c].id]||Th(r[c]);t&&(t[r[c].id]=m);let g=n[m];g||(g=n[m]=[]),g.push(r[c])}const o=[];for(const c in n)o.push(n[c]);return o},S.bl=qe,S.bm=o_,S.bn=u_,S.bo=jy,S.bp=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=br/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const t=r.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,c={layoutIconSize:o["icon-size"].possiblyEvaluate(new Jt(r.bucket.zoom+1),r.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Jt(r.bucket.zoom+1),r.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Jt(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=r.bucket.textSizeData;c.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Jt(k),r.canonical),o["text-size"].possiblyEvaluate(new Jt(I),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:k,maxZoom:I}=r.bucket.iconSizeData;c.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Jt(k),r.canonical),o["icon-size"].possiblyEvaluate(new Jt(I),r.canonical)]}const m=n.get("text-line-height")*kr,g=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",_=n.get("text-keep-upright"),x=n.get("text-size");for(const k of r.bucket.features){const I=n.get("text-font").evaluate(k,{},r.canonical).join(","),P=x.evaluate(k,{},r.canonical),M=c.layoutTextSize.evaluate(k,{},r.canonical),R=c.layoutIconSize.evaluate(k,{},r.canonical),B={horizontal:{},vertical:void 0},O=k.text;let $,X=[0,0];if(O){const oe=O.toString(),ge=n.get("text-letter-spacing").evaluate(k,{},r.canonical)*kr,Se=jp(oe)?ge:0,Ve=n.get("text-anchor").evaluate(k,{},r.canonical),st=w_(t,k,r.canonical);if(!st){const He=n.get("text-radial-offset").evaluate(k,{},r.canonical);X=He?x_(Ve,[He*kr,Tf]):n.get("text-offset").evaluate(k,{},r.canonical).map(Ze=>Ze*kr)}let Oe=g?"center":n.get("text-justify").evaluate(k,{},r.canonical);const Le=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(k,{},r.canonical)*kr:1/0,Qe=()=>{r.bucket.allowVerticalPlacement&&Vu(oe)&&(B.vertical=Gh(O,r.glyphMap,r.glyphPositions,r.imagePositions,I,Le,m,Ve,"left",Se,X,S.ah.vertical,!0,M,P))};if(!g&&st){const He=new Set;if(Oe==="auto")for(let _e=0;_e<st.values.length;_e+=2)He.add(kf(st.values[_e]));else He.add(Oe);let Ze=!1;for(const _e of He)if(!B.horizontal[_e])if(Ze)B.horizontal[_e]=B.horizontal[0];else{const et=Gh(O,r.glyphMap,r.glyphPositions,r.imagePositions,I,Le,m,"center",_e,Se,X,S.ah.horizontal,!1,M,P);et&&(B.horizontal[_e]=et,Ze=et.positionedLines.length===1)}Qe()}else{Oe==="auto"&&(Oe=kf(Ve));const He=Gh(O,r.glyphMap,r.glyphPositions,r.imagePositions,I,Le,m,Ve,Oe,Se,X,S.ah.horizontal,!1,M,P);He&&(B.horizontal[Oe]=He),Qe(),Vu(oe)&&g&&_&&(B.vertical=Gh(O,r.glyphMap,r.glyphPositions,r.imagePositions,I,Le,m,Ve,Oe,Se,X,S.ah.vertical,!1,M,P))}}let he=!1;if(k.icon&&k.icon.name){const oe=r.imageMap[k.icon.name];oe&&($=xw(r.imagePositions[k.icon.name],n.get("icon-offset").evaluate(k,{},r.canonical),n.get("icon-anchor").evaluate(k,{},r.canonical)),he=!!oe.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=he:r.bucket.sdfIcons!==he&&Xt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==r.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const ee=S_(B.horizontal)||B.vertical;r.bucket.iconsInText=!!ee&&ee.iconsInText,(ee||$)&&Fw(r.bucket,k,B,$,r.imageMap,c,M,R,X,he,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},S.bq=uf,S.br=af,S.bs=lf,S.bt=ga,S.bu=hf,S.bv=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},S.bw=function(r,t,n,o,c){return d(this,void 0,void 0,function*(){if(re())try{return yield ct(r,t,n,o,c)}catch{}return function(m,g,_,x,k){const I=m.width,P=m.height;dt&&Tt||(dt=new OffscreenCanvas(I,P),Tt=dt.getContext("2d",{willReadFrequently:!0})),dt.width=I,dt.height=P,Tt.drawImage(m,0,0,I,P);const M=Tt.getImageData(g,_,x,k);return Tt.clearRect(0,0,I,P),M.data}(r,t,n,o,c)})},S.bx=a_,S.by=H,S.bz=le,S.c=oi,S.d=r=>d(void 0,void 0,void 0,function*(){if(r.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(r)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),S.e=We,S.f=r=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=Xe})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const c=new Blob([new Uint8Array(r)],{type:"image/png"});o.src=r.byteLength?URL.createObjectURL(c):Xe}),S.g=Jr,S.h=(r,t)=>fn(We(r,{type:"json"}),t),S.i=wt,S.j=Gn,S.k=Ct,S.l=(r,t)=>fn(We(r,{type:"arrayBuffer"}),t),S.m=fn,S.n=function(r){return new hf(r).readFields(pw,[])},S.o=Ku,S.p=Ny,S.q=f,S.r=Op,S.s=An,S.t=Ou,S.u=bs,S.v=me,S.w=Xt,S.x=function([r,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:r*Math.cos(t)*Math.sin(n),y:r*Math.sin(t)*Math.sin(n),z:r*Math.cos(n)}},S.y=ui,S.z=Jt}),b("worker",["./shared"],function(S){class d{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const Z of L){this._layerConfigs[Z.id]=Z;const te=this._layers[Z.id]=S.aA(Z);te._featureFilter=S.a7(te.filter),this.keyCache[Z.id]&&delete this.keyCache[Z.id]}for(const Z of D)delete this.keyCache[Z],delete this._layerConfigs[Z],delete this._layers[Z];this.familiesBySource={};const N=S.bk(Object.values(this._layerConfigs),this.keyCache);for(const Z of N){const te=Z.map(fe=>this._layers[fe.id]),se=te[0];if(se.visibility==="none")continue;const ce=se.source||"";let Y=this.familiesBySource[ce];Y||(Y=this.familiesBySource[ce]={});const ye=se.sourceLayer||"_geojsonTileLayer";let be=Y[ye];be||(be=Y[ye]=[]),be.push(te)}}}class H{constructor(L){const D={},N=[];for(const ce in L){const Y=L[ce],ye=D[ce]={};for(const be in Y){const fe=Y[+be];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const Pe={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};N.push(Pe),ye[be]={rect:Pe,metrics:fe.metrics}}}const{w:Z,h:te}=S.p(N),se=new S.o({width:Z||1,height:te||1});for(const ce in L){const Y=L[ce];for(const ye in Y){const be=Y[+ye];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const fe=D[ce][ye].rect;S.o.copy(be.bitmap,se,{x:0,y:0},{x:fe.x+1,y:fe.y+1},be.bitmap)}}this.image=se,this.positions=D}}S.bl("GlyphAtlas",H);class le{constructor(L){this.tileID=new S.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,N,Z){return S._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new S.a5;const te=new S.bm(Object.keys(L.layers).sort()),se=new S.bn(this.tileID,this.promoteId);se.bucketLayerIDs=[];const ce={},Y={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},ye=D.familiesBySource[this.source];for(const vt in ye){const jt=L.layers[vt];if(!jt)continue;jt.version===1&&S.w(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const rr=te.encode(vt),Cr=[];for(let Dr=0;Dr<jt.length;Dr++){const Qr=jt.feature(Dr),$s=se.getId(Qr,vt);Cr.push({feature:Qr,id:$s,index:Dr,sourceLayerIndex:rr})}for(const Dr of ye[vt]){const Qr=Dr[0];Qr.source!==this.source&&S.w(`layer.source = ${Qr.source} does not equal this.source = ${this.source}`),Qr.minzoom&&this.zoom<Math.floor(Qr.minzoom)||Qr.maxzoom&&this.zoom>=Qr.maxzoom||Qr.visibility!=="none"&&(ve(Dr,this.zoom,N),(ce[Qr.id]=Qr.createBucket({index:se.bucketLayerIDs.length,layers:Dr,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:rr,sourceID:this.source})).populate(Cr,Y,this.tileID.canonical),se.bucketLayerIDs.push(Dr.map($s=>$s.id)))}}const be=S.aF(Y.glyphDependencies,vt=>Object.keys(vt).map(Number));this.inFlightDependencies.forEach(vt=>vt==null?void 0:vt.abort()),this.inFlightDependencies=[];let fe=Promise.resolve({});if(Object.keys(be).length){const vt=new AbortController;this.inFlightDependencies.push(vt),fe=Z.sendAsync({type:"GG",data:{stacks:be,source:this.source,tileID:this.tileID,type:"glyphs"}},vt)}const Pe=Object.keys(Y.iconDependencies);let tt=Promise.resolve({});if(Pe.length){const vt=new AbortController;this.inFlightDependencies.push(vt),tt=Z.sendAsync({type:"GI",data:{icons:Pe,source:this.source,tileID:this.tileID,type:"icons"}},vt)}const nt=Object.keys(Y.patternDependencies);let Pt=Promise.resolve({});if(nt.length){const vt=new AbortController;this.inFlightDependencies.push(vt),Pt=Z.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"patterns"}},vt)}const[mt,zt,bt]=yield Promise.all([fe,tt,Pt]),xr=new H(mt),sr=new S.bo(zt,bt);for(const vt in ce){const jt=ce[vt];jt instanceof S.a6?(ve(jt.layers,this.zoom,N),S.bp({bucket:jt,glyphMap:mt,glyphPositions:xr.positions,imageMap:zt,imagePositions:sr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):jt.hasPattern&&(jt instanceof S.bq||jt instanceof S.br||jt instanceof S.bs)&&(ve(jt.layers,this.zoom,N),jt.addFeatures(Y,this.tileID.canonical,sr.patternPositions))}return this.status="done",{buckets:Object.values(ce).filter(vt=>!vt.isEmpty()),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xr.image,imageAtlas:sr,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?zt:null,glyphPositions:this.returnDependencies?xr.positions:null}})}}function ve(W,L,D){const N=new S.z(L);for(const Z of W)Z.recalculate(N,D)}class ne{constructor(L,D,N){this.actor=L,this.layerIndex=D,this.availableImages=N,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=yield S.l(L.request,D);try{return{vectorTile:new S.bt.VectorTile(new S.bu(N.data)),rawData:N.data,cacheControl:N.cacheControl,expires:N.expires}}catch(Z){const te=new Uint8Array(N.data);let se=`Unable to parse the tile at ${L.request.url}, `;throw se+=te[0]===31&&te[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Z.message}`,new Error(se)}})}loadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid,N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request),Z=new le(L);this.loading[D]=Z;const te=new AbortController;Z.abort=te;try{const se=yield this.loadVectorTile(L,te);if(delete this.loading[D],!se)return null;const ce=se.rawData,Y={};se.expires&&(Y.expires=se.expires),se.cacheControl&&(Y.cacheControl=se.cacheControl);const ye={};if(N){const fe=N.finish();fe&&(ye.resourceTiming=JSON.parse(JSON.stringify(fe)))}Z.vectorTile=se.vectorTile;const be=Z.parse(se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=Z,this.fetching[D]={rawTileData:ce,cacheControl:Y,resourceTiming:ye};try{const fe=yield be;return S.e({rawTileData:ce.slice(0)},fe,Y,ye)}finally{delete this.fetching[D]}}catch(se){throw delete this.loading[D],Z.status="done",this.loaded[D]=Z,se}})}reloadTile(L){return S._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const N=this.loaded[D];if(N.showCollisionBoxes=L.showCollisionBoxes,N.status==="parsing"){const Z=yield N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor);let te;if(this.fetching[D]){const{rawTileData:se,cacheControl:ce,resourceTiming:Y}=this.fetching[D];delete this.fetching[D],te=S.e({rawTileData:se.slice(0)},Z,ce,Y)}else te=Z;return te}if(N.status==="done"&&N.vectorTile)return N.parse(N.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return S._(this,void 0,void 0,function*(){const D=this.loading,N=L.uid;D&&D[N]&&D[N].abort&&(D[N].abort.abort(),delete D[N])})}removeTile(L){return S._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class G{constructor(){this.loaded={}}loadTile(L){return S._(this,void 0,void 0,function*(){const{uid:D,encoding:N,rawImageData:Z,redFactor:te,greenFactor:se,blueFactor:ce,baseShift:Y}=L,ye=Z.width+2,be=Z.height+2,fe=S.b(Z)?new S.R({width:ye,height:be},yield S.bw(Z,-1,-1,ye,be)):Z,Pe=new S.bx(D,fe,N,te,se,ce,Y);return this.loaded=this.loaded||{},this.loaded[D]=Pe,Pe})}removeTile(L){const D=this.loaded,N=L.uid;D&&D[N]&&delete D[N]}}function Re(W,L){if(W.length!==0){Fe(W[0],L);for(var D=1;D<W.length;D++)Fe(W[D],!L)}}function Fe(W,L){for(var D=0,N=0,Z=0,te=W.length,se=te-1;Z<te;se=Z++){var ce=(W[Z][0]-W[se][0])*(W[se][1]+W[Z][1]),Y=D+ce;N+=Math.abs(D)>=Math.abs(ce)?D-Y+ce:ce-Y+D,D=Y}D+N>=0!=!!L&&W.reverse()}var Ne=S.by(function W(L,D){var N,Z=L&&L.type;if(Z==="FeatureCollection")for(N=0;N<L.features.length;N++)W(L.features[N],D);else if(Z==="GeometryCollection")for(N=0;N<L.geometries.length;N++)W(L.geometries[N],D);else if(Z==="Feature")W(L.geometry,D);else if(Z==="Polygon")Re(L.coordinates,D);else if(Z==="MultiPolygon")for(N=0;N<L.coordinates.length;N++)Re(L.coordinates[N],D);return L});const It=S.bt.VectorTileFeature.prototype.toGeoJSON;var ue={exports:{}},re=S.bz,de=S.bt.VectorTileFeature,Te=Ue;function Ue(W,L){this.options=L||{},this.features=W,this.length=W.length}function Ge(W,L){this.id=typeof W.id=="number"?W.id:void 0,this.type=W.type,this.rawGeometry=W.type===1?[W.geometry]:W.geometry,this.properties=W.tags,this.extent=L||4096}Ue.prototype.feature=function(W){return new Ge(this.features[W],this.options.extent)},Ge.prototype.loadGeometry=function(){var W=this.rawGeometry;this.geometry=[];for(var L=0;L<W.length;L++){for(var D=W[L],N=[],Z=0;Z<D.length;Z++)N.push(new re(D[Z][0],D[Z][1]));this.geometry.push(N)}return this.geometry},Ge.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var W=this.geometry,L=1/0,D=-1/0,N=1/0,Z=-1/0,te=0;te<W.length;te++)for(var se=W[te],ce=0;ce<se.length;ce++){var Y=se[ce];L=Math.min(L,Y.x),D=Math.max(D,Y.x),N=Math.min(N,Y.y),Z=Math.max(Z,Y.y)}return[L,N,D,Z]},Ge.prototype.toGeoJSON=de.prototype.toGeoJSON;var We=S.bA,it=Te;function Mt(W){var L=new We;return function(D,N){for(var Z in D.layers)N.writeMessage(3,pt,D.layers[Z])}(W,L),L.finish()}function pt(W,L){var D;L.writeVarintField(15,W.version||1),L.writeStringField(1,W.name||""),L.writeVarintField(5,W.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<W.length;D++)N.feature=W.feature(D),L.writeMessage(2,gt,N);var Z=N.keys;for(D=0;D<Z.length;D++)L.writeStringField(3,Z[D]);var te=N.values;for(D=0;D<te.length;D++)L.writeMessage(4,Kr,te[D])}function gt(W,L){var D=W.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,fr,W),L.writeVarintField(3,D.type),L.writeMessage(4,wt,D)}function fr(W,L){var D=W.feature,N=W.keys,Z=W.values,te=W.keycache,se=W.valuecache;for(var ce in D.properties){var Y=D.properties[ce],ye=te[ce];if(Y!==null){ye===void 0&&(N.push(ce),te[ce]=ye=N.length-1),L.writeVarint(ye);var be=typeof Y;be!=="string"&&be!=="boolean"&&be!=="number"&&(Y=JSON.stringify(Y));var fe=be+":"+Y,Pe=se[fe];Pe===void 0&&(Z.push(Y),se[fe]=Pe=Z.length-1),L.writeVarint(Pe)}}}function Xt(W,L){return(L<<3)+(7&W)}function ur(W){return W<<1^W>>31}function wt(W,L){for(var D=W.loadGeometry(),N=W.type,Z=0,te=0,se=D.length,ce=0;ce<se;ce++){var Y=D[ce],ye=1;N===1&&(ye=Y.length),L.writeVarint(Xt(1,ye));for(var be=N===3?Y.length-1:Y.length,fe=0;fe<be;fe++){fe===1&&N!==1&&L.writeVarint(Xt(2,be-1));var Pe=Y[fe].x-Z,tt=Y[fe].y-te;L.writeVarint(ur(Pe)),L.writeVarint(ur(tt)),Z+=Pe,te+=tt}N===3&&L.writeVarint(Xt(7,1))}}function Kr(W,L){var D=typeof W;D==="string"?L.writeStringField(1,W):D==="boolean"?L.writeBooleanField(7,W):D==="number"&&(W%1!=0?L.writeDoubleField(3,W):W<0?L.writeSVarintField(6,W):L.writeVarintField(5,W))}ue.exports=Mt,ue.exports.fromVectorTileJs=Mt,ue.exports.fromGeojsonVt=function(W,L){L=L||{};var D={};for(var N in W)D[N]=new it(W[N].features,L),D[N].name=N,D[N].version=L.version,D[N].extent=L.extent;return Mt({layers:D})},ue.exports.GeoJSONWrapper=it;var Or=S.by(ue.exports);const Xe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:W=>W},ct=Math.fround||(dt=new Float32Array(1),W=>(dt[0]=+W,dt[0]));var dt;const Tt=3,Bt=5,oi=6;class Ir{constructor(L){this.options=Object.assign(Object.create(Xe),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:N,maxZoom:Z}=this.options;D&&console.time("total time");const te=`prepare ${L.length} points`;D&&console.time(te),this.points=L;const se=[];for(let Y=0;Y<L.length;Y++){const ye=L[Y];if(!ye.geometry)continue;const[be,fe]=ye.geometry.coordinates,Pe=ct(ke(be)),tt=ct(Kt(fe));se.push(Pe,tt,1/0,Y,-1,1),this.options.reduce&&se.push(0)}let ce=this.trees[Z+1]=this._createTree(se);D&&console.timeEnd(te);for(let Y=Z;Y>=N;Y--){const ye=+Date.now();ce=this.trees[Y]=this._createTree(this._cluster(ce,Y)),D&&console.log("z%d: %d clusters in %dms",Y,ce.numItems,+Date.now()-ye)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let N=((L[0]+180)%360+360)%360-180;const Z=Math.max(-90,Math.min(90,L[1]));let te=L[2]===180?180:((L[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)N=-180,te=180;else if(N>te){const fe=this.getClusters([N,Z,180,se],D),Pe=this.getClusters([-180,Z,te,se],D);return fe.concat(Pe)}const ce=this.trees[this._limitZoom(D)],Y=ce.range(ke(N),Kt(se),ke(te),Kt(Z)),ye=ce.data,be=[];for(const fe of Y){const Pe=this.stride*fe;be.push(ye[Pe+Bt]>1?Jr(ye,Pe,this.clusterProps):this.points[ye[Pe+Tt]])}return be}getChildren(L){const D=this._getOriginId(L),N=this._getOriginZoom(L),Z="No cluster with the specified id.",te=this.trees[N];if(!te)throw new Error(Z);const se=te.data;if(D*this.stride>=se.length)throw new Error(Z);const ce=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Y=te.within(se[D*this.stride],se[D*this.stride+1],ce),ye=[];for(const be of Y){const fe=be*this.stride;se[fe+4]===L&&ye.push(se[fe+Bt]>1?Jr(se,fe,this.clusterProps):this.points[se[fe+Tt]])}if(ye.length===0)throw new Error(Z);return ye}getLeaves(L,D,N){const Z=[];return this._appendLeaves(Z,L,D=D||10,N=N||0,0),Z}getTile(L,D,N){const Z=this.trees[this._limitZoom(L)],te=Math.pow(2,L),{extent:se,radius:ce}=this.options,Y=ce/se,ye=(N-Y)/te,be=(N+1+Y)/te,fe={features:[]};return this._addTileFeatures(Z.range((D-Y)/te,ye,(D+1+Y)/te,be),Z.data,D,N,te,fe),D===0&&this._addTileFeatures(Z.range(1-Y/te,ye,1,be),Z.data,te,N,te,fe),D===te-1&&this._addTileFeatures(Z.range(0,ye,Y/te,be),Z.data,-1,N,te,fe),fe.features.length?fe:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const N=this.getChildren(L);if(D++,N.length!==1)break;L=N[0].properties.cluster_id}return D}_appendLeaves(L,D,N,Z,te){const se=this.getChildren(D);for(const ce of se){const Y=ce.properties;if(Y&&Y.cluster?te+Y.point_count<=Z?te+=Y.point_count:te=this._appendLeaves(L,Y.cluster_id,N,Z,te):te<Z?te++:L.push(ce),L.length===N)break}return te}_createTree(L){const D=new S.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let N=0;N<L.length;N+=this.stride)D.add(L[N],L[N+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,N,Z,te,se){for(const ce of L){const Y=ce*this.stride,ye=D[Y+Bt]>1;let be,fe,Pe;if(ye)be=Nr(D,Y,this.clusterProps),fe=D[Y],Pe=D[Y+1];else{const Pt=this.points[D[Y+Tt]];be=Pt.properties;const[mt,zt]=Pt.geometry.coordinates;fe=ke(mt),Pe=Kt(zt)}const tt={type:1,geometry:[[Math.round(this.options.extent*(fe*te-N)),Math.round(this.options.extent*(Pe*te-Z))]],tags:be};let nt;nt=ye||this.options.generateId?D[Y+Tt]:this.points[D[Y+Tt]].id,nt!==void 0&&(tt.id=nt),se.features.push(tt)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:N,extent:Z,reduce:te,minPoints:se}=this.options,ce=N/(Z*Math.pow(2,D)),Y=L.data,ye=[],be=this.stride;for(let fe=0;fe<Y.length;fe+=be){if(Y[fe+2]<=D)continue;Y[fe+2]=D;const Pe=Y[fe],tt=Y[fe+1],nt=L.within(Y[fe],Y[fe+1],ce),Pt=Y[fe+Bt];let mt=Pt;for(const zt of nt){const bt=zt*be;Y[bt+2]>D&&(mt+=Y[bt+Bt])}if(mt>Pt&&mt>=se){let zt,bt=Pe*Pt,xr=tt*Pt,sr=-1;const vt=((fe/be|0)<<5)+(D+1)+this.points.length;for(const jt of nt){const rr=jt*be;if(Y[rr+2]<=D)continue;Y[rr+2]=D;const Cr=Y[rr+Bt];bt+=Y[rr]*Cr,xr+=Y[rr+1]*Cr,Y[rr+4]=vt,te&&(zt||(zt=this._map(Y,fe,!0),sr=this.clusterProps.length,this.clusterProps.push(zt)),te(zt,this._map(Y,rr)))}Y[fe+4]=vt,ye.push(bt/mt,xr/mt,1/0,vt,-1,mt),te&&ye.push(sr)}else{for(let zt=0;zt<be;zt++)ye.push(Y[fe+zt]);if(mt>1)for(const zt of nt){const bt=zt*be;if(!(Y[bt+2]<=D)){Y[bt+2]=D;for(let xr=0;xr<be;xr++)ye.push(Y[bt+xr])}}}}return ye}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,N){if(L[D+Bt]>1){const se=this.clusterProps[L[D+oi]];return N?Object.assign({},se):se}const Z=this.points[L[D+Tt]].properties,te=this.options.map(Z);return N&&te===Z?Object.assign({},te):te}}function Jr(W,L,D){return{type:"Feature",id:W[L+Tt],properties:Nr(W,L,D),geometry:{type:"Point",coordinates:[(N=W[L],360*(N-.5)),fn(W[L+1])]}};var N}function Nr(W,L,D){const N=W[L+Bt],Z=N>=1e4?`${Math.round(N/1e3)}k`:N>=1e3?Math.round(N/100)/10+"k":N,te=W[L+oi],se=te===-1?{}:Object.assign({},D[te]);return Object.assign(se,{cluster:!0,cluster_id:W[L+Tt],point_count:N,point_count_abbreviated:Z})}function ke(W){return W/360+.5}function Kt(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function fn(W){const L=(180-360*W)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function An(W,L,D,N){let Z=N;const te=L+(D-L>>1);let se,ce=D-L;const Y=W[L],ye=W[L+1],be=W[D],fe=W[D+1];for(let Pe=L+3;Pe<D;Pe+=3){const tt=us(W[Pe],W[Pe+1],Y,ye,be,fe);if(tt>Z)se=Pe,Z=tt;else if(tt===Z){const nt=Math.abs(Pe-te);nt<ce&&(se=Pe,ce=nt)}}Z>N&&(se-L>3&&An(W,L,se,N),W[se+2]=Z,D-se>3&&An(W,se,D,N))}function us(W,L,D,N,Z,te){let se=Z-D,ce=te-N;if(se!==0||ce!==0){const Y=((W-D)*se+(L-N)*ce)/(se*se+ce*ce);Y>1?(D=Z,N=te):Y>0&&(D+=se*Y,N+=ce*Y)}return se=W-D,ce=L-N,se*se+ce*ce}function Di(W,L,D,N){const Z={id:W??null,type:L,geometry:D,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")Ct(Z,D);else if(L==="Polygon")Ct(Z,D[0]);else if(L==="MultiLineString")for(const te of D)Ct(Z,te);else if(L==="MultiPolygon")for(const te of D)Ct(Z,te[0]);return Z}function Ct(W,L){for(let D=0;D<L.length;D+=3)W.minX=Math.min(W.minX,L[D]),W.minY=Math.min(W.minY,L[D+1]),W.maxX=Math.max(W.maxX,L[D]),W.maxY=Math.max(W.maxY,L[D+1])}function Gn(W,L,D,N){if(!L.geometry)return;const Z=L.geometry.coordinates;if(Z&&Z.length===0)return;const te=L.geometry.type,se=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let ce=[],Y=L.id;if(D.promoteId?Y=L.properties[D.promoteId]:D.generateId&&(Y=N||0),te==="Point")Vs(Z,ce);else if(te==="MultiPoint")for(const ye of Z)Vs(ye,ce);else if(te==="LineString")me(Z,ce,se,!1);else if(te==="MultiLineString"){if(D.lineMetrics){for(const ye of Z)ce=[],me(ye,ce,se,!1),W.push(Di(Y,"LineString",ce,L.properties));return}cs(Z,ce,se,!1)}else if(te==="Polygon")cs(Z,ce,se,!0);else{if(te!=="MultiPolygon"){if(te==="GeometryCollection"){for(const ye of L.geometry.geometries)Gn(W,{id:Y,geometry:ye,properties:L.properties},D,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ye of Z){const be=[];cs(ye,be,se,!0),ce.push(be)}}W.push(Di(Y,te,ce,L.properties))}function Vs(W,L){L.push(Ua(W[0]),Rt(W[1]),0)}function me(W,L,D,N){let Z,te,se=0;for(let Y=0;Y<W.length;Y++){const ye=Ua(W[Y][0]),be=Rt(W[Y][1]);L.push(ye,be,0),Y>0&&(se+=N?(Z*be-ye*te)/2:Math.sqrt(Math.pow(ye-Z,2)+Math.pow(be-te,2))),Z=ye,te=be}const ce=L.length-3;L[2]=1,An(L,0,ce,D),L[ce+2]=1,L.size=Math.abs(se),L.start=0,L.end=L.size}function cs(W,L,D,N){for(let Z=0;Z<W.length;Z++){const te=[];me(W[Z],te,D,N),L.push(te)}}function Ua(W){return W/360+.5}function Rt(W){const L=Math.sin(W*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function nr(W,L,D,N,Z,te,se,ce){if(N/=L,te>=(D/=L)&&se<N)return W;if(se<D||te>=N)return null;const Y=[];for(const ye of W){const be=ye.geometry;let fe=ye.type;const Pe=Z===0?ye.minX:ye.minY,tt=Z===0?ye.maxX:ye.maxY;if(Pe>=D&&tt<N){Y.push(ye);continue}if(tt<D||Pe>=N)continue;let nt=[];if(fe==="Point"||fe==="MultiPoint")$a(be,nt,D,N,Z);else if(fe==="LineString")Hn(be,nt,D,N,Z,!1,ce.lineMetrics);else if(fe==="MultiLineString")Us(be,nt,D,N,Z,!1);else if(fe==="Polygon")Us(be,nt,D,N,Z,!0);else if(fe==="MultiPolygon")for(const Pt of be){const mt=[];Us(Pt,mt,D,N,Z,!0),mt.length&&nt.push(mt)}if(nt.length){if(ce.lineMetrics&&fe==="LineString"){for(const Pt of nt)Y.push(Di(ye.id,fe,Pt,ye.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(nt.length===1?(fe="LineString",nt=nt[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=nt.length===3?"Point":"MultiPoint"),Y.push(Di(ye.id,fe,nt,ye.tags))}}return Y.length?Y:null}function $a(W,L,D,N,Z){for(let te=0;te<W.length;te+=3){const se=W[te+Z];se>=D&&se<=N&&Li(L,W[te],W[te+1],W[te+2])}}function Hn(W,L,D,N,Z,te,se){let ce=Mn(W);const Y=Z===0?Za:qa;let ye,be,fe=W.start;for(let mt=0;mt<W.length-3;mt+=3){const zt=W[mt],bt=W[mt+1],xr=W[mt+2],sr=W[mt+3],vt=W[mt+4],jt=Z===0?zt:bt,rr=Z===0?sr:vt;let Cr=!1;se&&(ye=Math.sqrt(Math.pow(zt-sr,2)+Math.pow(bt-vt,2))),jt<D?rr>D&&(be=Y(ce,zt,bt,sr,vt,D),se&&(ce.start=fe+ye*be)):jt>N?rr<N&&(be=Y(ce,zt,bt,sr,vt,N),se&&(ce.start=fe+ye*be)):Li(ce,zt,bt,xr),rr<D&&jt>=D&&(be=Y(ce,zt,bt,sr,vt,D),Cr=!0),rr>N&&jt<=N&&(be=Y(ce,zt,bt,sr,vt,N),Cr=!0),!te&&Cr&&(se&&(ce.end=fe+ye*be),L.push(ce),ce=Mn(W)),se&&(fe+=ye)}let Pe=W.length-3;const tt=W[Pe],nt=W[Pe+1],Pt=Z===0?tt:nt;Pt>=D&&Pt<=N&&Li(ce,tt,nt,W[Pe+2]),Pe=ce.length-3,te&&Pe>=3&&(ce[Pe]!==ce[0]||ce[Pe+1]!==ce[1])&&Li(ce,ce[0],ce[1],ce[2]),ce.length&&L.push(ce)}function Mn(W){const L=[];return L.size=W.size,L.start=W.start,L.end=W.end,L}function Us(W,L,D,N,Z,te){for(const se of W)Hn(se,L,D,N,Z,te,!1)}function Li(W,L,D,N){W.push(L,D,N)}function Za(W,L,D,N,Z,te){const se=(te-L)/(N-L);return Li(W,te,D+(Z-D)*se,1),se}function qa(W,L,D,N,Z,te){const se=(te-D)/(Z-D);return Li(W,L+(N-L)*se,te,1),se}function Ie(W,L){const D=[];for(let N=0;N<W.length;N++){const Z=W[N],te=Z.type;let se;if(te==="Point"||te==="MultiPoint"||te==="LineString")se=mn(Z.geometry,L);else if(te==="MultiLineString"||te==="Polygon"){se=[];for(const ce of Z.geometry)se.push(mn(ce,L))}else if(te==="MultiPolygon"){se=[];for(const ce of Z.geometry){const Y=[];for(const ye of ce)Y.push(mn(ye,L));se.push(Y)}}D.push(Di(Z.id,te,se,Z.tags))}return D}function mn(W,L){const D=[];D.size=W.size,W.start!==void 0&&(D.start=W.start,D.end=W.end);for(let N=0;N<W.length;N+=3)D.push(W[N]+L,W[N+1],W[N+2]);return D}function Yr(W,L){if(W.transformed)return W;const D=1<<W.z,N=W.x,Z=W.y;for(const te of W.features){const se=te.geometry,ce=te.type;if(te.geometry=[],ce===1)for(let Y=0;Y<se.length;Y+=2)te.geometry.push(gn(se[Y],se[Y+1],L,D,N,Z));else for(let Y=0;Y<se.length;Y++){const ye=[];for(let be=0;be<se[Y].length;be+=2)ye.push(gn(se[Y][be],se[Y][be+1],L,D,N,Z));te.geometry.push(ye)}}return W.transformed=!0,W}function gn(W,L,D,N,Z,te){return[Math.round(D*(W*N-Z)),Math.round(D*(L*N-te))]}function Wn(W,L,D,N,Z){const te=L===Z.maxZoom?0:Z.tolerance/((1<<L)*Z.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:W.length,source:null,x:D,y:N,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ce of W)Me(se,ce,te,Z);return se}function Me(W,L,D,N){const Z=L.geometry,te=L.type,se=[];if(W.minX=Math.min(W.minX,L.minX),W.minY=Math.min(W.minY,L.minY),W.maxX=Math.max(W.maxX,L.maxX),W.maxY=Math.max(W.maxY,L.maxY),te==="Point"||te==="MultiPoint")for(let ce=0;ce<Z.length;ce+=3)se.push(Z[ce],Z[ce+1]),W.numPoints++,W.numSimplified++;else if(te==="LineString")_t(se,Z,W,D,!1,!1);else if(te==="MultiLineString"||te==="Polygon")for(let ce=0;ce<Z.length;ce++)_t(se,Z[ce],W,D,te==="Polygon",ce===0);else if(te==="MultiPolygon")for(let ce=0;ce<Z.length;ce++){const Y=Z[ce];for(let ye=0;ye<Y.length;ye++)_t(se,Y[ye],W,D,!0,ye===0)}if(se.length){let ce=L.tags||null;if(te==="LineString"&&N.lineMetrics){ce={};for(const ye in L.tags)ce[ye]=L.tags[ye];ce.mapbox_clip_start=Z.start/Z.size,ce.mapbox_clip_end=Z.end/Z.size}const Y={geometry:se,type:te==="Polygon"||te==="MultiPolygon"?3:te==="LineString"||te==="MultiLineString"?2:1,tags:ce};L.id!==null&&(Y.id=L.id),W.features.push(Y)}}function _t(W,L,D,N,Z,te){const se=N*N;if(N>0&&L.size<(Z?se:N))return void(D.numPoints+=L.length/3);const ce=[];for(let Y=0;Y<L.length;Y+=3)(N===0||L[Y+2]>se)&&(D.numSimplified++,ce.push(L[Y],L[Y+1])),D.numPoints++;Z&&function(Y,ye){let be=0;for(let fe=0,Pe=Y.length,tt=Pe-2;fe<Pe;tt=fe,fe+=2)be+=(Y[fe]-Y[tt])*(Y[fe+1]+Y[tt+1]);if(be>0===ye)for(let fe=0,Pe=Y.length;fe<Pe/2;fe+=2){const tt=Y[fe],nt=Y[fe+1];Y[fe]=Y[Pe-2-fe],Y[fe+1]=Y[Pe-1-fe],Y[Pe-2-fe]=tt,Y[Pe-1-fe]=nt}}(ce,te),W.push(ce)}const ot={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class li{constructor(L,D){const N=(D=this.options=function(te,se){for(const ce in se)te[ce]=se[ce];return te}(Object.create(ot),D)).debug;if(N&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let Z=function(te,se){const ce=[];if(te.type==="FeatureCollection")for(let Y=0;Y<te.features.length;Y++)Gn(ce,te.features[Y],se,Y);else Gn(ce,te.type==="Feature"?te:{geometry:te},se);return ce}(L,D);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Z=function(te,se){const ce=se.buffer/se.extent;let Y=te;const ye=nr(te,1,-1-ce,ce,0,-1,2,se),be=nr(te,1,1-ce,2+ce,0,-1,2,se);return(ye||be)&&(Y=nr(te,1,-ce,1+ce,0,-1,2,se)||[],ye&&(Y=Ie(ye,1).concat(Y)),be&&(Y=Y.concat(Ie(be,-1)))),Y}(Z,D),Z.length&&this.splitTile(Z,0,0,0),N&&(Z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,N,Z,te,se,ce){const Y=[L,D,N,Z],ye=this.options,be=ye.debug;for(;Y.length;){Z=Y.pop(),N=Y.pop(),D=Y.pop(),L=Y.pop();const fe=1<<D,Pe=Wi(D,N,Z);let tt=this.tiles[Pe];if(!tt&&(be>1&&console.time("creation"),tt=this.tiles[Pe]=Wn(L,D,N,Z,ye),this.tileCoords.push({z:D,x:N,y:Z}),be)){be>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,N,Z,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));const Cr=`z${D}`;this.stats[Cr]=(this.stats[Cr]||0)+1,this.total++}if(tt.source=L,te==null){if(D===ye.indexMaxZoom||tt.numPoints<=ye.indexMaxPoints)continue}else{if(D===ye.maxZoom||D===te)continue;if(te!=null){const Cr=te-D;if(N!==se>>Cr||Z!==ce>>Cr)continue}}if(tt.source=null,L.length===0)continue;be>1&&console.time("clipping");const nt=.5*ye.buffer/ye.extent,Pt=.5-nt,mt=.5+nt,zt=1+nt;let bt=null,xr=null,sr=null,vt=null,jt=nr(L,fe,N-nt,N+mt,0,tt.minX,tt.maxX,ye),rr=nr(L,fe,N+Pt,N+zt,0,tt.minX,tt.maxX,ye);L=null,jt&&(bt=nr(jt,fe,Z-nt,Z+mt,1,tt.minY,tt.maxY,ye),xr=nr(jt,fe,Z+Pt,Z+zt,1,tt.minY,tt.maxY,ye),jt=null),rr&&(sr=nr(rr,fe,Z-nt,Z+mt,1,tt.minY,tt.maxY,ye),vt=nr(rr,fe,Z+Pt,Z+zt,1,tt.minY,tt.maxY,ye),rr=null),be>1&&console.timeEnd("clipping"),Y.push(bt||[],D+1,2*N,2*Z),Y.push(xr||[],D+1,2*N,2*Z+1),Y.push(sr||[],D+1,2*N+1,2*Z),Y.push(vt||[],D+1,2*N+1,2*Z+1)}}getTile(L,D,N){L=+L,D=+D,N=+N;const Z=this.options,{extent:te,debug:se}=Z;if(L<0||L>24)return null;const ce=1<<L,Y=Wi(L,D=D+ce&ce-1,N);if(this.tiles[Y])return Yr(this.tiles[Y],te);se>1&&console.log("drilling down to z%d-%d-%d",L,D,N);let ye,be=L,fe=D,Pe=N;for(;!ye&&be>0;)be--,fe>>=1,Pe>>=1,ye=this.tiles[Wi(be,fe,Pe)];return ye&&ye.source?(se>1&&(console.log("found parent tile z%d-%d-%d",be,fe,Pe),console.time("drilling down")),this.splitTile(ye.source,be,fe,Pe,L,D,N),se>1&&console.timeEnd("drilling down"),this.tiles[Y]?Yr(this.tiles[Y],te):null):null}}function Wi(W,L,D){return 32*((1<<W)*D+L)+W}function ft(W,L){return L?W.properties[L]:W.id}function yn(W,L){if(W==null)return!0;if(W.type==="Feature")return ft(W,L)!=null;if(W.type==="FeatureCollection"){const D=new Set;for(const N of W.features){const Z=ft(N,L);if(Z==null||D.has(Z))return!1;D.add(Z)}return!0}return!1}function Dn(W,L){const D=new Map;if(W!=null)if(W.type==="Feature")D.set(ft(W,L),W);else for(const N of W.features)D.set(ft(N,L),N);return D}class Xn extends ne{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return S._(this,void 0,void 0,function*(){const N=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Z=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!Z)return null;const te=new class{constructor(ce){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=S.X,this.length=ce.length,this._features=ce}feature(ce){return new class{constructor(Y){this._feature=Y,this.extent=S.X,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const ye of this._feature.geometry)Y.push([new S.P(ye[0],ye[1])]);return Y}{const Y=[];for(const ye of this._feature.geometry){const be=[];for(const fe of ye)be.push(new S.P(fe[0],fe[1]));Y.push(be)}return Y}}toGeoJSON(Y,ye,be){return It.call(this,Y,ye,be)}}(this._features[ce])}}(Z.features);let se=Or(te);return se.byteOffset===0&&se.byteLength===se.buffer.byteLength||(se=new Uint8Array(se)),{vectorTile:te,rawData:se.buffer}})}loadData(L){return S._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const N=!!(L&&L.request&&L.request.collectResourceTiming)&&new S.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new Ir(function({superclusterOptions:se,clusterProperties:ce}){if(!ce||!se)return se;const Y={},ye={},be={accumulated:null,zoom:0},fe={properties:null},Pe=Object.keys(ce);for(const tt of Pe){const[nt,Pt]=ce[tt],mt=S.bC(Pt),zt=S.bC(typeof nt=="string"?[nt,["accumulated"],["get",tt]]:nt);Y[tt]=mt.value,ye[tt]=zt.value}return se.map=tt=>{fe.properties=tt;const nt={};for(const Pt of Pe)nt[Pt]=Y[Pt].evaluate(be,fe);return nt},se.reduce=(tt,nt)=>{fe.properties=nt;for(const Pt of Pe)be.accumulated=tt[Pt],tt[Pt]=ye[Pt].evaluate(be,fe)},se}(L)).load((yield this._pendingData).features):(Z=yield this._pendingData,new li(Z,L.geojsonVtOptions)),this.loaded={};const te={};if(N){const se=N.finish();se&&(te.resourceTiming={},te.resourceTiming[L.source]=JSON.parse(JSON.stringify(se)))}return te}catch(te){if(delete this._pendingRequest,S.bB(te))return{abandoned:!0};throw te}var Z})}getData(){return S._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return S._(this,void 0,void 0,function*(){let N=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof N!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(Ne(N,!0),L.filter){const Z=S.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Z.result==="error")throw new Error(Z.value.map(se=>`${se.key}: ${se.message}`).join(", "));N={type:"FeatureCollection",features:N.features.filter(se=>Z.value.evaluate({zoom:0},se))}}return N})}loadGeoJSON(L,D){return S._(this,void 0,void 0,function*(){const{promoteId:N}=L;if(L.request){const Z=yield S.h(L.request,D);return this._dataUpdateable=yn(Z.data,N)?Dn(Z.data,N):void 0,Z.data}if(typeof L.data=="string")try{const Z=JSON.parse(L.data);return this._dataUpdateable=yn(Z,N)?Dn(Z,N):void 0,Z}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(Z,te,se){var ce,Y,ye,be;if(te.removeAll&&Z.clear(),te.remove)for(const fe of te.remove)Z.delete(fe);if(te.add)for(const fe of te.add){const Pe=ft(fe,se);Pe!=null&&Z.set(Pe,fe)}if(te.update)for(const fe of te.update){let Pe=Z.get(fe.id);if(Pe==null)continue;const tt=!fe.removeAllProperties&&(((ce=fe.removeProperties)===null||ce===void 0?void 0:ce.length)>0||((Y=fe.addOrUpdateProperties)===null||Y===void 0?void 0:Y.length)>0);if((fe.newGeometry||fe.removeAllProperties||tt)&&(Pe=Object.assign({},Pe),Z.set(fe.id,Pe),tt&&(Pe.properties=Object.assign({},Pe.properties))),fe.newGeometry&&(Pe.geometry=fe.newGeometry),fe.removeAllProperties)Pe.properties={};else if(((ye=fe.removeProperties)===null||ye===void 0?void 0:ye.length)>0)for(const nt of fe.removeProperties)Object.prototype.hasOwnProperty.call(Pe.properties,nt)&&delete Pe.properties[nt];if(((be=fe.addOrUpdateProperties)===null||be===void 0?void 0:be.length)>0)for(const{key:nt,value:Pt}of fe.addOrUpdateProperties)Pe.properties[nt]=Pt}}(this._dataUpdateable,L.dataDiff,N),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return S._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class _n{constructor(L){this.self=L,this.actor=new S.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,N)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=N},this.self.addProtocol=S.bi,this.self.removeProtocol=S.bj,this.self.registerRTLTextPlugin=D=>{if(S.bD.isParsed())throw new Error("RTL text plugin already registered.");S.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,N)=>this._getDEMWorkerSource(D,N.source).loadTile(N)),this.actor.registerMessageHandler("RDT",(D,N)=>S._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,N.source).removeTile(N)})),this.actor.registerMessageHandler("GCEZ",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterExpansionZoom(N)})),this.actor.registerMessageHandler("GCC",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterChildren(N)})),this.actor.registerMessageHandler("GCL",(D,N)=>S._(this,void 0,void 0,function*(){return this._getWorkerSource(D,N.type,N.source).getClusterLeaves(N)})),this.actor.registerMessageHandler("LD",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadData(N)),this.actor.registerMessageHandler("GD",(D,N)=>this._getWorkerSource(D,N.type,N.source).getData()),this.actor.registerMessageHandler("LT",(D,N)=>this._getWorkerSource(D,N.type,N.source).loadTile(N)),this.actor.registerMessageHandler("RT",(D,N)=>this._getWorkerSource(D,N.type,N.source).reloadTile(N)),this.actor.registerMessageHandler("AT",(D,N)=>this._getWorkerSource(D,N.type,N.source).abortTile(N)),this.actor.registerMessageHandler("RMT",(D,N)=>this._getWorkerSource(D,N.type,N.source).removeTile(N)),this.actor.registerMessageHandler("RS",(D,N)=>S._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][N.type]||!this.workerSources[D][N.type][N.source])return;const Z=this.workerSources[D][N.type][N.source];delete this.workerSources[D][N.type][N.source],Z.removeSource!==void 0&&Z.removeSource(N)})),this.actor.registerMessageHandler("RM",D=>S._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,N)=>S._(this,void 0,void 0,function*(){this.referrer=N})),this.actor.registerMessageHandler("SRPS",(D,N)=>this._syncRTLPluginState(D,N)),this.actor.registerMessageHandler("IS",(D,N)=>S._(this,void 0,void 0,function*(){this.self.importScripts(N)})),this.actor.registerMessageHandler("SI",(D,N)=>this._setImages(D,N)),this.actor.registerMessageHandler("UL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(N.layers,N.removedIds)})),this.actor.registerMessageHandler("SL",(D,N)=>S._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(N)}))}_setImages(L,D){return S._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const N in this.workerSources[L]){const Z=this.workerSources[L][N];for(const te in Z)Z[te].availableImages=D}})}_syncRTLPluginState(L,D){return S._(this,void 0,void 0,function*(){if(S.bD.isParsed())return S.bD.getState();if(D.pluginStatus!=="loading")return S.bD.setState(D),D;const N=D.pluginURL;if(this.self.importScripts(N),S.bD.isParsed()){const Z={pluginStatus:"loaded",pluginURL:N};return S.bD.setState(Z),Z}throw S.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${N}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new d),D}_getWorkerSource(L,D,N){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][N]){const Z={sendAsync:(te,se)=>(te.targetMapId=L,this.actor.sendAsync(te,se))};switch(D){case"vector":this.workerSources[L][D][N]=new ne(Z,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][N]=new Xn(Z,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][N]=new this.externalWorkerSourceTypes[D](Z,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][N]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new G),this.demWorkerSources[L][D]}}return S.i(self)&&(self.worker=new _n(self)),_n}),b("index",["exports","./shared"],function(S,d){var H="4.7.1";let le,ve;const ne={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(d.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(le||(le=document.createElement("a")),le.href=f,le.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ve==null&&(ve=matchMedia("(prefers-reduced-motion: reduce)")),ve.matches)}};class G{static testProp(e){if(!G.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in G.docStyle)return e[s];return e[0]}static create(e,s,l){const u=window.document.createElement(e);return s!==void 0&&(u.className=s),l&&l.appendChild(u),u}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){G.docStyle&&G.selectProp&&(G.userSelect=G.docStyle[G.selectProp],G.docStyle[G.selectProp]="none")}static enableDrag(){G.docStyle&&G.selectProp&&(G.docStyle[G.selectProp]=G.userSelect)}static setTransform(e,s){e.style[G.transformProp]=s}static addEventListener(e,s,l,u={}){e.addEventListener(s,l,"passive"in u?u:u.capture)}static removeEventListener(e,s,l,u={}){e.removeEventListener(s,l,"passive"in u?u:u.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",G.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",G.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",G.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const u=s.boundingClientRect;return new d.P((l.clientX-u.left)/s.x-e.clientLeft,(l.clientY-u.top)/s.y-e.clientTop)}static mousePos(e,s){const l=G.getScale(e);return G.getPoint(e,l,s)}static touchPos(e,s){const l=[],u=G.getScale(e);for(let p=0;p<s.length;p++)l.push(G.getPoint(e,u,s[p]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}G.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,G.selectProp=G.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),G.transformProp=G.testProp(["transform","WebkitTransform"]);const Re={supported:!1,testSupport:function(f){!It&&Ne&&(ue?re(f):Fe=f)}};let Fe,Ne,It=!1,ue=!1;function re(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,Ne),f.isContextLost())return;Re.supported=!0}catch{}f.deleteTexture(e),It=!0}var de;typeof document<"u"&&(Ne=document.createElement("img"),Ne.onload=()=>{Fe&&re(Fe),Fe=null,ue=!0},Ne.onerror=()=>{It=!0,Fe=null},Ne.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,s,l,u;f.resetRequestQueue=()=>{e=[],s=0,l=0,u={}},f.addThrottleControl=T=>{const C=l++;return u[C]=T,C},f.removeThrottleControl=T=>{delete u[T],v()},f.getImage=(T,C,z=!0)=>new Promise((A,F)=>{Re.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),d.e(T,{type:"image"}),e.push({abortController:C,requestParameters:T,supportImageRefresh:z,state:"queued",onError:j=>{F(j)},onSuccess:j=>{A(j)}}),v()});const p=T=>d._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:C,supportImageRefresh:z,onError:A,onSuccess:F,abortController:j}=T,V=z===!1&&!d.i(self)&&!d.g(C.url)&&(!C.headers||Object.keys(C.headers).reduce((J,Q)=>J&&Q==="accept",!0));s++;const q=V?w(C,j):d.m(C,j);try{const J=yield q;delete T.abortController,T.state="completed",J.data instanceof HTMLImageElement||d.b(J.data)?F(J):J.data&&F({data:yield(K=J.data,typeof createImageBitmap=="function"?d.d(K):d.f(K)),cacheControl:J.cacheControl,expires:J.expires})}catch(J){delete T.abortController,A(J)}finally{s--,v()}var K}),v=()=>{const T=(()=>{for(const C of Object.keys(u))if(u[C]())return!0;return!1})()?d.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:d.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let C=s;C<T&&e.length>0;C++){const z=e.shift();z.abortController.signal.aborted?C--:p(z)}},w=(T,C)=>new Promise((z,A)=>{const F=new Image,j=T.url,V=T.credentials;V&&V==="include"?F.crossOrigin="use-credentials":(V&&V==="same-origin"||!d.s(j))&&(F.crossOrigin="anonymous"),C.signal.addEventListener("abort",()=>{F.src="",A(d.c())}),F.fetchPriority="high",F.onload=()=>{F.onerror=F.onload=null,z({data:F})},F.onerror=()=>{F.onerror=F.onload=null,C.signal.aborted||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},F.src=j})}(de||(de={})),de.resetRequestQueue();class Te{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ue(f){var e=new d.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var Ge,We=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};Ge=new d.A(3),d.A!=Float32Array&&(Ge[0]=0,Ge[1]=0,Ge[2]=0);var it=function(f){var e=f[0],s=f[1];return e*e+s*s};function Mt(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:u}of f){const p=`${l}${u}`;s.indexOf(p)===-1&&(s.push(p),e.push({id:l,url:u}))}}return e}function pt(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new d.A(2);d.A!=Float32Array&&(f[0]=0,f[1]=0)})();class gt{constructor(e,s,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,u)}update(e,s,l){const{width:u,height:p}=e,v=!(this.size&&this.size[0]===u&&this.size[1]===p||l),{context:w}=this,{gl:T}=w;if(this.useMipmap=!!(s&&s.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!s||s.premultiply!==!1)),v)this.size=[u,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,u,p,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:C,y:z}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||d.b(e)?T.texSubImage2D(T.TEXTURE_2D,0,C,z,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,C,z,u,p,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,s,l){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),l!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=p.LINEAR),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function fr(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class Xt extends d.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new d.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const u=s.data||s.spriteData;return this._validateStretch(s.stretchX,u&&u.width)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,u&&u.height)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new d.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const u of e){if(u[0]<l||u[1]<u[0]||s<u[1])return!1;l=u[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,u=l&&l.width||s.data.width,p=l&&l.height||s.data.height;return!(e[0]<0||u<e[0]||e[1]<0||p<e[1]||e[2]<0||u<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const u=this.getImage(e);if(l&&(u.data.width!==s.data.width||u.data.height!==s.data.height))throw new Error(`size mismatch between old image (${u.data.width}x${u.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=u.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,l)=>{let u=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(u=!1);this.isLoaded()||u?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const l of e){let u=this.getImage(l);u||(this.fire(new d.k("styleimagemissing",{id:l})),u=this.getImage(l)),u?s[l]={data:u.data.clone(),pixelRatio:u.pixelRatio,sdf:u.sdf,version:u.version,stretchX:u.stretchX,stretchY:u.stretchY,content:u.content,textFitWidth:u.textFitWidth,textFitHeight:u.textFitHeight,hasRenderCallback:!!(u.userImage&&u.userImage.render)}:d.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const u={w:l.data.width+2,h:l.data.height+2,x:0,y:0},p=new d.I(u,l);this.patterns[e]={bin:u,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new gt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:s,h:l}=d.p(e),u=this.atlasImage;u.resize({width:s||1,height:l||1});for(const p in this.patterns){const{bin:v}=this.patterns[p],w=v.x+1,T=v.y+1,C=this.getImage(p).data,z=C.width,A=C.height;d.R.copy(C,u,{x:0,y:0},{x:w,y:T},{width:z,height:A}),d.R.copy(C,u,{x:0,y:A-1},{x:w,y:T-1},{width:z,height:1}),d.R.copy(C,u,{x:0,y:0},{x:w,y:T+A},{width:z,height:1}),d.R.copy(C,u,{x:z-1,y:0},{x:w-1,y:T},{width:1,height:A}),d.R.copy(C,u,{x:0,y:0},{x:w+z,y:T},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||d.w(`Image with ID: "${s}" was not found`),fr(l)&&this.updateImage(s,l)}}}const ur=1e20;function wt(f,e,s,l,u,p,v,w,T){for(let C=e;C<e+l;C++)Kr(f,s*p+C,p,u,v,w,T);for(let C=s;C<s+u;C++)Kr(f,C*p+e,1,l,v,w,T)}function Kr(f,e,s,l,u,p,v){p[0]=0,v[0]=-ur,v[1]=ur,u[0]=f[e];for(let w=1,T=0,C=0;w<l;w++){u[w]=f[e+w*s];const z=w*w;do{const A=p[T];C=(u[w]-u[A]+z-A*A)/(w-A)/2}while(C<=v[T]&&--T>-1);T++,p[T]=w,v[T]=C,v[T+1]=ur}for(let w=0,T=0;w<l;w++){for(;v[T+1]<w;)T++;const C=p[T],z=w-C;f[e+w*s]=u[C]+z*z}}class Or{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return d._(this,void 0,void 0,function*(){const s=[];for(const p in e)for(const v of e[p])s.push(this._getAndCacheGlyphsPromise(p,v));const l=yield Promise.all(s),u={};for(const{stack:p,id:v,glyph:w}of l)u[p]||(u[p]={}),u[p][v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics};return u})}_getAndCacheGlyphsPromise(e,s){return d._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let u=l.glyphs[s];if(u!==void 0)return{stack:e,id:s,glyph:u};if(u=this._tinySDF(l,e,s),u)return l.glyphs[s]=u,{stack:e,id:s,glyph:u};const p=Math.floor(s/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[p])return{stack:e,id:s,glyph:u};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[p]){const w=Or.loadGlyphRange(e,p,this.url,this.requestManager);l.requests[p]=w}const v=yield l.requests[p];for(const w in v)this._doesCharSupportLocalGlyph(+w)||(l.glyphs[+w]=v[+w]);return l.ranges[p]=!0,{stack:e,id:s,glyph:v[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))}_tinySDF(e,s,l){const u=this.localIdeographFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),p=e.tinySDF=new Or.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:u,fontWeight:w})}const v=p.draw(String.fromCharCode(l));return{id:l,bitmap:new d.o({width:v.width||60,height:v.height||60},v.data),metrics:{width:v.glyphWidth/2||24,height:v.glyphHeight/2||24,left:v.glyphLeft/2+.5||0,top:v.glyphTop/2-27.5||-8,advance:v.glyphAdvance/2||24,isDoubleResolution:!0}}}}Or.loadGlyphRange=function(f,e,s,l){return d._(this,void 0,void 0,function*(){const u=256*e,p=u+255,v=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${u}-${p}`),"Glyphs"),w=yield d.l(v,new AbortController);if(!w||!w.data)throw new Error(`Could not load glyph range. range: ${e}, ${u}-${p}`);const T={};for(const C of d.n(w.data))T[C.id]=C;return T})},Or.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:v="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const w=this.size=f+4*e,T=this._createCanvas(w),C=this.ctx=T.getContext("2d",{willReadFrequently:!0});C.font=`${v} ${p} ${f}px ${u}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(f),v=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),T=Math.min(this.size-this.buffer,v+Math.ceil(l)),C=w+2*this.buffer,z=T+2*this.buffer,A=Math.max(C*z,0),F=new Uint8ClampedArray(A),j={data:F,width:C,height:z,glyphWidth:w,glyphHeight:T,glyphTop:v,glyphLeft:0,glyphAdvance:e};if(w===0||T===0)return j;const{ctx:V,buffer:q,gridInner:K,gridOuter:J}=this;V.clearRect(q,q,w,T),V.fillText(f,q,q+v);const Q=V.getImageData(q,q,w,T);J.fill(ur,0,A),K.fill(0,0,A);for(let U=0;U<T;U++)for(let ie=0;ie<w;ie++){const ae=Q.data[4*(U*w+ie)+3]/255;if(ae===0)continue;const pe=(U+q)*C+ie+q;if(ae===1)J[pe]=0,K[pe]=ur;else{const xe=.5-ae;J[pe]=xe>0?xe*xe:0,K[pe]=xe<0?xe*xe:0}}wt(J,0,0,C,z,C,this.f,this.v,this.z),wt(K,q,q,w,T,C,this.f,this.v,this.z);for(let U=0;U<A;U++){const ie=Math.sqrt(J[U])-Math.sqrt(K[U]);F[U]=Math.round(255-255*(ie/this.radius+this.cutoff))}return j}};class Xe{constructor(){this.specification=d.v.light.position}possiblyEvaluate(e,s){return d.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:d.y.number(e.x,s.x,l),y:d.y.number(e.y,s.y,l),z:d.y.number(e.z,s.z,l)}}}let ct;class dt extends d.E{constructor(e){super(),ct=ct||new d.q({anchor:new d.D(d.v.light.anchor),position:new Xe,color:new d.D(d.v.light.color),intensity:new d.D(d.v.light.intensity)}),this._transitionable=new d.T(ct),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(d.r,e,s))for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&d.t(this,e.call(d.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v}))}}const Tt=new d.q({"sky-color":new d.D(d.v.sky["sky-color"]),"horizon-color":new d.D(d.v.sky["horizon-color"]),"fog-color":new d.D(d.v.sky["fog-color"]),"fog-ground-blend":new d.D(d.v.sky["fog-ground-blend"]),"horizon-fog-blend":new d.D(d.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new d.D(d.v.sky["sky-horizon-blend"]),"atmosphere-blend":new d.D(d.v.sky["atmosphere-blend"])});class Bt extends d.E{constructor(e){super(),this._transitionable=new d.T(Tt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new d.z(0))}setSky(e,s={}){if(!this._validate(d.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const u=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),u):this._transitionable.setValue(l,u)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return(l==null?void 0:l.validate)!==!1&&d.t(this,e.call(d.u,d.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:d.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class oi{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,v=e[0]*l,w=!0;u.push({left:p,right:v,isDash:w,zeroLength:e[0]===0});let T=e[0];for(let C=1;C<e.length;C++){w=!w;const z=e[C];p=T*l,T+=z,v=T*l,u.push({left:p,right:v,isDash:w,zeroLength:z===0})}return u}addRoundDash(e,s,l){const u=s/2;for(let p=-l;p<=l;p++){const v=this.width*(this.nextRow+l+p);let w=0,T=e[w];for(let C=0;C<this.width;C++){C/T.right>1&&(T=e[++w]);const z=Math.abs(C-T.left),A=Math.abs(C-T.right),F=Math.min(z,A);let j;const V=p/l*(u+1);if(T.isDash){const q=u-Math.abs(V);j=Math.sqrt(F*F+q*q)}else j=u-Math.sqrt(F*F+V*V);this.data[v+C]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e){for(let w=e.length-1;w>=0;--w){const T=e[w],C=e[w+1];T.zeroLength?e.splice(w,1):C&&C.isDash===T.isDash&&(C.left=T.left,e.splice(w,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const u=this.width*this.nextRow;let p=0,v=e[p];for(let w=0;w<this.width;w++){w/v.right>1&&(v=e[++p]);const T=Math.abs(w-v.left),C=Math.abs(w-v.right),z=Math.min(T,C);this.data[u+w]=Math.max(0,Math.min(255,(v.isDash?z:-z)+128))}}addDash(e,s){const l=s?7:0,u=2*l+1;if(this.nextRow+u>this.height)return d.w("LineAtlas out of space"),null;let p=0;for(let w=0;w<e.length;w++)p+=e[w];if(p!==0){const w=this.width/p,T=this.getDashRanges(e,this.width,w);s?this.addRoundDash(T,w,l):this.addRegularDash(T)}const v={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:p};return this.nextRow+=u,this.dirty=!0,v}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Ir="maplibre_preloaded_worker_pool";class Jr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Jr.workerCount;)this.workers.push(new Worker(d.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ir]}numActive(){return Object.keys(this.active).length}}const Nr=Math.floor(ne.hardwareConcurrency/2);let ke,Kt;function fn(){return ke||(ke=new Jr),ke}Jr.workerCount=d.C(globalThis)?Math.max(Math.min(Nr,3),1):1;class An{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let u=0;u<l.length;u++){const p=new d.F(l[u],s);p.name=`Worker ${u}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const u of this.actors)l.push(u.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function us(){return Kt||(Kt=new An(fn(),d.G),Kt.registerMessageHandler("GR",(f,e,s)=>d.m(e,s))),Kt}function Di(f,e){const s=d.H();return d.J(s,s,[1,1,0]),d.K(s,s,[.5*f.width,.5*f.height,1]),d.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function Ct(f,e,s,l,u,p){const v=function(A,F,j){if(A)for(const V of A){const q=F[V];if(q&&q.source===j&&q.type==="fill-extrusion")return!0}else for(const V in F){const q=F[V];if(q.source===j&&q.type==="fill-extrusion")return!0}return!1}(u&&u.layers,e,f.id),w=p.maxPitchScaleFactor(),T=f.tilesIn(l,w,v);T.sort(Gn);const C=[];for(const A of T)C.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(e,s,f._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,u,p,w,Di(f.transform,A.tileID))});const z=function(A){const F={},j={};for(const V of A){const q=V.queryResults,K=V.wrappedTileID,J=j[K]=j[K]||{};for(const Q in q){const U=q[Q],ie=J[Q]=J[Q]||{},ae=F[Q]=F[Q]||[];for(const pe of U)ie[pe.featureIndex]||(ie[pe.featureIndex]=!0,ae.push(pe))}}return F}(C);for(const A in z)z[A].forEach(F=>{const j=F.feature,V=f.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=V});return z}function Gn(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function Vs(f,e,s){return d._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield d.h(e.transformRequest(f.url,"Source"),s)).data:yield ne.frameAsync(s),!l)return null;const u=d.M(d.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(u.vectorLayerIds=l.vector_layers.map(p=>p.id)),u})}class me{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof d.N?new d.N(e.lng,e.lat):d.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let u,p;if(e instanceof d.N)u=e,p=e;else{if(!(e instanceof me))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(me.convert(e)):this.extend(d.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(d.N.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return s||l?(s.lng=Math.min(u.lng,s.lng),s.lat=Math.min(u.lat,s.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new d.N(u.lng,u.lat),this._ne=new d.N(p.lng,p.lat)),this}getCenter(){return new d.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new d.N(this.getWest(),this.getNorth())}getSouthEast(){return new d.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=d.N.convert(e);let u=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return e instanceof me?e:e&&new me(e)}static fromLngLat(e,s=0){const l=360*s/40075017,u=l/Math.cos(Math.PI/180*e.lat);return new me(new d.N(e.lng-u,e.lat-l),new d.N(e.lng+u,e.lat+l))}adjustAntiMeridian(){const e=new d.N(this._sw.lng,this._sw.lat),s=new d.N(this._ne.lng,this._ne.lat);return new me(e,e.lng>s.lng?new d.N(s.lng+360,s.lat):s)}}class cs{constructor(e,s,l){this.bounds=me.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(d.O(this.bounds.getWest())*s),u=Math.floor(d.Q(this.bounds.getNorth())*s),p=Math.ceil(d.O(this.bounds.getEast())*s),v=Math.ceil(d.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<p&&e.y>=u&&e.y<v}}class Ua extends d.E{constructor(e,s,l,u){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.e(this,d.M(s,["url","scheme","tileSize","promoteId"])),this._options=d.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u)}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Vs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(d.e(this,e),e.bounds&&(this.tileBounds=new cs(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return d.e({},this._options)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let u="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((p,v)=>{e.reloadPromise={resolve:p,reject:v}})}else e.actor=this.dispatcher.getActor(),u="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:u,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Rt extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.e({type:"raster"},s),d.e(this,d.M(s,["url","scheme","tileSize"]))}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Vs(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(d.e(this,e),e.bounds&&(this.tileBounds=new cs(e.bounds,this.minzoom,this.maxzoom)),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new d.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return d.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield de.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const u=this.map.painter.context,p=u.gl,v=l.data;e.texture=this.map.painter.getTileTexture(v.width),e.texture?e.texture.update(v,{useMipmap:!0}):(e.texture=new gt(u,v,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class nr extends Rt{constructor(e,s,l,u){super(e,s,l,u),this.type="raster-dem",this.maxzoom=22,this._options=d.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const u=yield de.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(u&&u.data){const p=u.data;this.map._refreshExpiredTiles&&u.cacheControl&&u.expires&&e.setExpiryData({cacheControl:u.cacheControl,expires:u.expires});const v=d.b(p)&&d.U()?p:yield this.readImageNow(p),w={type:this.type,uid:e.uid,source:this.id,rawImageData:v,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:w});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(u){if(delete e.abortController,e.aborted)e.state="unloaded";else if(u)throw e.state="errored",u}})}readImageNow(e){return d._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&d.V()){const s=e.width+2,l=e.height+2;try{return new d.R({width:s,height:l},yield d.W(e,-1,-1,s,l))}catch{}}return ne.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),u=(s.x-1+l)%l,p=s.x===0?e.wrap-1:e.wrap,v=(s.x+1+l)%l,w=s.x+1===l?e.wrap+1:e.wrap,T={};return T[new d.S(e.overscaledZ,p,s.z,u,s.y).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y).key]={backfilled:!1},s.y>0&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y-1).key]={backfilled:!1}),s.y+1<l&&(T[new d.S(e.overscaledZ,p,s.z,u,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},T[new d.S(e.overscaledZ,w,s.z,v,s.y+1).key]={backfilled:!1}),T}unloadTile(e){return d._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class $a extends d.E{constructor(e,s,l,u){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(u),this._data=s.data,this._options=d.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const p=d.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&d.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=d.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*p,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*p,extent:d.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:d.X,radius:(s.clusterRadius||50)*p,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return d._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return d._(this,void 0,void 0,function*(){const e=d.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return d._(this,void 0,void 0,function*(){const s=d.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(ne.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new d.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new d.k("dataabort",{dataType:"source"}));let u=null;l.resourceTiming&&l.resourceTiming[this.id]&&(u=l.resourceTiming[this.id].slice(0));const p={dataType:"source"};this._collectResourceTiming&&u&&u.length>0&&d.e(p,{resourceTiming:u}),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"metadata"}))),this.fire(new d.k("data",Object.assign(Object.assign({},p),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new d.k("dataabort",{dataType:"source"}));this.fire(new d.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return d._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const u=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(u,this.map.painter,s==="RT")})}abortTile(e){return d._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return d._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return d.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Hn=d.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Mn extends d.E{constructor(e,s,l,u){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=s}load(e){return d._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new d.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield de.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new d.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(d.Z.fromLngLat);this.tileID=function(u){let p=1/0,v=1/0,w=-1/0,T=-1/0;for(const F of u)p=Math.min(p,F.x),v=Math.min(v,F.y),w=Math.max(w,F.x),T=Math.max(T,F.y);const C=Math.max(w-p,T-v),z=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),A=Math.pow(2,z);return new d.a1(z,Math.floor((p+w)/2*A),Math.floor((v+T)/2*A))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(u=>this.tileID.getTilePoint(u)._round());return this._boundsArray=new d.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,d.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,d.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,d.X,d.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Hn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new gt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return d._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Us extends Mn{constructor(e,s,l,u){super(e,s,l,u),this.roundZoom=!0,this.type="video",this.options=s}load(){return d._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield d.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new d.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new d.j(new d.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,Hn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new gt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const u in this.tiles){const p=this.tiles[u];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,l=!0)}l&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Li extends Mn{constructor(e,s,l,u){super(e,s,l,u),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(v=>typeof v!="number"))||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new d.j(new d.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new d.j(new d.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.j(new d.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return d._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Hn.members)),this.boundsSegments||(this.boundsSegments=d.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new gt(s,this.canvas,l.RGBA,{premultiply:!0});let u=!1;for(const p in this.tiles){const v=this.tiles[p];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,u=!0)}u&&this.fire(new d.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Za={},qa=f=>{switch(f){case"geojson":return $a;case"image":return Mn;case"raster":return Rt;case"raster-dem":return nr;case"vector":return Ua;case"video":return Us;case"canvas":return Li}return Za[f]},Ie="RTLPluginLoaded";class mn extends d.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=us()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return d._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ne.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return d._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new d.k(Ie))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Yr=null;function gn(){return Yr||(Yr=new mn),Yr}class Wn{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=d.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const v={};if(!p)return v;for(const w of u){const T=w.layerIds.map(C=>p.getLayer(C)).filter(Boolean);if(T.length!==0){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(C=>T.filter(z=>z.id===C)[0]));for(const C of T)v[C.id]=w}}return v}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof d.a6&&p.hasRTLText){this.hasRTLText=!0,gn().lazyLoad();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new d.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,u,p,v,w,T,C,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:u,cameraQueryGeometry:p,scale:v,tileSize:this.tileSize,pixelPosMatrix:z,transform:T,params:w,queryPadding:this.queryPadding*C},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=s&&s.sourceLayer?s.sourceLayer:"",v=u._geojsonTileLayer||u[p];if(!v)return;const w=d.a7(s&&s.filter),{z:T,x:C,y:z}=this.tileID.canonical,A={z:T,x:C,y:z};for(let F=0;F<v.length;F++){const j=v.feature(F);if(w.needGeometry){const K=d.a8(j,!0);if(!w.filter(new d.z(this.tileID.overscaledZ),K,this.tileID.canonical))continue}else if(!w.filter(new d.z(this.tileID.overscaledZ),j))continue;const V=l.getId(j,p),q=new d.a9(j,T,C,z,V);q.tile=A,e.push(q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=d.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(s)if(this.expirationTime<s)u=!0;else{const p=this.expirationTime-s;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const u in this.buckets){if(!s.style.hasLayer(u))continue;const p=this.buckets[u],v=p.layers[0].sourceLayer||"_geojsonTileLayer",w=l[v],T=e[v];if(!w||!T||Object.keys(T).length===0)continue;p.update(T,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const C=s&&s.style&&s.style.getLayer(u);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ne.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ne.now()+e}setDependencies(e,s){const l={};for(const u of s)l[u]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const u=this.dependencies[l];if(u){for(const p of s)if(u[p])return!0}}return!1}}class Me{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:s,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,u=s===void 0?0:this.data[l].indexOf(s),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||s.push(u);for(const l of s)this.remove(l.value.tileID,l)}}class _t{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const u=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},d.e(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const u=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),u=d.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][s];if(p===null)return{};for(const v in p)delete u[v]}return u}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const v in this.stateChanges[u])this.state[u][v]||(this.state[u][v]={}),d.e(this.state[u][v],this.stateChanges[u][v]),p[v]=this.state[u][v];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const v in this.state[u])p[v]={},this.state[u][v]={};else for(const v in this.deletedStates[u]){if(this.deletedStates[u][v]===null)this.state[u][v]={};else for(const w of Object.keys(this.deletedStates[u][v]))delete this.state[u][v][w];p[v]=this.state[u][v]}l[u]=l[u]||{},d.e(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,s)}}class ot extends d.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",u=>this._dataHandler(u)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((u,p,v,w)=>{const T=new(qa(p.type))(u,p,v,w);if(T.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${T.id}`);return T})(e,s,l,this),this._tiles={},this._cache=new Me(0,u=>this._unloadTile(u)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _t,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return d._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(u){e.state="errored",u.status!==404?this._source.fire(new d.j(u,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new d.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(li).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,u)=>{const p=l.tileID,v=u.tileID,w=new d.P(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new d.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-v.overscaledZ||T.y-w.y||T.x-w.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(li).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return d._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))})}_tileLoaded(e,s,l){e.timeAdded=ne.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new d.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let u=0;u<s.length;u++){const p=s[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const v=this.getTileByID(p);l(e,v),l(v,e)}}function l(u,p){u.needsHillshadePrepare=!0,u.needsTerrainPrepare=!0;let v=p.tileID.canonical.x-u.tileID.canonical.x;const w=p.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),C=p.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+T)===1?v+=T:Math.abs(v-T)===1&&(v-=T)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,v,w),u.neighboringTiles&&u.neighboringTiles[C]&&(u.neighboringTiles[C].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,u){for(const p in this._tiles){let v=this._tiles[p];if(u[p]||!v.hasData()||v.tileID.overscaledZ<=s||v.tileID.overscaledZ>l)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>s+1;){const C=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[C.key],v&&v.hasData()&&(w=C)}let T=w;for(;T.overscaledZ>s;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){u[w.key]=w;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,u=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?d.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+s),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(u,this._tiles[u])}}_updateCoveredAndRetainedTiles(e,s,l,u,p,v){const w={},T={},C=Object.keys(e),z=ne.now();for(const A of C){const F=e[A],j=this._tiles[A];if(!j||j.fadeEndTime!==0&&j.fadeEndTime<=z)continue;const V=this.findLoadedParent(F,s),q=this.findLoadedSibling(F),K=V||q||null;K&&(this._addTile(K.tileID),w[K.tileID.key]=K.tileID),T[A]=F}this._retainLoadedChildren(T,u,l,e);for(const A in w)e[A]||(this._coveredTiles[A]=!0,e[A]=w[A]);if(v){const A={},F={};for(const j of p)this._tiles[j.key].hasData()?A[j.key]=j:F[j.key]=j;for(const j in F){const V=F[j].children(this._source.maxzoom);this._tiles[V[0].key]&&this._tiles[V[1].key]&&this._tiles[V[2].key]&&this._tiles[V[3].key]&&(A[V[0].key]=e[V[0].key]=V[0],A[V[1].key]=e[V[1].key]=V[1],A[V[2].key]=e[V[2].key]=V[2],A[V[3].key]=e[V[3].key]=V[3],delete F[j])}for(const j in F){const V=F[j],q=this.findLoadedParent(V,this._source.minzoom),K=this.findLoadedSibling(V),J=q||K||null;if(J){A[J.tileID.key]=e[J.tileID.key]=J.tileID;for(const Q in A)A[Q].isChildOf(J.tileID)&&delete A[Q]}}for(const j in this._tiles)A[j]||(this._coveredTiles[j]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new d.S(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(z=>this._source.hasTile(z)))):l=[];const u=e.coveringZoomLevel(this._source),p=Math.max(u-ot.maxOverzooming,this._source.minzoom),v=Math.max(u+ot.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const A of l)if(A.canonical.z>this._source.minzoom){const F=A.scaledTo(A.canonical.z-1);z[F.key]=F;const j=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));z[j.key]=j}l=l.concat(Object.values(z))}const w=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new d.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,u);Wi(this._source.type)&&this._updateCoveredAndRetainedTiles(T,p,v,u,l,s);for(const z in T)this._tiles[z].clearFadeHold();const C=d.ab(this._tiles,T);for(const z of C){const A=this._tiles[z];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const u={},p={},v=Math.max(s-ot.maxOverzooming,this._source.minzoom),w=Math.max(s+ot.maxUnderzooming,this._source.minzoom),T={};for(const C of e){const z=this._addTile(C);u[C.key]=C,z.hasData()||s<this._source.maxzoom&&(T[C.key]=C)}this._retainLoadedChildren(T,s,w,u);for(const C of e){let z=this._tiles[C.key];if(z.hasData())continue;if(s+1>this._source.maxzoom){const F=C.children(this._source.maxzoom)[0],j=this.getTile(F);if(j&&j.hasData()){u[F.key]=F;continue}}else{const F=C.children(this._source.maxzoom);if(u[F[0].key]&&u[F[1].key]&&u[F[2].key]&&u[F[3].key])continue}let A=z.wasRequested();for(let F=C.overscaledZ-1;F>=v;--F){const j=C.scaledTo(F);if(p[j.key])break;if(p[j.key]=!0,z=this.getTile(j),!z&&A&&(z=this._addTile(j)),z){const V=z.hasData();if((V||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||A)&&(u[j.key]=j),A=z.wasRequested(),V)break}}}return u}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}s.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of s)this._loadedParentTiles[p]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new Wn(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new d.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const u=[],p=this.transform;if(!p)return u;const v=l?p.getCameraQueryGeometry(e):e,w=e.map(V=>p.pointCoordinate(V,this.terrain)),T=v.map(V=>p.pointCoordinate(V,this.terrain)),C=this.getIds();let z=1/0,A=1/0,F=-1/0,j=-1/0;for(const V of T)z=Math.min(z,V.x),A=Math.min(A,V.y),F=Math.max(F,V.x),j=Math.max(j,V.y);for(let V=0;V<C.length;V++){const q=this._tiles[C[V]];if(q.holdingForFade())continue;const K=q.tileID,J=Math.pow(2,p.zoom-q.tileID.overscaledZ),Q=s*q.queryPadding*d.X/q.tileSize/J,U=[K.getTilePoint(new d.Z(z,A)),K.getTilePoint(new d.Z(F,j))];if(U[0].x-Q<d.X&&U[0].y-Q<d.X&&U[1].x+Q>=0&&U[1].y+Q>=0){const ie=w.map(pe=>K.getTilePoint(pe)),ae=T.map(pe=>K.getTilePoint(pe));u.push({tile:q,tileID:K,queryGeometry:ie,cameraQueryGeometry:ae,scale:J})}}return u}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Wi(this._source.type)){const e=ne.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const u=this._tiles[e];u&&u.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function li(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Wi(f){return f==="raster"||f==="image"||f==="video"}ot.maxOverzooming=10,ot.maxUnderzooming=3;class ft{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=d.ac(e,0,1);let s=1,l=this._distances[s];const u=e*this.paddedLength+this.padding;for(;l<u&&s<this._distances.length;)l=this._distances[++s];const p=s-1,v=this._distances[p],w=l-v,T=w>0?(u-v)/w:0;return this.points[p].mult(1-T).add(this.points[s].mult(T))}}function yn(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class Dn{constructor(e,s,l){const u=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let v=0;v<this.xCellCount*this.yCellCount;v++)u.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,u,p){this._forEachCell(s,l,u,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(u),this.bboxes.push(p)}insertCircle(e,s,l,u){this._forEachCell(s-u,l-u,s+u,l+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(u)}_insertBoxCell(e,s,l,u,p,v){this.boxCells[p].push(v)}_insertCircleCell(e,s,l,u,p,v){this.circleCells[p].push(v)}_query(e,s,l,u,p,v,w){if(l<0||e>this.width||u<0||s>this.height)return[];const T=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=u){if(p)return[{key:null,x1:e,y1:s,x2:l,y2:u}];for(let C=0;C<this.boxKeys.length;C++)T.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],A=this.circles[3*C+1],F=this.circles[3*C+2];T.push({key:this.circleKeys[C],x1:z-F,y1:A-F,x2:z+F,y2:A+F})}}else this._forEachCell(e,s,l,u,this._queryCell,T,{hitTest:p,overlapMode:v,seenUids:{box:{},circle:{}}},w);return T}query(e,s,l,u){return this._query(e,s,l,u,!1,null)}hitTest(e,s,l,u,p,v){return this._query(e,s,l,u,!0,p,v).length>0}hitTestCircle(e,s,l,u,p){const v=e-l,w=e+l,T=s-l,C=s+l;if(w<0||v>this.width||C<0||T>this.height)return!1;const z=[];return this._forEachCell(v,T,w,C,this._queryCellCircle,z,{hitTest:!0,overlapMode:u,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},p),z.length>0}_queryCell(e,s,l,u,p,v,w,T){const{seenUids:C,hitTest:z,overlapMode:A}=w,F=this.boxCells[p];if(F!==null){const V=this.bboxes;for(const q of F)if(!C.box[q]){C.box[q]=!0;const K=4*q,J=this.boxKeys[q];if(e<=V[K+2]&&s<=V[K+3]&&l>=V[K+0]&&u>=V[K+1]&&(!T||T(J))&&(!z||!yn(A,J.overlapMode))&&(v.push({key:J,x1:V[K],y1:V[K+1],x2:V[K+2],y2:V[K+3]}),z))return!0}}const j=this.circleCells[p];if(j!==null){const V=this.circles;for(const q of j)if(!C.circle[q]){C.circle[q]=!0;const K=3*q,J=this.circleKeys[q];if(this._circleAndRectCollide(V[K],V[K+1],V[K+2],e,s,l,u)&&(!T||T(J))&&(!z||!yn(A,J.overlapMode))){const Q=V[K],U=V[K+1],ie=V[K+2];if(v.push({key:J,x1:Q-ie,y1:U-ie,x2:Q+ie,y2:U+ie}),z)return!0}}}return!1}_queryCellCircle(e,s,l,u,p,v,w,T){const{circle:C,seenUids:z,overlapMode:A}=w,F=this.boxCells[p];if(F!==null){const V=this.bboxes;for(const q of F)if(!z.box[q]){z.box[q]=!0;const K=4*q,J=this.boxKeys[q];if(this._circleAndRectCollide(C.x,C.y,C.radius,V[K+0],V[K+1],V[K+2],V[K+3])&&(!T||T(J))&&!yn(A,J.overlapMode))return v.push(!0),!0}}const j=this.circleCells[p];if(j!==null){const V=this.circles;for(const q of j)if(!z.circle[q]){z.circle[q]=!0;const K=3*q,J=this.circleKeys[q];if(this._circlesCollide(V[K],V[K+1],V[K+2],C.x,C.y,C.radius)&&(!T||T(J))&&!yn(A,J.overlapMode))return v.push(!0),!0}}}_forEachCell(e,s,l,u,p,v,w,T){const C=this._convertToXCellCoord(e),z=this._convertToYCellCoord(s),A=this._convertToXCellCoord(l),F=this._convertToYCellCoord(u);for(let j=C;j<=A;j++)for(let V=z;V<=F;V++)if(p.call(this,e,s,l,u,this.xCellCount*V+j,v,w,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,u,p,v){const w=u-e,T=p-s,C=l+v;return C*C>w*w+T*T}_circleAndRectCollide(e,s,l,u,p,v,w){const T=(v-u)/2,C=Math.abs(e-(u+T));if(C>T+l)return!1;const z=(w-p)/2,A=Math.abs(s-(p+z));if(A>z+l)return!1;if(C<=T||A<=z)return!0;const F=C-T,j=A-z;return F*F+j*j<=l*l}}function Xn(f,e,s,l,u){const p=d.H();return e?(d.K(p,p,[1/u,1/u,1]),s||d.ad(p,p,l.angle)):d.L(p,l.labelPlaneMatrix,f),p}function _n(f,e,s,l,u){if(e){const p=d.ae(f);return d.K(p,p,[u,u,1]),s||d.ad(p,p,-l.angle),p}return l.glCoordMatrix}function W(f,e,s,l){let u;l?(u=[f,e,l(f,e),1],d.af(u,u,s)):(u=[f,e,0,1],Pt(u,u,s));const p=u[3];return{point:new d.P(u[0]/p,u[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function L(f,e){return .5+f/e*.5}function D(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function N(f,e,s,l,u,p,v,w,T,C,z,A,F,j,V){const q=l?f.textSizeData:f.iconSizeData,K=d.ag(q,s.transform.zoom),J=[256/s.width*2+1,256/s.height*2+1],Q=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;Q.clear();const U=f.lineVertexArray,ie=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,ae=s.transform.width/s.transform.height;let pe=!1;for(let xe=0;xe<ie.length;xe++){const Ee=ie.get(xe);if(Ee.hidden||Ee.writingMode===d.ah.vertical&&!pe){nt(Ee.numGlyphs,Q);continue}pe=!1;const Be=W(Ee.anchorX,Ee.anchorY,e,V);if(!D(Be.point,J)){nt(Ee.numGlyphs,Q);continue}const $e=L(s.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),Ae=d.ai(q,K,Ee),ze=v?Ae/$e:Ae*$e,Je={getElevation:V,labelPlaneMatrix:u,lineVertexArray:U,pitchWithMap:v,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:C,tileAnchorPoint:new d.P(Ee.anchorX,Ee.anchorY),unwrappedTileID:z,width:A,height:F,translation:j},ht=se(Je,Ee,ze,!1,w,e,p,f.glyphOffsetArray,Q,ae,T);pe=ht.useVertical,(ht.notEnoughRoom||pe||ht.needsFlipping&&se(Je,Ee,ze,!0,w,e,p,f.glyphOffsetArray,Q,ae,T).notEnoughRoom)&&nt(Ee.numGlyphs,Q)}l?f.text.dynamicLayoutVertexBuffer.updateData(Q):f.icon.dynamicLayoutVertexBuffer.updateData(Q)}function Z(f,e,s,l,u,p,v,w){const T=p.glyphStartIndex+p.numGlyphs,C=p.lineStartIndex,z=p.lineStartIndex+p.lineLength,A=e.getoffsetX(p.glyphStartIndex),F=e.getoffsetX(T-1),j=Pe(f*A,s,l,u,p.segment,C,z,w,v);if(!j)return null;const V=Pe(f*F,s,l,u,p.segment,C,z,w,v);return V?w.projectionCache.anyProjectionOccluded?null:{first:j,last:V}:null}function te(f,e,s,l){return f===d.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===d.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function se(f,e,s,l,u,p,v,w,T,C,z){const A=s/24,F=e.lineOffsetX*A,j=e.lineOffsetY*A;let V;if(e.numGlyphs>1){const q=e.glyphStartIndex+e.numGlyphs,K=e.lineStartIndex,J=e.lineStartIndex+e.lineLength,Q=Z(A,w,F,j,l,e,z,f);if(!Q)return{notEnoughRoom:!0};const U=W(Q.first.point.x,Q.first.point.y,v,f.getElevation).point,ie=W(Q.last.point.x,Q.last.point.y,v,f.getElevation).point;if(u&&!l){const ae=te(e.writingMode,U,ie,C);if(ae)return ae}V=[Q.first];for(let ae=e.glyphStartIndex+1;ae<q-1;ae++)V.push(Pe(A*w.getoffsetX(ae),F,j,l,e.segment,K,J,f,z));V.push(Q.last)}else{if(u&&!l){const K=W(f.tileAnchorPoint.x,f.tileAnchorPoint.y,p,f.getElevation).point,J=e.lineStartIndex+e.segment+1,Q=new d.P(f.lineVertexArray.getx(J),f.lineVertexArray.gety(J)),U=W(Q.x,Q.y,p,f.getElevation),ie=U.signedDistanceFromCamera>0?U.point:function(pe,xe,Ee,Be,$e,Ae){return ce(pe,xe,Ee,1,$e,Ae)}(f.tileAnchorPoint,Q,K,0,p,f),ae=te(e.writingMode,K,ie,C);if(ae)return ae}const q=Pe(A*w.getoffsetX(e.glyphStartIndex),F,j,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,z);if(!q||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};V=[q]}for(const q of V)d.aj(T,q.point,q.angle);return{}}function ce(f,e,s,l,u,p){const v=f.add(f.sub(e)._unit()),w=u!==void 0?W(v.x,v.y,u,p.getElevation).point:ye(v.x,v.y,p).point,T=s.sub(w);return s.add(T._mult(l/T.mag()))}function Y(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const u=new d.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),p=ye(u.x,u.y,e);if(p.signedDistanceFromCamera>0)return l.projections[f]=p.point,l.anyProjectionOccluded=l.anyProjectionOccluded||p.isOccluded,p.point;const v=f-s.direction;return function(w,T,C,z,A){return ce(w,T,C,z,void 0,A)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new d.P(e.lineVertexArray.getx(v),e.lineVertexArray.gety(v)),u,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function ye(f,e,s){const l=f+s.translation[0],u=e+s.translation[1];let p;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(p=s.projection.projectTileCoordinates(l,u,s.unwrappedTileID,s.getElevation),p.point.x=(.5*p.point.x+.5)*s.width,p.point.y=(.5*-p.point.y+.5)*s.height):(p=W(l,u,s.labelPlaneMatrix,s.getElevation),p.isOccluded=!1),p}function be(f,e,s){return f._unit()._perp()._mult(e*s)}function fe(f,e,s,l,u,p,v,w,T){if(w.projectionCache.offsets[f])return w.projectionCache.offsets[f];const C=s.add(e);if(f+T.direction<l||f+T.direction>=u)return w.projectionCache.offsets[f]=C,C;const z=Y(f+T.direction,w,T),A=be(z.sub(s),v,T.direction),F=s.add(A),j=z.add(A);return w.projectionCache.offsets[f]=d.ak(p,C,F,j)||C,w.projectionCache.offsets[f]}function Pe(f,e,s,l,u,p,v,w,T){const C=l?f-e:f+e;let z=C>0?1:-1,A=0;l&&(z*=-1,A=Math.PI),z<0&&(A+=Math.PI);let F,j=z>0?p+u:p+u+1;w.projectionCache.cachedAnchorPoint?F=w.projectionCache.cachedAnchorPoint:(F=ye(w.tileAnchorPoint.x,w.tileAnchorPoint.y,w).point,w.projectionCache.cachedAnchorPoint=F);let V,q,K=F,J=F,Q=0,U=0;const ie=Math.abs(C),ae=[];let pe;for(;Q+U<=ie;){if(j+=z,j<p||j>=v)return null;Q+=U,J=K,q=V;const Be={absOffsetX:ie,direction:z,distanceFromAnchor:Q,previousVertex:J};if(K=Y(j,w,Be),s===0)ae.push(J),pe=K.sub(J);else{let $e;const Ae=K.sub(J);$e=Ae.mag()===0?be(Y(j+z,w,Be).sub(K),s,z):be(Ae,s,z),q||(q=J.add($e)),V=fe(j,$e,K,p,v,q,s,w,Be),ae.push(q),pe=V.sub(q)}U=pe.mag()}const xe=pe._mult((ie-Q)/U)._add(q||J),Ee=A+Math.atan2(K.y-J.y,K.x-J.x);return ae.push(xe),{point:xe,angle:T?Ee:0,path:ae}}const tt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(tt,3*l)}}function Pt(f,e,s){const l=e[0],u=e[1];return f[0]=s[0]*l+s[4]*u+s[12],f[1]=s[1]*l+s[5]*u+s[13],f[3]=s[3]*l+s[7]*u+s[15],f}const mt=100;class zt{constructor(e,s,l=new Dn(e.width+200,e.height+200,25),u=new Dn(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=u,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+mt,this.screenBottomBoundary=e.height+mt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,u,p,v,w,T,C,z,A){const F=e.anchorPointX+T[0],j=e.anchorPointY+T[1],V=this.projectAndGetPerspectiveRatio(u,F,j,p,z),q=l*V.perspectiveRatio;let K;if(v||w)K=this._projectCollisionBox(e,q,u,p,v,w,T,V,z,A);else{const ae=V.point.x+(A?A.x*q:0),pe=V.point.y+(A?A.y*q:0);K={allPointsOccluded:!1,box:[ae+e.x1*q,pe+e.y1*q,ae+e.x2*q,pe+e.y2*q]}}const[J,Q,U,ie]=K.box;return this.mapProjection.useSpecialProjectionForSymbols&&(v?K.allPointsOccluded:this.mapProjection.isOccluded(F,j,p))||V.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(J,Q,U,ie)||s!=="always"&&this.grid.hitTest(J,Q,U,ie,s,C)?{box:[J,Q,U,ie],placeable:!1,offscreen:!1}:{box:[J,Q,U,ie],placeable:!0,offscreen:this.isOffscreen(J,Q,U,ie)}}placeCollisionCircles(e,s,l,u,p,v,w,T,C,z,A,F,j,V,q,K){const J=[],Q=new d.P(s.anchorX,s.anchorY),U=this.getPerspectiveRatio(v,Q.x,Q.y,w,K),ie=(A?p/U:p*U)/d.ap,ae={getElevation:K,labelPlaneMatrix:T,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Q,unwrappedTileID:w,width:this.transform.width,height:this.transform.height,translation:q},pe=Z(ie,u,s.lineOffsetX*ie,s.lineOffsetY*ie,!1,s,!1,ae);let xe=!1,Ee=!1,Be=!0;if(pe){const $e=.5*j*U+V,Ae=new d.P(-100,-100),ze=new d.P(this.screenRightBoundary,this.screenBottomBoundary),Je=new ft,ht=pe.first,De=pe.last;let je=[];for(let yt=ht.path.length-1;yt>=1;yt--)je.push(ht.path[yt]);for(let yt=1;yt<De.path.length;yt++)je.push(De.path[yt]);const lt=2.5*$e;if(C){const yt=this.projectPathToScreenSpace(je,ae,C);je=yt.some(St=>St.signedDistanceFromCamera<=0)?[]:yt.map(St=>St.point)}let Yt=[];if(je.length>0){const yt=je[0].clone(),St=je[0].clone();for(let Qt=1;Qt<je.length;Qt++)yt.x=Math.min(yt.x,je[Qt].x),yt.y=Math.min(yt.y,je[Qt].y),St.x=Math.max(St.x,je[Qt].x),St.y=Math.max(St.y,je[Qt].y);Yt=yt.x>=Ae.x&&St.x<=ze.x&&yt.y>=Ae.y&&St.y<=ze.y?[je]:St.x<Ae.x||yt.x>ze.x||St.y<Ae.y||yt.y>ze.y?[]:d.al([je],Ae.x,Ae.y,ze.x,ze.y)}for(const yt of Yt){Je.reset(yt,.25*$e);let St=0;St=Je.length<=.5*$e?1:Math.ceil(Je.paddedLength/lt)+1;for(let Qt=0;Qt<St;Qt++){const Vr=Qt/Math.max(St-1,1),en=Je.lerp(Vr),er=en.x+mt,hi=en.y+mt;J.push(er,hi,$e,0);const ei=er-$e,Ur=hi-$e,ti=er+$e,bn=hi+$e;if(Be=Be&&this.isOffscreen(ei,Ur,ti,bn),Ee=Ee||this.isInsideGrid(ei,Ur,ti,bn),e!=="always"&&this.grid.hitTestCircle(er,hi,$e,e,F)&&(xe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:xe}}}}return{circles:!z&&xe||!Ee||U<this.perspectiveRatioCutoff?[]:J,offscreen:Be,collisionDetected:xe}}projectPathToScreenSpace(e,s,l){return e.map(u=>W(u.x,u.y,l,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,u=1/0,p=-1/0,v=-1/0;for(const z of e){const A=new d.P(z.x+mt,z.y+mt);l=Math.min(l,A.x),u=Math.min(u,A.y),p=Math.max(p,A.x),v=Math.max(v,A.y),s.push(A)}const w=this.grid.query(l,u,p,v).concat(this.ignoredGrid.query(l,u,p,v)),T={},C={};for(const z of w){const A=z.key;if(T[A.bucketInstanceId]===void 0&&(T[A.bucketInstanceId]={}),T[A.bucketInstanceId][A.featureIndex])continue;const F=[new d.P(z.x1,z.y1),new d.P(z.x2,z.y1),new d.P(z.x2,z.y2),new d.P(z.x1,z.y2)];d.am(s,F)&&(T[A.bucketInstanceId][A.featureIndex]=!0,C[A.bucketInstanceId]===void 0&&(C[A.bucketInstanceId]=[]),C[A.bucketInstanceId].push(A.featureIndex))}return C}insertCollisionBox(e,s,l,u,p,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,u,p,v){const w=l?this.ignoredGrid:this.grid,T={bucketInstanceId:u,featureIndex:p,collisionGroupID:v,overlapMode:s};for(let C=0;C<e.length;C+=4)w.insertCircle(T,e[C],e[C+1],e[C+2])}projectAndGetPerspectiveRatio(e,s,l,u,p){let v;p?(v=[s,l,p(s,l),1],d.af(v,v,e)):(v=[s,l,0,1],Pt(v,v,e));const w=v[3];return{point:new d.P((v[0]/w+1)/2*this.transform.width+mt,(-v[1]/w+1)/2*this.transform.height+mt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/w*.5,isOccluded:!1,signedDistanceFromCamera:w}}getPerspectiveRatio(e,s,l,u,p){const v=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,u,p):W(s,l,e,p);return .5+this.transform.cameraToCenterDistance/v.signedDistanceFromCamera*.5}isOffscreen(e,s,l,u){return l<mt||e>=this.screenRightBoundary||u<mt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,u){return l>=0&&e<this.gridRightBoundary&&u>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=d.an([]);return d.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,u,p,v,w,T,C,z){let A=new d.P(1,0),F=new d.P(0,1);const j=new d.P(e.anchorPointX+w[0],e.anchorPointY+w[1]);if(v&&!p){const Be=this.projectAndGetPerspectiveRatio(l,j.x+1,j.y,u,C).point.sub(T.point).unit(),$e=Math.atan(Be.y/Be.x)+(Be.x<0?Math.PI:0),Ae=Math.sin($e),ze=Math.cos($e);A=new d.P(ze,Ae),F=new d.P(-Ae,ze)}else if(!v&&p){const Be=-this.transform.angle,$e=Math.sin(Be),Ae=Math.cos(Be);A=new d.P(Ae,$e),F=new d.P(-$e,Ae)}let V=T.point,q=s;if(p){V=j;const Be=this.transform.zoom-Math.floor(this.transform.zoom);q=Math.pow(2,-Be),q*=this.mapProjection.getPitchedTextCorrection(this.transform,j,u),z||(q*=d.ac(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}z&&(V=V.add(A.mult(z.x*q)).add(F.mult(z.y*q)));const K=e.x1*q,J=e.x2*q,Q=(K+J)/2,U=e.y1*q,ie=e.y2*q,ae=(U+ie)/2,pe=[{offsetX:K,offsetY:U},{offsetX:Q,offsetY:U},{offsetX:J,offsetY:U},{offsetX:J,offsetY:ae},{offsetX:J,offsetY:ie},{offsetX:Q,offsetY:ie},{offsetX:K,offsetY:ie},{offsetX:K,offsetY:ae}];let xe=[];for(const{offsetX:Be,offsetY:$e}of pe)xe.push(new d.P(V.x+A.x*Be+F.x*$e,V.y+A.y*Be+F.y*$e));let Ee=!1;if(p){const Be=xe.map($e=>this.projectAndGetPerspectiveRatio(l,$e.x,$e.y,u,C));Ee=Be.some($e=>!$e.isOccluded),xe=Be.map($e=>$e.point)}else Ee=!0;return{box:d.ao(xe),allPointsOccluded:!Ee}}}function bt(f,e,s){return e*(d.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class xr{constructor(e,s,l,u){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):u&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class sr{constructor(e,s,l,u,p){this.text=new xr(e?e.text:null,s,l,p),this.icon=new xr(e?e.icon:null,s,u,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class vt{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class jt{constructor(){this.invProjMatrix=d.H(),this.viewportMatrix=d.H(),this.circles=[]}}class rr{constructor(e,s,l,u,p){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=u,this.tileID=p}}class Cr{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Dr(f,e,s,l,u){const{horizontalAlign:p,verticalAlign:v}=d.au(f);return new d.P(-(p-.5)*e+l[0]*u,-(v-.5)*s+l[1]*u)}class Qr{constructor(e,s,l,u,p,v){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new zt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Cr(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,u)=>s.getElevation(e,l,u):null}getBucketParts(e,s,l,u){const p=l.getBucket(s),v=l.latestFeatureIndex;if(!p||!v||s.id!==p.layerIds[0])return;const w=l.collisionBoxArray,T=p.layers[0].layout,C=p.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),A=l.tileSize/d.X,F=l.tileID.toUnwrapped(),j=this.transform.calculatePosMatrix(F),V=T.get("text-pitch-alignment")==="map",q=T.get("text-rotation-alignment")==="map",K=bt(l,1,this.transform.zoom),J=this.collisionIndex.mapProjection.translatePosition(this.transform,l,C.get("text-translate"),C.get("text-translate-anchor")),Q=this.collisionIndex.mapProjection.translatePosition(this.transform,l,C.get("icon-translate"),C.get("icon-translate-anchor")),U=Xn(j,V,q,this.transform,K);let ie=null;if(V){const pe=_n(j,V,q,this.transform,K);ie=d.L([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[p.bucketInstanceId]=new rr(p.bucketInstanceId,v,p.sourceLayerIndex,p.index,l.tileID);const ae={bucket:p,layout:T,translationText:J,translationIcon:Q,posMatrix:j,unwrappedTileID:F,textLabelPlaneMatrix:U,labelToScreenMatrix:ie,scale:z,textPixelRatio:A,holdingForFade:l.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:d.ag(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(u)for(const pe of p.sortKeyRanges){const{sortKey:xe,symbolInstanceStart:Ee,symbolInstanceEnd:Be}=pe;e.push({sortKey:xe,symbolInstanceStart:Ee,symbolInstanceEnd:Be,parameters:ae})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(e,s,l,u,p,v,w,T,C,z,A,F,j,V,q,K,J,Q,U){const ie=d.aq[e.textAnchor],ae=[e.textOffset0,e.textOffset1],pe=Dr(ie,l,u,ae,p),xe=this.collisionIndex.placeCollisionBox(s,F,T,C,z,w,v,K,A.predicate,U,pe);if((!Q||this.collisionIndex.placeCollisionBox(Q,F,T,C,z,w,v,J,A.predicate,U,pe).placeable)&&xe.placeable){let Ee;if(this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(Ee=this.prevPlacement.variableOffsets[j.crossTileID].anchor),j.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[j.crossTileID]={textOffset:ae,width:l,height:u,anchor:ie,textBoxScale:p,prevAnchor:Ee},this.markUsedJustification(V,ie,j,q),V.allowVerticalPlacement&&(this.markUsedOrientation(V,q,j),this.placedOrientations[j.crossTileID]=q),{shift:pe,placedGlyphBoxes:xe}}}placeLayerBucketPart(e,s,l){const{bucket:u,layout:p,translationText:v,translationIcon:w,posMatrix:T,unwrappedTileID:C,textLabelPlaneMatrix:z,labelToScreenMatrix:A,textPixelRatio:F,holdingForFade:j,collisionBoxArray:V,partiallyEvaluatedTextSize:q,collisionGroup:K}=e.parameters,J=p.get("text-optional"),Q=p.get("icon-optional"),U=d.ar(p,"text-overlap","text-allow-overlap"),ie=U==="always",ae=d.ar(p,"icon-overlap","icon-allow-overlap"),pe=ae==="always",xe=p.get("text-rotation-alignment")==="map",Ee=p.get("text-pitch-alignment")==="map",Be=p.get("icon-text-fit")!=="none",$e=p.get("symbol-z-order")==="viewport-y",Ae=ie&&(pe||!u.hasIconData()||Q),ze=pe&&(ie||!u.hasTextData()||J);!u.collisionArrays&&V&&u.deserializeCollisionBoxes(V);const Je=this._getTerrainElevationFunc(this.retainedQueryData[u.bucketInstanceId].tileID),ht=(De,je,lt)=>{var Yt,yt;if(s[De.crossTileID])return;if(j)return void(this.placements[De.crossTileID]=new vt(!1,!1,!1));let St=!1,Qt=!1,Vr=!0,en=null,er={box:null,placeable:!1,offscreen:null},hi={placeable:!1},ei=null,Ur=null,ti=null,bn=0,ca=0,hl=0;je.textFeatureIndex?bn=je.textFeatureIndex:De.useRuntimeCollisionCircles&&(bn=De.featureIndex),je.verticalTextFeatureIndex&&(ca=je.verticalTextFeatureIndex);const ha=je.textBox;if(ha){const ji=Lr=>{let $r=d.ah.horizontal;if(u.allowVerticalPlacement&&!Lr&&this.prevPlacement){const Ei=this.prevPlacement.placedOrientations[De.crossTileID];Ei&&(this.placedOrientations[De.crossTileID]=Ei,$r=Ei,this.markUsedOrientation(u,$r,De))}return $r},Vi=(Lr,$r)=>{if(u.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&je.verticalTextBox){for(const Ei of u.writingModes)if(Ei===d.ah.vertical?(er=$r(),hi=er):er=Lr(),er&&er.placeable)break}else er=Lr()},Yn=De.textAnchorOffsetStartIndex,tn=De.textAnchorOffsetEndIndex;if(tn===Yn){const Lr=($r,Ei)=>{const Et=this.collisionIndex.placeCollisionBox($r,U,F,T,C,Ee,xe,v,K.predicate,Je);return Et&&Et.placeable&&(this.markUsedOrientation(u,Ei,De),this.placedOrientations[De.crossTileID]=Ei),Et};Vi(()=>Lr(ha,d.ah.horizontal),()=>{const $r=je.verticalTextBox;return u.allowVerticalPlacement&&De.numVerticalGlyphVertices>0&&$r?Lr($r,d.ah.vertical):{box:null,offscreen:null}}),ji(er&&er.placeable)}else{let Lr=d.aq[(yt=(Yt=this.prevPlacement)===null||Yt===void 0?void 0:Yt.variableOffsets[De.crossTileID])===null||yt===void 0?void 0:yt.anchor];const $r=(Et,Ss,da)=>{const pa=Et.x2-Et.x1,Dh=Et.y2-Et.y1,qp=De.textBoxScale,Lh=Be&&ae==="never"?Ss:null;let Qn=null,Rh=U==="never"?1:2,pl="never";Lr&&Rh++;for(let ho=0;ho<Rh;ho++){for(let fl=Yn;fl<tn;fl++){const ml=u.textAnchorOffsets.get(fl);if(Lr&&ml.textAnchor!==Lr)continue;const fa=this.attemptAnchorPlacement(ml,Et,pa,Dh,qp,xe,Ee,F,T,C,K,pl,De,u,da,v,w,Lh,Je);if(fa&&(Qn=fa.placedGlyphBoxes,Qn&&Qn.placeable))return St=!0,en=fa.shift,Qn}Lr?Lr=null:pl=U}return l&&!Qn&&(Qn={box:this.collisionIndex.placeCollisionBox(ha,"always",F,T,C,Ee,xe,v,K.predicate,Je,new d.P(0,0)).box,offscreen:!1,placeable:!1}),Qn};Vi(()=>$r(ha,je.iconBox,d.ah.horizontal),()=>{const Et=je.verticalTextBox;return u.allowVerticalPlacement&&(!er||!er.placeable)&&De.numVerticalGlyphVertices>0&&Et?$r(Et,je.verticalIconBox,d.ah.vertical):{box:null,occluded:!0,offscreen:null}}),er&&(St=er.placeable,Vr=er.offscreen);const Ei=ji(er&&er.placeable);if(!St&&this.prevPlacement){const Et=this.prevPlacement.variableOffsets[De.crossTileID];Et&&(this.variableOffsets[De.crossTileID]=Et,this.markUsedJustification(u,Et.anchor,De,Ei))}}}if(ei=er,St=ei&&ei.placeable,Vr=ei&&ei.offscreen,De.useRuntimeCollisionCircles){const ji=u.text.placedSymbolArray.get(De.centerJustifiedTextSymbolIndex),Vi=d.ai(u.textSizeData,q,ji),Yn=p.get("text-padding");Ur=this.collisionIndex.placeCollisionCircles(U,ji,u.lineVertexArray,u.glyphOffsetArray,Vi,T,C,z,A,l,Ee,K.predicate,De.collisionCircleDiameter,Yn,v,Je),Ur.circles.length&&Ur.collisionDetected&&!l&&d.w("Collisions detected, but collision boxes are not shown"),St=ie||Ur.circles.length>0&&!Ur.collisionDetected,Vr=Vr&&Ur.offscreen}if(je.iconFeatureIndex&&(hl=je.iconFeatureIndex),je.iconBox){const ji=Vi=>this.collisionIndex.placeCollisionBox(Vi,ae,F,T,C,Ee,xe,w,K.predicate,Je,Be&&en?en:void 0);hi&&hi.placeable&&je.verticalIconBox?(ti=ji(je.verticalIconBox),Qt=ti.placeable):(ti=ji(je.iconBox),Qt=ti.placeable),Vr=Vr&&ti.offscreen}const Ni=J||De.numHorizontalGlyphVertices===0&&De.numVerticalGlyphVertices===0,dl=Q||De.numIconVertices===0;Ni||dl?dl?Ni||(Qt=Qt&&St):St=Qt&&St:Qt=St=Qt&&St;const Gu=Qt&&ti.placeable;if(St&&ei.placeable&&this.collisionIndex.insertCollisionBox(ei.box,U,p.get("text-ignore-placement"),u.bucketInstanceId,hi&&hi.placeable&&ca?ca:bn,K.ID),Gu&&this.collisionIndex.insertCollisionBox(ti.box,ae,p.get("icon-ignore-placement"),u.bucketInstanceId,hl,K.ID),Ur&&St&&this.collisionIndex.insertCollisionCircles(Ur.circles,U,p.get("text-ignore-placement"),u.bucketInstanceId,bn,K.ID),l&&this.storeCollisionData(u.bucketInstanceId,lt,je,ei,ti,Ur),De.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(u.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[De.crossTileID]=new vt(St||Ae,Qt||ze,Vr||u.justReloaded),s[De.crossTileID]=!0};if($e){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const De=u.getSortedSymbolIndexes(this.transform.angle);for(let je=De.length-1;je>=0;--je){const lt=De[je];ht(u.symbolInstances.get(lt),u.collisionArrays[lt],lt)}}else for(let De=e.symbolInstanceStart;De<e.symbolInstanceEnd;De++)ht(u.symbolInstances.get(De),u.collisionArrays[De],De);if(l&&u.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[u.bucketInstanceId];d.as(De.invProjMatrix,T),De.viewportMatrix=this.collisionIndex.getViewportMatrix()}u.justReloaded=!1}storeCollisionData(e,s,l,u,p,v){if(l.textBox||l.iconBox){let w,T;this.collisionBoxArrays.has(e)?w=this.collisionBoxArrays.get(e):(w=new Map,this.collisionBoxArrays.set(e,w)),w.has(s)?T=w.get(s):(T={text:null,icon:null},w.set(s,T)),l.textBox&&(T.text=u.box),l.iconBox&&(T.icon=p.box)}if(v){let w=this.collisionCircleArrays[e];w===void 0&&(w=this.collisionCircleArrays[e]=new jt);for(let T=0;T<v.circles.length;T+=4)w.circles.push(v.circles[T+0]),w.circles.push(v.circles[T+1]),w.circles.push(v.circles[T+2]),w.circles.push(v.collisionDetected?1:0)}}markUsedJustification(e,s,l,u){let p;p=u===d.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[d.at(s)];const v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const w of v)w>=0&&(e.text.placedSymbolArray.get(w).crossTileID=p>=0&&w!==p?0:l.crossTileID)}markUsedOrientation(e,s,l){const u=s===d.ah.horizontal||s===d.ah.horizontalOnly?s:0,p=s===d.ah.vertical?s:0,v=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const w of v)e.text.placedSymbolArray.get(w).placedOrientation=u;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const u=s?s.symbolFadeChange(e):1,p=s?s.opacities:{},v=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const T in this.placements){const C=this.placements[T],z=p[T];z?(this.opacities[T]=new sr(z,u,C.text,C.icon),l=l||C.text!==z.text.placed||C.icon!==z.icon.placed):(this.opacities[T]=new sr(null,u,C.text,C.icon,C.skipFade),l=l||C.text||C.icon)}for(const T in p){const C=p[T];if(!this.opacities[T]){const z=new sr(C,u,!1,!1);z.isHidden()||(this.opacities[T]=z,l=l||C.text.placed||C.icon.placed)}}for(const T in v)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=v[T]);for(const T in w)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=w[T]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const u of s){const p=u.getBucket(e);p&&u.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,u.tileID,l,u.collisionBoxArray)}}updateBucketOpacities(e,s,l,u){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],v=p.layout,w=new sr(null,0,!1,!1,!0),T=v.get("text-allow-overlap"),C=v.get("icon-allow-overlap"),z=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",j=v.get("icon-text-fit")!=="none",V=new sr(null,0,T&&(C||!e.hasIconData()||v.get("icon-optional")),C&&(T||!e.hasTextData()||v.get("text-optional")),!0);!e.collisionArrays&&u&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(u);const q=(J,Q,U)=>{for(let ie=0;ie<Q/4;ie++)J.opacityVertexArray.emplaceBack(U);J.hasVisibleVertices=J.hasVisibleVertices||U!==Zs},K=this.collisionBoxArrays.get(e.bucketInstanceId);for(let J=0;J<e.symbolInstances.length;J++){const Q=e.symbolInstances.get(J),{numHorizontalGlyphVertices:U,numVerticalGlyphVertices:ie,crossTileID:ae}=Q;let pe=this.opacities[ae];l[ae]?pe=w:pe||(pe=V,this.opacities[ae]=pe),l[ae]=!0;const xe=Q.numIconVertices>0,Ee=this.placedOrientations[Q.crossTileID],Be=Ee===d.ah.vertical,$e=Ee===d.ah.horizontal||Ee===d.ah.horizontalOnly;if(U>0||ie>0){const ze=Si(pe.text);q(e.text,U,Be?Zs:ze),q(e.text,ie,$e?Zs:ze);const Je=pe.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(je=>{je>=0&&(e.text.placedSymbolArray.get(je).hidden=Je||Be?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Je||$e?1:0);const ht=this.variableOffsets[Q.crossTileID];ht&&this.markUsedJustification(e,ht.anchor,Q,Ee);const De=this.placedOrientations[Q.crossTileID];De&&(this.markUsedJustification(e,"left",Q,De),this.markUsedOrientation(e,De,Q))}if(xe){const ze=Si(pe.icon),Je=!(j&&Q.verticalPlacedIconSymbolIndex&&Be);Q.placedIconSymbolIndex>=0&&(q(e.icon,Q.numIconVertices,Je?ze:Zs),e.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=pe.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(q(e.icon,Q.numVerticalIconVertices,Je?Zs:ze),e.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}const Ae=K&&K.has(J)?K.get(J):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ze=e.collisionArrays[J];if(ze){let Je=new d.P(0,0);if(ze.textBox||ze.verticalTextBox){let ht=!0;if(z){const De=this.variableOffsets[ae];De?(Je=Dr(De.anchor,De.width,De.height,De.textOffset,De.textBoxScale),A&&Je._rotate(F?this.transform.angle:-this.transform.angle)):ht=!1}if(ze.textBox||ze.verticalTextBox){let De;ze.textBox&&(De=Be),ze.verticalTextBox&&(De=$e),$s(e.textCollisionBox.collisionVertexArray,pe.text.placed,!ht||De,Ae.text,Je.x,Je.y)}}if(ze.iconBox||ze.verticalIconBox){const ht=!!(!$e&&ze.verticalIconBox);let De;ze.iconBox&&(De=ht),ze.verticalIconBox&&(De=!ht),$s(e.iconCollisionBox.collisionVertexArray,pe.icon.placed,De,Ae.icon,j?Je.x:0,j?Je.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const J=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=J.invProjMatrix,e.placementViewportMatrix=J.viewportMatrix,e.collisionCircleArray=J.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function $s(f,e,s,l,u,p){l&&l.length!==0||(l=[0,0,0,0]);const v=l[0]-mt,w=l[1]-mt,T=l[2]-mt,C=l[3]-mt;f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,w),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,T,C),f.emplaceBack(e?1:0,s?1:0,u||0,p||0,v,C)}const Vt=Math.pow(2,25),iu=Math.pow(2,24),nu=Math.pow(2,17),wi=Math.pow(2,16),bi=Math.pow(2,9),vp=Math.pow(2,8),Ri=Math.pow(2,1);function Si(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Vt+e*iu+s*nu+e*wi+s*bi+e*vp+s*Ri+e}const Zs=0;function hs(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>function(u,p,v,w,T=!1){if(!v[0]&&!v[1])return[0,0];const C=T?w==="map"?u.angle:0:w==="viewport"?-u.angle:0;if(C){const z=Math.sin(C),A=Math.cos(C);v=[v[0]*A-v[1]*z,v[0]*z+v[1]*A]}return[T?v[0]:bt(p,v[0],u.zoom),T?v[1]:bt(p,v[1],u.zoom)]}(f,e,s,l),getCircleRadiusCorrection:f=>1}}class wr{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,u,p){const v=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(v,u,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((w,T)=>w.sortKey-T.sortKey));this._currentPartIndex<v.length;)if(s.placeLayerBucketPart(v[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,p())return!0;return!1}}class Ga{constructor(e,s,l,u,p,v,w,T){this.placement=new Qr(e,hs(),s,v,w,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const u=ne.now(),p=()=>!this._forceFullPlacement&&ne.now()-u>2;for(;this._currentPlacementIndex>=0;){const v=s[e[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=w)&&(!v.maxzoom||v.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new wr(v)),this._inProgressLayer.continuePlacement(l[v.source],this.placement,this._showCollisionBoxes,v,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Xi=512/d.X/2;class mr{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const u=new Map;for(let p=0;p<s.length;p++){const v=s.get(p),w=v.key,T=u.get(w);T?T.push(v):u.set(w,[v])}for(const[p,v]of u){const w={positions:v.map(T=>({x:Math.floor(T.anchorX*Xi),y:Math.floor(T.anchorY*Xi)})),crossTileIDs:v.map(T=>T.crossTileID)};if(w.positions.length>128){const T=new d.av(w.positions.length,16,Uint16Array);for(const{x:C,y:z}of w.positions)T.add(C,z);T.finish(),delete w.positions,w.index=T}this._symbolsByKey[p]=w}}getScaledCoordinates(e,s){const{x:l,y:u,z:p}=this.tileID.canonical,{x:v,y:w,z:T}=s.canonical,C=Xi/Math.pow(2,T-p),z=(w*d.X+e.anchorY)*C,A=u*d.X*Xi;return{x:Math.floor((v*d.X+e.anchorX)*C-l*d.X*Xi),y:Math.floor(z-A)}}findMatches(e,s,l){const u=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let p=0;p<e.length;p++){const v=e.get(p);if(v.crossTileID)continue;const w=this._symbolsByKey[v.key];if(!w)continue;const T=this.getScaledCoordinates(v,s);if(w.index){const C=w.index.range(T.x-u,T.y-u,T.x+u,T.y+u).sort();for(const z of C){const A=w.crossTileIDs[z];if(!l[A]){l[A]=!0,v.crossTileID=A;break}}}else if(w.positions)for(let C=0;C<w.positions.length;C++){const z=w.positions[C],A=w.crossTileIDs[C];if(Math.abs(z.x-T.x)<=u&&Math.abs(z.y-T.y)<=u&&!l[A]){l[A]=!0,v.crossTileID=A;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class Lo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ki{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const u=this.indexes[l],p={};for(const v in u){const w=u[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),p[w.tileID.key]=w}this.indexes[l]=p}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<s.symbolInstances.length;p++)s.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const u=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const v=this.indexes[p];if(Number(p)>e.overscaledZ)for(const w in v){const T=v[w];T.tileID.isChildOf(e)&&T.findMatches(s.symbolInstances,e,u)}else{const w=v[e.scaledTo(Number(p)).key];w&&w.findMatches(s.symbolInstances,e,u)}}for(let p=0;p<s.symbolInstances.length;p++){const v=s.symbolInstances.get(p);v.crossTileID||(v.crossTileID=l.generate(),u[v.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new mr(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const u of l)delete this.usedCrossTileIDs[e][u]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const u=this.indexes[l];for(const p in u)e[u[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,u[p]),delete u[p],s=!0)}return s}}class su{constructor(){this.layerIndexes={},this.crossTileIDs=new Lo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let u=this.layerIndexes[e.id];u===void 0&&(u=this.layerIndexes[e.id]=new Ki);let p=!1;const v={};u.handleWrapJump(l);for(const w of s){const T=w.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),u.addBucket(w.tileID,T,this.crossTileIDs)&&(p=!0),v[T.bucketInstanceId]=!0)}return u.removeStaleBuckets(v)&&(p=!0),p}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const Ji=(f,e)=>d.t(f,e&&e.filter(s=>s.identifier!=="source.canvas")),xp=d.aw();class Ro extends d.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const u=this.sourceCaches[l].getSource().type;u!=="vector"&&u!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new An(fn(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,u)=>this.getGlyphs(l,u)),this.dispatcher.registerMessageHandler("GI",(l,u)=>this.getImages(l,u)),this.imageManager=new Xt,this.imageManager.setEventedParent(this),this.glyphManager=new Or(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new oi(256,512),this.crossTileSymbolIndex=new su,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",d.ay()),gn().on(Ie,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const u=this.sourceCaches[l.sourceId];if(!u)return;const p=u.getSource();if(p&&p.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===p.id&&this._validateLayer(w)}})}loadURL(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const u=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;d.h(u,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,s,l)}).catch(v=>{this._loadStyleRequest=null,v&&!p.signal.aborted&&this.fire(new d.j(v))})}loadJSON(e,s={},l){this.fire(new d.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ne.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new d.k("dataloading",{dataType:"style"})),this._load(xp,{validate:!1})}_load(e,s,l){var u;const p=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!Ji(this,d.u(p))){this._loaded=!0,this.stylesheet=p;for(const v in p.sources)this.addSource(v,p.sources[v],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs),this._createLayers(),this.light=new dt(this.stylesheet.light),this.sky=new Bt(this.stylesheet.sky),this.map.setTerrain((u=this.stylesheet.terrain)!==null&&u!==void 0?u:null),this.fire(new d.k("data",{dataType:"style"})),this.fire(new d.k("style.load"))}}_createLayers(){const e=d.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=d.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let u;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(p,v,w,T){return d._(this,void 0,void 0,function*(){const C=Mt(p),z=w>1?"@2x":"",A={},F={};for(const{id:j,url:V}of C){const q=v.transformRequest(pt(V,z,".json"),"SpriteJSON");A[j]=d.h(q,T);const K=v.transformRequest(pt(V,z,".png"),"SpriteImage");F[j]=de.getImage(K,T)}return yield Promise.all([...Object.values(A),...Object.values(F)]),function(j,V){return d._(this,void 0,void 0,function*(){const q={};for(const K in j){q[K]={};const J=ne.getImageCanvasContext((yield V[K]).data),Q=(yield j[K]).data;for(const U in Q){const{width:ie,height:ae,x:pe,y:xe,sdf:Ee,pixelRatio:Be,stretchX:$e,stretchY:Ae,content:ze,textFitWidth:Je,textFitHeight:ht}=Q[U];q[K][U]={data:null,pixelRatio:Be,sdf:Ee,stretchX:$e,stretchY:Ae,content:ze,textFitWidth:Je,textFitHeight:ht,spriteData:{width:ie,height:ae,x:pe,y:xe,context:J}}}}return q})}(A,F)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(p=>{if(this._spriteRequest=null,p)for(const v in p){this._spritesImagesIds[v]=[];const w=this._spritesImagesIds[v]?this._spritesImagesIds[v].filter(T=>!(T in p)):[];for(const T of w)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in p[v]){const C=v==="default"?T:`${v}:${T}`;this._spritesImagesIds[v].push(C),C in this.imageManager.images?this.imageManager.updateImage(C,p[v][T],!1):this.imageManager.addImage(C,p[v][T]),s&&(this._changedImages[C]=!0)}}}).catch(p=>{this._spriteRequest=null,u=p,this.fire(new d.j(u))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"})),l&&l(u)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const u=s.getSource();(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(l)===-1)&&this.fire(new d.j(new Error(`Source layer "${l}" does not exist on source "${u.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?d.aB(l):l);const u=[];for(const p of e)if(l[p]){const v=s?d.aB(l[p]):l[p];u.push(v)}return u}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const u=this._layers[l];u.type!=="custom"&&(e[l]=u.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const u=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(u.length||p.length)&&this._updateWorkerLayers(u,p);for(const v in this._updatedSources){const w=this._updatedSources[v];if(w==="reload")this._reloadSource(v);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(v)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const u in this.sourceCaches){const p=this.sourceCaches[u];l[u]=p.used,p.used=!1}for(const u of this._order){const p=this._layers[u];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const u in l){const p=this.sourceCaches[u];!!l[u]!=!!p.used&&p.fire(new d.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:u}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new d.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const u=this.serialize();if(e=s.transformStyle?s.transformStyle(u,e):e,((l=s.validate)===null||l===void 0||l)&&Ji(this,d.u(e)))return!1;(e=d.aB(e)).layers=d.az(e.layers);const p=d.aC(u,e),v=this._getOperationsToPerform(p);if(v.unimplemented.length>0)throw new Error(`Unimplemented: ${v.unimplemented.join(", ")}.`);if(v.operations.length===0)return!1;for(const w of v.operations)w();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const u of e)switch(u.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,u.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,u.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,u.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,u.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,u.args));break;case"addSource":s.push(()=>this.addSource.apply(this,u.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,u.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,u.args));break;case"setLight":s.push(()=>this.setLight.apply(this,u.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,u.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,u.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,u.args));break;case"setSky":s.push(()=>this.setSky.apply(this,u.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,u.args));break;case"setTransition":s.push(()=>{});break;default:l.push(u.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new d.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(d.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const u=this.sourceCaches[e]=new ot(e,s,this.dispatcher);u.style=this,u.setEventedParent(this,()=>({isSourceLoaded:u.loaded(),source:u.serialize(),sourceId:e})),u.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new d.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new d.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const u=e.id;if(this.getLayer(u))return void this.fire(new d.j(new Error(`Layer "${u}" already exists on this map.`)));let p;if(e.type==="custom"){if(Ji(this,d.aD(e)))return;p=d.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(u,e.source),e=d.aB(e),e=d.e(e,{source:u})),this._validate(d.u.layer,`layers.${u}`,e,{arrayIndex:-1},l))return;p=d.aA(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:u}})}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)this.fire(new d.j(new Error(`Cannot add layer "${u}" before non-existing layer "${s}".`)));else{if(this._order.splice(v,0,u),this._layerOrderChanged=!0,this._layers[u]=p,this._removedLayers[u]&&p.source&&p.type!=="custom"){const w=this._removedLayers[u];delete this._removedLayers[u],w.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new d.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const u=s?this._order.indexOf(s):this._order.length;s&&u===-1?this.fire(new d.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(u,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new d.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const u=this.getLayer(e);u?u.minzoom===s&&u.maxzoom===l||(s!=null&&(u.minzoom=s),l!=null&&(u.maxzoom=l),this._updateLayer(u)):this.fire(new d.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const u=this.getLayer(e);if(u){if(!d.aE(u.filter,s))return s==null?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(d.u.filter,`layers.${u.id}.filter`,s,null,l)||(u.filter=d.aB(s),this._updateLayer(u)))}else this.fire(new d.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return d.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getLayoutProperty(s),l)||(p.setLayoutProperty(s,l,u),this._updateLayer(p)):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new d.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,u={}){this._checkLoaded();const p=this.getLayer(e);p?d.aE(p.getPaintProperty(s),l)||(p.setPaintProperty(s,l,u)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new d.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,u=e.sourceLayer,p=this.sourceCaches[l];if(p===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const v=p.getSource().type;v==="geojson"&&u?this.fire(new d.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):v!=="vector"||u?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),p.setFeatureState(u,e.id,s)):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,u=this.sourceCaches[l];if(u===void 0)return void this.fire(new d.j(new Error(`The source '${l}' does not exist in the map's style.`)));const p=u.getSource().type,v=p==="vector"?e.sourceLayer:void 0;p!=="vector"||v?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new d.j(new Error("A feature id is required to remove its specific state property."))):u.removeFeatureState(v,e.id,s):this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,u=this.sourceCaches[s];if(u!==void 0)return u.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new d.j(new Error("The feature id parameter must be provided."))),u.getFeatureState(l,e.id)):void this.fire(new d.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new d.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return d.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=d.aF(this.sourceCaches,p=>p.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,u=this.stylesheet;return d.aG({version:u.version,name:u.name,metadata:u.metadata,light:u.light,sky:u.sky,center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch,sprite:u.sprite,glyphs:u.glyphs,transition:u.transition,sources:e,layers:s,terrain:l},p=>p!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=v=>this._layers[v].type==="fill-extrusion",l={},u=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w)){l[w]=v;for(const T of e){const C=T[w];if(C)for(const z of C)u.push(z)}}}u.sort((v,w)=>w.intersectionZ-v.intersectionZ);const p=[];for(let v=this._order.length-1;v>=0;v--){const w=this._order[v];if(s(w))for(let T=u.length-1;T>=0;T--){const C=u[T].feature;if(l[C.layer.id]<v)break;p.push(C),u.pop()}else for(const T of e){const C=T[w];if(C)for(const z of C)p.push(z.feature)}}return p}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(d.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const u={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new d.j(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const T=this._layers[w];if(!T)return this.fire(new d.j(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];u[T.source]=!0}}const p=[];s.availableImages=this._availableImages;const v=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!u[w]||p.push(Ct(this.sourceCaches[w],this._layers,v,e,s,l));return this.placement&&p.push(function(w,T,C,z,A,F,j){const V={},q=F.queryRenderedSymbols(z),K=[];for(const J of Object.keys(q).map(Number))K.push(j[J]);K.sort(Gn);for(const J of K){const Q=J.featureIndex.lookupSymbolFeatures(q[J.bucketInstanceId],T,J.bucketIndex,J.sourceLayerIndex,A.filter,A.layers,A.availableImages,w);for(const U in Q){const ie=V[U]=V[U]||[],ae=Q[U];ae.sort((pe,xe)=>{const Ee=J.featureSortOrder;if(Ee){const Be=Ee.indexOf(pe.featureIndex);return Ee.indexOf(xe.featureIndex)-Be}return xe.featureIndex-pe.featureIndex});for(const pe of ae)ie.push(pe)}}for(const J in V)V[J].forEach(Q=>{const U=Q.feature,ie=C[w[J].source].getFeatureState(U.layer["source-layer"],U.id);U.source=U.layer.source,U.layer["source-layer"]&&(U.sourceLayer=U.layer["source-layer"]),U.state=ie});return V}(this._layers,v,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,s){s&&s.filter&&this._validate(d.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(u,p){const v=u.getRenderableIds().map(C=>u.getTileByID(C)),w=[],T={};for(let C=0;C<v.length;C++){const z=v[C],A=z.tileID.canonical.key;T[A]||(T[A]=!0,z.querySourceFeatures(w,p))}return w}(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let u=!1;for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:ne.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(p)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let u=!1;if(!e&&!l)return;if(e&&!l)u=!0;else if(!e&&l)u=!0;else for(const v in e)if(!d.aE(e[v],l[v])){u=!0;break}if(!u)return;const p={now:ne.now(),transition:d.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(p)}_validate(e,s,l,u,p={}){return(!p||p.validate!==!1)&&Ji(this,e.call(d.u,d.e({key:s,style:this.serialize(),value:l,styleSpec:d.v},u)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),gn().off(Ie,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,u,p=!1){let v=!1,w=!1;const T={};for(const C of this._order){const z=this._layers[C];if(z.type!=="symbol")continue;if(!T[z.source]){const F=this.sourceCaches[z.source];T[z.source]=F.getRenderableIds(!0).map(j=>F.getTileByID(j)).sort((j,V)=>V.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(V.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(z,T[z.source],e.center.lng);v=v||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ne.now(),e.zoom))&&(this.pauseablePlacement=new Ga(e,this.map.terrain,this._order,p,s,l,u,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ne.now()),w=!0),v&&this.pauseablePlacement.placement.setStale()),w||v)for(const C of this._order){const z=this._layers[C];z.type==="symbol"&&this.placement.updateLayerOpacities(z,T[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ne.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(e,s){return d._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),u=this.sourceCaches[s.source];return u&&u.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(d.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},u){this._checkLoaded();const p=[{id:e,url:s}],v=[...Mt(this.stylesheet.sprite),...p];this._validate(d.u.sprite,"sprite",v,null,l)||(this.stylesheet.sprite=v,this._loadSprite(p,!0,u))}removeSprite(e){this._checkLoaded();const s=Mt(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new d.k("data",{dataType:"style"}))}else this.fire(new d.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Mt(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(d.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var ds=d.Y([{name:"a_pos",type:"Int16",components:2}]);const Kn={prelude:Ft(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ft(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ft(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ft(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ft("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ft(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ft(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ft("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ft("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ft("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ft(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ft(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ft(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ft(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ft(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ft(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ft(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ft(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ft(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ft(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ft(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ft(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ft(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ft(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ft("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Ft("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Ft("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:Ft("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Ft(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),u=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=p?p.concat(u):u,w={};return{fragmentSource:f=f.replace(s,(T,C,z,A,F)=>(w[F]=!0,C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${z} ${A} ${F};
#else
uniform ${z} ${A} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${z} ${A} ${F} = u_${F};
#endif
`)),vertexSource:e=e.replace(s,(T,C,z,A,F)=>{const j=A==="float"?"vec2":"vec4",V=F.match(/color/)?"color":j;return w[F]?C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${z} ${j} a_${F};
varying ${z} ${A} ${F};
#else
uniform ${z} ${A} u_${F};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${z} ${A} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${z} ${A} ${F} = u_${F};
#endif
`:C==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${z} ${j} a_${F};
#else
uniform ${z} ${A} u_${F};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${z} ${A} ${F} = a_${F};
#else
    ${z} ${A} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${z} ${A} ${F} = unpack_mix_${V}(a_${F}, u_${F}_t);
#else
    ${z} ${A} ${F} = u_${F};
#endif
`}),staticAttributes:l,staticUniforms:v}}class au{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,u,p,v,w,T,C){this.context=e;let z=this.boundPaintVertexBuffers.length!==u.length;for(let A=0;!z&&A<u.length;A++)this.boundPaintVertexBuffers[A]!==u[A]&&(z=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==p||this.boundVertexOffset!==v||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==C?this.freshBind(s,l,u,p,v,w,T,C):(e.bindVertexArray.set(this.vao),w&&w.bind(),p&&p.dynamicDraw&&p.bind(),T&&T.bind(),C&&C.bind())}freshBind(e,s,l,u,p,v,w,T){const C=e.numAttributes,z=this.context,A=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=u,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=T,s.enableAttributes(A,e);for(const F of l)F.enableAttributes(A,e);v&&v.enableAttributes(A,e),w&&w.enableAttributes(A,e),T&&T.enableAttributes(A,e),s.bind(),s.setVertexAttribPointers(A,e,p);for(const F of l)F.bind(),F.setVertexAttribPointers(A,e,p);v&&(v.bind(),v.setVertexAttribPointers(A,e,p)),u&&u.bind(),w&&(w.bind(),w.setVertexAttribPointers(A,e,p)),T&&(T.bind(),T.setVertexAttribPointers(A,e,p)),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const ou=(f,e,s,l,u)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):d.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(u):0,u_horizon_color:l?l.properties.get("horizon-color"):d.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function qs(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class lu{constructor(e,s,l,u,p,v){const w=e.gl;this.program=w.createProgram();const T=qs(s.staticAttributes),C=l?l.getBinderAttributes():[],z=T.concat(C),A=Kn.prelude.staticUniforms?qs(Kn.prelude.staticUniforms):[],F=s.staticUniforms?qs(s.staticUniforms):[],j=l?l.getBinderUniforms():[],V=A.concat(F).concat(j),q=[];for(const pe of V)q.indexOf(pe)<0&&q.push(pe);const K=l?l.defines():[];p&&K.push("#define OVERDRAW_INSPECTOR;"),v&&K.push("#define TERRAIN3D;");const J=K.concat(Kn.prelude.fragmentSource,s.fragmentSource).join(`
`),Q=K.concat(Kn.prelude.vertexSource,s.vertexSource).join(`
`),U=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(U,J),w.compileShader(U),!w.getShaderParameter(U,w.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${w.getShaderInfoLog(U)}`);w.attachShader(this.program,U);const ie=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);if(w.shaderSource(ie,Q),w.compileShader(ie),!w.getShaderParameter(ie,w.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${w.getShaderInfoLog(ie)}`);w.attachShader(this.program,ie),this.attributes={};const ae={};this.numAttributes=z.length;for(let pe=0;pe<this.numAttributes;pe++)z[pe]&&(w.bindAttribLocation(this.program,pe,z[pe]),this.attributes[z[pe]]=pe);if(w.linkProgram(this.program),!w.getProgramParameter(this.program,w.LINK_STATUS))throw new Error(`Program failed to link: ${w.getProgramInfoLog(this.program)}`);w.deleteShader(ie),w.deleteShader(U);for(let pe=0;pe<q.length;pe++){const xe=q[pe];if(xe&&!ae[xe]){const Ee=w.getUniformLocation(this.program,xe);Ee&&(ae[xe]=Ee)}}this.fixedUniforms=u(e,ae),this.terrainUniforms=((pe,xe)=>({u_depth:new d.aH(pe,xe.u_depth),u_terrain:new d.aH(pe,xe.u_terrain),u_terrain_dim:new d.aI(pe,xe.u_terrain_dim),u_terrain_matrix:new d.aJ(pe,xe.u_terrain_matrix),u_terrain_unpack:new d.aK(pe,xe.u_terrain_unpack),u_terrain_exaggeration:new d.aI(pe,xe.u_terrain_exaggeration)}))(e,ae),this.binderUniforms=l?l.getUniforms(e,ae):[]}draw(e,s,l,u,p,v,w,T,C,z,A,F,j,V,q,K,J,Q){const U=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(u),e.setColorMode(p),e.setCullFace(v),T){e.activeTexture.set(U.TEXTURE2),U.bindTexture(U.TEXTURE_2D,T.depthTexture),e.activeTexture.set(U.TEXTURE3),U.bindTexture(U.TEXTURE_2D,T.texture);for(const ae in this.terrainUniforms)this.terrainUniforms[ae].set(T[ae])}for(const ae in this.fixedUniforms)this.fixedUniforms[ae].set(w[ae]);q&&q.setUniforms(e,this.binderUniforms,j,{zoom:V});let ie=0;switch(s){case U.LINES:ie=2;break;case U.TRIANGLES:ie=3;break;case U.LINE_STRIP:ie=1}for(const ae of F.get()){const pe=ae.vaos||(ae.vaos={});(pe[C]||(pe[C]=new au)).bind(e,this,z,q?q.getPaintVertexBuffers():[],A,ae.vertexOffset,K,J,Q),U.drawElements(s,ae.primitiveLength*ie,U.UNSIGNED_SHORT,ae.primitiveOffset*ie*2)}}}function Fo(f,e,s){const l=1/bt(s,1,e.transform.tileZoom),u=Math.pow(2,s.tileID.overscaledZ),p=s.tileSize*Math.pow(2,e.transform.tileZoom)/u,v=p*(s.tileID.canonical.x+s.tileID.wrap*u),w=p*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[v>>16,w>>16],u_pixel_coord_lower:[65535&v,65535&w]}}const Ha=(f,e,s,l)=>{const u=e.style.light,p=u.properties.get("position"),v=[p.x,p.y,p.z],w=function(){var C=new d.A(9);return d.A!=Float32Array&&(C[1]=0,C[2]=0,C[3]=0,C[5]=0,C[6]=0,C[7]=0),C[0]=1,C[4]=1,C[8]=1,C}();u.properties.get("anchor")==="viewport"&&function(C,z){var A=Math.sin(z),F=Math.cos(z);C[0]=F,C[1]=A,C[2]=0,C[3]=-A,C[4]=F,C[5]=0,C[6]=0,C[7]=0,C[8]=1}(w,-e.transform.angle),function(C,z,A){var F=z[0],j=z[1],V=z[2];C[0]=F*A[0]+j*A[3]+V*A[6],C[1]=F*A[1]+j*A[4]+V*A[7],C[2]=F*A[2]+j*A[5]+V*A[8]}(v,v,w);const T=u.properties.get("color");return{u_matrix:f,u_lightpos:v,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+s,u_opacity:l}},Bo=(f,e,s,l,u,p,v)=>d.e(Ha(f,e,s,l),Fo(p,e,v),{u_height_factor:-Math.pow(2,u.overscaledZ)/v.tileSize/8}),Gs=f=>({u_matrix:f}),eh=(f,e,s,l)=>d.e(Gs(f),Fo(s,e,l)),wp=(f,e)=>({u_matrix:f,u_world:e}),th=(f,e,s,l,u)=>d.e(eh(f,e,s,l),{u_world:u}),bp=(f,e,s,l)=>{const u=f.transform;let p,v;if(l.paint.get("circle-pitch-alignment")==="map"){const w=bt(s,1,u.zoom);p=!0,v=[w,w]}else p=!1,v=u.pixelsToGLUnits;return{u_camera_to_center_distance:u.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+p,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:v}},ps=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Wa=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),ui=f=>({u_matrix:f}),ci=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:bt(e,1,s),u_intensity:l}),Oo=(f,e,s,l)=>{const u=d.H();d.aP(u,0,f.width,f.height,0,0,1);const p=f.context.gl;return{u_matrix:u,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function No(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new d.Z(0,l/s).toLngLat().lat,new d.Z(0,(l+1)/s).toLngLat().lat]}const jo=(f,e,s,l)=>{const u=f.transform;return{u_matrix:nh(f,e,s,l),u_ratio:1/bt(e,1,u.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]]}},rh=(f,e,s,l,u)=>d.e(jo(f,e,s,u),{u_image:0,u_image_height:l}),Hs=(f,e,s,l,u)=>{const p=f.transform,v=ih(e,p);return{u_matrix:nh(f,e,s,u),u_texsize:e.imageAtlasTexture.size,u_ratio:1/bt(e,1,p.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[v,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Sp=(f,e,s,l,u,p)=>{const v=f.lineAtlas,w=ih(e,f.transform),T=s.layout.get("line-cap")==="round",C=v.getDash(l.from,T),z=v.getDash(l.to,T),A=C.width*u.fromScale,F=z.width*u.toScale;return d.e(jo(f,e,s,p),{u_patternscale_a:[w/A,-C.height/2],u_patternscale_b:[w/F,-z.height/2],u_sdfgamma:v.width/(256*Math.min(A,F)*f.pixelRatio)/2,u_image:0,u_tex_y_a:C.y,u_tex_y_b:z.y,u_mix:u.t})};function ih(f,e){return 1/bt(f,1,e.tileZoom)}function nh(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Tp=(f,e,s,l,u)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(p=u.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:kp(u.paint.get("raster-hue-rotate"))};var p,v};function kp(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const sh=(f,e,s,l,u,p,v,w,T,C,z,A,F,j)=>{const V=v.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:V.width/V.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:T,u_coord_matrix:C,u_is_text:+A,u_pitch_with_map:+l,u_is_along_line:u,u_is_variable_anchor:p,u_texsize:F,u_texture:0,u_translation:z,u_pitched_scale:j}},Xa=(f,e,s,l,u,p,v,w,T,C,z,A,F,j,V)=>{const q=v.transform;return d.e(sh(f,e,s,l,u,p,v,w,T,C,z,A,F,V),{u_gamma_scale:l?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:1})},uu=(f,e,s,l,u,p,v,w,T,C,z,A,F,j)=>d.e(Xa(f,e,s,l,u,p,v,w,T,C,z,!0,A,!0,j),{u_texsize_icon:F,u_texture_icon:1}),Vo=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),cu=(f,e,s,l,u,p)=>d.e(function(v,w,T,C){const z=T.imageManager.getPattern(v.from.toString()),A=T.imageManager.getPattern(v.to.toString()),{width:F,height:j}=T.imageManager.getPixelSize(),V=Math.pow(2,C.tileID.overscaledZ),q=C.tileSize*Math.pow(2,T.transform.tileZoom)/V,K=q*(C.tileID.canonical.x+C.tileID.wrap*V),J=q*C.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[F,j],u_mix:w.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/bt(C,1,T.transform.tileZoom),u_pixel_coord_upper:[K>>16,J>>16],u_pixel_coord_lower:[65535&K,65535&J]}}(l,p,s,u),{u_matrix:f,u_opacity:e}),hu={fillExtrusion:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_opacity:new d.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_lightpos:new d.aN(f,e.u_lightpos),u_lightintensity:new d.aI(f,e.u_lightintensity),u_lightcolor:new d.aN(f,e.u_lightcolor),u_vertical_gradient:new d.aI(f,e.u_vertical_gradient),u_height_factor:new d.aI(f,e.u_height_factor),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade),u_opacity:new d.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_texsize:new d.aO(f,e.u_texsize),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new d.aH(f,e.u_scale_with_map),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_extrude_scale:new d.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_matrix:new d.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_pixel_extrude_scale:new d.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_inv_matrix:new d.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_viewport_size:new d.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new d.aL(f,e.u_color),u_matrix:new d.aJ(f,e.u_matrix),u_overlay:new d.aH(f,e.u_overlay),u_overlay_scale:new d.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new d.aI(f,e.u_extrude_scale),u_intensity:new d.aI(f,e.u_intensity),u_matrix:new d.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_world:new d.aO(f,e.u_world),u_image:new d.aH(f,e.u_image),u_color_ramp:new d.aH(f,e.u_color_ramp),u_opacity:new d.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_latrange:new d.aO(f,e.u_latrange),u_light:new d.aO(f,e.u_light),u_shadow:new d.aL(f,e.u_shadow),u_highlight:new d.aL(f,e.u_highlight),u_accent:new d.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_image:new d.aH(f,e.u_image),u_dimension:new d.aO(f,e.u_dimension),u_zoom:new d.aI(f,e.u_zoom),u_unpack:new d.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_image:new d.aH(f,e.u_image),u_image_height:new d.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texsize:new d.aO(f,e.u_texsize),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_image:new d.aH(f,e.u_image),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_scale:new d.aN(f,e.u_scale),u_fade:new d.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ratio:new d.aI(f,e.u_ratio),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new d.aO(f,e.u_units_to_pixels),u_patternscale_a:new d.aO(f,e.u_patternscale_a),u_patternscale_b:new d.aO(f,e.u_patternscale_b),u_sdfgamma:new d.aI(f,e.u_sdfgamma),u_image:new d.aH(f,e.u_image),u_tex_y_a:new d.aI(f,e.u_tex_y_a),u_tex_y_b:new d.aI(f,e.u_tex_y_b),u_mix:new d.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_tl_parent:new d.aO(f,e.u_tl_parent),u_scale_parent:new d.aI(f,e.u_scale_parent),u_buffer_scale:new d.aI(f,e.u_buffer_scale),u_fade_t:new d.aI(f,e.u_fade_t),u_opacity:new d.aI(f,e.u_opacity),u_image0:new d.aH(f,e.u_image0),u_image1:new d.aH(f,e.u_image1),u_brightness_low:new d.aI(f,e.u_brightness_low),u_brightness_high:new d.aI(f,e.u_brightness_high),u_saturation_factor:new d.aI(f,e.u_saturation_factor),u_contrast_factor:new d.aI(f,e.u_contrast_factor),u_spin_weights:new d.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texture:new d.aH(f,e.u_texture),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new d.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new d.aH(f,e.u_is_size_feature_constant),u_size_t:new d.aI(f,e.u_size_t),u_size:new d.aI(f,e.u_size),u_camera_to_center_distance:new d.aI(f,e.u_camera_to_center_distance),u_pitch:new d.aI(f,e.u_pitch),u_rotate_symbol:new d.aH(f,e.u_rotate_symbol),u_aspect_ratio:new d.aI(f,e.u_aspect_ratio),u_fade_change:new d.aI(f,e.u_fade_change),u_matrix:new d.aJ(f,e.u_matrix),u_label_plane_matrix:new d.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new d.aJ(f,e.u_coord_matrix),u_is_text:new d.aH(f,e.u_is_text),u_pitch_with_map:new d.aH(f,e.u_pitch_with_map),u_is_along_line:new d.aH(f,e.u_is_along_line),u_is_variable_anchor:new d.aH(f,e.u_is_variable_anchor),u_texsize:new d.aO(f,e.u_texsize),u_texsize_icon:new d.aO(f,e.u_texsize_icon),u_texture:new d.aH(f,e.u_texture),u_texture_icon:new d.aH(f,e.u_texture_icon),u_gamma_scale:new d.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new d.aI(f,e.u_device_pixel_ratio),u_is_halo:new d.aH(f,e.u_is_halo),u_translation:new d.aO(f,e.u_translation),u_pitched_scale:new d.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_color:new d.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_opacity:new d.aI(f,e.u_opacity),u_image:new d.aH(f,e.u_image),u_pattern_tl_a:new d.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new d.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new d.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new d.aO(f,e.u_pattern_br_b),u_texsize:new d.aO(f,e.u_texsize),u_mix:new d.aI(f,e.u_mix),u_pattern_size_a:new d.aO(f,e.u_pattern_size_a),u_pattern_size_b:new d.aO(f,e.u_pattern_size_b),u_scale_a:new d.aI(f,e.u_scale_a),u_scale_b:new d.aI(f,e.u_scale_b),u_pixel_coord_upper:new d.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new d.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new d.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_ele_delta:new d.aI(f,e.u_ele_delta),u_fog_matrix:new d.aJ(f,e.u_fog_matrix),u_fog_color:new d.aL(f,e.u_fog_color),u_fog_ground_blend:new d.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new d.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon_fog_blend:new d.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_ele_delta:new d.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new d.aJ(f,e.u_matrix),u_texture:new d.aH(f,e.u_texture),u_terrain_coords_id:new d.aI(f,e.u_terrain_coords_id),u_ele_delta:new d.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new d.aL(f,e.u_sky_color),u_horizon_color:new d.aL(f,e.u_horizon_color),u_horizon:new d.aI(f,e.u_horizon),u_sky_horizon_blend:new d.aI(f,e.u_sky_horizon_blend)})};class vn{constructor(e,s,l){this.context=e;const u=e.gl;this.buffer=u.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ep={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class du{constructor(e,s,l,u){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=u,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const u=s.attributes[this.attributes[l].name];u!==void 0&&e.enableVertexAttribArray(u)}}setVertexAttribPointers(e,s,l){for(let u=0;u<this.attributes.length;u++){const p=this.attributes[u],v=s.attributes[p.name];v!==void 0&&e.vertexAttribPointer(v,p.components,e[Ep[p.type]],!1,this.itemSize,p.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const fs=new WeakMap;function Jn(f){var e;if(fs.has(f))return fs.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return fs.set(f,s),s}}class Ot{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Uo extends Ot{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ip extends Ot{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ws extends Ot{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Cp extends Ot{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ah extends Ot{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Pp extends Ot{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class oh extends Ot{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class pu extends Ot{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class lh extends Ot{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class uh extends Ot{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class ch extends Ot{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class hh extends Ot{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ms extends Ot{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class dh extends Ot{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class zp extends Ot{getDefault(){return d.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ph extends Ot{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Ka extends Ot{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Ap extends Ot{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class $o extends Ot{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Mp extends Ot{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Dp extends Ot{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class fh extends Ot{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class mh extends Ot{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class gh extends Ot{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class fu extends Ot{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class yh extends Ot{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Zo extends Ot{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ln extends Ot{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Jn(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class mu extends Ot{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class gu extends Ot{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class yu extends Ot{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class qo extends Ot{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class _u extends qo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class gs extends qo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class vu extends qo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Lp{constructor(e,s,l,u,p){this.context=e,this.width=s,this.height=l;const v=e.gl,w=this.framebuffer=v.createFramebuffer();if(this.colorAttachment=new _u(e,w),u)this.depthAttachment=p?new vu(e,w):new gs(e,w);else if(p)throw new Error("Stencil cannot be set without depth");if(v.checkFramebufferStatus(v.FRAMEBUFFER)!==v.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class cr{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}cr.Replace=[1,0],cr.disabled=new cr(cr.Replace,d.aM.transparent,[!1,!1,!1,!1]),cr.unblended=new cr(cr.Replace,d.aM.transparent,[!0,!0,!0,!0]),cr.alphaBlended=new cr([1,771],d.aM.transparent,[!0,!0,!0,!0]);class Rp{constructor(e){var s,l;if(this.gl=e,this.clearColor=new Uo(this),this.clearDepth=new Ip(this),this.clearStencil=new Ws(this),this.colorMask=new Cp(this),this.depthMask=new ah(this),this.stencilMask=new Pp(this),this.stencilFunc=new oh(this),this.stencilOp=new pu(this),this.stencilTest=new lh(this),this.depthRange=new uh(this),this.depthTest=new ch(this),this.depthFunc=new hh(this),this.blend=new ms(this),this.blendFunc=new dh(this),this.blendColor=new zp(this),this.blendEquation=new ph(this),this.cullFace=new Ka(this),this.cullFaceSide=new Ap(this),this.frontFace=new $o(this),this.program=new Mp(this),this.activeTexture=new Dp(this),this.viewport=new fh(this),this.bindFramebuffer=new mh(this),this.bindRenderbuffer=new gh(this),this.bindTexture=new fu(this),this.bindVertexBuffer=new yh(this),this.bindElementBuffer=new Zo(this),this.bindVertexArray=new Ln(this),this.pixelStoreUnpack=new mu(this),this.pixelStoreUnpackPremultiplyAlpha=new gu(this),this.pixelStoreUnpackFlipY=new yu(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Jn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const u=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:u==null?void 0:u.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:u==null?void 0:u.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const u=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=u==null?void 0:u.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new vn(this,e,s)}createVertexBuffer(e,s,l){return new du(this,e,s,l)}createRenderbuffer(e,s,l){const u=this.gl,p=u.createRenderbuffer();return this.bindRenderbuffer.set(p),u.renderbufferStorage(u.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),p}createFramebuffer(e,s,l,u){return new Lp(this,e,s,l,u)}clear({color:e,depth:s,stencil:l}){const u=this.gl;let p=0;e&&(p|=u.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(p|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),u.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){d.aE(e.blendFunction,cr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Jn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Jn(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class xt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}xt.ReadOnly=!1,xt.ReadWrite=!0,xt.disabled=new xt(519,xt.ReadOnly,[0,1]);const Go=7680;class Gt{constructor(e,s,l,u,p,v){this.test=e,this.ref=s,this.mask=l,this.fail=u,this.depthFail=p,this.pass=v}}Gt.disabled=new Gt({func:519,mask:0},0,0,Go,Go,Go);class Ut{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let ys;function Ja(f,e,s,l,u){const p=f.context,v=p.gl,w=f.useProgram("collisionBox"),T=[];let C=0,z=0;for(let J=0;J<l.length;J++){const Q=l[J],U=e.getTile(Q).getBucket(s);if(!U)continue;const ie=u?U.textCollisionBox:U.iconCollisionBox,ae=U.collisionCircleArray;if(ae.length>0){const pe=d.H();d.aQ(pe,U.placementInvProjMatrix,f.transform.glCoordMatrix),d.aQ(pe,pe,U.placementViewportMatrix),T.push({circleArray:ae,circleOffset:z,transform:Q.posMatrix,invTransform:pe,coord:Q}),C+=ae.length/4,z=C}ie&&w.draw(p,v.LINES,xt.disabled,Gt.disabled,f.colorModeForRenderPass(),Ut.disabled,{u_matrix:Q.posMatrix,u_pixel_extrude_scale:[1/(A=f.transform).width,1/A.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q),s.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,null,f.transform.zoom,null,null,ie.collisionVertexBuffer)}var A;if(!u||!T.length)return;const F=f.useProgram("collisionCircle"),j=new d.aR;j.resize(4*C),j._trim();let V=0;for(const J of T)for(let Q=0;Q<J.circleArray.length/4;Q++){const U=4*Q,ie=J.circleArray[U+0],ae=J.circleArray[U+1],pe=J.circleArray[U+2],xe=J.circleArray[U+3];j.emplace(V++,ie,ae,pe,xe,0),j.emplace(V++,ie,ae,pe,xe,1),j.emplace(V++,ie,ae,pe,xe,2),j.emplace(V++,ie,ae,pe,xe,3)}(!ys||ys.length<2*C)&&(ys=function(J){const Q=2*J,U=new d.aT;U.resize(Q),U._trim();for(let ie=0;ie<Q;ie++){const ae=6*ie;U.uint16[ae+0]=4*ie+0,U.uint16[ae+1]=4*ie+1,U.uint16[ae+2]=4*ie+2,U.uint16[ae+3]=4*ie+2,U.uint16[ae+4]=4*ie+3,U.uint16[ae+5]=4*ie+0}return U}(C));const q=p.createIndexBuffer(ys,!0),K=p.createVertexBuffer(j,d.aS.members,!0);for(const J of T){const Q=ps(J.transform,J.invTransform,f.transform);F.draw(p,v.TRIANGLES,xt.disabled,Gt.disabled,f.colorModeForRenderPass(),Ut.disabled,Q,f.style.map.terrain&&f.style.map.terrain.getTerrainData(J.coord),s.id,K,q,d.a0.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,f.transform.zoom,null,null,null)}K.destroy(),q.destroy()}Ut.disabled=new Ut(!1,1029,2305),Ut.backCCW=new Ut(!0,1029,2305);const Ya=d.an(new Float32Array(16));function xu(f,e,s,l,u,p){const{horizontalAlign:v,verticalAlign:w}=d.au(f);return new d.P((-(v-.5)*e/u+l[0])*p,(-(w-.5)*s/u+l[1])*p)}function _s(f,e,s,l,u,p){const v=e.tileAnchorPoint.add(new d.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let w=l.mult(p);s||(w=w.rotate(-u));const T=v.add(w);return W(T.x,T.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const w=ye(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),T=Math.atan(w.y/w.x)+(w.x<0?Math.PI:0);return f.add(l.rotate(T))}return f.add(l)}function Xs(f,e,s,l,u,p,v,w,T,C,z,A,F,j){const V=f.text.placedSymbolArray,q=f.text.dynamicLayoutVertexArray,K=f.icon.dynamicLayoutVertexArray,J={};q.clear();for(let Q=0;Q<V.length;Q++){const U=V.get(Q),ie=U.hidden||!U.crossTileID||f.allowVerticalPlacement&&!U.placedOrientation?null:l[U.crossTileID];if(ie){const ae=new d.P(U.anchorX,U.anchorY),pe={getElevation:j,width:u.width,height:u.height,labelPlaneMatrix:p,pitchWithMap:s,projection:z,tileAnchorPoint:ae,translation:A,unwrappedTileID:F},xe=s?W(ae.x,ae.y,v,j):ye(ae.x,ae.y,pe),Ee=L(u.cameraToCenterDistance,xe.signedDistanceFromCamera);let Be=d.ai(f.textSizeData,T,U)*Ee/d.ap;s&&(Be*=f.tilePixelRatio/w);const{width:$e,height:Ae,anchor:ze,textOffset:Je,textBoxScale:ht}=ie,De=xu(ze,$e,Ae,Je,ht,Be),je=z.getPitchedTextCorrection(u,ae.add(new d.P(A[0],A[1])),F),lt=_s(xe.point,pe,e,De,u.angle,je),Yt=f.allowVerticalPlacement&&U.placedOrientation===d.ah.vertical?Math.PI/2:0;for(let yt=0;yt<U.numGlyphs;yt++)d.aj(q,lt,Yt);C&&U.associatedIconIndex>=0&&(J[U.associatedIconIndex]={shiftedAnchor:lt,angle:Yt})}else nt(U.numGlyphs,q)}if(C){K.clear();const Q=f.icon.placedSymbolArray;for(let U=0;U<Q.length;U++){const ie=Q.get(U);if(ie.hidden)nt(ie.numGlyphs,K);else{const ae=J[U];if(ae)for(let pe=0;pe<ie.numGlyphs;pe++)d.aj(K,ae.shiftedAnchor,ae.angle);else nt(ie.numGlyphs,K)}}f.icon.dynamicLayoutVertexBuffer.updateData(K)}f.text.dynamicLayoutVertexBuffer.updateData(q)}function Fi(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function wu(f,e,s,l,u,p,v,w,T,C,z,A){const F=f.context,j=F.gl,V=f.transform,q=hs(),K=w==="map",J=T==="map",Q=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",U=K&&!J&&!Q,ie=!J&&Q,ae=!s.layout.get("symbol-sort-key").isConstant();let pe=!1;const xe=f.depthModeForSublayer(0,xt.ReadOnly),Ee=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Be=[],$e=q.getCircleRadiusCorrection(V);for(const Ae of l){const ze=e.getTile(Ae),Je=ze.getBucket(s);if(!Je)continue;const ht=u?Je.text:Je.icon;if(!ht||!ht.segments.get().length||!ht.hasVisibleVertices)continue;const De=ht.programConfigurations.get(s.id),je=u||Je.sdfIcons,lt=u?Je.textSizeData:Je.iconSizeData,Yt=J||V.pitch!==0,yt=f.useProgram(Fi(je,u,Je),De),St=d.ag(lt,V.zoom),Qt=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Ae);let Vr,en,er,hi,ei=[0,0],Ur=null;if(u)en=ze.glyphAtlasTexture,er=j.LINEAR,Vr=ze.glyphAtlasTexture.size,Je.iconsInText&&(ei=ze.imageAtlasTexture.size,Ur=ze.imageAtlasTexture,hi=Yt||f.options.rotating||f.options.zooming||lt.kind==="composite"||lt.kind==="camera"?j.LINEAR:j.NEAREST);else{const Et=s.layout.get("icon-size").constantOr(0)!==1||Je.iconsNeedLinear;en=ze.imageAtlasTexture,er=je||f.options.rotating||f.options.zooming||Et||Yt?j.LINEAR:j.NEAREST,Vr=ze.imageAtlasTexture.size}const ti=bt(ze,1,f.transform.zoom),bn=ie?Ae.posMatrix:Ya,ca=Xn(bn,J,K,f.transform,ti),hl=_n(bn,J,K,f.transform,ti),ha=_n(Ae.posMatrix,J,K,f.transform,ti),Ni=q.translatePosition(f.transform,ze,p,v),dl=Ee&&Je.hasTextData(),Gu=s.layout.get("icon-text-fit")!=="none"&&dl&&Je.hasIconData();if(Q){const Et=f.style.map.terrain?(da,pa)=>f.style.map.terrain.getElevation(Ae,da,pa):null,Ss=s.layout.get("text-rotation-alignment")==="map";N(Je,Ae.posMatrix,f,u,ca,ha,J,C,Ss,q,Ae.toUnwrapped(),V.width,V.height,Ni,Et)}const ji=Ae.posMatrix,Vi=u&&Ee||Gu,Yn=Q||Vi?Ya:ca,tn=hl,Lr=je&&s.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let $r;$r=je?Je.iconsInText?uu(lt.kind,St,U,J,Q,Vi,f,ji,Yn,tn,Ni,Vr,ei,$e):Xa(lt.kind,St,U,J,Q,Vi,f,ji,Yn,tn,Ni,u,Vr,!0,$e):sh(lt.kind,St,U,J,Q,Vi,f,ji,Yn,tn,Ni,u,Vr,$e);const Ei={program:yt,buffers:ht,uniformValues:$r,atlasTexture:en,atlasTextureIcon:Ur,atlasInterpolation:er,atlasInterpolationIcon:hi,isSDF:je,hasHalo:Lr};if(ae&&Je.canOverlap){pe=!0;const Et=ht.segments.get();for(const Ss of Et)Be.push({segments:new d.a0([Ss]),sortKey:Ss.sortKey,state:Ei,terrainData:Qt})}else Be.push({segments:ht.segments,sortKey:0,state:Ei,terrainData:Qt})}pe&&Be.sort((Ae,ze)=>Ae.sortKey-ze.sortKey);for(const Ae of Be){const ze=Ae.state;if(F.activeTexture.set(j.TEXTURE0),ze.atlasTexture.bind(ze.atlasInterpolation,j.CLAMP_TO_EDGE),ze.atlasTextureIcon&&(F.activeTexture.set(j.TEXTURE1),ze.atlasTextureIcon&&ze.atlasTextureIcon.bind(ze.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),ze.isSDF){const Je=ze.uniformValues;ze.hasHalo&&(Je.u_is_halo=1,bu(ze.buffers,Ae.segments,s,f,ze.program,xe,z,A,Je,Ae.terrainData)),Je.u_is_halo=0}bu(ze.buffers,Ae.segments,s,f,ze.program,xe,z,A,ze.uniformValues,Ae.terrainData)}}function bu(f,e,s,l,u,p,v,w,T,C){const z=l.context;u.draw(z,z.gl.TRIANGLES,p,v,w,Ut.disabled,T,C,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Su(f,e,s,l){const u=f.context,p=u.gl,v=Gt.disabled,w=new cr([p.ONE,p.ONE],d.aM.transparent,[!0,!0,!0,!0]),T=e.getBucket(s);if(!T)return;const C=l.key;let z=s.heatmapFbos.get(C);z||(z=Qa(u,e.tileSize,e.tileSize),s.heatmapFbos.set(C,z)),u.bindFramebuffer.set(z.framebuffer),u.viewport.set([0,0,e.tileSize,e.tileSize]),u.clear({color:d.aM.transparent});const A=T.programConfigurations.get(s.id),F=f.useProgram("heatmap",A),j=f.style.map.terrain.getTerrainData(l);F.draw(u,p.TRIANGLES,xt.disabled,v,w,Ut.disabled,ci(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),j,s.id,T.layoutVertexBuffer,T.indexBuffer,T.segments,s.paint,f.transform.zoom,A)}function vs(f,e,s){const l=f.context,u=l.gl;l.setColorMode(f.colorModeForRenderPass());const p=eo(l,e),v=s.key,w=e.heatmapFbos.get(v);w&&(l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,w.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,u.TRIANGLES,xt.disabled,Gt.disabled,f.colorModeForRenderPass(),Ut.disabled,Oo(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),w.destroy(),e.heatmapFbos.delete(v))}function Qa(f,e,s){var l,u;const p=f.gl,v=p.createTexture();p.bindTexture(p.TEXTURE_2D,v),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const w=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:p.UNSIGNED_BYTE,T=(u=f.RGBA16F)!==null&&u!==void 0?u:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,T,e,s,0,p.RGBA,w,null);const C=f.createFramebuffer(e,s,!1,!1);return C.colorAttachment.set(v),C}function eo(f,e){return e.colorRampTexture||(e.colorRampTexture=new gt(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function Ks(f,e,s,l,u){if(!s||!l||!l.imageAtlas)return;const p=l.imageAtlas.patternPositions;let v=p[s.to.toString()],w=p[s.from.toString()];if(!v&&w&&(v=w),!w&&v&&(w=v),!v||!w){const T=u.getPaintProperty(e);v=p[T],w=p[T]}v&&w&&f.setConstantPatternPositions(v,w)}function to(f,e,s,l,u,p,v){const w=f.context.gl,T="fill-pattern",C=s.paint.get(T),z=C&&C.constantOr(1),A=s.getCrossfadeParameters();let F,j,V,q,K;v?(j=z&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=w.LINES):(j=z?"fillPattern":"fill",F=w.TRIANGLES);const J=C.constantOr(null);for(const Q of l){const U=e.getTile(Q);if(z&&!U.patternsLoaded())continue;const ie=U.getBucket(s);if(!ie)continue;const ae=ie.programConfigurations.get(s.id),pe=f.useProgram(j,ae),xe=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Q);z&&(f.context.activeTexture.set(w.TEXTURE0),U.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),ae.updatePaintBuffers(A)),Ks(ae,T,J,U,s);const Ee=xe?Q:null,Be=f.translatePosMatrix(Ee?Ee.posMatrix:Q.posMatrix,U,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){q=ie.indexBuffer2,K=ie.segments2;const $e=[w.drawingBufferWidth,w.drawingBufferHeight];V=j==="fillOutlinePattern"&&z?th(Be,f,A,U,$e):wp(Be,$e)}else q=ie.indexBuffer,K=ie.segments,V=z?eh(Be,f,A,U):Gs(Be);pe.draw(f.context,F,u,f.stencilModeForClipping(Q),p,Ut.disabled,V,xe,s.id,ie.layoutVertexBuffer,q,K,s.paint,f.transform.zoom,ae)}}function Ho(f,e,s,l,u,p,v){const w=f.context,T=w.gl,C="fill-extrusion-pattern",z=s.paint.get(C),A=z.constantOr(1),F=s.getCrossfadeParameters(),j=s.paint.get("fill-extrusion-opacity"),V=z.constantOr(null);for(const q of l){const K=e.getTile(q),J=K.getBucket(s);if(!J)continue;const Q=f.style.map.terrain&&f.style.map.terrain.getTerrainData(q),U=J.programConfigurations.get(s.id),ie=f.useProgram(A?"fillExtrusionPattern":"fillExtrusion",U);A&&(f.context.activeTexture.set(T.TEXTURE0),K.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),U.updatePaintBuffers(F)),Ks(U,C,V,K,s);const ae=f.translatePosMatrix(q.posMatrix,K,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),pe=s.paint.get("fill-extrusion-vertical-gradient"),xe=A?Bo(ae,f,pe,j,q,F,K):Ha(ae,f,pe,j);ie.draw(w,w.gl.TRIANGLES,u,p,v,Ut.backCCW,xe,Q,s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,f.transform.zoom,U,f.style.map.terrain&&J.centroidVertexBuffer)}}function Js(f,e,s,l,u,p,v){const w=f.context,T=w.gl,C=s.fbo;if(!C)return;const z=f.useProgram("hillshade"),A=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,C.colorAttachment.get()),z.draw(w,T.TRIANGLES,u,p,v,Ut.disabled,((F,j,V,q)=>{const K=V.paint.get("hillshade-shadow-color"),J=V.paint.get("hillshade-highlight-color"),Q=V.paint.get("hillshade-accent-color");let U=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(U-=F.transform.angle);const ie=!F.options.moving;return{u_matrix:q?q.posMatrix:F.transform.calculatePosMatrix(j.tileID.toUnwrapped(),ie),u_image:0,u_latrange:No(0,j.tileID),u_light:[V.paint.get("hillshade-exaggeration"),U],u_shadow:K,u_highlight:J,u_accent:Q}})(f,s,l,A?e:null),A,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Ys(f,e,s,l,u,p){const v=f.context,w=v.gl,T=e.dem;if(T&&T.data){const C=T.dim,z=T.stride,A=T.getPixels();if(v.activeTexture.set(w.TEXTURE1),v.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(z),e.demTexture){const j=e.demTexture;j.update(A,{premultiply:!1}),j.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else e.demTexture=new gt(v,A,w.RGBA,{premultiply:!1}),e.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);v.activeTexture.set(w.TEXTURE0);let F=e.fbo;if(!F){const j=new gt(v,{width:C,height:C,data:null},w.RGBA);j.bind(w.LINEAR,w.CLAMP_TO_EDGE),F=e.fbo=v.createFramebuffer(C,C,!0,!1),F.colorAttachment.set(j.texture)}v.bindFramebuffer.set(F.framebuffer),v.viewport.set([0,0,C,C]),f.useProgram("hillshadePrepare").draw(v,w.TRIANGLES,l,u,p,Ut.disabled,((j,V)=>{const q=V.stride,K=d.H();return d.aP(K,0,d.X,-d.X,0,0,1),d.J(K,K,[0,-d.X,0]),{u_matrix:K,u_image:1,u_dimension:[q,q],u_zoom:j.overscaledZ,u_unpack:V.getUnpackVector()}})(e.tileID,T),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function _h(f,e,s,l,u,p){const v=l.paint.get("raster-fade-duration");if(!p&&v>0){const w=ne.now(),T=(w-f.timeAdded)/v,C=e?(w-e.timeAdded)/v:-1,z=s.getSource(),A=u.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),F=!e||Math.abs(e.tileID.overscaledZ-A)>Math.abs(f.tileID.overscaledZ-A),j=F&&f.refreshedUponExpiration?1:d.ac(F?T:1-C,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Tu=new d.aM(1,0,0,1),Dt=new d.aM(0,1,0,1),Wo=new d.aM(0,0,1,1),Fp=new d.aM(1,0,1,1),vh=new d.aM(0,1,1,1);function Qs(f,e,s,l){Xo(f,0,e+s/2,f.transform.width,s,l)}function xh(f,e,s,l){Xo(f,e-s/2,0,s,f.transform.height,l)}function Xo(f,e,s,l,u,p){const v=f.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,u*f.pixelRatio),v.clear({color:p}),w.disable(w.SCISSOR_TEST)}function wh(f,e,s){const l=f.context,u=l.gl,p=s.posMatrix,v=f.useProgram("debug"),w=xt.disabled,T=Gt.disabled,C=f.colorModeForRenderPass(),z="$debug",A=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(u.TEXTURE0);const F=e.getTileByID(s.key).latestRawTileData,j=Math.floor((F&&F.byteLength||0)/1024),V=e.getTile(s).tileSize,q=512/Math.min(V,512)*(s.overscaledZ/f.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(J,Q){J.initDebugOverlayCanvas();const U=J.debugOverlayCanvas,ie=J.context.gl,ae=J.debugOverlayCanvas.getContext("2d");ae.clearRect(0,0,U.width,U.height),ae.shadowColor="white",ae.shadowBlur=2,ae.lineWidth=1.5,ae.strokeStyle="white",ae.textBaseline="top",ae.font="bold 36px Open Sans, sans-serif",ae.fillText(Q,5,5),ae.strokeText(Q,5,5),J.debugOverlayTexture.update(U),J.debugOverlayTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE)}(f,`${K} ${j}kB`),v.draw(l,u.TRIANGLES,w,T,cr.alphaBlended,Ut.disabled,Wa(p,d.aM.transparent,q),null,z,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),v.draw(l,u.LINE_STRIP,w,T,C,Ut.disabled,Wa(p,d.aM.red),A,z,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function bh(f,e,s){const l=f.context,u=l.gl,p=f.colorModeForRenderPass(),v=new xt(u.LEQUAL,xt.ReadWrite,f.depthRangeFor3D),w=f.useProgram("terrain"),T=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const C of s){const z=f.renderToTexture.getTexture(C),A=e.getTerrainData(C.tileID);l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,z.texture);const F=f.transform.calculatePosMatrix(C.tileID.toUnwrapped()),j=e.getMeshFrameDelta(f.transform.zoom),V=f.transform.calculateFogMatrix(C.tileID.toUnwrapped()),q=ou(F,j,V,f.style.sky,f.transform.pitch);w.draw(l,u.TRIANGLES,v,Gt.disabled,p,Ut.backCCW,q,A,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Ko{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Jo{constructor(e,s){this.context=new Rp(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:d.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ot.maxUnderzooming+ot.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new su}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style._order)this.style._layers[u].resize()}setup(){const e=this.context,s=new d.aX;s.emplaceBack(0,0),s.emplaceBack(d.X,0),s.emplaceBack(0,d.X),s.emplaceBack(d.X,d.X),this.tileExtentBuffer=e.createVertexBuffer(s,ds.members),this.tileExtentSegments=d.a0.simpleSegment(0,0,4,2);const l=new d.aX;l.emplaceBack(0,0),l.emplaceBack(d.X,0),l.emplaceBack(0,d.X),l.emplaceBack(d.X,d.X),this.debugBuffer=e.createVertexBuffer(l,ds.members),this.debugSegments=d.a0.simpleSegment(0,0,4,5);const u=new d.$;u.emplaceBack(0,0,0,0),u.emplaceBack(d.X,0,d.X,0),u.emplaceBack(0,d.X,0,d.X),u.emplaceBack(d.X,d.X,d.X,d.X),this.rasterBoundsBuffer=e.createVertexBuffer(u,Hn.members),this.rasterBoundsSegments=d.a0.simpleSegment(0,0,4,2);const p=new d.aX;p.emplaceBack(0,0),p.emplaceBack(1,0),p.emplaceBack(0,1),p.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(p,ds.members),this.viewportSegments=d.a0.simpleSegment(0,0,4,2);const v=new d.aZ;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(v);const w=new d.aY;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(w);const T=this.context.gl;this.stencilClearMode=new Gt({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=d.H();d.aP(l,0,this.width,this.height,0,0,1),d.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,xt.disabled,this.stencilClearMode,cr.disabled,Ut.disabled,ui(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,u=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(cr.disabled),l.setDepthMode(xt.disabled);const p=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of s){const w=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(v);p.draw(l,u.TRIANGLES,xt.disabled,new Gt({func:u.ALWAYS,mask:0},w,255,u.KEEP,u.KEEP,u.REPLACE),cr.disabled,Ut.disabled,ui(v.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Gt({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Gt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((v,w)=>w.overscaledZ-v.overscaledZ),u=l[l.length-1].overscaledZ,p=l[0].overscaledZ-u+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const v={};for(let w=0;w<p;w++)v[w+u]=new Gt({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=p,[v,l]}return[{[u]:Gt.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new cr([e.CONSTANT_COLOR,e.ONE],new d.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cr.unblended:cr.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return xt.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new xt(l||this.context.gl.LEQUAL,s,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(ne.now()),this.imageManager.beginFrame();const l=this.style._order,u=this.style.sourceCaches,p={},v={},w={};for(const T in u){const C=u[T];C.used&&C.prepare(this.context),p[T]=C.getVisibleCoordinates(),v[T]=p[T].slice().reverse(),w[T]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<l.length;T++)if(this.style._layers[l[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of l){const C=this.style._layers[T];if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const z=v[C.source];(C.type==="custom"||z.length)&&this.renderLayer(this,u[C.source],C,z)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?d.aM.black:d.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(T,C){const z=T.context,A=z.gl,F=((J,Q,U)=>({u_sky_color:J.properties.get("sky-color"),u_horizon_color:J.properties.get("horizon-color"),u_horizon:(Q.height/2+Q.getHorizon())*U,u_sky_horizon_blend:J.properties.get("sky-horizon-blend")*Q.height/2*U}))(C,T.style.map.transform,T.pixelRatio),j=new xt(A.LEQUAL,xt.ReadWrite,[0,1]),V=Gt.disabled,q=T.colorModeForRenderPass(),K=T.useProgram("sky");if(!C.mesh){const J=new d.aX;J.emplaceBack(-1,-1),J.emplaceBack(1,-1),J.emplaceBack(1,1),J.emplaceBack(-1,1);const Q=new d.aY;Q.emplaceBack(0,1,2),Q.emplaceBack(0,2,3),C.mesh=new Ko(z.createVertexBuffer(J,ds.members),z.createIndexBuffer(Q),d.a0.simpleSegment(0,0,J.length,Q.length))}K.draw(z,A.TRIANGLES,j,V,q,Ut.disabled,F,void 0,"sky",C.mesh.vertexBuffer,C.mesh.indexBuffer,C.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[l[this.currentLayer]],C=u[T.source],z=p[T.source];this._renderTileClippingMasks(T,z),this.renderLayer(this,C,T,z)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const T=this.style._layers[l[this.currentLayer]],C=u[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const z=(T.type==="symbol"?w:v)[T.source];this._renderTileClippingMasks(T,p[T.source]),this.renderLayer(this,C,T,z)}if(this.options.showTileBoundaries){const T=function(C,z){let A=null;const F=Object.values(C._layers).flatMap(K=>K.source&&!K.isHidden(z)?[C.sourceCaches[K.source]]:[]),j=F.filter(K=>K.getSource().type==="vector"),V=F.filter(K=>K.getSource().type!=="vector"),q=K=>{(!A||A.getSource().maxzoom<K.getSource().maxzoom)&&(A=K)};return j.forEach(K=>q(K)),A||V.forEach(K=>q(K)),A}(this.style,this.transform.zoom);T&&function(C,z,A){for(let F=0;F<A.length;F++)wh(C,z,A[F])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const C=T.transform.padding;Qs(T,T.transform.height-(C.top||0),3,Tu),Qs(T,C.bottom||0,3,Dt),xh(T,C.left||0,3,Wo),xh(T,T.transform.width-(C.right||0),3,Fp);const z=T.transform.centerPoint;(function(A,F,j,V){Xo(A,F-1,j-10,2,20,V),Xo(A,F-10,j-1,20,2,V)})(T,z.x,T.transform.height-z.y,vh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let u=this.terrainFacilitator.dirty;u||(u=e?!d.a_(s,l):!d.a$(s,l)),u||(u=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),u&&(d.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(p,v){const w=p.context,T=w.gl,C=cr.unblended,z=new xt(T.LEQUAL,xt.ReadWrite,[0,1]),A=v.getTerrainMesh(),F=v.sourceCache.getRenderableTiles(),j=p.useProgram("terrainDepth");w.bindFramebuffer.set(v.getFramebuffer("depth").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1});for(const V of F){const q=v.getTerrainData(V.tileID),K={u_matrix:p.transform.calculatePosMatrix(V.tileID.toUnwrapped()),u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};j.draw(w,T.TRIANGLES,z,Gt.disabled,C,Ut.backCCW,K,q,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain),function(p,v){const w=p.context,T=w.gl,C=cr.unblended,z=new xt(T.LEQUAL,xt.ReadWrite,[0,1]),A=v.getTerrainMesh(),F=v.getCoordsTexture(),j=v.sourceCache.getRenderableTiles(),V=p.useProgram("terrainCoords");w.bindFramebuffer.set(v.getFramebuffer("coords").framebuffer),w.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),w.clear({color:d.aM.transparent,depth:1}),v.coordsIndex=[];for(const q of j){const K=v.getTerrainData(q.tileID);w.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,F.texture);const J={u_matrix:p.transform.calculatePosMatrix(q.tileID.toUnwrapped()),u_terrain_coords_id:(255-v.coordsIndex.length)/255,u_texture:0,u_ele_delta:v.getMeshFrameDelta(p.transform.zoom)};V.draw(w,T.TRIANGLES,z,Gt.disabled,C,Ut.backCCW,J,K,"terrain",A.vertexBuffer,A.indexBuffer,A.segments),v.coordsIndex.push(q.tileID.key)}w.bindFramebuffer.set(null),w.viewport.set([0,0,p.width,p.height])}(this,this.style.map.terrain))}renderLayer(e,s,l,u){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(u||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(p,v,w,T,C){if(p.renderPass!=="translucent")return;const z=Gt.disabled,A=p.colorModeForRenderPass();(w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(F,j,V,q,K,J,Q,U,ie){const ae=j.transform,pe=hs(),xe=K==="map",Ee=J==="map";for(const Be of F){const $e=q.getTile(Be),Ae=$e.getBucket(V);if(!Ae||!Ae.text||!Ae.text.segments.get().length)continue;const ze=d.ag(Ae.textSizeData,ae.zoom),Je=bt($e,1,j.transform.zoom),ht=Xn(Be.posMatrix,Ee,xe,j.transform,Je),De=V.layout.get("icon-text-fit")!=="none"&&Ae.hasIconData();if(ze){const je=Math.pow(2,ae.zoom-$e.tileID.overscaledZ),lt=j.style.map.terrain?(yt,St)=>j.style.map.terrain.getElevation(Be,yt,St):null,Yt=pe.translatePosition(ae,$e,Q,U);Xs(Ae,xe,Ee,ie,ae,ht,Be.posMatrix,je,ze,De,pe,Yt,Be.toUnwrapped(),lt)}}}(T,p,w,v,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),C),w.paint.get("icon-opacity").constantOr(1)!==0&&wu(p,v,w,T,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),z,A),w.paint.get("text-opacity").constantOr(1)!==0&&wu(p,v,w,T,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),z,A),v.map.showCollisionBoxes&&(Ja(p,v,w,T,!0),Ja(p,v,w,T,!1))})(e,s,l,u,this.style.placement.variableOffsets);break;case"circle":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const C=w.paint.get("circle-opacity"),z=w.paint.get("circle-stroke-width"),A=w.paint.get("circle-stroke-opacity"),F=!w.layout.get("circle-sort-key").isConstant();if(C.constantOr(1)===0&&(z.constantOr(1)===0||A.constantOr(1)===0))return;const j=p.context,V=j.gl,q=p.depthModeForSublayer(0,xt.ReadOnly),K=Gt.disabled,J=p.colorModeForRenderPass(),Q=[];for(let U=0;U<T.length;U++){const ie=T[U],ae=v.getTile(ie),pe=ae.getBucket(w);if(!pe)continue;const xe=pe.programConfigurations.get(w.id),Ee=p.useProgram("circle",xe),Be=pe.layoutVertexBuffer,$e=pe.indexBuffer,Ae=p.style.map.terrain&&p.style.map.terrain.getTerrainData(ie),ze={programConfiguration:xe,program:Ee,layoutVertexBuffer:Be,indexBuffer:$e,uniformValues:bp(p,ie,ae,w),terrainData:Ae};if(F){const Je=pe.segments.get();for(const ht of Je)Q.push({segments:new d.a0([ht]),sortKey:ht.sortKey,state:ze})}else Q.push({segments:pe.segments,sortKey:0,state:ze})}F&&Q.sort((U,ie)=>U.sortKey-ie.sortKey);for(const U of Q){const{programConfiguration:ie,program:ae,layoutVertexBuffer:pe,indexBuffer:xe,uniformValues:Ee,terrainData:Be}=U.state;ae.draw(j,V.TRIANGLES,q,K,J,Ut.disabled,Ee,Be,w.id,pe,xe,U.segments,w.paint,p.transform.zoom,ie)}})(e,s,l,u);break;case"heatmap":(function(p,v,w,T){if(w.paint.get("heatmap-opacity")===0)return;const C=p.context;if(p.style.map.terrain){for(const z of T){const A=v.getTile(z);v.hasRenderableParent(z)||(p.renderPass==="offscreen"?Su(p,A,w,z):p.renderPass==="translucent"&&vs(p,w,z))}C.viewport.set([0,0,p.width,p.height])}else p.renderPass==="offscreen"?function(z,A,F,j){const V=z.context,q=V.gl,K=Gt.disabled,J=new cr([q.ONE,q.ONE],d.aM.transparent,[!0,!0,!0,!0]);(function(Q,U,ie){const ae=Q.gl;Q.activeTexture.set(ae.TEXTURE1),Q.viewport.set([0,0,U.width/4,U.height/4]);let pe=ie.heatmapFbos.get(d.aU);pe?(ae.bindTexture(ae.TEXTURE_2D,pe.colorAttachment.get()),Q.bindFramebuffer.set(pe.framebuffer)):(pe=Qa(Q,U.width/4,U.height/4),ie.heatmapFbos.set(d.aU,pe))})(V,z,F),V.clear({color:d.aM.transparent});for(let Q=0;Q<j.length;Q++){const U=j[Q];if(A.hasRenderableParent(U))continue;const ie=A.getTile(U),ae=ie.getBucket(F);if(!ae)continue;const pe=ae.programConfigurations.get(F.id),xe=z.useProgram("heatmap",pe),{zoom:Ee}=z.transform;xe.draw(V,q.TRIANGLES,xt.disabled,K,J,Ut.disabled,ci(U.posMatrix,ie,Ee,F.paint.get("heatmap-intensity")),null,F.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,F.paint,z.transform.zoom,pe)}V.viewport.set([0,0,z.width,z.height])}(p,v,w,T):p.renderPass==="translucent"&&function(z,A){const F=z.context,j=F.gl;F.setColorMode(z.colorModeForRenderPass());const V=A.heatmapFbos.get(d.aU);V&&(F.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,V.colorAttachment.get()),F.activeTexture.set(j.TEXTURE1),eo(F,A).bind(j.LINEAR,j.CLAMP_TO_EDGE),z.useProgram("heatmapTexture").draw(F,j.TRIANGLES,xt.disabled,Gt.disabled,z.colorModeForRenderPass(),Ut.disabled,Oo(z,A,0,1),null,A.id,z.viewportBuffer,z.quadTriangleIndexBuffer,z.viewportSegments,A.paint,z.transform.zoom))}(p,w)})(e,s,l,u);break;case"line":(function(p,v,w,T){if(p.renderPass!=="translucent")return;const C=w.paint.get("line-opacity"),z=w.paint.get("line-width");if(C.constantOr(1)===0||z.constantOr(1)===0)return;const A=p.depthModeForSublayer(0,xt.ReadOnly),F=p.colorModeForRenderPass(),j=w.paint.get("line-dasharray"),V=w.paint.get("line-pattern"),q=V.constantOr(1),K=w.paint.get("line-gradient"),J=w.getCrossfadeParameters(),Q=q?"linePattern":j?"lineSDF":K?"lineGradient":"line",U=p.context,ie=U.gl;let ae=!0;for(const pe of T){const xe=v.getTile(pe);if(q&&!xe.patternsLoaded())continue;const Ee=xe.getBucket(w);if(!Ee)continue;const Be=Ee.programConfigurations.get(w.id),$e=p.context.program.get(),Ae=p.useProgram(Q,Be),ze=ae||Ae.program!==$e,Je=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe),ht=V.constantOr(null);if(ht&&xe.imageAtlas){const lt=xe.imageAtlas,Yt=lt.patternPositions[ht.to.toString()],yt=lt.patternPositions[ht.from.toString()];Yt&&yt&&Be.setConstantPatternPositions(Yt,yt)}const De=Je?pe:null,je=q?Hs(p,xe,w,J,De):j?Sp(p,xe,w,j,J,De):K?rh(p,xe,w,Ee.lineClipsArray.length,De):jo(p,xe,w,De);if(q)U.activeTexture.set(ie.TEXTURE0),xe.imageAtlasTexture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE),Be.updatePaintBuffers(J);else if(j&&(ze||p.lineAtlas.dirty))U.activeTexture.set(ie.TEXTURE0),p.lineAtlas.bind(U);else if(K){const lt=Ee.gradients[w.id];let Yt=lt.texture;if(w.gradientVersion!==lt.version){let yt=256;if(w.stepInterpolant){const St=v.getSource().maxzoom,Qt=pe.canonical.z===St?Math.ceil(1<<p.transform.maxZoom-pe.canonical.z):1;yt=d.ac(d.aV(Ee.maxLineLength/d.X*1024*Qt),256,U.maxTextureSize)}lt.gradient=d.aW({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:yt,image:lt.gradient||void 0,clips:Ee.lineClipsArray}),lt.texture?lt.texture.update(lt.gradient):lt.texture=new gt(U,lt.gradient,ie.RGBA),lt.version=w.gradientVersion,Yt=lt.texture}U.activeTexture.set(ie.TEXTURE0),Yt.bind(w.stepInterpolant?ie.NEAREST:ie.LINEAR,ie.CLAMP_TO_EDGE)}Ae.draw(U,ie.TRIANGLES,A,p.stencilModeForClipping(pe),F,Ut.disabled,je,Je,w.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,w.paint,p.transform.zoom,Be,Ee.layoutVertexBuffer2),ae=!1}})(e,s,l,u);break;case"fill":(function(p,v,w,T){const C=w.paint.get("fill-color"),z=w.paint.get("fill-opacity");if(z.constantOr(1)===0)return;const A=p.colorModeForRenderPass(),F=w.paint.get("fill-pattern"),j=p.opaquePassEnabledForLayer()&&!F.constantOr(1)&&C.constantOr(d.aM.transparent).a===1&&z.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===j){const V=p.depthModeForSublayer(1,p.renderPass==="opaque"?xt.ReadWrite:xt.ReadOnly);to(p,v,w,T,V,A,!1)}if(p.renderPass==="translucent"&&w.paint.get("fill-antialias")){const V=p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,xt.ReadOnly);to(p,v,w,T,V,A,!0)}})(e,s,l,u);break;case"fill-extrusion":(function(p,v,w,T){const C=w.paint.get("fill-extrusion-opacity");if(C!==0&&p.renderPass==="translucent"){const z=new xt(p.context.gl.LEQUAL,xt.ReadWrite,p.depthRangeFor3D);if(C!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))Ho(p,v,w,T,z,Gt.disabled,cr.disabled),Ho(p,v,w,T,z,p.stencilModeFor3D(),p.colorModeForRenderPass());else{const A=p.colorModeForRenderPass();Ho(p,v,w,T,z,Gt.disabled,A)}}})(e,s,l,u);break;case"hillshade":(function(p,v,w,T){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const C=p.context,z=p.depthModeForSublayer(0,xt.ReadOnly),A=p.colorModeForRenderPass(),[F,j]=p.renderPass==="translucent"?p.stencilConfigForOverlap(T):[{},T];for(const V of j){const q=v.getTile(V);q.needsHillshadePrepare!==void 0&&q.needsHillshadePrepare&&p.renderPass==="offscreen"?Ys(p,q,w,z,Gt.disabled,A):p.renderPass==="translucent"&&Js(p,V,q,w,z,F[V.overscaledZ],A)}C.viewport.set([0,0,p.width,p.height])})(e,s,l,u);break;case"raster":(function(p,v,w,T){if(p.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!T.length)return;const C=p.context,z=C.gl,A=v.getSource(),F=p.useProgram("raster"),j=p.colorModeForRenderPass(),[V,q]=A instanceof Mn?[{},T]:p.stencilConfigForOverlap(T),K=q[q.length-1].overscaledZ,J=!p.options.moving;for(const Q of q){const U=p.depthModeForSublayer(Q.overscaledZ-K,w.paint.get("raster-opacity")===1?xt.ReadWrite:xt.ReadOnly,z.LESS),ie=v.getTile(Q);ie.registerFadeDuration(w.paint.get("raster-fade-duration"));const ae=v.findLoadedParent(Q,0),pe=v.findLoadedSibling(Q),xe=_h(ie,ae||pe||null,v,w,p.transform,p.style.map.terrain);let Ee,Be;const $e=w.paint.get("raster-resampling")==="nearest"?z.NEAREST:z.LINEAR;C.activeTexture.set(z.TEXTURE0),ie.texture.bind($e,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),C.activeTexture.set(z.TEXTURE1),ae?(ae.texture.bind($e,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),Ee=Math.pow(2,ae.tileID.overscaledZ-ie.tileID.overscaledZ),Be=[ie.tileID.canonical.x*Ee%1,ie.tileID.canonical.y*Ee%1]):ie.texture.bind($e,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),ie.texture.useMipmap&&C.extTextureFilterAnisotropic&&p.transform.pitch>20&&z.texParameterf(z.TEXTURE_2D,C.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,C.extTextureFilterAnisotropicMax);const Ae=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Q),ze=Ae?Q:null,Je=ze?ze.posMatrix:p.transform.calculatePosMatrix(Q.toUnwrapped(),J),ht=Tp(Je,Be||[0,0],Ee||1,xe,w);A instanceof Mn?F.draw(C,z.TRIANGLES,U,Gt.disabled,j,Ut.disabled,ht,Ae,w.id,A.boundsBuffer,p.quadTriangleIndexBuffer,A.boundsSegments):F.draw(C,z.TRIANGLES,U,V[Q.overscaledZ],j,Ut.disabled,ht,Ae,w.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}})(e,s,l,u);break;case"background":(function(p,v,w,T){const C=w.paint.get("background-color"),z=w.paint.get("background-opacity");if(z===0)return;const A=p.context,F=A.gl,j=p.transform,V=j.tileSize,q=w.paint.get("background-pattern");if(p.isPatternMissing(q))return;const K=!q&&C.a===1&&z===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==K)return;const J=Gt.disabled,Q=p.depthModeForSublayer(0,K==="opaque"?xt.ReadWrite:xt.ReadOnly),U=p.colorModeForRenderPass(),ie=p.useProgram(q?"backgroundPattern":"background"),ae=T||j.coveringTiles({tileSize:V,terrain:p.style.map.terrain});q&&(A.activeTexture.set(F.TEXTURE0),p.imageManager.bind(p.context));const pe=w.getCrossfadeParameters();for(const xe of ae){const Ee=T?xe.posMatrix:p.transform.calculatePosMatrix(xe.toUnwrapped()),Be=q?cu(Ee,z,p,q,{tileID:xe,tileSize:V},pe):Vo(Ee,z,C),$e=p.style.map.terrain&&p.style.map.terrain.getTerrainData(xe);ie.draw(A,F.TRIANGLES,Q,J,U,Ut.disabled,Be,$e,w.id,p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}})(e,0,l,u);break;case"custom":(function(p,v,w){const T=p.context,C=w.implementation;if(p.renderPass==="offscreen"){const z=C.prerender;z&&(p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),z.call(C,T.gl,p.transform.customLayerMatrix()),T.setDirty(),p.setBaseState())}else if(p.renderPass==="translucent"){p.setCustomLayerDefaults(),T.setColorMode(p.colorModeForRenderPass()),T.setStencilMode(Gt.disabled);const z=C.renderingMode==="3d"?new xt(p.context.gl.LEQUAL,xt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,xt.ReadOnly);T.setDepthMode(z),C.render(T.gl,p.transform.customLayerMatrix(),{farZ:p.transform.farZ,nearZ:p.transform.nearZ,fov:p.transform._fov,modelViewProjectionMatrix:p.transform.modelViewProjectionMatrix,projectionMatrix:p.transform.projectionMatrix}),T.setDirty(),p.setBaseState(),T.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,u,p){if(!l[0]&&!l[1])return e;const v=p?u==="map"?this.transform.angle:0:u==="viewport"?-this.transform.angle:0;if(v){const C=Math.sin(v),z=Math.cos(v);l=[l[0]*z-l[1]*C,l[0]*C+l[1]*z]}const w=[p?l[0]:bt(s,l[0],this.transform.zoom),p?l[1]:bt(s,l[1],this.transform.zoom),0],T=new Float32Array(16);return d.J(T,e,w),T}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new lu(this.context,Kn[e],s,hu[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new gt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class ea{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const u=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const T=1/(w=d.af([],w,e))[3]/s*u;return d.b1(w,w,[T,T,1/w[3],T])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const T=function(F,j){var V=j[0],q=j[1],K=j[2],J=V*V+q*q+K*K;return J>0&&(J=1/Math.sqrt(J)),F[0]=j[0]*J,F[1]=j[1]*J,F[2]=j[2]*J,F}([],function(F,j,V){var q=j[0],K=j[1],J=j[2],Q=V[0],U=V[1],ie=V[2];return F[0]=K*ie-J*U,F[1]=J*Q-q*ie,F[2]=q*U-K*Q,F}([],We([],p[w[0]],p[w[1]]),We([],p[w[2]],p[w[1]]))),C=-((z=T)[0]*(A=p[w[1]])[0]+z[1]*A[1]+z[2]*A[2]);var z,A;return T.concat(C)});return new ea(p,v)}}class ta{constructor(e,s){this.min=e,this.max=s,this.center=function(l,u,p){return l[0]=.5*u[0],l[1]=.5*u[1],l[2]=.5*u[2],l}([],function(l,u,p){return l[0]=u[0]+p[0],l[1]=u[1]+p[1],l[2]=u[2]+p[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=Ue(this.min),u=Ue(this.max);for(let p=0;p<s.length;p++)l[p]=s[p]?this.min[p]:this.center[p],u[p]=s[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new ta(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let v=0;for(let w=0;w<s.length;w++)d.b2(p,s[w])>=0&&v++;if(v===0)return 0;v!==s.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][u]-this.min[u];p=Math.min(p,T),v=Math.max(v,T)}if(v<0||p>this.max[u]-this.min[u])return 0}return 1}}class ra{constructor(e=0,s=0,l=0,u=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=u}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=d.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=d.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=d.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=d.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=d.ac((this.left+e-this.right)/2,0,e),u=d.ac((this.top+s-this.bottom)/2,0,s);return new d.P(l,u)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ra(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const ku=85.051129;class ia{constructor(e,s,l,u,p){this.tileSize=512,this._renderWorldCopies=p===void 0||!!p,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=u??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ra,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new ia(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-d.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new d.A(4);return d.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,u,p){var v=u[0],w=u[1],T=u[2],C=u[3],z=Math.sin(p),A=Math.cos(p);l[0]=v*A+T*z,l[1]=w*A+C*z,l[2]=v*-z+T*A,l[3]=w*-z+C*A}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=d.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new d.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new d.P(0,0)),u=this.pointCoordinate(new d.P(this.width,0)),p=this.pointCoordinate(new d.P(this.width,this.height)),v=this.pointCoordinate(new d.P(0,this.height)),w=Math.floor(Math.min(l.x,u.x,p.x,v.x)),T=Math.floor(Math.max(l.x,u.x,p.x,v.x)),C=1;for(let z=w-C;z<=T+C;z++)z!==0&&s.push(new d.b4(z,e))}return s}coveringTiles(e){var s,l;let u=this.coveringZoomLevel(e);const p=u;if(e.minzoom!==void 0&&u<e.minzoom)return[];e.maxzoom!==void 0&&u>e.maxzoom&&(u=e.maxzoom);const v=this.pointCoordinate(this.getCameraPoint()),w=d.Z.fromLngLat(this.center),T=Math.pow(2,u),C=[T*v.x,T*v.y,0],z=[T*w.x,T*w.y,0],A=ea.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,u);let F=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(F=u);const j=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,V=U=>({aabb:new ta([U*T,0,0],[(U+1)*T,T,0]),zoom:0,x:0,y:0,wrap:U,fullyVisible:!1}),q=[],K=[],J=u,Q=e.reparseOverscaled?p:u;if(this._renderWorldCopies)for(let U=1;U<=3;U++)q.push(V(-U)),q.push(V(U));for(q.push(V(0));q.length>0;){const U=q.pop(),ie=U.x,ae=U.y;let pe=U.fullyVisible;if(!pe){const Ae=U.aabb.intersects(A);if(Ae===0)continue;pe=Ae===2}const xe=e.terrain?C:z,Ee=U.aabb.distanceX(xe),Be=U.aabb.distanceY(xe),$e=Math.max(Math.abs(Ee),Math.abs(Be));if(U.zoom===J||$e>j+(1<<J-U.zoom)-2&&U.zoom>=F){const Ae=J-U.zoom,ze=C[0]-.5-(ie<<Ae),Je=C[1]-.5-(ae<<Ae);K.push({tileID:new d.S(U.zoom===J?Q:U.zoom,U.wrap,U.zoom,ie,ae),distanceSq:it([z[0]-.5-ie,z[1]-.5-ae]),tileDistanceToCamera:Math.sqrt(ze*ze+Je*Je)})}else for(let Ae=0;Ae<4;Ae++){const ze=(ie<<1)+Ae%2,Je=(ae<<1)+(Ae>>1),ht=U.zoom+1;let De=U.aabb.quadrant(Ae);if(e.terrain){const je=new d.S(ht,U.wrap,ht,ze,Je),lt=e.terrain.getMinMaxElevation(je),Yt=(s=lt.minElevation)!==null&&s!==void 0?s:this.elevation,yt=(l=lt.maxElevation)!==null&&l!==void 0?l:this.elevation;De=new ta([De.min[0],De.min[1],Yt],[De.max[0],De.max[1],yt])}q.push({aabb:De,zoom:ht,x:ze,y:Je,wrap:U.wrap,fullyVisible:pe})}}return K.sort((U,ie)=>U.distanceSq-ie.distanceSq).map(U=>U.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=d.ac(e.lat,-85.051129,ku);return new d.P(d.O(e.lng)*this.worldSize,d.Q(s)*this.worldSize)}unproject(e){return new d.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,u=this.pointLocation(this.centerPoint,e),p=e.getElevationForLngLatZoom(u,this.tileZoom);if(!(this.elevation-p))return;const v=l+s-p,w=Math.cos(this._pitch)*this.cameraToCenterDistance/v/d.b5(1,u.lat),T=this.scaleZoom(w/this.tileSize);this._elevation=p,this._center=u,this.zoom=T}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),u=this.pointCoordinate(this.centerPoint),p=this.locationCoordinate(e),v=new d.Z(p.x-(l.x-u.x),p.y-(l.y-u.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return d.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const F=s.pointCoordinate(e);if(F!=null)return F}const l=[e.x,e.y,0,1],u=[e.x,e.y,1,1];d.af(l,l,this.pixelMatrixInverse),d.af(u,u,this.pixelMatrixInverse);const p=l[3],v=u[3],w=l[1]/p,T=u[1]/v,C=l[2]/p,z=u[2]/v,A=C===z?0:(0-C)/(z-C);return new d.Z(d.y.number(l[0]/p,u[0]/v,A)/this.worldSize,d.y.number(w,T,A)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const u=[e.x*this.worldSize,e.y*this.worldSize,s,1];return d.af(u,u,l),new d.P(u[0]/u[3],u[1]/u[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new me().extend(this.pointLocation(new d.P(0,e))).extend(this.pointLocation(new d.P(this.width,e))).extend(this.pointLocation(new d.P(this.width,this.height))).extend(this.pointLocation(new d.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new me([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,ku])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),u=s.x+Math.pow(2,s.z)*e.wrap,p=d.an(new Float64Array(16));return d.J(p,p,[u*l,s.y*l,0]),d.K(p,p,[l/d.X,l/d.X,1]),p}calculatePosMatrix(e,s=!1){const l=e.key,u=s?this._alignedPosMatrixCache:this._posMatrixCache;if(u[l])return u[l];const p=this.calculateTileMatrix(e);return d.L(p,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,p),u[l]=new Float32Array(p),u[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const u=this.calculateTileMatrix(e);return d.L(u,this.fogMatrix,u),l[s]=new Float32Array(u),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=d.ac(+s,this.minZoom,this.maxZoom);const l={center:new d.N(e.lng,e.lat),zoom:s};let u=this.lngRange;if(!this._renderWorldCopies&&u===null){const U=179.9999999999;u=[-U,U]}const p=this.tileSize*this.zoomScale(l.zoom);let v=0,w=p,T=0,C=p,z=0,A=0;const{x:F,y:j}=this.size;if(this.latRange){const U=this.latRange;v=d.Q(U[1])*p,w=d.Q(U[0])*p,w-v<j&&(z=j/(w-v))}u&&(T=d.b3(d.O(u[0])*p,0,p),C=d.b3(d.O(u[1])*p,0,p),C<T&&(C+=p),C-T<F&&(A=F/(C-T)));const{x:V,y:q}=this.project.call({worldSize:p},e);let K,J;const Q=Math.max(A||0,z||0);if(Q){const U=new d.P(A?(C+T)/2:V,z?(w+v)/2:q);return l.center=this.unproject.call({worldSize:p},U).wrap(),l.zoom+=this.scaleZoom(Q),l}if(this.latRange){const U=j/2;q-U<v&&(J=v+U),q+U>w&&(J=w-U)}if(u){const U=(T+C)/2;let ie=V;this._renderWorldCopies&&(ie=d.b3(V,U-p/2,U+p/2));const ae=F/2;ie-ae<T&&(K=T+ae),ie+ae>C&&(K=C-ae)}if(K!==void 0||J!==void 0){const U=new d.P(K??V,J??q);l.center=this.unproject.call({worldSize:p},U).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=d.b5(1,this.center.lat)*this.worldSize;let u=d.an(new Float64Array(16));d.K(u,u,[this.width/2,-this.height/2,1]),d.J(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=d.an(new Float64Array(16)),d.K(u,u,[1,-1,1]),d.J(u,u,[-1,-1,0]),d.K(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u;const p=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),v=Math.min(this.elevation,this.minElevationForCurrentTile),w=p-v*this._pixelPerMeter/Math.cos(this._pitch),T=v<0?w:p,C=Math.PI/2+this._pitch,z=this._fov*(.5+e.y/this.height),A=Math.sin(z)*T/Math.sin(d.ac(Math.PI-C-z,.01,Math.PI-.01)),F=this.getHorizon(),j=2*Math.atan(F/this.cameraToCenterDistance)*(.5+e.y/(2*F)),V=Math.sin(j)*T/Math.sin(d.ac(Math.PI-C-j,.01,Math.PI-.01)),q=Math.min(A,V);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*q+T),this.nearZ=this.height/50,u=new Float64Array(16),d.b6(u,this._fov,this.width/this.height,this.nearZ,this.farZ),u[8]=2*-e.x/this.width,u[9]=2*e.y/this.height,this.projectionMatrix=d.ae(u),d.K(u,u,[1,-1,1]),d.J(u,u,[0,0,-this.cameraToCenterDistance]),d.b7(u,u,this._pitch),d.ad(u,u,this.angle),d.J(u,u,[-s,-l,0]),this.mercatorMatrix=d.K([],u,[this.worldSize,this.worldSize,this.worldSize]),d.K(u,u,[1,1,this._pixelPerMeter]),this.pixelMatrix=d.L(new Float64Array(16),this.labelPlaneMatrix,u),d.J(u,u,[0,0,-this.elevation]),this.modelViewProjectionMatrix=u,this.invModelViewProjectionMatrix=d.as([],u),this.fogMatrix=new Float64Array(16),d.b6(this.fogMatrix,this._fov,this.width/this.height,p,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,d.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),d.b7(this.fogMatrix,this.fogMatrix,this._pitch),d.ad(this.fogMatrix,this.fogMatrix,this.angle),d.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),d.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),d.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=d.L(new Float64Array(16),this.labelPlaneMatrix,u);const K=this.width%2/2,J=this.height%2/2,Q=Math.cos(this.angle),U=Math.sin(this.angle),ie=s-Math.round(s)+Q*K+U*J,ae=l-Math.round(l)+Q*J+U*K,pe=new Float64Array(u);if(d.J(pe,pe,[ie>.5?ie-1:ie,ae>.5?ae-1:ae,0]),this.alignedModelViewProjectionMatrix=pe,u=d.as(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");this.pixelMatrixInverse=u,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new d.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return d.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,u=s.y,p=s.x,v=s.y;for(const w of e)l=Math.min(l,w.x),u=Math.min(u,w.y),p=Math.max(p,w.x),v=Math.max(v,w.y);return[new d.P(l,u),new d.P(p,u),new d.P(p,v),new d.P(l,v),new d.P(l,u)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),u=[l.x*this.worldSize,l.y*this.worldSize,s,1];return d.af(u,u,this.modelViewProjectionMatrix),u[2]/u[3]}}function ro(f,e){let s,l=!1,u=null,p=null;const v=()=>{u=null,l&&(f.apply(p,s),u=setTimeout(v,e),l=!1)};return(...w)=>(l=!0,p=this,s=w,u||v(),u)}class Yo{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(l=u)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let u=l;u.split("&").length>0&&(u=u.split("&")[0]),this._hashName&&(u=`${this._hashName}=${l}`);let p=window.location.hash.replace(u,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let v=window.location.href.replace(/(#.+)?$/,p);v=v.replace("&&","&"),window.history.replaceState(window.history.state,null,v)},this._updateHash=ro(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,u=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,u),v=Math.round(s.lng*p)/p,w=Math.round(s.lat*p)/p,T=this._map.getBearing(),C=this._map.getPitch();let z="";if(z+=e?`/${v}/${w}/${l}`:`${l}/${w}/${v}`,(T||C)&&(z+="/"+Math.round(10*T)/10),C&&(z+=`/${Math.round(C)}`),this._hashName){const A=this._hashName;let F=!1;const j=window.location.hash.slice(1).split("&").map(V=>{const q=V.split("=")[0];return q===A?(F=!0,`${q}=${z}`):V}).filter(V=>V);return F||j.push(`${A}=${z}`),`#${j.join("&")}`}return`#${z}`}}const Qo={linearity:.3,easing:d.b8(0,0,.3,1)},Eu=d.e({deceleration:2500,maxSpeed:1400},Qo),Bp=d.e({deceleration:20,maxSpeed:1400},Qo),Sh=d.e({deceleration:1e3,maxSpeed:360},Qo),el=d.e({deceleration:1e3,maxSpeed:90},Qo);class Iu{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ne.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=ne.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new d.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)s.zoom+=p.zoomDelta||0,s.bearing+=p.bearingDelta||0,s.pitch+=p.pitchDelta||0,p.panDelta&&s.pan._add(p.panDelta),p.around&&(s.around=p.around),p.pinchAround&&(s.pinchAround=p.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(s.pan.mag()){const p=no(s.pan.mag(),l,d.e({},Eu,e||{}));u.offset=s.pan.mult(p.amount/s.pan.mag()),u.center=this._map.transform.center,io(u,p)}if(s.zoom){const p=no(s.zoom,l,Bp);u.zoom=this._map.transform.zoom+p.amount,io(u,p)}if(s.bearing){const p=no(s.bearing,l,Sh);u.bearing=this._map.transform.bearing+d.ac(p.amount,-179,179),io(u,p)}if(s.pitch){const p=no(s.pitch,l,el);u.pitch=this._map.transform.pitch+p.amount,io(u,p)}if(u.zoom||u.bearing){const p=s.pinchAround===void 0?s.around:s.pinchAround;u.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),d.e(u,{noMoveStart:!0})}}function io(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function no(f,e,s){const{maxSpeed:l,linearity:u,deceleration:p}=s,v=d.ac(f*u/(e/1e3),-l,l),w=Math.abs(v)/(p*u);return{easing:s.easing,duration:1e3*w,amount:v*(w/2)}}class jr extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,u={}){const p=G.mousePos(s.getCanvas(),l),v=s.unproject(p);super(e,d.e({point:p,lngLat:v,originalEvent:l},u)),this._defaultPrevented=!1,this.target=s}}class xs extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const u=e==="touchend"?l.changedTouches:l.touches,p=G.touchPos(s.getCanvasContainer(),u),v=p.map(T=>s.unproject(T)),w=p.reduce((T,C,z,A)=>T.add(C.div(A.length)),new d.P(0,0));super(e,{points:p,point:w,lngLats:v,lngLat:s.unproject(w),originalEvent:l}),this._defaultPrevented=!1}}class Th extends d.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class kh{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Th(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new jr(e.type,this._map,e))}mouseup(e){this._map.fire(new jr(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new jr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new jr(e.type,this._map,e))}mouseover(e){this._map.fire(new jr(e.type,this._map,e))}mouseout(e){this._map.fire(new jr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new xs(e.type,this._map,e))}touchmove(e){this._map.fire(new xs(e.type,this._map,e))}touchend(e){this._map.fire(new xs(e.type,this._map,e))}touchcancel(e){this._map.fire(new xs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hr{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new jr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new jr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Yi{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(d.P.convert(e),this._map.terrain)}}class Ti{constructor(e,s){this._map=e,this._tr=new Yi(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(G.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const u=this._startPos;this._lastPos=l,this._box||(this._box=G.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(u.x,l.x),v=Math.max(u.x,l.x),w=Math.min(u.y,l.y),T=Math.max(u.y,l.y);G.setTransform(this._box,`translate(${p}px,${w}px)`),this._box.style.width=v-p+"px",this._box.style.height=T-w+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,u=s;if(this.reset(),G.suppressClick(),l.x!==u.x||l.y!==u.y)return this._map.fire(new d.k("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(l,u,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(G.remove(this._box),this._box=null),G.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new d.k(e,{originalEvent:s}))}}function so(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class Cu{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(u){const p=new d.P(0,0);for(const v of u)p._add(v);return p.div(u.length)}(s),this.touches=so(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const u=so(l,s);for(const p in this.touches){const v=u[p];(!v||v.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class tl{constructor(e){this.singleTap=new Cu(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const u=this.singleTap.touchend(e,s,l);if(u){const p=e.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(u)<30;if(p&&v||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class na{constructor(e){this._tr=new Yi(e),this._zoomIn=new tl({numTouches:1,numTaps:2}),this._zoomOut=new tl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const u=this._zoomIn.touchend(e,s,l),p=this._zoomOut.touchend(e,s,l),v=this._tr;return u?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom+1,around:v.unproject(u)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:v.zoom-1,around:v.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rn{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const u=s.length?s[0]:s;return!this._moved&&u.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=u,this._move(l,u))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&G.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Pu={0:1,2:2};class rl{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=G.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const u=Pu[l];return s.buttons===void 0||(s.buttons&u)!==u}(e,this._eventButton)}isValidEndEvent(e){return G.mouseButton(e)===this._eventButton}}class zu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const il=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},Au=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new rl({checkCorrectEvent:u=>G.mouseButton(u)===0&&u.ctrlKey||G.mouseButton(u)===2});return new Rn({clickTolerance:e,move:(u,p)=>({bearingDelta:(p.x-u.x)*s}),moveStateManager:l,enable:f,assignEvents:il})},Mu=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new rl({checkCorrectEvent:u=>G.mouseButton(u)===0&&u.ctrlKey||G.mouseButton(u)===2});return new Rn({clickTolerance:e,move:(u,p)=>({pitchDelta:(p.y-u.y)*s}),moveStateManager:l,enable:f,assignEvents:il})};class ws{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new d.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const u=so(l,s),p=new d.P(0,0),v=new d.P(0,0);let w=0;for(const C in u){const z=u[C],A=this._touches[C];A&&(p._add(z),v._add(z.sub(A)),w++,u[C]=z)}if(this._touches=u,this._shouldBePrevented(w)||!v.mag())return;const T=v.div(w);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(w),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[u,p]=this._firstTwoTouches,v=ao(l,s,u),w=ao(l,s,p);if(!v||!w)return;const T=this._aroundCenter?null:v.add(w).div(2);return this._move([v,w],T,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[u,p]=this._firstTwoTouches,v=ao(l,s,u),w=ao(l,s,p);v&&w||(this._active&&G.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ao(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function Du(f,e){return Math.log(f/e)/Math.LN2}class Lu extends nl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Du(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Du(this._distance,l),pinchAround:s}}}function Ru(f,e){return 180*f.angleWith(e)/Math.PI}class Fu extends nl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const u=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ru(this._vector,u),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Ru(e,this._startVector);return Math.abs(l)<s}}function sl(f){return Math.abs(f.y)>Math.abs(f.x)}class oo extends nl{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,sl(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const u=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(u,p,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(u.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const u=e.mag()>=2,p=s.mag()>=2;if(!u&&!p)return;if(!u||!p)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const v=e.y>0==s.y>0;return sl(e)&&sl(s)&&v}}const Eh={panStep:100,bearingStep:15,pitchStep:10};class Bi{constructor(e){this._tr=new Yi(e);const s=Eh;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,u=0,p=0,v=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?u=1:(e.preventDefault(),v=-1);break;case 40:e.shiftKey?u=-1:(e.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(l=0,u=0),{cameraAnimation:w=>{const T=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:xn,zoom:s?Math.round(T.zoom)+s*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+u*this._pitchStep,offset:[-p*this._panStep,-v*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function xn(f){return f*(2-f)}const Bu=4.000244140625;class Qi{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new Yi(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=ne.now(),u=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%Bu==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(u*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=G.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?d.N.convert(this._aroundCenter?l.center:l.unproject(s)):d.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const T=this._type==="wheel"&&Math.abs(this._delta)>Bu?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*T)));this._delta<0&&C!==0&&(C=1/C);const z=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(z*C))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,u=this._easing;let p,v=!1;const w=ne.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&u&&w){const T=Math.min(w/200,1),C=u(T);p=d.y.number(l,s,C),T<1?this._frameId||(this._frameId=!0):v=!0}else p=s,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=d.b9;if(this._prevEase){const l=this._prevEase,u=(ne.now()-l.start)/l.duration,p=l.easing(u+.01)-l.easing(u),v=.27/Math.sqrt(p*p+1e-4)*.01,w=Math.sqrt(.0729-v*v);s=d.b8(v,w,.25,1)}return this._prevEase={start:ne.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class bs{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Op{constructor(e){this._tr=new Yi(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Np{constructor(){this._tap=new tl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const u=s[0],p=e.timeStamp-this._tapTime<500,v=this._tapPoint.dist(u)<30;p&&v?l.length>0&&(this._swipePoint=u,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const u=s[0],p=u.y-this._swipePoint.y;return this._swipePoint=u,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const u=this._tap.touchend(e,s,l);u&&(this._tapTime=e.timeStamp,this._tapPoint=u)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ih{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ch{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ou{constructor(e,s,l,u){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class sa{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=G.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),u=document.createElement("div");u.className="maplibregl-desktop-message",u.textContent=s,this._container.appendChild(u);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=l,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(G.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new d.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Oi=f=>f.zoom||f.drag||f.pitch||f.rotate;class qe extends d.k{}function al(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Nu{constructor(e,s){this.handleWindowEvent=u=>{this.handleEvent(u,`${u.type}Window`)},this.handleEvent=(u,p)=>{if(u.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const v=u.type==="renderFrame"?void 0:u,w={needsRenderFrame:!1},T={},C={},z=u.touches,A=z?this._getMapTouches(z):void 0,F=A?G.touchPos(this._map.getCanvas(),A):G.mousePos(this._map.getCanvas(),u);for(const{handlerName:q,handler:K,allowed:J}of this._handlers){if(!K.isEnabled())continue;let Q;this._blockedByActive(C,J,q)?K.reset():K[p||u.type]&&(Q=K[p||u.type](u,F,A),this.mergeHandlerResult(w,T,Q,q,v),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||K.isActive())&&(C[q]=K)}const j={};for(const q in this._previousActiveHandlers)C[q]||(j[q]=v);this._previousActiveHandlers=C,(Object.keys(j).length||al(w))&&(this._changes.push([w,T,j]),this._triggerRenderFrame()),(Object.keys(C).length||al(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=w;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Iu(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[u,p,v]of this._listeners)G.addEventListener(u,p,u===document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[e,s,l]of this._listeners)G.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new kh(s,e));const u=s.boxZoom=new Ti(s,e);this._add("boxZoom",u),e.interactive&&e.boxZoom&&u.enable();const p=s.cooperativeGestures=new sa(s,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const v=new na(s),w=new Op(s);s.doubleClickZoom=new bs(w,v),this._add("tapZoom",v),this._add("clickZoom",w),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const T=new Np;this._add("tapDragZoom",T);const C=s.touchPitch=new oo(s);this._add("touchPitch",C),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const z=Au(e),A=Mu(e);s.dragRotate=new Ch(e,z,A),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const F=(({enable:Q,clickTolerance:U})=>{const ie=new rl({checkCorrectEvent:ae=>G.mouseButton(ae)===0&&!ae.ctrlKey});return new Rn({clickTolerance:U,move:(ae,pe)=>({around:pe,panDelta:pe.sub(ae)}),activateOnStart:!0,moveStateManager:ie,enable:Q,assignEvents:il})})(e),j=new ws(e,s);s.dragPan=new Ih(l,F,j),this._add("mousePan",F),this._add("touchPan",j,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const V=new Fu,q=new Lu;s.touchZoomRotate=new Ou(l,q,V,T),this._add("touchRotate",V,["touchPan","touchZoom"]),this._add("touchZoom",q,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const K=s.scrollZoom=new Qi(s,()=>this._triggerRenderFrame());this._add("scrollZoom",K,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const J=s.keyboard=new Bi(s);this._add("keyboard",J),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new hr(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Oi(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const u in e)if(u!==l&&(!s||s.indexOf(u)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,u,p){if(!l)return;d.e(e,l);const v={handlerName:u,originalEvent:l.originalEvent||p};l.zoomDelta!==void 0&&(s.zoom=v),l.panDelta!==void 0&&(s.drag=v),l.pitchDelta!==void 0&&(s.pitch=v),l.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const e={},s={},l={};for(const[u,p,v]of this._changes)u.panDelta&&(e.panDelta=(e.panDelta||new d.P(0,0))._add(u.panDelta)),u.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+u.pitchDelta),u.around!==void 0&&(e.around=u.around),u.pinchAround!==void 0&&(e.pinchAround=u.pinchAround),u.noInertia&&(e.noInertia=u.noInertia),d.e(s,p),d.e(l,v);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const u=this._map,p=u._getTransformForUpdate(),v=u.terrain;if(!(al(e)||v&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:w,zoomDelta:T,bearingDelta:C,pitchDelta:z,around:A,pinchAround:F}=e;F!==void 0&&(A=F),u._stop(!0),A=A||u.transform.centerPoint;const j=p.pointLocation(w?A.sub(w):A);C&&(p.bearing+=C),z&&(p.pitch+=z),T&&(p.zoom+=T),v?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?p.center=p.pointLocation(p.centerPoint.sub(w)):p.setLocationAtPoint(j,A):(this._terrainMovement=!0,this._map._elevationFreeze=!0,p.setLocationAtPoint(j,A)):p.setLocationAtPoint(j,A),u._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const u=Oi(this._eventsInProgress),p=Oi(e),v={};for(const A in e){const{originalEvent:F}=e[A];this._eventsInProgress[A]||(v[`${A}start`]=F),this._eventsInProgress[A]=e[A]}!u&&p&&this._fireEvent("movestart",p.originalEvent);for(const A in v)this._fireEvent(A,v[A]);p&&this._fireEvent("move",p.originalEvent);for(const A in e){const{originalEvent:F}=e[A];this._fireEvent(A,F)}const w={};let T;for(const A in this._eventsInProgress){const{handlerName:F,originalEvent:j}=this._eventsInProgress[A];this._handlersById[F].isActive()||(delete this._eventsInProgress[A],T=s[F]||j,w[`${A}end`]=T)}for(const A in w)this._fireEvent(A,w[A]);const C=Oi(this._eventsInProgress),z=(u||p)&&!C;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const A=this._map._getTransformForUpdate();A.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(A)}if(l&&z){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=j=>j!==0&&-this._bearingSnap<j&&j<this._bearingSnap;!A||!A.essential&&ne.prefersReducedMotion?(this._map.fire(new d.k("moveend",{originalEvent:T})),F(this._map.getBearing())&&this._map.resetNorth()):(F(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new d.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new qe("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ph extends d.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((ne.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new d.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=d.P.convert(e).mult(-1),this.panTo(this.transform.center,d.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(d.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(d.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(d.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,d.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(d.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=me.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,u){const p={top:0,bottom:0,right:0,left:0};if(typeof(u=d.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},u)).padding=="number"){const Ae=u.padding;u.padding={top:Ae,bottom:Ae,right:Ae,left:Ae}}u.padding=d.e(p,u.padding);const v=this.transform,w=v.padding,T=new me(e,s),C=v.project(T.getNorthWest()),z=v.project(T.getNorthEast()),A=v.project(T.getSouthEast()),F=v.project(T.getSouthWest()),j=d.ba(-l),V=C.rotate(j),q=z.rotate(j),K=A.rotate(j),J=F.rotate(j),Q=new d.P(Math.max(V.x,q.x,J.x,K.x),Math.max(V.y,q.y,J.y,K.y)),U=new d.P(Math.min(V.x,q.x,J.x,K.x),Math.min(V.y,q.y,J.y,K.y)),ie=Q.sub(U),ae=(v.width-(w.left+w.right+u.padding.left+u.padding.right))/ie.x,pe=(v.height-(w.top+w.bottom+u.padding.top+u.padding.bottom))/ie.y;if(pe<0||ae<0)return void d.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const xe=Math.min(v.scaleZoom(v.scale*Math.min(ae,pe)),u.maxZoom),Ee=d.P.convert(u.offset),Be=new d.P((u.padding.left-u.padding.right)/2,(u.padding.top-u.padding.bottom)/2).rotate(d.ba(l)),$e=Ee.add(Be).mult(v.scale/v.zoomScale(xe));return{center:v.unproject(C.add(A).div(2).sub($e)),zoom:xe,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,u,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.P.convert(e)),this.transform.pointLocation(d.P.convert(s)),l,u),u,p)}_fitInternal(e,s,l){return e?(delete(s=d.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let u=!1,p=!1,v=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(u=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=d.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(p=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(v=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new d.k("movestart",s)).fire(new d.k("move",s)),u&&this.fire(new d.k("zoomstart",s)).fire(new d.k("zoom",s)).fire(new d.k("zoomend",s)),p&&this.fire(new d.k("rotatestart",s)).fire(new d.k("rotate",s)).fire(new d.k("rotateend",s)),v&&this.fire(new d.k("pitchstart",s)).fire(new d.k("pitch",s)).fire(new d.k("pitchend",s)),this.fire(new d.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,u=0){const p=d.Z.fromLngLat(e,s),v=d.Z.fromLngLat(l,u),w=v.x-p.x,T=v.y-p.y,C=v.z-p.z,z=Math.hypot(w,T,C);if(z===0)throw new Error("Can't calculate camera options with same From and To");const A=Math.hypot(w,T),F=this.transform.scaleZoom(this.transform.cameraToCenterDistance/z/this.transform.tileSize),j=180*Math.atan2(w,-T)/Math.PI;let V=180*Math.acos(A/z)/Math.PI;return V=C<0?90-V:90+V,{center:v.toLngLat(),zoom:F,pitch:V,bearing:j}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=d.e({offset:[0,0],duration:500,easing:d.b9},e)).animate===!1||!e.essential&&ne.prefersReducedMotion)&&(e.duration=0);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,C="bearing"in e?this._normalizeBearing(e.bearing,v):v,z="pitch"in e?+e.pitch:w,A="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let j=u.centerPoint.add(F);const V=u.pointLocation(j),{center:q,zoom:K}=u.getConstrained(d.N.convert(e.center||V),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(q,u);const J=u.project(V),Q=u.project(q).sub(J),U=u.zoomScale(K-p);let ie,ae;e.around&&(ie=d.N.convert(e.around),ae=u.locationPoint(ie));const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||K!==p,this._rotating=this._rotating||v!==C,this._pitching=this._pitching||z!==w,this._padding=!u.isPaddingEqual(A),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,pe),this.terrain&&this._prepareElevation(q),this._ease(xe=>{if(this._zooming&&(u.zoom=d.y.number(p,K,xe)),this._rotating&&(u.bearing=d.y.number(v,C,xe)),this._pitching&&(u.pitch=d.y.number(w,z,xe)),this._padding&&(u.interpolatePadding(T,A,xe),j=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(xe),ie)u.setLocationAtPoint(ie,ae);else{const Ee=u.zoomScale(u.zoom-p),Be=K>p?Math.min(2,U):Math.max(.5,U),$e=Math.pow(Be,1-xe),Ae=u.unproject(J.add(Q.mult(xe*$e)).mult(Ee));u.setLocationAtPoint(u.renderWorldCopies?Ae.wrap():Ae,j)}this._applyUpdatedTransform(u),this._fireMoveEvents(s)},xe=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,xe)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new d.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new d.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new d.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new d.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=d.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const u=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:u.pitch,zoom:u.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(u=>this._elevateCameraIfInsideTerrain(u)),this.transformCameraUpdate&&s.push(u=>this.transformCameraUpdate(u)),!s.length)return;const l=e.clone();for(const u of s){const p=l.clone(),{center:v,zoom:w,pitch:T,bearing:C,elevation:z}=u(p);v&&(p.center=v),w!==void 0&&(p.zoom=w),T!==void 0&&(p.pitch=T),C!==void 0&&(p.bearing=C),z!==void 0&&(p.elevation=z),l.apply(p)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new d.k("move",e)),this._zooming&&this.fire(new d.k("zoom",e)),this._rotating&&this.fire(new d.k("rotate",e)),this._pitching&&this.fire(new d.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,u=this._rotating,p=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new d.k("zoomend",e)),u&&this.fire(new d.k("rotateend",e)),p&&this.fire(new d.k("pitchend",e)),this.fire(new d.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&ne.prefersReducedMotion){const je=d.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,s)}this.stop(),e=d.e({offset:[0,0],speed:1.2,curve:1.42,easing:d.b9},e);const u=this._getTransformForUpdate(),p=u.zoom,v=u.bearing,w=u.pitch,T=u.padding,C="bearing"in e?this._normalizeBearing(e.bearing,v):v,z="pitch"in e?+e.pitch:w,A="padding"in e?e.padding:u.padding,F=d.P.convert(e.offset);let j=u.centerPoint.add(F);const V=u.pointLocation(j),{center:q,zoom:K}=u.getConstrained(d.N.convert(e.center||V),(l=e.zoom)!==null&&l!==void 0?l:p);this._normalizeCenter(q,u);const J=u.zoomScale(K-p),Q=u.project(V),U=u.project(q).sub(Q);let ie=e.curve;const ae=Math.max(u.width,u.height),pe=ae/J,xe=U.mag();if("minZoom"in e){const je=d.ac(Math.min(e.minZoom,p,K),u.minZoom,u.maxZoom),lt=ae/u.zoomScale(je-p);ie=Math.sqrt(lt/xe*2)}const Ee=ie*ie;function Be(je){const lt=(pe*pe-ae*ae+(je?-1:1)*Ee*Ee*xe*xe)/(2*(je?pe:ae)*Ee*xe);return Math.log(Math.sqrt(lt*lt+1)-lt)}function $e(je){return(Math.exp(je)-Math.exp(-je))/2}function Ae(je){return(Math.exp(je)+Math.exp(-je))/2}const ze=Be(!1);let Je=function(je){return Ae(ze)/Ae(ze+ie*je)},ht=function(je){return ae*((Ae(ze)*($e(lt=ze+ie*je)/Ae(lt))-$e(ze))/Ee)/xe;var lt},De=(Be(!0)-ze)/ie;if(Math.abs(xe)<1e-6||!isFinite(De)){if(Math.abs(ae-pe)<1e-6)return this.easeTo(e,s);const je=pe<ae?-1:1;De=Math.abs(Math.log(pe/ae))/ie,ht=()=>0,Je=lt=>Math.exp(je*ie*lt)}return e.duration="duration"in e?+e.duration:1e3*De/("screenSpeed"in e?+e.screenSpeed/ie:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=v!==C,this._pitching=z!==w,this._padding=!u.isPaddingEqual(A),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(q),this._ease(je=>{const lt=je*De,Yt=1/Je(lt);u.zoom=je===1?K:p+u.scaleZoom(Yt),this._rotating&&(u.bearing=d.y.number(v,C,je)),this._pitching&&(u.pitch=d.y.number(w,z,je)),this._padding&&(u.interpolatePadding(T,A,je),j=u.centerPoint.add(F)),this.terrain&&!e.freezeElevation&&this._updateElevation(je);const yt=je===1?q:u.unproject(Q.add(U.mult(ht(lt))).mult(Yt));u.setLocationAtPoint(u.renderWorldCopies?yt.wrap():yt,j),this._applyUpdatedTransform(u),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const u=this._onEaseEnd;delete this._onEaseEnd,u.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=ne.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=d.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(d.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const aa={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class oa{constructor(e=aa){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=G.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=G.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=G.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){G.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(u=>typeof u!="string"?"":u)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const s=this._map.style.sourceCaches;for(const u in s){const p=s[u];if(p.used||p.usedForTerrain){const v=p.getSource();v.attribution&&e.indexOf(v.attribution)<0&&e.push(v.attribution)}}e=e.filter(u=>String(u).trim()),e.sort((u,p)=>u.length-p.length),e=e.filter((u,p)=>{for(let v=p+1;v<e.length;v++)if(e[v].indexOf(u)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ju{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=G.create("div","maplibregl-ctrl");const s=G.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){G.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class kt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const u of l)if(u.id===e)return void(u.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Vu=d.Y([{name:"a_pos3d",type:"Int16",components:3}]);class jp extends d.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const u of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[u.key]=!0,this._renderableTilesKeys.push(u.key),this._tiles[u.key]||(u.posMatrix=new Float64Array(16),d.aP(u.posMatrix,0,d.X,0,d.X,0,1),this._tiles[u.key]=new Wn(u,this.tileSize));for(const u in this._tiles)l[u]||delete this._tiles[u]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const u=this._tiles[l].tileID;if(u.canonical.equals(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16),d.aP(p.posMatrix,0,d.X,0,d.X,0,1),s[l]=p}else if(u.canonical.isChildOf(e.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=u.canonical.z-e.canonical.z,w=u.canonical.x-(u.canonical.x>>v<<v),T=u.canonical.y-(u.canonical.y>>v<<v),C=d.X>>v;d.aP(p.posMatrix,0,C,0,C,0,1),d.J(p.posMatrix,p.posMatrix,[-w*C,-T*C,0]),s[l]=p}else if(e.canonical.isChildOf(u.canonical)){const p=e.clone();p.posMatrix=new Float64Array(16);const v=e.canonical.z-u.canonical.z,w=e.canonical.x-(e.canonical.x>>v<<v),T=e.canonical.y-(e.canonical.y>>v<<v),C=d.X>>v;d.aP(p.posMatrix,0,d.X,0,d.X,0,1),d.J(p.posMatrix,p.posMatrix,[w*C,T*C,0]),d.K(p.posMatrix,p.posMatrix,[1/2**v,1/2**v,0]),s[l]=p}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let u=e.overscaledZ-this.deltaZoom;if(u>l.maxzoom&&(u=l.maxzoom),u<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(u).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&s)for(;u>=l.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(u--).key);return p}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class Uu{constructor(e,s,l){this.painter=e,this.sourceCache=new jp(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,u=d.X){var p;if(!(s>=0&&s<u&&l>=0&&l<u))return 0;const v=this.getTerrainData(e),w=(p=v.tile)===null||p===void 0?void 0:p.dem;if(!w)return 0;const T=function(V,q,K){var J=q[0],Q=q[1];return V[0]=K[0]*J+K[4]*Q+K[12],V[1]=K[1]*J+K[5]*Q+K[13],V}([],[s/u*d.X,l/u*d.X],v.u_terrain_matrix),C=[T[0]*w.dim,T[1]*w.dim],z=Math.floor(C[0]),A=Math.floor(C[1]),F=C[0]-z,j=C[1]-A;return w.get(z,A)*(1-F)*(1-j)+w.get(z+1,A)*F*(1-j)+w.get(z,A+1)*(1-F)*j+w.get(z+1,A+1)*F*j}getElevationForLngLatZoom(e,s){if(!d.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:u,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,u%d.X,p%d.X,d.X)}getElevation(e,s,l,u=d.X){return this.getDEMElevation(e,s,l,u)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const u=this.painter.context,p=new d.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new gt(u,p,u.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new gt(u,new d.R({width:1,height:1}),u.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=d.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const u=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new gt(u,s.dem.getPixels(),u.gl.RGBA,{premultiply:!1}),s.demTexture.bind(u.gl.NEAREST,u.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const u=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=u?p=e.canonical.z-u:d.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const v=e.canonical.x-(e.canonical.x>>p<<p),w=e.canonical.y-(e.canonical.y>>p<<p),T=d.bc(new Float64Array(16),[1/(d.X<<p),1/(d.X<<p),0]);d.J(T,T,[v*d.X,w*d.X,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,u=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===u||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new gt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new gt(s.context,{width:l,height:u,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,u,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,u))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,v=0;p<this._coordsTextureSize;p++)for(let w=0;w<this._coordsTextureSize;w++,v+=4)s[v+0]=255&w,s[v+1]=255&p,s[v+2]=w>>8<<4|p>>8,s[v+3]=0;const l=new d.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),u=new gt(e,l,e.gl.RGBA,{premultiply:!1});return u.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=u,u}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,u=l.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),v=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),w=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),u.readPixels(p,w-v-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const T=s[0]+(s[2]>>4<<8),C=s[1]+((15&s[2])<<8),z=this.coordsIndex[255-s[3]],A=z&&this.sourceCache.getTileByID(z);if(!A)return null;const F=this._coordsTextureSize,j=(1<<A.tileID.canonical.z)*F;return new d.Z((A.tileID.canonical.x*F+T)/j+A.tileID.wrap,(A.tileID.canonical.y*F+C)/j,this.getElevation(A.tileID,T,C,F))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,u=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),u.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,u.RGBA,u.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new d.bd,l=new d.aY,u=this.meshSize,p=d.X/u,v=u*u;for(let A=0;A<=u;A++)for(let F=0;F<=u;F++)s.emplaceBack(F*p,A*p,0);for(let A=0;A<v;A+=u+1)for(let F=0;F<u;F++)l.emplaceBack(F+A,u+F+A+1,u+F+A+2),l.emplaceBack(F+A,u+F+A+2,F+A+1);const w=s.length,T=w+2*(u+1);for(const A of[0,1])for(let F=0;F<=u;F++)for(const j of[0,1])s.emplaceBack(F*p,A*d.X,j);for(let A=0;A<2*u;A+=2)l.emplaceBack(T+A,T+A+1,T+A+3),l.emplaceBack(T+A,T+A+3,T+A+2),l.emplaceBack(w+A,w+A+3,w+A+1),l.emplaceBack(w+A,w+A+2,w+A+3);const C=s.length,z=C+2*(u+1);for(const A of[0,1])for(let F=0;F<=u;F++)for(const j of[0,1])s.emplaceBack(A*d.X,F*p,j);for(let A=0;A<2*u;A+=2)l.emplaceBack(C+A,C+A+1,C+A+3),l.emplaceBack(C+A,C+A+3,C+A+2),l.emplaceBack(z+A,z+A+3,z+A+1),l.emplaceBack(z+A,z+A+2,z+A+3);return this._mesh=new Ko(e.createVertexBuffer(s,Vu.members),e.createIndexBuffer(l),d.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*d.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:u}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(u).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=d.Z.fromLngLat(e.wrap()),u=(1<<s)*d.X,p=l.x*u,v=l.y*u,w=Math.floor(p/d.X),T=Math.floor(v/d.X);return{tileID:new d.S(s,0,s,w,T),mercatorX:p,mercatorY:v}}}class Vp{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new gt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const la={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class zh{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Vp(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const u=e.sourceCaches[l].getVisibleCoordinates();for(const p of u){const v=this.terrain.sourceCache.getTerrainCoords(p);for(const w in v)this._coordsDescendingInv[l][w]||(this._coordsDescendingInv[l][w]=[]),this._coordsDescendingInv[l][w].push(v[w])}}this._coordsDescendingInvStr={};for(const l of e._order){const u=e._layers[l],p=u.source;if(la[u.type]&&!this._coordsDescendingInvStr[p]){this._coordsDescendingInvStr[p]={};for(const v in this._coordsDescendingInv[p])this._coordsDescendingInvStr[p][v]=this._coordsDescendingInv[p][v].map(w=>w.key).sort().join()}}for(const l of this._renderableTiles)for(const u in this._coordsDescendingInvStr){const p=this._coordsDescendingInvStr[u][l.tileID.key];p&&p!==l.rttCoords[u]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,u=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(la[s]&&(this._prevType&&la[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!u))return!0;if(la[this._prevType]||la[s]&&u){this._prevType=s;const p=this._stacks.length-1,v=this._stacks[p]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(bh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[p]){const C=this.pool.getObjectForId(w.rtt[p].id);if(C.stamp===w.rtt[p].stamp){this.pool.useObject(C);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),w.rtt[p]={id:T.id,stamp:T.stamp},l.context.bindFramebuffer.set(T.fbo.framebuffer),l.context.clear({color:d.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let C=0;C<v.length;C++){const z=l.style._layers[v[C]],A=z.source?this._coordsDescendingInv[z.source][w.tileID.key]:[w.tileID];l.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),l._renderTileClippingMasks(z,A),l.renderLayer(l,l.style.sourceCaches[z.source],z,A),z.source&&(w.rttCoords[z.source]=this._coordsDescendingInvStr[z.source][w.tileID.key])}}return bh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),la[s]}return!1}}const $u={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Ah=H,Up={hash:!1,interactive:!0,bearingSnap:7,attributionControl:aa,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:d.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Zu=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},$p={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zp{constructor(e,s,l=!1){this.mousedown=v=>{this.startMouse(d.e({},v,{ctrlKey:!0,preventDefault:()=>v.preventDefault()}),G.mousePos(this.element,v)),G.addEventListener(window,"mousemove",this.mousemove),G.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=v=>{this.moveMouse(v,G.mousePos(this.element,v))},this.mouseup=v=>{this.mouseRotate.dragEnd(v),this.mousePitch&&this.mousePitch.dragEnd(v),this.offTemp()},this.touchstart=v=>{v.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=G.touchPos(this.element,v.targetTouches)[0],this.startTouch(v,this._startPos),G.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.addEventListener(window,"touchend",this.touchend))},this.touchmove=v=>{v.targetTouches.length!==1?this.reset():(this._lastPos=G.touchPos(this.element,v.targetTouches)[0],this.moveTouch(v,this._lastPos))},this.touchend=v=>{v.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const u=e.dragRotate._mouseRotate.getClickTolerance(),p=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Au({clickTolerance:u,enable:!0}),this.touchRotate=(({enable:v,clickTolerance:w,bearingDegreesPerPixelMoved:T=.8})=>{const C=new zu;return new Rn({clickTolerance:w,move:(z,A)=>({bearingDelta:(A.x-z.x)*T}),moveStateManager:C,enable:v,assignEvents:Zu})})({clickTolerance:u,enable:!0}),this.map=e,l&&(this.mousePitch=Mu({clickTolerance:p,enable:!0}),this.touchPitch=(({enable:v,clickTolerance:w,pitchDegreesPerPixelMoved:T=-.5})=>{const C=new zu;return new Rn({clickTolerance:w,move:(z,A)=>({pitchDelta:(A.y-z.y)*T}),moveStateManager:C,enable:v,assignEvents:Zu})})({clickTolerance:p,enable:!0})),G.addEventListener(s,"mousedown",this.mousedown),G.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),G.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),G.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),G.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:u}=this.mouseRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.mousePitch){const{pitchDelta:p}=this.mousePitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}moveTouch(e,s){const l=this.map,{bearingDelta:u}=this.touchRotate.dragMove(e,s)||{};if(u&&l.setBearing(l.getBearing()+u),this.touchPitch){const{pitchDelta:p}=this.touchPitch.dragMove(e,s)||{};p&&l.setPitch(l.getPitch()+p)}}off(){const e=this.element;G.removeEventListener(e,"mousedown",this.mousedown),G.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend),G.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){G.enableDrag(),G.removeEventListener(window,"mousemove",this.mousemove),G.removeEventListener(window,"mouseup",this.mouseup),G.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),G.removeEventListener(window,"touchend",this.touchend)}}let ki;function Jt(f,e,s){const l=new d.N(f.lng,f.lat);if(f=new d.N(f.lng,f.lat),e){const u=new d.N(f.lng-360,f.lat),p=new d.N(f.lng+360,f.lat),v=s.locationPoint(f).distSqr(e);s.locationPoint(u).distSqr(e)<v?f=u:s.locationPoint(p).distSqr(e)<v&&(f=p)}for(;Math.abs(f.lng-s.center.lng)>180;){const u=s.locationPoint(f);if(u.x>=0&&u.y>=0&&u.x<=s.width&&u.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const ua={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ol(f,e,s){const l=f.classList;for(const u in ua)l.remove(`maplibregl-${s}-anchor-${u}`);l.add(`maplibregl-${s}-anchor-${e}`)}class ll extends d.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,u=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&u!==32&&u!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,u=this._element;this._popup&&(l===u||u.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const u=this._map.loaded()&&!this._map.isMoving();((s==null?void 0:s.type)==="terrain"||(s==null?void 0:s.type)==="render"&&!u)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Jt(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let v="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?v="rotateX(0deg)":this._pitchAlignment==="map"&&(v=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),G.setTransform(this._element,`${ua[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${v} ${p}`),ne.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.k("dragstart"))),this.fire(new d.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e==null?void 0:e.opacity,e==null?void 0:e.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=d.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=G.create("div");const s=G.createNS("http://www.w3.org/2000/svg","svg"),l=41,u=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${u}px`),s.setAttributeNS(null,"viewBox",`0 0 ${u} ${l}`);const p=G.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const v=G.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"fill-rule","nonzero");const w=G.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const J of T){const Q=G.createNS("http://www.w3.org/2000/svg","ellipse");Q.setAttributeNS(null,"opacity","0.04"),Q.setAttributeNS(null,"cx","10.5"),Q.setAttributeNS(null,"cy","5.80029008"),Q.setAttributeNS(null,"rx",J.rx),Q.setAttributeNS(null,"ry",J.ry),w.appendChild(Q)}const C=G.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill",this._color);const z=G.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),C.appendChild(z);const A=G.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"opacity","0.25"),A.setAttributeNS(null,"fill","#000000");const F=G.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),A.appendChild(F);const j=G.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const V=G.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const q=G.createNS("http://www.w3.org/2000/svg","circle");q.setAttributeNS(null,"fill","#000000"),q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"cx","5.5"),q.setAttributeNS(null,"cy","5.5"),q.setAttributeNS(null,"r","5.4999962");const K=G.createNS("http://www.w3.org/2000/svg","circle");K.setAttributeNS(null,"fill","#FFFFFF"),K.setAttributeNS(null,"cx","5.5"),K.setAttributeNS(null,"cy","5.5"),K.setAttributeNS(null,"r","5.4999962"),V.appendChild(q),V.appendChild(K),v.appendChild(w),v.appendChild(C),v.appendChild(A),v.appendChild(j),v.appendChild(V),s.appendChild(v),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",u*this._scale+"px"),this._element.appendChild(s),this._offset=d.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),ol(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),G.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=d.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const u=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(38.1-13.5+u)],"bottom-right":[-u,-1*(38.1-13.5+u)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const u=this._map,p=u.terrain.depthAtPoint(this._pos),v=u.terrain.getElevationForLngLatZoom(this._lngLat,u.transform.tileZoom);if(u.transform.lngLatToCameraDepth(this._lngLat,v)-p<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/u.transform._pixelPerMeter,T=Math.sin(u.getPitch()*Math.PI/180)*w,C=u.terrain.depthAtPoint(new d.P(this._pos.x,this._pos.y-this._offset.y)),z=u.transform.lngLatToCameraDepth(this._lngLat,v+T)-C>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&z&&this._popup.remove(),this._element.style.opacity=z?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=d.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const Mh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let lo=0,uo=!1;const wn={maxWidth:100,unit:"metric"};function co(f,e,s){const l=s&&s.maxWidth||100,u=f._container.clientHeight/2,p=f.unproject([0,u]),v=f.unproject([l,u]),w=p.distanceTo(v);if(s&&s.unit==="imperial"){const T=3.2808*w;T>5280?Ke(e,l,T/5280,f._getUIString("ScaleControl.Miles")):Ke(e,l,T,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Ke(e,l,w/1852,f._getUIString("ScaleControl.NauticalMiles")):w>=1e3?Ke(e,l,w/1e3,f._getUIString("ScaleControl.Kilometers")):Ke(e,l,w,f._getUIString("ScaleControl.Meters"))}function Ke(f,e,s,l){const u=function(p){const v=Math.pow(10,`${Math.floor(p)}`.length-1);let w=p/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(T){const C=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*C)/C}(w),v*w}(s);f.style.width=e*(u/s)+"px",f.innerHTML=`${u}&nbsp;${l}`}const at={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},ul=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cl(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new d.P(0,0),top:new d.P(0,f),"top-left":new d.P(e,e),"top-right":new d.P(-e,e),bottom:new d.P(0,-f),"bottom-left":new d.P(e,-e),"bottom-right":new d.P(-e,-e),left:new d.P(f,0),right:new d.P(-f,0)}}if(f instanceof d.P||Array.isArray(f)){const e=d.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:d.P.convert(f.center||[0,0]),top:d.P.convert(f.top||[0,0]),"top-left":d.P.convert(f["top-left"]||[0,0]),"top-right":d.P.convert(f["top-right"]||[0,0]),bottom:d.P.convert(f.bottom||[0,0]),"bottom-left":d.P.convert(f["bottom-left"]||[0,0]),"bottom-right":d.P.convert(f["bottom-right"]||[0,0]),left:d.P.convert(f.left||[0,0]),right:d.P.convert(f.right||[0,0])}}return cl(new d.P(0,0))}const qu=H;S.AJAXError=d.bh,S.Evented=d.E,S.LngLat=d.N,S.MercatorCoordinate=d.Z,S.Point=d.P,S.addProtocol=d.bi,S.config=d.a,S.removeProtocol=d.bj,S.AttributionControl=oa,S.BoxZoomHandler=Ti,S.CanvasSource=Li,S.CooperativeGesturesHandler=sa,S.DoubleClickZoomHandler=bs,S.DragPanHandler=Ih,S.DragRotateHandler=Ch,S.EdgeInsets=ra,S.FullscreenControl=class extends d.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s==null?void 0:s.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:d.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){G.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=G.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);G.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new d.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new d.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},S.GeoJSONSource=$a,S.GeolocateControl=class extends d.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new d.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new d.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new d.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,u=this._map.getBearing(),p=d.e({bearing:u},this.options.fitBoundsOptions),v=me.fromLngLat(s,l);this._map.fitBounds(v,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new d.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&uo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new d.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=G.create("button","maplibregl-ctrl-geolocate",this._container),G.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){d.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=G.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ll({element:this._dotElement}),this._circleElement=G.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ll({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new d.k("trackuserlocationend")),this.fire(new d.k("userlocationlostfocus")))})}},this.options=d.e({},Mh,f)}onAdd(f){return this._map=f,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return d._(this,arguments,void 0,function*(e=!1){if(ki!==void 0&&!e)return ki;if(window.navigator.permissions===void 0)return ki=!!window.navigator.geolocation,ki;try{ki=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ki=!!window.navigator.geolocation}return ki})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),G.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,lo=0,uo=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),u=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}trigger(){if(!this._setup)return d.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":lo--,uo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new d.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.k("trackuserlocationstart")),this.fire(new d.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),lo++,lo>1?(f={maximumAge:6e5,timeout:0},uo=!0):(f=this.options.positionOptions,uo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},S.Hash=Yo,S.ImageSource=Mn,S.KeyboardHandler=Bi,S.LngLatBounds=me,S.LogoControl=ju,S.Map=class extends Ph{constructor(f){d.bf.mark(d.bg.create);const e=Object.assign(Object.assign({},Up),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ia(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new kt,this._controls=[],this._mapId=d.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new d.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new d.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},$u),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=de.addThrottleControl(()=>this.isMoving()),this._requestManager=new Te(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=ro(u=>{this._trackResize&&!this._removed&&(this.resize(u),this.redraw())},50);this._resizeObserver=new ResizeObserver(u=>{s?l(u):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Nu(this,e),this._hash=e.hash&&new Yo(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,d.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new oa(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new ju,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new d.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new d.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new d.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new d.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new d.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],u=s[1],p=this._getClampedPixelRatio(l,u);if(this._resizeCanvas(l,u,p),this.painter.resize(l,u,p),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const T=this._getClampedPixelRatio(l,u);this._resizeCanvas(l,u,T),this.painter.resize(l,u,T)}this.transform.resize(l,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,u);const v=!this._moving;return v&&(this.stop(),this.fire(new d.k("movestart",f)).fire(new d.k("move",f))),this.fire(new d.k("resize",f)),v&&this.fire(new d.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,u=this.getPixelRatio(),p=f*u,v=e*u;return Math.min(p>s?s/p:1,v>l?l/v:1)*u}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(me.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(d.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(d.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:p=>{const v=e.filter(T=>this.getLayer(T)),w=v.length!==0?this.queryRenderedFeatures(p.point,{layers:v}):[];w.length?l||(l=!0,s.call(this,new jr(f,this,p.originalEvent,{features:w}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:v=>{const w=e.filter(T=>this.getLayer(T));(w.length!==0?this.queryRenderedFeatures(v.point,{layers:w}):[]).length?l=!0:l&&(l=!1,s.call(this,new jr(f,this,v.originalEvent)))},mouseout:v=>{l&&(l=!1,s.call(this,new jr(f,this,v.originalEvent)))}}}}{const l=u=>{const p=e.filter(w=>this.getLayer(w)),v=p.length!==0?this.queryRenderedFeatures(u.point,{layers:p}):[];v.length&&(u.features=v,s.call(this,u),delete u.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let u=0;u<l.length;u++){const p=l[u];if(p.listener===s&&p.layers.length===e.length&&p.layers.every(v=>e.includes(v))){for(const v in p.delegates)this.off(v,p.delegates[v]);return void l.splice(u,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const u in l.delegates)this.on(u,l.delegates[u]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,u=this._createDelegatedListener(f,l,s);for(const p in u.delegates){const v=u.delegates[p];u.delegates[p]=(...w)=>{this._removeDelegatedListener(f,l,s),v(...w)}}this._saveDelegatedListener(f,u);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof d.P||Array.isArray(f),u=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},u instanceof d.P||typeof u[0]=="number")s=[d.P.convert(u)];else{const p=d.P.convert(u[0]),v=d.P.convert(u[1]);s=[p,new d.P(v.x,p.y),v,new d.P(p.x,v.y),p]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=d.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new Ro(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");d.h(s,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new d.j(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){d.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():d.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new d.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&d.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Uu(this.painter,e,f),this.painter.renderToTexture=new zh(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new d.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const u=s[l];if(u.state!=="loaded"&&u.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:u=!1,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:C}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||d.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:A,data:F}=e,j=e;return this.style.addImage(f,{data:new d.R({width:z,height:A},new Uint8Array(F)),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:C,sdf:u,version:0,userImage:j}),j.onAdd&&j.onAdd(this,f),this}}{const{width:z,height:A,data:F}=ne.getImageData(e);this.style.addImage(f,{data:new d.R({width:z,height:A},F),pixelRatio:l,stretchX:p,stretchY:v,content:w,textFitWidth:T,textFitHeight:C,sdf:u,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new d.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||d.b(e)?ne.getImageData(e):e,{width:u,height:p,data:v}=l;if(u===void 0||p===void 0)return this.fire(new d.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(u!==s.data.width||p!==s.data.height)return this.fire(new d.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(e instanceof HTMLImageElement||d.b(e));return s.data.replace(v,w),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new d.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return de.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,s=>{s||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=G.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=G.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const u=this._controlContainer=G.create("div","maplibregl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{p[v]=G.create("div",`maplibregl-ctrl-${v} `,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Jo(s,this.transform),Re.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const u=this.transform.zoom,p=ne.now();this.style.zoomHistory.update(u,p);const v=new d.z(u,{now:p,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=v.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(v)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new d.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,d.bf.mark(d.bg.load),this.fire(new d.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,d.bf.mark(d.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),de.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e!=null&&e.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),G.remove(this._canvasContainer),G.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),d.bf.clearMetrics(),this._removed=!0,this.fire(new d.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ne.frameAsync(this._frameRequest).then(f=>{d.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Ah}getCameraTargetElevation(){return this.transform.elevation}},S.MapMouseEvent=jr,S.MapTouchEvent=xs,S.MapWheelEvent=Th,S.Marker=ll,S.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=d.e({},$p,f),this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),G.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),G.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=G.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){G.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=G.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},S.Popup=class extends d.E{constructor(f){super(),this.remove=()=>(this._content&&G.remove(this._content),this._container&&(G.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new d.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=G.create("div","maplibregl-popup",this._map.getContainer()),this._tip=G.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const w of this.options.className.split(" "))this._container.classList.add(w);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Jt(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let u=this.options.anchor;const p=cl(this.options.offset);if(!u){const w=this._container.offsetWidth,T=this._container.offsetHeight;let C;C=l.y+p.bottom.y<T?["top"]:l.y>this._map.transform.height-T?["bottom"]:[],l.x<w/2?C.push("left"):l.x>this._map.transform.width-w/2&&C.push("right"),u=C.length===0?"bottom":C.join("-")}let v=l.add(p[u]);this.options.subpixelPositioning||(v=v.round()),G.setTransform(this._container,`${ua[u]} translate(${v.x}px,${v.y}px)`),ol(this._container,u,"popup")},this._onClose=()=>{this.remove()},this.options=d.e(Object.create(at),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new d.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=d.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=G.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=G.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(ul);f&&f.focus()}},S.RasterDEMTileSource=nr,S.RasterTileSource=Rt,S.ScaleControl=class{constructor(f){this._onMove=()=>{co(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,co(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wn),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){G.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},S.ScrollZoomHandler=Qi,S.Style=Ro,S.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=G.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=G.create("button","maplibregl-ctrl-terrain",this._container),G.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){G.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},S.TwoFingersTouchPitchHandler=oo,S.TwoFingersTouchRotateHandler=Fu,S.TwoFingersTouchZoomHandler=Lu,S.TwoFingersTouchZoomRotateHandler=Ou,S.VectorTileSource=Ua,S.VideoSource=Us,S.addSourceType=(f,e)=>d._(void 0,void 0,void 0,function*(){if(qa(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{Za[s]=l})(f,e)}),S.clearPrewarmedResources=function(){const f=ke;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Ir),ke=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},S.getMaxParallelImageRequests=function(){return d.a.MAX_PARALLEL_IMAGE_REQUESTS},S.getRTLTextPluginStatus=function(){return gn().getRTLTextPluginStatus()},S.getVersion=function(){return qu},S.getWorkerCount=function(){return Jr.workerCount},S.getWorkerUrl=function(){return d.a.WORKER_URL},S.importScriptInWorkers=function(f){return us().broadcast("IS",f)},S.prewarm=function(){fn().acquire(Ir)},S.setMaxParallelImageRequests=function(f){d.a.MAX_PARALLEL_IMAGE_REQUESTS=f},S.setRTLTextPlugin=function(f,e){return gn().setRTLTextPlugin(f,e)},S.setWorkerCount=function(f){Jr.workerCount=f},S.setWorkerUrl=function(f){d.a.WORKER_URL=f}});var E=h;return E})})(r1);var TS=r1.exports;const Vv=$v(TS),kS=[{id:"nakalipithecus",name:" ()",year:-98e5,year_end:-95e5,lat:1.1,lon:36.6,description:"",type:"evolution"},{id:"chororapithecus",name:"",year:-8e6,year_end:-75e5,lat:9.3,lon:40.2,description:"",type:"evolution"},{id:"sahelanthropus",name:" ()",year:-7e6,year_end:-6e6,lat:16.3,lon:18,description:"",type:"evolution"},{id:"orrorin",name:"",year:-6e6,year_end:-5e6,lat:.6,lon:35.9,description:"",type:"evolution"},{id:"ardipithecus_kadabba",name:"",year:-56e5,year_end:-5e6,lat:11.5,lon:40.5,description:"",type:"evolution"},{id:"ardipithecus_ramidus",name:"",year:-44e5,year_end:-4e6,lat:11.1,lon:40.2,description:"",type:"evolution"},{id:"australopithecus_anamensis",name:"",year:-42e5,year_end:-39e5,lat:3,lon:36,description:"",type:"evolution"},{id:"kenyanthropus",name:"",year:-35e5,year_end:-32e5,lat:3.9,lon:35.9,description:"",type:"evolution"},{id:"laetoli_footprints",name:"",year:-36e5,year_end:-3e6,lat:-2.9,lon:35.2,description:"3",type:"evolution"},{id:"lomekwi_tools",name:" ()",year:-33e5,year_end:-25e5,lat:3.9,lon:35.9,description:"",type:"evolution"},{id:"lucy",name:" ()",year:-32e5,year_end:-28e5,lat:11.1,lon:40.5,description:"40%",type:"evolution"},{id:"australopithecus_africanus",name:"",year:-25e5,year_end:-2e6,lat:-24.7,lon:27.5,description:"",type:"evolution"},{id:"homo_habilis",name:" ()",year:-24e5,year_end:-14e5,lat:-3,lon:35,description:"",type:"evolution"},{id:"homo_rudolfensis",name:"",year:-24e5,year_end:-18e5,lat:4,lon:36,description:"",type:"evolution"},{id:"sediba",name:"",year:-198e4,year_end:-18e5,lat:-25.9,lon:27.8,description:"",type:"evolution"},{id:"homo_erectus_origin",name:" ()",year:-19e5,year_end:-14e4,lat:3.5,lon:36.2,description:"",type:"evolution"},{id:"dmanisi",name:" ()",year:-185e4,year_end:-1e6,lat:41.3,lon:44.2,description:"",type:"migration"},{id:"acheulean_handaxe",name:"",year:-176e4,year_end:-5e5,lat:4,lon:36,description:"",type:"evolution"},{id:"java_man",name:"",year:-15e5,year_end:-5e5,lat:-7.4,lon:110.8,description:"",type:"migration"},{id:"fire_wonderwerk",name:"",year:-1e6,year_end:-3e5,lat:-27.6,lon:23.4,description:"",type:"evolution"},{id:"gran_dolina",name:"",year:-8e5,year_end:-5e5,lat:42.3,lon:-3.5,description:"",type:"migration"},{id:"peking_man",name:"",year:-7e5,year_end:-3e5,lat:39.7,lon:115.9,description:"",type:"migration"},{id:"heidelbergensis",name:"",year:-6e5,year_end:-2e5,lat:49.3,lon:8.8,description:"",type:"evolution"},{id:"boxgrove",name:"",year:-5e5,year_end:-4e5,lat:50.8,lon:-.6,description:"",type:"migration"},{id:"atapuerca_sima",name:" ()",year:-43e4,year_end:-3e5,lat:42.3,lon:-3.5,description:"",type:"evolution"},{id:"naledi",name:"",year:-335e3,year_end:-236e3,lat:-25.9,lon:27.8,description:"",type:"evolution"},{id:"schoningen_spears",name:"",year:-3e5,year_end:-2e5,lat:52.2,lon:10.9,description:"",type:"evolution"}],ES=[{id:"jebel_irhoud",name:" ()",year:-315e3,year_end:-2e5,lat:31.8,lon:-8.8,description:"",type:"evolution"},{id:"twin_rivers",name:"()",year:-27e4,year_end:-1e5,lat:-14.4,lon:28.4,description:"",type:"evolution"},{id:"dali_man",name:" ()",year:-26e4,year_end:-2e5,lat:34.8,lon:109.4,description:"",type:"evolution"},{id:"florisbad",name:"",year:-259e3,year_end:-15e4,lat:-28.7,lon:26.1,description:"",type:"evolution"},{id:"narmada",name:"",year:-25e4,year_end:-15e4,lat:22.8,lon:77.9,description:"",type:"migration"},{id:"apidima",name:" ()",year:-21e4,year_end:-17e4,lat:36.6,lon:22.4,description:"",type:"migration"},{id:"omo_kibish",name:"",year:-195e3,year_end:-15e4,lat:5.4,lon:36,description:"",type:"evolution"},{id:"misliya",name:" ()",year:-18e4,year_end:-12e4,lat:32.7,lon:34.9,description:"",type:"migration"},{id:"pinnacle_point",name:" ()",year:-165e3,year_end:-1e5,lat:-34.2,lon:22.5,description:"",type:"evolution"},{id:"herto_man",name:"",year:-16e4,year_end:-12e4,lat:10.3,lon:40.6,description:"",type:"evolution"},{id:"singa",name:"",year:-133e3,year_end:-1e5,lat:13.1,lon:33.9,description:"",type:"evolution"},{id:"jebel_faya",name:" ()",year:-125e3,year_end:-9e4,lat:25.1,lon:55.8,description:"UAE",type:"migration"},{id:"klasies_river",name:"",year:-12e4,year_end:-6e4,lat:-34.1,lon:24.4,description:"",type:"evolution"},{id:"qafzeh",name:"",year:-1e5,year_end:-8e4,lat:32.6,lon:35,description:"",type:"evolution"},{id:"skhul",name:"",year:-9e4,year_end:-7e4,lat:32.6,lon:35,description:"",type:"migration"},{id:"katanda",name:" ()",year:-9e4,year_end:-7e4,lat:-.5,lon:29.5,description:"",type:"evolution"},{id:"sibudu",name:" ()",year:-77e3,year_end:-6e4,lat:-29.5,lon:31.1,description:"",type:"evolution"},{id:"blombos_art",name:" ()",year:-75e3,year_end:-7e4,lat:-34.4,lon:21.2,description:"",type:"evolution"},{id:"border_cave",name:"",year:-8e4,year_end:-4e4,lat:-27.1,lon:31.9,description:"",type:"evolution"},{id:"porc_epic",name:"",year:-7e4,year_end:-6e4,lat:9.6,lon:41.8,description:"",type:"evolution"}],IS=[{id:"toba_catastrophe",name:"",year:-74e3,year_end:-7e4,lat:2.6,lon:98.8,description:"",type:"evolution",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%90%E3%83%BB%E3%82%AB%E3%82%BF%E3%82%B9%E3%83%88%E3%83%AD%E3%83%95%E3%83%BB%E3%83%AC%E3%83%92%E3%83%BC%E3%83%AB"},{id:"main_out_of_africa",name:"(2)",year:-7e4,year_end:-5e4,lat:12.6,lon:43.4,description:"",type:"migration",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%82%A2%E3%83%95%E3%83%AA%E3%82%AB%E5%8D%98%E4%B8%80%E8%B5%B7%E6%BA%90%E8%AA%AC"},{id:"luzonensis",name:"",year:-67e3,year_end:-5e4,lat:17.6,lon:121.8,description:"",type:"evolution"},{id:"sahul_entry",name:" ()",year:-65e3,year_end:-45e3,lat:-12.5,lon:132.8,description:"",type:"migration"},{id:"tam_pa_ling",name:" ()",year:-63e3,year_end:-5e4,lat:20.2,lon:103.5,description:"",type:"migration"},{id:"manot_cave",name:"",year:-55e3,year_end:-45e3,lat:33,lon:35.2,description:"",type:"migration"},{id:"denisova_hybrid",name:"",year:-5e4,year_end:-4e4,lat:51.4,lon:84.7,description:"",type:"evolution"},{id:"hobbits_flores",name:" ()",year:-5e4,year_end:-4e4,lat:-8.5,lon:120.4,description:"",type:"evolution"},{id:"ust_ishim",name:"",year:-45e3,year_end:-4e4,lat:57,lon:71,description:"",type:"migration"},{id:"bacho_kiro",name:" ()",year:-45e3,year_end:-35e3,lat:42.9,lon:25.4,description:"",type:"migration"},{id:"fumane",name:"",year:-45e3,year_end:-35e3,lat:45.5,lon:10.9,description:"()",type:"migration"},{id:"sulawesi_art",name:"",year:-44e3,year_end:-3e4,lat:-5,lon:119.7,description:"()",type:"civilization"},{id:"el_castillo",name:"",year:-4e4,year_end:-3e4,lat:43.3,lon:-4,description:"",type:"civilization"},{id:"neanderthal_extinction",name:"",year:-4e4,year_end:-39e3,lat:36.1,lon:-5.3,description:"",type:"evolution"},{id:"japan_first_step",name:"",year:-38e3,year_end:-3e4,lat:35,lon:139,description:"",type:"migration"},{id:"altamira",name:"",year:-36e3,year_end:-3e4,lat:43.4,lon:-4.1,description:"",type:"civilization"},{id:"venus_hohle_fels",name:"",year:-35e3,year_end:-3e4,lat:48.4,lon:9.8,description:"",type:"civilization"},{id:"sungir",name:"",year:-34e3,year_end:-3e4,lat:56.2,lon:40.5,description:"",type:"civilization"},{id:"malta_buret",name:"",year:-24e3,year_end:-2e4,lat:52.8,lon:103.1,description:"",type:"migration"},{id:"bluefish_caves",name:"",year:-24e3,year_end:-2e4,lat:67.1,lon:-140.6,description:"()",type:"migration"},{id:"white_sands",name:"",year:-23e3,year_end:-21e3,lat:32.8,lon:-106.3,description:"",type:"migration"},{id:"last_glacial_maximum",name:" (LGM)",year:-21e3,year_end:-18e3,lat:50,lon:10,description:"",type:"evolution",sourceUrl:"https://ja.wikipedia.org/wiki/%E6%9C%80%E7%B5%82%E6%B0%B7%E6%9C%9F"},{id:"lascaux_cave",name:"",year:-17e3,year_end:-15e3,lat:45.1,lon:1.2,description:"",type:"civilization"},{id:"jomon_pottery",name:"",year:-14500,year_end:-1e3,lat:40.8,lon:140.6,description:"",type:"civilization"},{id:"monte_verde",name:"",year:-14500,year_end:-14e3,lat:-41.5,lon:-73.2,description:"",type:"migration"},{id:"paisley_caves",name:"",year:-14300,year_end:-14e3,lat:42.7,lon:-120.6,description:"",type:"migration"}],CS=[{id:"gobekli_tepe",name:" ()",year:-9600,year_end:-8e3,lat:37.2,lon:38.9,description:"",type:"civilization"},{id:"jericho_walls",name:"",year:-8500,year_end:-2e3,lat:31.9,lon:35.4,description:"",type:"civilization"},{id:"catalhoyuk",name:"",year:-7500,year_end:-5700,lat:37.6,lon:32.8,description:"",type:"civilization"},{id:"jiahu",name:"()",year:-7e3,year_end:-5e3,lat:33.6,lon:113.6,description:"",type:"civilization"},{id:"mehrgarh",name:"",year:-7e3,year_end:-2500,lat:29.4,lon:67.6,description:"",type:"civilization"},{id:"china_rice_agri",name:"",year:-6e3,year_end:-3e3,lat:29,lon:115,description:"",type:"civilization"},{id:"varna_gold",name:"",year:-4500,year_end:-4e3,lat:43.2,lon:27.9,description:"",type:"civilization"},{id:"cuneiform_writing",name:"",year:-3200,year_end:-2500,lat:31,lon:46,description:"",type:"civilization"},{id:"sumer_civilization",name:"",year:-4e3,year_end:-2e3,lat:31,lon:46,description:"",type:"civilization"},{id:"sannai_maruyama",name:"",year:-3900,year_end:-2200,lat:40.8,lon:140.6,description:"",type:"civilization"},{id:"hieroglyphs_egypt",name:" ()",year:-3100,year_end:-2e3,lat:29.9,lon:31.2,description:"",type:"civilization"},{id:"malta_temples",name:"",year:-3600,year_end:-2500,lat:36,lon:14.5,description:"",type:"civilization"},{id:"egypt_unification",name:"",year:-3100,year_end:-30,lat:29.9,lon:31.2,description:"",type:"civilization"},{id:"indus_valley",name:" ()",year:-2600,year_end:-1900,lat:27.3,lon:68.1,description:"",type:"civilization"},{id:"zero_concept_india",name:"0",year:-500,year_end:500,lat:25.3,lon:83,description:"0",type:"civilization"},{id:"shang_dynasty",name:"()",year:-1600,year_end:-1046,lat:36.1,lon:114.4,description:"",type:"civilization"},{id:"alphabet_phoenician",name:" ()",year:-1200,year_end:-800,lat:33.9,lon:35.5,description:"",type:"civilization"},{id:"olmecs",name:"",year:-1200,year_end:-400,lat:17.9,lon:-94,description:"",type:"civilization"},{id:"yayoi_revolution",name:"",year:-1e3,year_end:250,lat:33.5,lon:130.4,description:"",type:"civilization"},{id:"qin_dynasty_unification",name:" ()",year:-221,year_end:-206,lat:34.2,lon:108.9,description:"",type:"civilization"},{id:"han_silk_road",name:"",year:-206,year_end:220,lat:34.6,lon:112.4,description:"",type:"civilization"},{id:"papermaking_cai_lun",name:" ()",year:105,year_end:150,lat:34.2,lon:108.9,description:"",type:"civilization"},{id:"roman_empire_peak",name:" ()",year:27,year_end:476,lat:41.9,lon:12.5,description:"",type:"civilization"},{id:"himiko_yamatai",name:"",year:239,year_end:248,lat:33.3,lon:130.4,description:"",type:"civilization"},{id:"kofun_period_japan",name:" ()",year:400,year_end:600,lat:34.5,lon:135.5,description:"()",type:"civilization"},{id:"buddhism_japan_intro",name:" ()",year:538,year_end:600,lat:34.5,lon:135.8,description:"",type:"civilization"},{id:"tang_dynasty_golden",name:" ()",year:618,year_end:907,lat:34.2,lon:108.9,description:"",type:"civilization"},{id:"islam_golden_age",name:"",year:750,year_end:1258,lat:33.3,lon:44.4,description:"",type:"civilization"},{id:"compass_invention",name:"",year:1e3,year_end:1100,lat:31.2,lon:121.5,description:"",type:"civilization"},{id:"gunpowder_china",name:"",year:800,year_end:1e3,lat:32,lon:118.8,description:"",type:"civilization"},{id:"murasaki_shikibu_genji",name:" ()",year:1008,year_end:1020,lat:35,lon:135.8,description:"",type:"civilization"},{id:"song_dynasty_tech",name:"",year:960,year_end:1279,lat:34.8,lon:114.3,description:"",type:"civilization"},{id:"kamakura_shogunate",name:"",year:1185,year_end:1333,lat:35.3,lon:139.5,description:"",type:"civilization"},{id:"mongol_empire_expansion",name:" ()",year:1206,year_end:1368,lat:47.9,lon:106.9,description:"",type:"civilization"},{id:"black_death_europe",name:" () ",year:1347,year_end:1351,lat:48.8,lon:2.3,description:"31",type:"civilization"},{id:"zheng_he_voyages",name:"",year:1405,year_end:1433,lat:32,lon:118.8,description:"",type:"civilization"},{id:"gutenberg_printing",name:" ()",year:1440,year_end:1455,lat:50,lon:8.2,description:"",type:"civilization"},{id:"columbus_discovery",name:" ",year:1492,year_end:1506,lat:23,lon:-75,description:"",type:"migration"},{id:"oda_nobunaga_unification",name:"",year:1568,year_end:1582,lat:35.1,lon:136.2,description:"",type:"civilization"},{id:"edo_shogunate_peace",name:" ()",year:1603,year_end:1868,lat:35.7,lon:139.7,description:"",type:"civilization"},{id:"grand_canal_china",name:" ()",year:605,year_end:610,lat:34.2,lon:117.2,description:"",type:"civilization"},{id:"shotoku_taishi_reforms",name:"",year:604,year_end:622,lat:34.5,lon:135.8,description:"",type:"civilization"},{id:"genpei_war",name:" ()",year:1180,year_end:1185,lat:33.9,lon:130.9,description:"",type:"civilization"},{id:"onin_war",name:"",year:1467,year_end:1477,lat:35,lon:135.7,description:"",type:"civilization"},{id:"telescope_galileo",name:" ()",year:1609,year_end:1642,lat:43.7,lon:11.2,description:"",type:"civilization"}],PS=[{id:"principia_newton",name:" ()",year:1687.5,year_end:1750,lat:52.2,lon:.1,description:"",type:"modern"},{id:"industrial_revolution_watt",name:" ()",year:1769.1,year_end:1840,lat:55.8,lon:-4.3,description:"",type:"modern",importance:5},{id:"periodic_table_mendeleev",name:" ()",year:1869.2,year_end:1900,lat:59.9,lon:30.3,description:"",type:"modern"},{id:"radio_marconi",name:" ()",year:1895.9,year_end:1920,lat:44.4,lon:11.3,description:"",type:"modern"},{id:"television_baird",name:" ()",year:1926.1,year_end:1940,lat:51.5,lon:-.1,description:"",type:"modern"},{id:"turing_machine_concept",name:" ()",year:1936.4,year_end:1950,lat:52.2,lon:.1,description:"",type:"modern"},{id:"vaccination_jenner",name:" ()",year:1796,year_end:1820,lat:51.7,lon:-2.5,description:"",type:"modern"},{id:"telegraph_morse",name:" ()",year:1837,year_end:1860,lat:40.7,lon:-74,description:"",type:"modern"},{id:"origin_of_species_darwin",name:"()",year:1859.9,year_end:1880,lat:51.3,lon:.1,description:"",type:"modern"},{id:"meiji_restoration",name:" ()",year:1868.811,year_end:1912,lat:35.7,lon:139.7,description:"1868102398",type:"modern"},{id:"jp_first_railway",name:"",year:1872.75,year_end:1880,lat:35.6,lon:139.7,description:"",type:"modern"},{id:"meiji_constitution",name:"",year:1889.1,year_end:1900,lat:35.7,lon:139.7,description:"",type:"modern"},{id:"russo_japanese_war",name:"",year:1904.1,year_end:1905.7,lat:38.8,lon:121.2,description:"",type:"modern"},{id:"taisho_democracy",name:"",year:1912.6,year_end:1926,lat:35.7,lon:139.7,description:"",type:"modern"},{id:"great_kanto_earthquake",name:"",year:1923.67,year_end:1930,lat:35.3,lon:139.3,description:"192391",type:"modern"},{id:"telephone_bell",name:" ()",year:1876.2,year_end:1890,lat:42.4,lon:-71.1,description:"",type:"modern"},{id:"lightbulb_edison",name:" ()",year:1879.8,year_end:1900,lat:40.5,lon:-74.3,description:"24",type:"modern"},{id:"first_flight_wright",name:" ",year:1903.95,year_end:1910,lat:36,lon:-75.7,description:"3",type:"modern"},{id:"einstein_relativity",name:" ()",year:1905.5,year_end:1920,lat:46.9,lon:7.4,description:"",type:"modern"},{id:"world_war_one",name:"",year:1914.5,year_end:1918.8,lat:50.8,lon:4.4,description:"",type:"modern",importance:5},{id:"penicillin_fleming",name:" ()",year:1928.7,year_end:1945,lat:51.5,lon:-.2,description:"",type:"modern"},{id:"great_depression",name:"",year:1929.8,year_end:1939,lat:40.7,lon:-74,description:"",type:"modern"},{id:"world_war_two_start",name:" ",year:1939.67,year_end:1945.6,lat:52.2,lon:21,description:"",type:"modern",importance:5},{id:"hiroshima_nagasaki",name:"",year:1945.6,year_end:1950,lat:34.4,lon:132.5,description:"",type:"modern"},{id:"transistor_invention",name:"",year:1947.9,year_end:1960,lat:40.7,lon:-74.4,description:"IT",type:"modern",importance:5},{id:"dna_structure_watson_crick",name:"DNA",year:1953.3,year_end:1970,lat:52.2,lon:.1,description:"",type:"modern"},{id:"sputnik_space_age",name:"1 ()",year:1957.77,year_end:1965,lat:45.9,lon:63.3,description:"",type:"modern"},{id:"apollo_11_moon_landing",name:"11 ",year:1969.55,year_end:1975,lat:28.5,lon:-80.6,description:"1969720",type:"modern"},{id:"tokyo_olympics_1964",name:" (1964)",year:1964.8,year_end:1965,lat:35.6,lon:139.7,description:"",type:"modern"},{id:"osaka_expo_1970",name:" ()",year:1970.2,year_end:1970.7,lat:34.8,lon:135.5,description:"",type:"modern"},{id:"pc_revolution_apple",name:"",year:1977.3,year_end:1990,lat:37.3,lon:-122,description:"II",type:"modern"},{id:"berlin_wall_fall",name:"",year:1989.86,year_end:1991,lat:52.5,lon:13.4,description:"1989119",type:"modern"},{id:"www_invention_cern",name:"World Wide Web (WWW) ",year:1991.6,year_end:2e3,lat:46.2,lon:6,description:"CERN",type:"modern",importance:5},{id:"smartphone_iphone",name:"iPhone ()",year:2007.48,year_end:2015,lat:37.3,lon:-122,description:"2007629",type:"modern",importance:5},{id:"great_east_japan_earthquake",name:"",year:2011.2,year_end:2015,lat:38.3,lon:142.4,description:"2011311",type:"modern"},{id:"gpt3_release",name:"GPT-3 ",year:2020.4,year_end:2022,lat:37.7,lon:-122.4,description:"20205OpenAI1750AI(LLM)",type:"modern"},{id:"stable_diffusion_release",name:"AI (Stable Diffusion)",year:2022.65,year_end:2023,lat:51.5,lon:-.1,description:"20228AI",type:"modern"},{id:"chatgpt_shock",name:"ChatGPT  (AI)",year:2022.91,year_end:2024,lat:37.7,lon:-122.4,description:"20221130AI5100AI",type:"modern",importance:5},{id:"gpt4_release",name:"GPT-4 ",year:2023.2,year_end:2024,lat:37.7,lon:-122.4,description:"2023310%AI",type:"modern"},{id:"claude_release",name:"Claude  (Anthropic)",year:2023.25,year_end:2025,lat:37.7,lon:-122.4,description:"20233AIConstitutional AI",type:"modern"},{id:"gemini_release",name:"Gemini  (Google DeepMind)",year:2023.95,year_end:2026,lat:37.4,lon:-122.1,description:"20231220242AI100",type:"modern"},{id:"sora_announcement",name:"AI Sora ",year:2024.12,year_end:2026,lat:37.7,lon:-122.4,description:"202421AI",type:"modern"},{id:"future_ai_singularity",name:"AI",year:2026,year_end:2100,lat:37.5,lon:-122.1,description:"AI",type:"modern"}],zS=[{id:"trojan_war",name:" ()",year:-1194,lat:39.95,lon:26.23,description:"",type:"war"},{id:"greco_persian_wars",name:"",year:-499,year_end:-449,lat:37.98,lon:23.72,description:"",type:"war"},{id:"punic_wars",name:"",year:-264,year_end:-146,lat:36.85,lon:10.33,description:"3",type:"war"},{id:"battle_of_red_cliffs",name:"",year:208,lat:29.88,lon:113.88,description:"",type:"war"},{id:"crusades",name:"",year:1096,year_end:1291,lat:31.76,lon:35.21,description:"",type:"war"},{id:"mongol_invasions",name:"",year:1206,year_end:1368,lat:47.92,lon:106.91,description:"",type:"war"},{id:"onin_war",name:"",year:1467,year_end:1477,lat:35.01,lon:135.76,description:"",type:"war"},{id:"battle_of_sekigahara",name:"",year:1600,lat:35.36,lon:136.46,description:"",type:"war"},{id:"thirty_years_war",name:"",year:1618,year_end:1648,lat:50.08,lon:14.42,description:"",type:"war"},{id:"american_revolution",name:"",year:1775,year_end:1783,lat:39.95,lon:-75.16,description:"13",type:"war"},{id:"napoleonic_wars",name:"",year:1803,year_end:1815,lat:48.85,lon:2.35,description:"",type:"war"},{id:"american_civil_war",name:"",year:1861,year_end:1865,lat:38.89,lon:-77.03,description:"",type:"war"},{id:"boshin_war",name:"",year:1868,year_end:1869,lat:35.01,lon:135.76,description:"",type:"war"},{id:"sino_japanese_war",name:"",year:1894,year_end:1895,lat:38.91,lon:121.6,description:"",type:"war"},{id:"russo_japanese_war",name:"",year:1904,year_end:1905,lat:38.8,lon:121.26,description:"",type:"war"},{id:"world_war_1",name:"",year:1914,year_end:1918,lat:43.85,lon:18.41,description:"",type:"war"},{id:"world_war_2",name:"",year:1939,year_end:1945,lat:52.52,lon:13.4,description:"6",type:"war"},{id:"korean_war",name:"",year:1950,year_end:1953,lat:38,lon:127,description:"",type:"war"},{id:"vietnam_war",name:"",year:1955,year_end:1975,lat:14.05,lon:108.27,description:"",type:"war"},{id:"iraq_war",name:"",year:2003,year_end:2011,lat:33.31,lon:44.36,description:"",type:"war"},{id:"russo_ukrainian_war",name:"",year:2014,year_end:2026,lat:50.45,lon:30.52,description:"2022",type:"war"}],AS=[{id:"mf_mammoth",name:" (Woolly Mammoth)",year:-4e5,year_end:-1700,lat:71.9833,lon:-179.5333,description:"4000",type:"megafauna",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%82%B1%E3%83%8A%E3%82%AC%E3%83%9E%E3%83%B3%E3%83%A2%E3%82%B9"},{id:"mf_smilodon",name:" ()",year:-25e5,year_end:-1e4,lat:34.0628,lon:-118.355,description:"",type:"megafauna",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%82%B9%E3%83%9F%E3%83%AD%E3%83%89%E3%83%B3"},{id:"mf_megatherium",name:" ()",year:-4e5,year_end:-8e3,lat:-34.6037,lon:-58.3816,description:"6m4",type:"megafauna",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%A1%E3%82%AC%E3%83%86%E3%83%AA%E3%82%A6%E3%83%A0"},{id:"mf_diprotodon",name:"",year:-16e5,year_end:-46e3,lat:-28.0167,lon:137.4,description:"5",type:"megafauna",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%87%E3%82%A3%E3%83%97%E3%83%AD%E3%83%88%E3%83%89%E3%83%B3"},{id:"mf_glyptodon",name:"",year:-25e5,year_end:-1e4,lat:-23.5505,lon:-46.6333,description:"",type:"megafauna",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%82%B0%E3%83%AA%E3%83%97%E3%83%88%E3%83%89%E3%83%B3"},{id:"mf_moa",name:"",year:-25e5,year_end:1440,lat:-43.9802,lon:170.4357,description:"3.6m13",type:"megafauna",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%A2%E3%82%A2"},{id:"mf_dodo",name:"",year:-25e5,year_end:1681,lat:-20.2802,lon:57.5522,description:"",type:"megafauna",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%89%E3%83%BC%E3%83%89%E3%83%BC"}],MS=[{id:"hm_neanderthal",name:" (Homo neanderthalensis)",year:-4e5,year_end:-4e4,lat:51.2277,lon:6.9416,description:"4",type:"hominin",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%8D%E3%82%A2%E3%83%B3%E3%83%87%E3%83%AB%E3%82%BF%E3%83%BC%E3%83%AB%E4%BA%BA"},{id:"hm_denisovan",name:" (Denisovans)",year:-4e5,year_end:-3e4,lat:51.397,lon:84.676,description:"3",type:"hominin",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%87%E3%83%8B%E3%82%BD%E3%83%AF%E4%BA%BA"},{id:"hm_erectus_asia",name:" ()",year:-18e5,year_end:-1e5,lat:39.7289,lon:115.911,description:"",type:"hominin",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%9B%E3%83%A2%E3%83%BB%E3%82%A8%E3%83%AC%E3%82%AF%E3%83%88%E3%82%B9"},{id:"hm_floresiensis",name:" ()",year:-19e4,year_end:-5e4,lat:-8.5333,lon:120.45,description:"1m",type:"hominin",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%9B%E3%83%A2%E3%83%BB%E3%83%95%E3%83%AD%E3%83%BC%E3%83%AC%E3%82%B7%E3%82%A8%E3%83%B3%E3%82%B7%E3%82%B9"},{id:"hm_naledi",name:"",year:-335e3,year_end:-236e3,lat:-25.9222,lon:27.7667,description:"",type:"hominin",sourceUrl:"https://ja.wikipedia.org/wiki/%E3%83%9B%E3%83%A2%E3%83%BB%E3%83%8A%E3%83%AC%E3%83%87%E3%82%A3"}],om=[...kS,...ES,...IS,...CS,...PS,...zS,...AS,...MS],DS=[{id:"out_of_africa",name:"",year_start:-7e4,year_end:-5e4,coordinates:[[38,9],[43,12],[50,20],[60,25]]},{id:"coastal_route",name:" ()",year_start:-65e3,year_end:-45e3,coordinates:[[60,25],[75,15],[95,15],[110,0],[130,-20]]},{id:"european_entry",name:"",year_start:-45e3,year_end:-3e4,coordinates:[[45,30],[30,40],[15,48],[0,45]]},{id:"siberian_expansion",name:"",year_start:-3e4,year_end:-15e3,coordinates:[[100,50],[130,60],[170,65]]},{id:"american_entry",name:"",year_start:-15e3,year_end:-1e4,coordinates:[[170,65],[-150,60],[-120,40],[-100,20],[-70,-10],[-50,-40]]},{id:"japan_northern",name:" ()",year_start:-3e4,year_end:-15e3,coordinates:[[140,50],[142,43],[141,40]]},{id:"japan_peninsula",name:" ()",year_start:-38e3,year_end:-25e3,coordinates:[[126,37],[130,34],[135,35]]},{id:"japan_southern",name:" ()",year_start:-4e4,year_end:-3e4,coordinates:[[121,23],[125,26],[130,32]]}],LS={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Laurentid Ice Sheet",peak_year:-21e3},geometry:{type:"Polygon",coordinates:[[[-130,50],[-120,48],[-110,48],[-100,45],[-90,42],[-80,40],[-70,42],[-60,45],[-50,50],[-50,80],[-130,80],[-130,50]]]}},{type:"Feature",properties:{name:"Fennoscandian Ice Sheet",peak_year:-21e3},geometry:{type:"Polygon",coordinates:[[[-10,55],[0,53],[10,52],[20,52],[30,55],[40,60],[50,65],[60,65],[60,85],[-10,85],[-10,55]]]}},{type:"Feature",properties:{name:"Antarctic Ice Sheet (LGM)",peak_year:-21e3},geometry:{type:"Polygon",coordinates:[[[-180,-60],[180,-60],[180,-90],[-180,-90],[-180,-60]]]}}]},RS={type:"FeatureCollection",features:[{type:"Feature",properties:{name:"Beringia"},geometry:{type:"Polygon",coordinates:[[[160,60],[180,55],[-160,55],[-150,65],[-170,75],[170,75],[160,60]]]}},{type:"Feature",properties:{name:"Japan Land Bridges"},geometry:{type:"MultiPolygon",coordinates:[[[[140,55],[144,55],[146,45],[142,40],[140,45],[140,55]]],[[[125,38],[132,38],[132,32],[125,32],[125,38]]]]}},{type:"Feature",properties:{name:"Sundaland"},geometry:{type:"Polygon",coordinates:[[[95,15],[120,15],[125,5],[125,-10],[90,-10],[95,15]]]}},{type:"Feature",properties:{name:"Sahul"},geometry:{type:"Polygon",coordinates:[[[120,-10],[155,-10],[155,-45],[120,-45],[120,-10]]]}}]},FS=[{id:"jp_paleolithic",name:"",start:-4e4,end:-14e3,color:"#888"},{id:"jp_jomon",name:"",start:-14e3,end:-1e3,color:"#4caf50"},{id:"jp_yayoi",name:"",start:-1e3,end:250,color:"#ff9800"},{id:"jp_kofun",name:"",start:250,end:538,color:"#e91e63"},{id:"jp_asuka",name:"",start:538,end:710,color:"#9c27b0"},{id:"jp_nara",name:"",start:710,end:794,color:"#3f51b5"},{id:"jp_heian",name:"",start:794,end:1185,color:"#03a9f4"},{id:"jp_kamakura",name:"",start:1185,end:1333,color:"#00bcd4"},{id:"jp_muromachi",name:"",start:1336,end:1573,color:"#009688"},{id:"jp_sengoku",name:"",start:1467,end:1603,color:"#f44336"},{id:"jp_edo",name:"",start:1603,end:1868.811,color:"#fbc02d"},{id:"jp_meiji",name:"",start:1868.811,end:1912.58,color:"#ff5722"},{id:"jp_taisho",name:"",start:1912.58,end:1926.98,color:"#795548"},{id:"jp_showa",name:"",start:1926.98,end:1989.02,color:"#607d8b"},{id:"jp_heisei",name:"",start:1989.02,end:2019.33,color:"#00d4ff"},{id:"jp_reiwa",name:"",start:2019.33,end:2026,color:"#ff00ff"}],BS=[{id:"cn_xia",name:"",start:-2070,end:-1600,color:"#795548"},{id:"cn_shang",name:" ()",start:-1600,end:-1046,color:"#ff5722"},{id:"cn_zhou",name:"",start:-1046,end:-256,color:"#ffeb3b"},{id:"cn_qin",name:"",start:-221,end:-206,color:"#000000"},{id:"cn_han",name:"",start:-206,end:220,color:"#f44336"},{id:"cn_three_kingdoms",name:"",start:220,end:280,color:"#4caf50"},{id:"cn_jin",name:"",start:265,end:420,color:"#2196f3"},{id:"cn_north_south",name:"",start:420,end:589,color:"#9c27b0"},{id:"cn_sui",name:"",start:581,end:618,color:"#3f51b5"},{id:"cn_tang",name:"",start:618,end:907,color:"#ffc107"},{id:"cn_five_dynasties",name:"",start:907,end:960,color:"#607d8b"},{id:"cn_song",name:"",start:960,end:1279,color:"#8bc34a"},{id:"cn_yuan",name:"",start:1271,end:1368,color:"#00bcd4"},{id:"cn_ming",name:"",start:1368,end:1644,color:"#e91e63"},{id:"cn_qing",name:"",start:1644,end:1912,color:"#ffc107"},{id:"cn_roc",name:"",start:1912,end:1949,color:"#3f51b5"},{id:"cn_prc",name:"",start:1949,end:2026,color:"#f44336"}],OS=[{id:"w_prehistoric",name:"",start:-1e7,end:-3500,color:"#555"},{id:"w_ancient",name:"",start:-3500,end:500,color:"#ff5722"},{id:"w_medieval",name:"",start:500,end:1450,color:"#795548"},{id:"w_renaissance",name:"",start:1450,end:1750,color:"#ffeb3b"},{id:"w_industrial",name:"",start:1750,end:1945,color:"#cddc39"},{id:"w_contemporary",name:"",start:1945,end:2026,color:"#00d4ff"}],Cs=[{year:-1e7,age:15},{year:-4e6,age:18},{year:-2e6,age:22},{year:-3e5,age:25},{year:-1e5,age:28},{year:-1e4,age:30},{year:-8e3,age:20},{year:-3e3,age:25},{year:0,age:28},{year:1e3,age:30},{year:1500,age:33},{year:1800,age:35},{year:1900,age:45},{year:1950,age:48},{year:1970,age:58},{year:2e3,age:67},{year:2023,age:73},{year:2026,age:75}],NS=i=>{if(i<=Cs[0].year)return Cs[0].age;if(i>=Cs[Cs.length-1].year)return Cs[Cs.length-1].age;for(let a=0;a<Cs.length-1;a++){const h=Cs[a],y=Cs[a+1];if(i>=h.year&&i<=y.year){const b=(i-h.year)/(y.year-h.year);return Math.round(h.age+b*(y.age-h.age))}}return 30},Ps=[{year:-1e7,world:1e4},{year:-2e6,world:1e5},{year:-3e5,world:5e5},{year:-74e3,world:1e4},{year:-5e4,world:2e6},{year:-1e4,world:5e6,japan:2e4},{year:-5e3,world:2e7,japan:1e5},{year:-3e3,world:45e6,japan:2e5},{year:-1e3,world:1e8,japan:6e5},{year:1,world:2e8,japan:1e6},{year:600,world:21e7,japan:45e5},{year:1e3,world:28e7,japan:7e6},{year:1200,world:4e8,japan:1e7},{year:1400,world:35e7,japan:12e6},{year:1600,world:55e7,japan:15e6},{year:1700,world:64e7,japan:28e6},{year:1800,world:95e7,japan:3e7},{year:1868,world:13e8,japan:333e5},{year:1900,world:165e7,japan:44e6},{year:1945,world:235e7,japan:72e6},{year:1964,world:326e7,japan:97e6},{year:1989,world:52e8,japan:123e6},{year:2011,world:7e9,japan:128e6},{year:2024,world:81e8,japan:124e6},{year:2100,world:1e10,japan:7e7}],jS=i=>{if(i<=Ps[0].year)return{world:Ps[0].world,japan:0};if(i>=Ps[Ps.length-1].year){const a=Ps[Ps.length-1];return{world:a.world,japan:a.japan||0}}for(let a=0;a<Ps.length-1;a++){const h=Ps[a],y=Ps[a+1];if(i>=h.year&&i<=y.year){const b=(i-h.year)/(y.year-h.year),E=Math.round(h.world+b*(y.world-h.world));let S=0;return h.japan!==void 0&&y.japan!==void 0?S=Math.round(h.japan+b*(y.japan-h.japan)):y.japan!==void 0&&(S=Math.round(b*y.japan)),{world:E,japan:S}}}return{world:0,japan:0}},Uv=i=>i>=1e8?(i/1e8).toFixed(2)+" ":i>=1e4?(i/1e4).toFixed(1)+" ":i.toLocaleString(),zs=[{year:-1e7,temp:18},{year:-5e6,temp:17},{year:-2e6,temp:16},{year:-1e6,temp:15},{year:-3e5,temp:14.5},{year:-125e3,temp:16},{year:-74e3,temp:11},{year:-5e4,temp:13},{year:-21e3,temp:9},{year:-1e4,temp:14},{year:-6e3,temp:15.5},{year:-1e3,temp:14.8},{year:1,temp:14.5},{year:1100,temp:15},{year:1700,temp:13.8},{year:1850,temp:14},{year:2024,temp:15.2},{year:2100,temp:17.5}],VS=i=>{if(i<=zs[0].year)return zs[0].temp;if(i>=zs[zs.length-1].year)return zs[zs.length-1].temp;for(let a=0;a<zs.length-1;a++){const h=zs[a],y=zs[a+1];if(i>=h.year&&i<=y.year){const b=(i-h.year)/(y.year-h.year);return Number((h.temp+b*(y.temp-h.temp)).toFixed(1))}}return 15},vd=[{id:"evolution",name:"",min:-1e7,max:-3e5,step:1e4,color:"#ff4444"},{id:"early_sapiens",name:"",min:-3e5,max:-7e4,step:1e3,color:"#ffaa00"},{id:"great_journey",name:"",min:-7e4,max:-1e4,step:200,color:"#44ff44"},{id:"civilization",name:"",min:-1e4,max:1868,step:1,color:"#00d4ff"},{id:"modern",name:"",min:1868,max:2026,step:.1,color:"#ff00ff"}];function xd(i){if(i<0)return`${Math.abs(Math.floor(i)).toLocaleString()} BCE`;if(i>=1868){const a=Math.floor(i),h=Math.floor((i-a)*12)+1,y=Math.floor((i-a)*12%1*30)+1;return`${a} ${h} ${y}`}return`${Math.floor(i)} CE`}function US(){const[i,a]=Sr.useState(-7e6),[h,y]=Sr.useState("evolution"),[b,E]=Sr.useState(!0),[S,d]=Sr.useState(!0),[H,le]=Sr.useState(!0),[ve,ne]=Sr.useState(!0),[G,Re]=Sr.useState(!0),[Fe,Ne]=Sr.useState(!0),[It,ue]=Sr.useState(!0),[re,de]=Sr.useState(!0),[Te,Ue]=Sr.useState(!0),[Ge,We]=Sr.useState(!0),[it,Mt]=Sr.useState(!1),[pt,gt]=Sr.useState(3),[fr,Xt]=Sr.useState(null),ur=Sr.useRef(null),wt=Sr.useRef(null),Kr=vd.find(ke=>ke.id===h)||vd[0];Sr.useEffect(()=>{wt.current||!ur.current||(wt.current=new Vv.Map({container:ur.current,style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[138,38],zoom:3,renderWorldCopies:!0}),wt.current.on("load",()=>{wt.current&&(wt.current.addSource("exposed-land",{type:"geojson",data:RS}),wt.current.addLayer({id:"exposed-land-layer",type:"fill",source:"exposed-land",paint:{"fill-color":"#c2b280","fill-opacity":.3}}),wt.current.addSource("ice-sheets",{type:"geojson",data:LS}),wt.current.addLayer({id:"ice-sheet-layer",type:"fill",source:"ice-sheets",paint:{"fill-color":"#ffffff","fill-opacity":.6}}),wt.current.addSource("migrations",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),wt.current.addLayer({id:"migration-layer",type:"line",source:"migrations",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ffcc00","line-width":["interpolate",["linear"],["zoom"],1,1,6,3],"line-opacity":.6,"line-dasharray":[2,2]}}),wt.current.addSource("events",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),wt.current.addLayer({id:"event-layer",type:"circle",source:"events",paint:{"circle-radius":["match",["get","type"],"megafauna",["interpolate",["linear"],["zoom"],1,6,12,12],"hominin",["interpolate",["linear"],["zoom"],1,15,12,35],["interpolate",["linear"],["zoom"],1,6,12,12]],"circle-color":["get","color"],"circle-blur":["match",["get","type"],"hominin",.6,0],"circle-stroke-width":["match",["get","type"],"hominin",0,2],"circle-stroke-color":"#fff","circle-opacity":["match",["get","type"],"hominin",.5,.8]}}),wt.current.on("click","event-layer",ke=>{if(!ke.features||ke.features.length===0)return;const Kt=ke.features[0].properties;new Vv.Popup({closeButton:!1,className:"custom-popup"}).setLngLat(ke.lngLat).setHTML(`
            <div class="popup-content">
              <h3>${Kt.name}</h3>
              <p><strong>:</strong> ${xd(Kt.year)}</p>
              <p>${Kt.description}</p>
            </div>
          `).addTo(wt.current)}),wt.current.on("mouseenter","event-layer",()=>{wt.current&&(wt.current.getCanvas().style.cursor="pointer")}),wt.current.on("mouseleave","event-layer",()=>{wt.current&&(wt.current.getCanvas().style.cursor="")}))}))},[]),Sr.useEffect(()=>{if(!wt.current||!wt.current.isStyleLoaded())return;const Kt={type:"FeatureCollection",features:DS.filter(Ct=>i>=Ct.year_start).map(Ct=>({type:"Feature",geometry:{type:"LineString",coordinates:Ct.coordinates},properties:{}}))};wt.current.getSource("migrations").setData(Kt);const An={type:"FeatureCollection",features:(it?om.filter(Ct=>i>=Ct.year&&(re||Ct.type!=="war")&&(Te||Ct.type!=="megafauna")&&(Ge||Ct.type!=="hominin")&&(Ct.importance??3)>=pt):om.filter(Ct=>i>=Ct.year&&(Ct.year_end?i<=Ct.year_end:i<=Ct.year+1e6)&&(re||Ct.type!=="war")&&(Te||Ct.type!=="megafauna")&&(Ge||Ct.type!=="hominin")&&(Ct.importance??3)>=pt)).map(Ct=>({type:"Feature",geometry:{type:"Point",coordinates:[Ct.lon,Ct.lat]},properties:{name:Ct.name,description:Ct.description,year:Ct.year,type:Ct.type,color:Ct.type==="war"?"#ff4444":Ct.type==="megafauna"?"#8b4513":Ct.type==="hominin"?"#ff8800":"#ffcc00"}}))};wt.current.getSource("events").setData(An);const us=i<-1e4,Di=b&&us;wt.current.setPaintProperty("exposed-land-layer","fill-opacity",Di?.3:0),wt.current.setPaintProperty("ice-sheet-layer","fill-opacity",Di?.6:0)},[i,b,it]);const Or=ke=>{const Kt=vd.find(fn=>fn.id===ke);Kt&&(y(ke),a(Kt.min))},Xe=()=>{const ke=document.querySelector(".app-container");!document.fullscreenElement&&ke?ke.requestFullscreen().catch(Kt=>{console.error(`Error attempting to enable fullscreen: ${Kt.message}`)}):document.fullscreenElement&&document.exitFullscreen()},ct=FS.filter(ke=>i>=ke.start&&i<ke.end),dt=BS.filter(ke=>i>=ke.start&&i<ke.end),Tt=OS.filter(ke=>i>=ke.start&&i<ke.end),Bt=NS(i),oi=jS(i),Ir=VS(i),Nr=(()=>{const ke=[];return i>=-75e3&&i<=-71e3&&ke.push({type:"crisis",class:"crisis-toba",title:" BOTTLE NECK",desc:" / "}),i>=-26e3&&i<=-19e3&&ke.push({type:"crisis",class:"crisis-ice",title:" ICE AGE",desc:" (LGM) / "}),i>=-26e5&&i<=-23e5&&ke.push({type:"tech",class:"tech-stone",title:"    ",desc:"   "}),i>=-1e6&&i<=-7e5&&ke.push({type:"tech",class:"tech-fire",title:"    ",desc:"   "}),i>=-12e3&&i<=-8e3&&ke.push({type:"tech",class:"tech-agri",title:"    ",desc:"    "}),i>=1760&&i<=1840&&ke.push({type:"tech",class:"tech-industry",title:"    ",desc:"   "}),i>=2022&&i<=2040&&ke.push({type:"tech",class:"tech-ai",title:"    ",desc:"  AI   "}),ke})();return we.jsxs("div",{className:"app-container",children:[we.jsxs("header",{className:"app-header",children:[we.jsxs("div",{className:"logo",children:[we.jsx("span",{className:"icon",children:""}),we.jsx("h1",{children:"History Visualizer"})]}),we.jsxs("div",{className:"era-tabs",children:[vd.map(ke=>we.jsx("button",{className:`era-tab ${h===ke.id?"active":""}`,onClick:()=>Or(ke.id),style:{"--era-color":ke.color},children:ke.name},ke.id)),we.jsxs("div",{className:"detail-filter",children:[we.jsx("span",{children:":"}),we.jsx("button",{className:`detail-btn ${pt===5?"active":""}`,onClick:()=>gt(5),children:""}),we.jsx("button",{className:`detail-btn ${pt===3?"active":""}`,onClick:()=>gt(3),children:""}),we.jsx("button",{className:`detail-btn ${pt===1?"active":""}`,onClick:()=>gt(1),children:""})]}),we.jsx("button",{className:"era-tab",onClick:Xe,style:{marginLeft:"1rem",borderLeft:"1px solid rgba(255,255,255,0.1)",paddingLeft:"1.5rem"},children:" "})]})]}),we.jsxs("main",{children:[we.jsx("div",{className:"map-view",ref:ur}),Nr.map((ke,Kt)=>we.jsx("div",{className:`screen-overlay ${ke.class}`,children:we.jsxs("div",{className:`effect-banner ${ke.type}`,children:[we.jsx("div",{className:"effect-title",children:ke.title}),we.jsx("div",{className:"effect-desc",children:ke.desc})]})},Kt)),G&&we.jsxs("div",{className:"status-badge life-exp-badge",children:[we.jsx("div",{className:"badge-label",children:""}),we.jsxs("div",{className:"badge-value",children:[Bt," ",we.jsx("span",{className:"unit",children:""})]})]}),Fe&&we.jsx("div",{className:"status-badge population-badge",children:we.jsxs("div",{className:"badge-group",children:[we.jsxs("div",{className:"badge-item",children:[we.jsx("div",{className:"badge-label",children:""}),we.jsxs("div",{className:"badge-value",children:[Uv(oi.world)," ",we.jsx("span",{className:"unit",children:""})]})]}),we.jsxs("div",{className:"badge-item",children:[we.jsx("div",{className:"badge-label",children:""}),we.jsxs("div",{className:"badge-value",children:[Uv(oi.japan)," ",we.jsx("span",{className:"unit",children:""})]})]})]})}),It&&we.jsxs("div",{className:"status-badge temperature-badge",children:[we.jsx("div",{className:"badge-label",children:""}),we.jsxs("div",{className:"badge-value",children:[Ir.toFixed(1)," ",we.jsx("span",{className:"unit",children:""})]})]}),we.jsxs("aside",{className:"history-sidebar",children:[we.jsxs("div",{className:"sidebar-section",children:[we.jsx("h2",{children:"Visual Controls"}),we.jsxs("div",{className:"controls-grid",children:[we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:b,onChange:()=>E(!b)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:"Paleo View (Ice/Land)"})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:S,onChange:()=>d(!S)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:"Japan Era Labels"})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:H,onChange:()=>le(!H)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:"China Era Labels"})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:ve,onChange:()=>ne(!ve)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:"World Era Labels"})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:G,onChange:()=>Re(!G)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:""})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:Fe,onChange:()=>Ne(!Fe)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:""})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:It,onChange:()=>ue(!It)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:""})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:re,onChange:()=>de(!re)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:""})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:Te,onChange:()=>Ue(!Te)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:""})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:Ge,onChange:()=>We(!Ge)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:""})]}),we.jsxs("label",{className:"toggle-switch",children:[we.jsx("input",{type:"checkbox",checked:it,onChange:()=>Mt(!it)}),we.jsx("span",{className:"slider"}),we.jsx("span",{className:"label",children:""})]})]})]}),we.jsxs("div",{className:"sidebar-section scrollable",children:[we.jsx("h2",{children:"History Log"}),we.jsx("div",{className:"event-list",children:om.filter(ke=>i>=ke.year&&i<=(ke.year_end||ke.year+1e6)).filter(ke=>re||ke.type!=="war").filter(ke=>Te||ke.type!=="megafauna").filter(ke=>Ge||ke.type!=="hominin").filter(ke=>(ke.importance??3)>=pt).sort((ke,Kt)=>Kt.year-ke.year).map(ke=>we.jsxs("div",{className:"event-card",onClick:()=>{Xt(ke),wt.current&&wt.current.flyTo({center:[ke.lon,ke.lat],zoom:6})},children:[we.jsx("div",{className:"event-year",children:xd(ke.year)}),we.jsx("div",{className:"event-name",children:ke.name}),we.jsx("div",{className:"event-desc",children:ke.description})]},ke.id))})]})]}),fr&&we.jsx("div",{className:"modal-overlay",onClick:()=>Xt(null),children:we.jsxs("div",{className:"detail-modal",onClick:ke=>ke.stopPropagation(),children:[we.jsx("button",{className:"close-btn",onClick:()=>Xt(null),children:""}),fr.imageUrl&&we.jsx("div",{className:"modal-image",children:we.jsx("img",{src:fr.imageUrl,alt:fr.name})}),we.jsxs("div",{className:"modal-content",children:[we.jsx("div",{className:"modal-era-tag",children:fr.type.toUpperCase()}),we.jsx("div",{className:"modal-year",children:xd(fr.year)}),we.jsx("h2",{className:"modal-title",children:fr.name}),we.jsx("p",{className:"modal-description",children:fr.description}),fr.sourceUrl&&we.jsx("div",{className:"modal-footer",children:we.jsx("a",{href:fr.sourceUrl,target:"_blank",rel:"noopener noreferrer",className:"source-button",children:"Wikipedia "})})]})]})})]}),we.jsx("footer",{children:we.jsxs("div",{className:"timeline-container",children:[we.jsxs("div",{className:"era-overlays",children:[we.jsxs("div",{className:`era-row japan-eras ${S?"visible":""}`,children:[we.jsx("div",{className:"era-label",children:"Japan"}),we.jsx("div",{className:"era-name-display",children:ct.map(ke=>we.jsx("div",{className:"era-tag",style:{color:ke.color},children:ke.name},ke.id))})]}),we.jsxs("div",{className:`era-row china-eras ${H?"visible":""}`,children:[we.jsx("div",{className:"era-label",children:"China"}),we.jsx("div",{className:"era-name-display",children:dt.map(ke=>we.jsx("div",{className:"era-tag",style:{color:ke.color},children:ke.name},ke.id))})]}),we.jsxs("div",{className:`era-row world-eras ${ve?"visible":""}`,children:[we.jsx("div",{className:"era-label",children:"World"}),we.jsx("div",{className:"era-name-display",children:Tt.map(ke=>we.jsx("div",{className:"era-tag",style:{color:ke.color},children:ke.name},ke.id))})]})]}),we.jsxs("div",{className:"controls",children:[we.jsx("div",{className:"year-display",children:xd(i)}),we.jsx("input",{type:"range",min:Kr.min,max:Kr.max,step:Kr.step,value:i,onChange:ke=>a(parseFloat(ke.target.value)),className:"timeline-slider",style:{"--accent-color":Kr.color}})]})]})})]})}lm.createRoot(document.getElementById("root")).render(we.jsx(db.StrictMode,{children:we.jsx(US,{})}));
