# 人類史シミュレーター（-1000万年〜現在）要件定義・MVP仕様書 v0.1

作成日: 2026-02-20  
対象: Webアプリ（PC/スマホ対応）  
目的: スライダーで年代を自由に操作し、**大陸形状の変化**・**人類の拡散/分岐**・**文明/文化圏の成立**・**平均寿命推移**を、動画的に動くインタラクティブ体験として提供する。

---

## 0. 用語と前提

- **年（t）**: スライダーで指定する「基準年」。BCは負の値で扱う（例: 紀元前1万年 = -10000）。
- **Paleomap（背景）**: 大陸・海岸線・氷床などの「舞台」を年代に応じて切替表示する背景レイヤー。
- **集団（Population / Lineage）**: 民族断定を避けるため、MVPでは「人類集団」や「系統」など**中立的ラベル**で扱う。
- **文化圏/文明（Culture/Civilization）**: 定住・都市・交易などの要素をもつ広義の文化単位。国境再現はMVP外。

---

## 1. 目的（Why）

1. **理解の促進**  
   長大な時間軸（-1000万年〜現在）を、地図とグラフで直感的に把握できる。
2. **体験としての面白さ**  
   “動画のように動く”タイムラインを触っているだけで、発見がある。
3. **拡張可能な土台**  
   将来的に「疫病・戦争・技術革新などの因果」や「反実仮想（IF）」にも拡張できる構造にする。

---

## 2. スコープ（MVPでやる / やらない）

### 2.1 MVPでやる（Must）
- **タイムスライダー**
  - 任意年へジャンプ（ドラッグ）
  - 再生/停止
  - 速度変更（例: 0.5x / 1x / 2x / 5x）
  - 現在年表示（例: `t = -12000`）
- **Paleomap（背景）切替**
  - 年代スライス（タイムスライス）ごとに背景が切り替わる
  - 切替はフェード（視覚的に“動いて見える”）
- **人類拡散レイヤー（概念表現）**
  - 集団コア（点）+ 影響半径（ぼかし/円）
  - 移動フロー（矢印/流線）
  - 表示対象期間: 例 **-300000〜-10000**（調整可）
- **文明/文化圏レイヤー（コアのみ）**
  - 代表的な文明/文化圏を点または簡易領域で表示
  - 表示対象期間: **-10000〜現在**
- **平均寿命グラフ（世界推定）**
  - 年代に応じた推移ライン（最低限 mean）
  - 地図スライダーと同期する縦線カーソル
- **情報カード（クリック）**
  - 地図上の要素をクリック → 右パネルに説明表示（名称/期間/要点）

### 2.2 MVPでやらない（Won’t）
- プレート運動の厳密なベクタ変形（GPlates的）
- 国境の精密再現（現代国家の境界など）
- 人口の精密推定（ヒートマップの精度追求）
- 疫病・戦争・技術革新の因果シミュレーション（Phase2以降）
- 反実仮想分岐（IF世界線）（Phase3以降）

---

## 3. 体験要件（UX）

### 3.1 画面レイアウト（案）
- **中央**: 世界地図（Map）
- **右**: 情報パネル（Info Panel）
- **下**: タイムライン領域
  - 上段: スライダー + 再生/停止 + 速度
  - 下段: 平均寿命グラフ（同期カーソル）
- **左上**: レイヤーON/OFF（背景 / 人類拡散 / 文明・文化圏 / 寿命）
- **右上（任意・簡易）**: 検索（名称入力→対象へジャンプ）

### 3.2 操作フロー（主要）
1. ユーザーがスライダーを動かす  
   → 地図背景・レイヤー表示・寿命グラフカーソルが同期
2. 再生ボタンを押す  
   → 年が自動で進む（速度変更可能）
3. 地図上の点/領域をクリック  
   → 右パネルに説明カードが出る
4. レイヤーをON/OFF  
   → 表示密度を自分で調整できる

### 3.3 “動画的に見える”最低条件
- 背景切替フェード
- 点・ラベルのフェードイン/アウト
- フローのアニメ（粒子 or 進行エフェクトはMVPで簡易でも可）

---

## 4. 機能要件（Functional Requirements）

### FR-1: 時間制御（Time Controller）
- `t`（年）を単一の真実のソースとして保持
- UIから `t` を変更可能（ドラッグ・再生）
- `t` の変更に応じて、各レイヤーが `getState(t)` で状態更新

### FR-2: Paleomap背景
- `paleomap_slices`（年→画像URL）により、最も近いスライスを選択
- スライス間の遷移でフェードを入れる

### FR-3: 人類拡散レイヤー
- `human_nodes` のうち `year_start <= t <= year_end` を表示
- `human_flows` のうち `year_start <= t <= year_end` を表示
- 不確実性は「半径」「透明度」「ぼかし」で表現（断定を避ける）

### FR-4: 文明/文化圏レイヤー
- `cultures` のうち `year_start <= t <= year_end` を表示
- 表現は点（中心）または簡易領域（ポリゴン）
- 文化圏名の表示はズームに応じて間引く（ラベル密度制御）

### FR-5: 平均寿命グラフ
- `life_expectancy` の時系列を描画
- `t` と同期する縦線カーソル
- データが疎でも補間して滑らかに表示（見せ方優先）

### FR-6: 情報パネル
- 地図要素クリックで詳細表示
- 表示項目（最低限）
  - 名称 / 期間 / 概要（3〜8行）
  - タグ（例: 農耕/都市/交易/文字 など）

---

## 5. 非機能要件（NFR）

- **パフォーマンス**: スマホでもスライダーが引っかからない（目安: 30fps以上を維持）
- **初期ロード**: MVPは静的配信でOK（データは段階ロード可）
- **拡張性**: データの追加で新レイヤーを増やせる設計（`getState(t)` パターン）
- **倫理/センシティブ対応**
  - 「民族断定」を避け、MVPは「集団/文化圏/言語/系統」など中立表現を優先
  - 不確実性はUI上でも“レンジ/ぼかし”で表現

---

## 6. データ設計（MVPスキーマ）

> 形式: JSON / GeoJSON（まずは静的ファイル）  
> 将来: タイル化（PMTiles等）で高速化

### 6.1 paleomap_slices.json
```json
{
  "slices": [
    { "year": -10000000, "raster_url": "paleomap/-10000000.png" },
    { "year": -5000000,  "raster_url": "paleomap/-5000000.png" },
    { "year": -2000000,  "raster_url": "paleomap/-2000000.png" },
    { "year": -500000,   "raster_url": "paleomap/-500000.png" },
    { "year": -20000,    "raster_url": "paleomap/-20000.png" },
    { "year": -10000,    "raster_url": "paleomap/-10000.png" },
    { "year": -6000,     "raster_url": "paleomap/-6000.png" },
    { "year": 0,         "raster_url": "paleomap/0.png" },
    { "year": 1000,      "raster_url": "paleomap/1000.png" },
    { "year": 1500,      "raster_url": "paleomap/1500.png" },
    { "year": 1800,      "raster_url": "paleomap/1800.png" },
    { "year": 2026,      "raster_url": "paleomap/2026.png" }
  ]
}
```

### 6.2 human_nodes.json / human_flows.json（概念モデル）
```json
{
  "nodes": [
    {
      "id": "africa_core",
      "name": "初期集団（アフリカ）",
      "year_start": -300000,
      "year_end": -60000,
      "lon": 30.0,
      "lat": 0.0,
      "radius_km": 1200,
      "note": "MVPでは概念表現。詳細な系統断定はしない。"
    }
  ]
}
```

```json
{
  "flows": [
    {
      "from_id": "africa_core",
      "to_id": "eurasia_entry",
      "year_start": -120000,
      "year_end": -60000,
      "intensity": 0.7
    }
  ]
}
```

### 6.3 cultures.geojson（文明・文化圏）
- 点中心だけなら `Point` を基本にし、必要なものだけ `Polygon` を入れる

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "id": "sumer",
        "name": "シュメール（メソポタミア）",
        "year_start": -3500,
        "year_end": -2000,
        "tags": ["都市", "文字", "交易"],
        "summary": "南メソポタミアで都市国家が発展。楔形文字、灌漑農業。"
      },
      "geometry": { "type": "Point", "coordinates": [44.4, 31.3] }
    }
  ]
}
```

### 6.4 life_expectancy.json（平均寿命）
- MVPは世界平均（推定）でよい。将来 `region` を追加して多系列化。

```json
{
  "series": [
    { "year": -10000, "world_mean": 25 },
    { "year": -5000,  "world_mean": 26 },
    { "year": 0,      "world_mean": 28 },
    { "year": 1000,   "world_mean": 30 },
    { "year": 1800,   "world_mean": 32 },
    { "year": 1900,   "world_mean": 36 },
    { "year": 1950,   "world_mean": 46 },
    { "year": 2000,   "world_mean": 66 },
    { "year": 2020,   "world_mean": 73 }
  ]
}
```

---

## 7. 初期データ最小セット（提案）

### 7.1 Paleomap 年代スライス（まずは12枚）
- -10,000,000
- -5,000,000
- -2,000,000
- -500,000
- -20,000（最終氷期付近）
- -10,000
- -6,000
- 0
- 1000
- 1500
- 1800
- 2026

> まずは「変化がわかる」スライスで十分。細分化はPhase2で増やす。

### 7.2 人類拡散（ノード例 8〜12 / フロー例 10〜18）
- Africa core（-300k〜）
- Eurasia entry（-120k〜）
- South Asia（-70k〜）
- SE Asia（-60k〜）
- Sahul/Oceania（-50k〜）
- Europe（-45k〜）
- Siberia（-30k〜）
- Americas entry（-20k〜）
- North America / South America（-15k〜）

> MVPは概念表現。位置・年は「粗く整合」が取れていればOK。

### 7.3 文明/文化圏（まずは20件）
例（コア候補）
- シュメール
- 古代エジプト
- インダス
- 黄河流域（殷など：MVPは“候補/概略”表記）
- メソアメリカ（オルメカ/マヤ前史など）
- アンデス（カラル/チャビンなどの概略）
- 地中海（ミノア/ミケーネ概略）
- 北米先住文化圏（広域ラベルとして）

> 「文化圏」として広域ラベルにすると荒さを吸収できる。

### 7.4 平均寿命
- MVPは世界平均1本
- Phase2で地域別（アフリカ/ユーラシア/アメリカ等）を追加

---

## 8. アーキテクチャ（実装方針）

### 8.1 技術スタック（推奨）
- UI: React + TypeScript
- 地図: MapLibre GL
- 表現強化（任意）: deck.gl（フロー/粒子/アーク）
- グラフ: d3 or lightweight chart（MVPはシンプル優先）
- 状態管理: `t` を中心に、各レイヤーが `getState(t)` で更新

### 8.2 レイヤー更新の基本設計
- `t` の変更 → 各レイヤーが表示対象をフィルタ
- データ差替えよりも **スタイル更新（opacity/size）** を優先（軽い）

### 8.3 パフォーマンス施策（必要になったら）
- フローアニメが重い場合: WebWorker
- 大量データ化: タイル化（PMTiles）/ 遅延ロード

---

## 9. 実装タスク（1〜2週間のチェックリスト）

### Week 1: “動く骨格”を作る
- [ ] リポジトリ作成（React + TS）
- [ ] MapLibre の地図表示
- [ ] タイムコントローラ（tの状態管理、スライダーUI）
- [ ] 再生/停止 + 速度変更
- [ ] Paleomapスライス切替（フェード）
- [ ] 情報パネル（クリックで表示する枠だけ先に）

### Week 2: レイヤーとグラフを入れる
- [ ] 人類ノード表示（点+半径）
- [ ] 人類フロー表示（線/矢印、簡易アニメ）
- [ ] 文化圏表示（点 or 簡易領域）
- [ ] クリック判定 → 情報パネルにカード表示
- [ ] 平均寿命グラフ（同期カーソル）
- [ ] レイヤーON/OFF（UI）
- [ ] ラベル密度制御（ズームで間引き）
- [ ] 最低限のレスポンシブ対応（スマホで操作できる）

---

## 10. 受け入れ条件（Done Definition）
- スライダー操作で背景が年代に応じて切り替わる（フェード付き）
- -300k〜の範囲で人類拡散レイヤーが表示される（点＋フロー）
- -10k〜の範囲で文明/文化圏が表示される
- 平均寿命グラフが表示され、年カーソルが同期して動く
- クリックで右パネルに説明が出る
- 再生/停止・速度変更が動作する
- スマホで最低限操作可能（ドラッグでt変更できる）

---

## 11. リスクと対策
- **歴史/民族のセンシティブさ**
  - 対策: 中立ラベル（集団/文化圏/系統）、不確実性の可視化（ぼかし/レンジ）
- **データの正確性要求が膨らむ**
  - 対策: MVPは「概略・出典付き」で成立させ、精度はPhase2で上げる
- **-1000万年の“価値”が薄くなる**
  - 対策: Paleomapと氷期表現を強め、舞台としての納得感を出す

---

## 12. 次フェーズ（参考）
- Phase2: 氷床・気候帯・人口（概略）・疫病/技術イベント（注釈）
- Phase3: 介入シミュ（IF）、プレート変形、地域別寿命・人口推定

---

## 付録: オープン事項（あとで決めればOK）
- 年の表記（BC/AD表示に変換するUI）
- 年の刻み（連続/スナップ、ログスケール導入の是非）
- 背景地図の入手方法（画像作成/ライセンス）
- 表示する文明/文化圏の一次リスト（20→100へ拡張）
